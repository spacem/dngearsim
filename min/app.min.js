"use strict";!function(){function l(l){l.when("/about",{templateUrl:"ui/about/about.html",controller:"AboutCtrl as about"}).when("/setup",{templateUrl:"ui/nav/setup.html",controller:"SetupCtrl"}).when("/test",{templateUrl:"ui/nav/test.html",controller:"TestCtrl"}).when("/items",{templateUrl:"ui/search/everything-search.html",controller:"ItemsCtrl as items",reloadOnSearch:!1}).when("/",{templateUrl:"ui/welcome.html"}).when("/builds",{templateUrl:"ui/builds/build-list.html",controller:"BuildListCtrl as buildList"}).when("/build",{templateUrl:"ui/builds/build-list.html",controller:"BuildListCtrl as buildList"}).when("/view-group",{templateUrl:"ui/builds/view-group.html",controller:"ViewGroupCtrl"}).when("/edit-build",{templateUrl:"ui/builds/edit-build.html",controller:"EditBuildCtrl as editGroup"}).when("/new-build",{templateUrl:"ui/builds/edit-build.html",controller:"EditBuildCtrl as editGroup"}).when("/delete-build",{templateUrl:"ui/builds/delete-build.html",controller:"DeleteBuildCtrl as deleteBuild"}).when("/reload-build",{templateUrl:"ui/builds/reload-build.html",controller:"ReloadBuildCtrl as ctrl"}).when("/search",{templateUrl:"ui/search/search.html",controller:"ItemSearchCtrl as ctrl",reloadOnSearch:!1}).when("/item",{templateUrl:"ui/item/item.html",controller:"ItemCtrl"}).when("/item",{templateUrl:"ui/item/item.html",controller:"ItemCtrl"}).when("/export",{templateUrl:"ui/nav/export.html",controller:"ExportCtrl"}).when("/talismans",{templateUrl:"ui/builds/build-talismans.html",controller:"BuildTalismansCtrl as ctrl"}).when("/publish",{templateUrl:"ui/online/publish.html",controller:"PublishCtrl as ctrl"}).when("/profile",{templateUrl:"ui/online/profile.html",controller:"ProfileCtrl as ctrl"}).when("/published",{templateUrl:"ui/online/published.html",controller:"PublishedCtrl as ctrl"}).when("/import",{templateUrl:"ui/builds/build-import.html",controller:"BuildImportCtrl as ctrl"}).when("/published",{templateUrl:"ui/online/published.html",controller:"PublishedCtrl as ctrl"}).when("/build-search",{templateUrl:"ui/online/build-search.html",controller:"BuildSearchCtrl as ctrl"}).otherwise({redirectTo:"/"})}angular.module("dnsim").config(["$routeProvider",l])}();
"use strict";!function(){angular.module("dnsim").controller("AboutCtrl",["$window",function(t){document.body.className="default-back",t.document.title="dngearsim | ABOUT/FAQ"}])}();
"use strict";!function(){angular.module("dnsim").filter("escape",[function(){function n(n){return n?window.encodeURIComponent(n):""}return n}])}();
"use strict";!function(){angular.module("dnsim").filter("percentage",[function(){function n(n){return"number"==typeof n?Math.round(100*n*100)/100+"%":n}return n.$stateful=!1,n}])}();
"use strict";angular.module("dnsim").controller("buildActionsCtrl",["$location","saveHelper","exportLinkHelper",function(i,e,t){var l=this;this.deleteGroup=function(){i.path("/delete-build"),i.search("name",l.buildName)},this.editGroup=function(){i.path("/edit-build"),i.search("buildName",l.buildName)},this.copyGroup=function(){var t=e.importGroup(l.buildName,l.build.items);e.saveBuild(t,t,l.build),i.path("/build"),i.search("buildName",t)},this.reloaded=!1,this.reloadGroup=function(){i.path("/reload-build"),i.search("name",l.buildName)},this.setShortUrl=function(){if(l.build){var i=t.createGroupLink(l.buildName,l.build);l.build.shortUrl=sessionStorage.getItem(i)}},this.setShortUrl()}]).directive("dngearsimBuildActions",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build",onChange:"&onChange"},controller:"buildActionsCtrl",controllerAs:"buildActions",templateUrl:"ui/builds/build-actions.html"}});
"use strict";angular.module("dnsim").controller("buildExportActionCtrl",["$timeout","$location","hCodeValues","statHelper","itemCategory","saveHelper","exportLinkHelper","groupHelper","translations","dntData","dntReset",function(t,e,l,r,i,o,n,u,a,d,s){function c(){var t=new Blob([JSON.stringify(p.build,null,1)],{type:"text/plain;charset=utf-8"});saveAs(t,"dngearsim-"+p.buildName+".json")}var p=this;p.export=c}]).directive("dngearsimBuildExportAction",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build"},controller:"buildExportActionCtrl",controllerAs:"ctrl",templateUrl:"ui/builds/build-export-action.html"}});
"use strict";angular.module("dnsim").controller("BuildImportCtrl",["$timeout","$location","hCodeValues","statHelper","itemCategory","saveHelper","exportLinkHelper","groupHelper","translations","dntData","dntReset",function(e,l,t,i,a,r,n,o,u,d,s){function m(l){var t=l.target.files;if(console.log("importing files",t),t&&t.length){var i=t[0].name,a=new FileReader;a.readAsText(t[0]),a.onload=function(){b.build=JSON.parse(a.result),i&&i.length>5?(b.buildName=i.substr(0,i.length-5),b.buildName=b.buildName.replace("dngearsim-","")):b.buildName="imported build",e()}}}function p(){var e=r.importGroup(b.buildName,b.build.items);r.saveBuild(e,e,b.build),l.path("/build"),l.search("buildName",e)}var b=this;b.onFileChange=m,b.copyLocally=p}]);
"use strict";function buildItemListController(e,n,t){var a=this;a.getCategoryItems=function(){var e=n.getItemsByCategory(a.build.items);return a.category.name in e?e[a.category.name]:[]};var i={},r="";a.getSubCategories=function(){if(r!=a.category.name){i={},r=a.category.name;var e=[],t=a.build.items.sort(function(e,n){return e.exchangeType-n.exchangeType});if("increasing gems"==a.category.name)e=_.filter(t,function(e){return e.increasingGemSlots>0});else if("offensive gems"==a.category.name)e=_.filter(t,function(e){return e.offensiveGemSlots>0});else if("imprint"==a.category.name){var o=n.byName("costume");e=_.filter(t,function(e){return n.isItemForCat(o,e)})}_.each(e,function(e){e.exchangeType in i||(i[e.exchangeType]={names:[],slots:0,exchangeType:e.exchangeType}),i[e.exchangeType].names.push(e.name),"increasing gems"==a.category.name?i[e.exchangeType].slots+=e.increasingGemSlots:"offensive gems"==a.category.name?i[e.exchangeType].slots+=e.offensiveGemSlots:i[e.exchangeType].slots=1}),i[0]=null}return i},a.getNumTaken=function(n){var t,i=0;if("imprint"==a.category.name)t=n.exchangeType;else{t=_.find(e.gemExchanges,function(e){return e.exchange==n.exchangeType}).id}if(t){var r=a.getCategoryItems();_.each(r,function(e){e.gemSlot==t&&++i})}return i},a.isInSubCat=function(n,t){if(!t&&!n.gemSlot)return!0;var i;if("imprint"==a.category.name)i=n.gemSlot;else{var r=_.find(e.gemExchanges,function(e){return e.id==n.gemSlot});r&&(i=r.exchange)}if(t||!i)return!(!t||!i)&&i==t.exchangeType;var o=a.getSubCategories();return!_.find(o,function(e){return null!=e&&i==e.exchangeType})||void 0},a.canMove=function(){return"increasing gems"==a.category.name||"offensive gems"==a.category.name||"imprint"==a.category.name},a.getGemSlot=function(n){if("imprint"==a.category.name)return n.exchangeType;if(n){var t=_.find(e.gemExchanges,function(e){return e.exchange==n.exchangeType});return t||console.log("cannot find exchange for",n),t.id}},a.move=function(e,n){e.gemSlot=a.getGemSlot(n),t.updatedSavedItems(a.buildName,a.build.items),a.handleChange()},a.allowMoreItems=function(){return!a.category.maxCat||a.getCategoryItems().length<a.category.maxCat},a.handleChange=function(){r="",a.onChange()},a.handleItemEdit=function(){t.updatedSavedItems(a.buildName,a.build.items),a.handleChange()},a.cancelEdit=function(){a.onChange()},a.canEdit=function(e){return"custom"==e.typeName||"weapons"==e.typeName||"armour"==e.typeName||"offensive gems"==e.typeName||"increasing gems"==e.typeName},a.removeItem=function(e){r="",e.removeItem=!0;var n=[];angular.forEach(a.build.items,function(e,t){e&&!e.removeItem&&n.push(e)}),a.build.items=n,t.updatedSavedItems(a.buildName,n),a.handleChange()}}buildItemListController.$inject=["hCodeValues","itemCategory","saveHelper"],angular.module("dnsim").directive("dngearsimBuildItemList",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build",category:"=category",server:"=server",onChange:"&onChange"},controller:buildItemListController,controllerAs:"buildCtrl",templateUrl:"ui/builds/build-item-list.html"}});
"use strict";angular.module("dnsim").controller("buildItemCtrl",["$timeout","statHelper","saveHelper","hCodeValues",function(t,e,l,i){function m(t){if(t.gemSlot)for(var e=0;e<a.gemSlots.length;++e)if(a.gemSlots[e].id==t.gemSlot)return a.gemSlots[e].name}function n(){a.item.fullStats=a.item.stats,null!=a.item.enchantmentStats&&a.item.enchantmentStats.length>0&&(a.item.fullStats=i.mergeStats(a.item.enchantmentStats,a.item.fullStats)),null!=a.item.sparkStats&&a.item.sparkStats.length>0&&(a.item.fullStats=i.mergeStats(a.item.sparkStats,a.item.fullStats))}var a=this;a.updateItem=n,a.gemSlots=i.gemExchanges,a.getGemSlotName=m}]).directive("dngearsimBuildItem",function(){return{scope:!0,bindToController:{item:"=item",editMode:"=editMode",onChange:"&onChange",cancelEdit:"&cancelEdit"},controller:"buildItemCtrl",controllerAs:"ctrl",templateUrl:"ui/builds/build-item.html"}});
"use strict";angular.module("dnsim").controller("BuildListCtrl",["$window","$location","$routeParams","$timeout","saveHelper",function(e,t,s,u,i){var r=this;document.body.className="saved-back",this.setupBuilds=function(){r.savedItems=i.getSavedItems(),r.buildNames=Object.keys(r.savedItems).sort(),r.builds=[];for(var e=0;e<r.buildNames.length;++e)r.builds.push({name:r.buildNames[e],build:r.savedItems[r.buildNames[e]]})},this.setupBuilds(),"buildName"in s?s.buildName in r.savedItems?s.buildName!=this.currentGroup&&(this.currentGroup=s.buildName,i.saveBuildSelection(this.currentGroup,this.savedItems)):this.currentGroup=null:this.currentGroup&&this.currentGroup in this.savedItems?(t.path("/build"),t.search("buildName",this.currentGroup)):this.currentGroup=null,this.currentGroup?e.document.title="dngearsim | "+this.currentGroup:e.document.title="dngearsim | BUILDS",this.anyItems=function(){return Object.keys(this.savedItems).length>0},this.createGroup=function(){t.path("/new-build")},this.handleChange=function(){r.setupBuilds(),u()},this.toggleGroup=function(e){i.saveBuildSelection(e,this.savedItems),t.url("/build?buildName="+encodeURIComponent(e))},this.publish=function(){t.url("/publish")},this.search=function(){t.url("/build-search")}}]);
"use strict";function buildStatsController(t,l){var r=this;r.exportStatCard=function(){var t=l.convertStats(r.build,r.buildName,r.stats.calculatedStats),a=l.cardImportUrl+"?dngsimport="+btoa(JSON.stringify(t));window.open(a)}}buildStatsController.$inject=["statHelper","dvStatcardHelper"],angular.module("dnsim").directive("dngearsimBuildStats",function(){return{scope:!0,bindToController:{stats:"=stats",build:"=build",buildName:"=buildName"},controller:buildStatsController,controllerAs:"statsCtrl",templateUrl:"ui/builds/build-stats.html"}});
"use strict";angular.module("dnsim").controller("buildSummaryCtrl",["$routeParams","$location","hCodeValues","statHelper","itemCategory",function(t,e,i,l,a){var r=this;this.stats=l.getBuildStats(this.build),this.itemsByCategory=a.getItemsByCategory(this.build.items),this.getSaveDate=function(t){if(r.build.lastUpdate>0){return new Date(r.build.lastUpdate).toLocaleDateString()}},this.getSaveTime=function(t){if(r.build.lastUpdate>0){return new Date(r.build.lastUpdate).toLocaleTimeString()}},this.getBuildSummary=function(t){var e="";return angular.forEach(r.itemsByCategory,function(t,i){t.length>0&&(e.length>0&&(e+=", "),e+=t.length+" "+i)}),e}}]).directive("dngearsimBuildSummary",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build"},controller:"buildSummaryCtrl",controllerAs:"buildCtrl",templateUrl:"ui/builds/build-summary.html"}});
"use strict";angular.module("dnsim").controller("BuildTalismansCtrl",["$window","$location","$routeParams","$timeout","saveHelper","statHelper","jobs","hCodeValues","itemColumnsToLoad","character",function(e,t,a,s,n,m,i,r,u,c){function l(e,t){return e&&t?Math.round(1e4*(1-t/e))/100:0}var o=this;if(e.document.title="dngearsim | TALISMANS",e.scrollTo(0,0),this.savedItems=n.getSavedItems(),this.groupNames=Object.keys(this.savedItems),this.groupNames||(this.groupNames=[]),this.groupNames.length>0?this.groupName=n.getCurrentBuild():this.groupName=null,this.groupName&&this.groupName in this.savedItems||this.groupNames.length>0&&(this.groupName=this.groupNames[0]),this.groupName){this.getGroupCalcStats=function(){if(null==this.groupCalcStats){var e=o.savedItems[o.groupName];e&&(this.groupCalcStats=m.getCalculatedStatsFromItems(e,e.items))}return this.groupCalcStats},this.getBuild=function(){return o.savedItems[o.groupName]},this.pickup=function(e){o.selectedIndex=e,o.replaceHPAffectAmount=[],o.replaceMDmgAffectAmount=[],o.replacePDmgAffectAmount=[],o.replaceAvgDmgAffectAmount=[]},this.headers=["+100%","+75%","+25%","+0%"],this.summaryStatIds=[];for(var d in r.stats)r.stats[d].summaryDisplay&&this.summaryStatIds.push(d);this.pcIndexes={},this.pcIndexes[100]=0,this.pcIndexes[75]=1,this.pcIndexes[25]=2,this.pcIndexes[0]=3,this.selectedIndex=-1,this.rows=[],this.updateRows=function(){o.rows=[],angular.forEach(o.savedItems[o.groupName].items,function(e,t){if("talisman"==e.typeName){var a=o.pcIndexes[e.enchantmentNum];a||0==a||(a=3);for(var s=0;;){if(o.rows[s]||(o.rows[s]=o.makeFakeCells()),o.rows[s][a].index<0){e.enchantmentNum||(e.enchantmentNum=0);var n=o.makeCell(e,t);o.rows[s][a]=n;break}s++}}}),o.rows.length<3&&(o.rows[o.rows.length+1]=o.makeFakeCells())},this.makeFakeCells=function(e){return[o.makeCell({enchantmentNum:100},-1),o.makeCell({enchantmentNum:75},-2),o.makeCell({enchantmentNum:25},-3),o.makeCell({enchantmentNum:0},-4)]},this.makeCell=function(e,t){return{item:e,index:t}},this.click=function(e){o.selectedIndex==-1?e.index>=0&&o.pickup(e.index):o.move(e)},this.move=function(e){var t=o.savedItems[o.groupName].items;if(e.index>=0){var a=e.item.enchantmentNum;o.setTalisman(e.item,t[o.selectedIndex].enchantmentNum),o.setTalisman(t[o.selectedIndex],a),t[e.index]=t[o.selectedIndex],t[o.selectedIndex]=e.item}else{var n=t[o.selectedIndex];o.setTalisman(n,e.item.enchantmentNum),t.splice(o.selectedIndex,1),t.push(n)}o.groupCalcStats=null,o.selectedIndex=-1,o.updateRows(),o.replaceAffectAmount={},s()},this.setTalisman=function(e,t){var a=[],s=r.mergeStats(e.stats,[]);angular.forEach(s,function(e,s){t&&a.push({id:e.id,max:e.max*(t/100)})}),e.enchantmentStats=a,e.enchantmentNum=t,e.fullStats=r.mergeStats(e.enchantmentStats,e.stats)},this.replaceAffectAmount={},this.getReplaceAffectAmount=function(e,t,a){if(this.initReplaceAffects(t,a),this.replaceAffectAmount[t])return this.replaceAffectAmount[t][e]},this.initReplaceAffects=function(e,t){if(!o.replaceAffectAmount[e]&&o.selectedIndex!=-1){this.replaceAffectAmount[e]={};var a=o.savedItems[o.groupName],s=a.items[o.selectedIndex],n=[],i=[];if(t.stats){var u=r.mergeStats(t.stats,[]);angular.forEach(u,function(e,t){n.push({id:e.id,max:e.max*(s.enchantmentNum/100)})}),i=r.mergeStats(n,t.stats)}n=[];var c=r.mergeStats(s.stats,[]);angular.forEach(c,function(e,a){n.push({id:e.id,max:e.max*(t.enchantmentNum/100)})});var d=r.mergeStats(n,s.stats),h=[{stats:i},{stats:d}];angular.forEach(a.items,function(e,a){t!==e&&s!==e&&h.push(e)});var p=m.getCalculatedStatsFromItems(a,h),f=o.getGroupCalcStats();for(var g in r.stats)r.stats[g].summaryDisplay&&(o.replaceAffectAmount[e][g]=l(o.getStat(g,p).max,o.getStat(g,f).max))}},this.getStatName=function(e){var t="";if("primary"==r.stats[e].element){var a=0;o.savedItems[o.groupName].element&&(a=o.savedItems[o.groupName].element.id),t+=r.elements[a].name}else if("secondary"==r.stats[e].element){var a=0;o.savedItems[o.groupName].secondaryElement&&(a=o.savedItems[o.groupName].secondaryElement.id),t+=r.elements[a].name}return t+" "+r.stats[e].name},this.getStat=function(e,t){for(var a=t.length,s=0;s<a;++s)if(t[s].id==e)return t[s];return{id:e,max:0}},this.save=function(){n.updatedSavedItems(o.groupName,o.savedItems[o.groupName].items),t.path("/build"),t.search("buildName",o.groupName)},this.updateRows()}}]);
"use strict";function bulidController(e,t,a,n){var r=this;r.stats=t.getBuildStats(r.build);var i=localStorage.getItem("selectedItemCategory");r.category=a.byName(i),r.category&&!r.category.hideInBuild||(i="titles",r.category=a.byName("titles")),r.getCategoryItems=function(){var e=a.getItemsByCategory(r.build.items);return r.category.name in e?e[r.category.name]:[]},r.changeCategory=function(){r.xsView=null,r.moveItem=null,r.categoryChanging=!0,e(function(){r.categoryChanging=!1},0)},r.getCategories=function(){return a.categories},r.setSelectedCategory=function(e){r.category=a.byName(e),localStorage.setItem("selectedItemCategory",e)},r.getSaveDate=function(e){if(r.build.lastUpdate>0){return new Date(r.build.lastUpdate).toLocaleDateString()}},r.getSaveTime=function(e){if(r.build.lastUpdate>0){return new Date(r.build.lastUpdate).toLocaleTimeString()}},r.allowMoreItems=function(){return!r.category.maxCat||r.getCategoryItems().length<r.category.maxCat},r.getItemCount=function(){var e="",t=r.build.items;if("offensive gems"==r.category.name){var n=0,i=0;angular.forEach(t,function(e,t){e.typeName==r.category.name?i++:e.offensiveGemSlots&&(n+=e.offensiveGemSlots)}),e=i+" / "+n}else if("increasing gems"==r.category.name){var o=0,l=0,u={};angular.forEach(t,function(e,t){if(e.typeName==r.category.name){var a=e.sparkTypeId;a||(a=0),a in u||(u[a]=0),u[a]++,o++}else e.increasingGemSlots&&(l+=e.increasingGemSlots)}),e="",angular.forEach(u,function(t,a){e.length>0&&(e+="+"),e+=t}),e=o+" ("+e+") / "+l}else{var g=0;angular.forEach(t,function(e,t){e&&e.typeName==r.category.name&&g++}),e=g;var m=a.byName(r.category.name);m&&"numItemText"in m&&(e+=" / "+m.numItemText)}return e},r.newCustom=function(){var e={id:0,typeName:"custom",name:"new custom item",stats:[]};r.build.items=r.build.items.concat(e),n.updatedSavedItems(r.buildName,r.build.items),r.handleChange()},r.handleChange=function(){r.stats=t.getBuildStats(r.build),r.onChange()}}bulidController.$inject=["$timeout","statHelper","itemCategory","saveHelper"],angular.module("dnsim").directive("dngearsimBuild",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build",onChange:"&onChange",server:"=server"},controller:bulidController,controllerAs:"buildCtrl",templateUrl:"ui/builds/build.html"}});
"use strict";angular.module("dnsim").controller("DeleteBuildCtrl",["$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad",function(e,t,n,a,i,l,o,s){this.newGroup=!0,"name"in t&&(this.name=t.name),this.delete=function(){a.deleteBuild(this.name),e.path("/builds/")}}]);
"use strict";!function(){function e(e,t,n,o,a,r,l,s,m,i,u){var p=this;p.savedItems=a.getSavedItems(),p.group={},p.newGroup=!0,"buildName"in n?(p.groupName=n.buildName,p.groupName in p.savedItems&&(p.group=p.savedItems[p.groupName],p.newGroup=!1)):p.groupName="",p.oldGroupName=p.groupName,p.heroStats=[],p.elements=s.elements,p.damageTypes=s.damageTypes,p.initDamageType=function(){p.job&&(p.group.damageType?p.damageType=p.group.damageType:p.newGroup&&"DamageType"in p.job.d?p.job.d.DamageType?p.damageType=s.damageTypes[2]:p.damageType=s.damageTypes[1]:p.damageType=s.damageTypes[0])},p.initDefaultElement=function(){var e=s.elements[0],t=s.elements[0];if(p.job&&p.job.d){var n=p.job.d.EnglishName;"CRUSADES"==n||"INQUISITOR"==n||"GUARDIAN"==n||"SAINT"==n||"SILVERHUNTER"==n||"STINGBREEZER"==n?(e=s.elements[3],t=s.elements[3]):"RAVEN"==n||"MAJESTY"==n||"SOULEATER"==n||"DARKSUMMONER"==n||"ABYSSWALKER"==n||"BLACKMARA"==n||"PHYSICIAN"==n?(e=s.elements[4],t=s.elements[4]):"SALEANA"==n||"RIPPER"==n||"DARKAVENGER"==n||"RANDGRID"==n?(e=s.elements[1],t=s.elements[1]):"ELESTRA"==n||"AVALANCHE"==n?(e=s.elements[2],t=s.elements[2]):"ADEPT"==n?(e=s.elements[1],t=s.elements[2]):"LIGHTFURY"==n&&(e=s.elements[3],t=s.elements[4])}p.newGroup&&(p.element=e,p.secondaryElement=t),p.element||(p.element=e),p.secondaryElement||(p.secondaryElement=e)},p.group.element?p.element=p.group.element:p.element=s.elements[0],p.group.secondaryElement?p.secondaryElement=p.group.secondaryElement:p.secondaryElement=s.elements[0],"critResist"in p.group?p.critResist=p.group.critResist:p.critResist=20,"eleResist"in p.group?p.eleResist=p.group.eleResist:p.eleResist=0,p.group.enemyLevel?p.enemyLevel=p.group.enemyLevel:p.enemyLevel=95,p.group.playerLevel?p.playerLevel=p.group.playerLevel:p.playerLevel=95,p.group.heroLevel&&p.group.heroLevel>0?p.heroLevel=p.group.heroLevel:p.heroLevel=1,p.init=function(){var e=l.getFinalJobs();e.length>0&&o(function(){"job"in p.group&&angular.forEach(e,function(e,t){e.id==p.group.job.id&&(p.job=e)}),p.initDamageType(),p.initDefaultElement(),p.setHeroStats()})},p.setJob=function(){e.scrollTo(0,0),o(function(){p.initDamageType(),p.initDefaultElement()})},u.init(),i.init(function(){p.init()}),p.getStatCap=function(e,t){return i.getStatCaps(t)[e]},p.getJobConversion=function(e){return i.getConversions(p.job.id)[e]},p.getJobBaseStat=function(e){return i.getBaseStats(p.playerLevel,p.job.id)[e]},p.invalidGroupName=function(){return!p.groupName||!(!(p.groupName in p.savedItems)||!p.newGroup&&p.groupName==p.oldGroupName)},p.ok=function(){var e=i.getStatCaps(p.enemyLevel),n=i.getStatCaps(p.playerLevel),o=i.getConversions(p.job.id),r=i.getBaseStats(p.playerLevel,p.job.id),l=i.getHeroStats(p.heroLevel);p.newGroup&&(p.oldGroupName=p.groupName,a.importGroup(p.groupName,[])),a.saveBuild(p.oldGroupName,p.groupName,{enemyLevel:p.enemyLevel,playerLevel:p.playerLevel,heroLevel:p.heroLevel,job:p.job,damageType:p.damageType,element:p.element,secondaryElement:p.secondaryElement,critResist:p.critResist,eleResist:p.eleResist,enemyStatCaps:e,playerStatCaps:n,conversions:o,baseStats:r,heroStats:l}),t.path("/build"),t.search("buildName",p.groupName)},p.setHeroStats=function(){p.heroStats=i.getHeroStats(p.heroLevel)},o(function(){var e=document.getElementById("groupNameInput");e&&(e.focus(),e.setSelectionRange(0,9999))})}e.$inject=["$window","$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad","character","region"],angular.module("dnsim").controller("EditBuildCtrl",e)}();
"use strict";angular.module("dnsim").controller("quickAddCtrl",["$timeout","statHelper","saveHelper","quickAdd","itemCategory","jobs","dntData","exportLinkHelper",function(t,e,n,i,a,o,s,r){var u=this;u.startedForCat="",u.stepNumber=0,u.datas=[],u.options=[],this.setOptions=function(){u.hasStarted()&&(u.options=i.getOptions(u.category,u.build,u.datas),1==u.options.length&&u.selectOption(u.options[0]))},this.selectOption=function(t){var e=i.createData(t,u.category,u.stepNumber);if(u.datas.push(e),u.stepNumber++,i.isValidStepNumber(u.category,u.stepNumber))u.setOptions();else{var n=i.getItem(u.datas),a=r.getDntFiles(n);angular.forEach(a,function(t,e){s.init(e,t,function(){},function(){u.tryToAddItem(a,n)})}),u.tryToAddItem(a,n)}},this.tryToAddItem=function(t,e){if(!s.anyLoading()){var i=!0;if(angular.forEach(t,function(t,e){s.isLoaded(e)||(i=!1)}),i&&u.datas.length>0){u.cancel();var a=r.reloadItem(e);a.gemSlot=u.gemSlot,n.saveItem(u.buildName,a),u.build.items.push(a),u.onChange()}}},this.reset=function(){u.stepNumber=0,u.datas=[],t(function(){u.setOptions()})},this.hasStarted=function(){return u.startedForCat==u.category.name},this.start=function(){u.startedForCat=u.category.name,o.init(function(){},u.reset),a.init(u.category.name,u.reset)},this.hasOptions=function(){return i.hasOptions(u.category,u.build,[])},this.cancel=function(){u.startedForCat="",u.reset()},this.back=function(){if(0==u.stepNumber)u.cancel();else{do{u.stepNumber--,u.datas.pop();var t=i.getOptions(u.category,u.build,u.datas)}while(t.length<=1&&u.stepNumber>0);u.setOptions()}},s.init("exchange.json",null,function(){},u.reset)}]).directive("dngearsimQuickAdd",function(){return{scope:!0,bindToController:{category:"=category",build:"=build",buildName:"=buildName",gemSlot:"=gemSlot",onChange:"&onChange"},controller:"quickAddCtrl",controllerAs:"quickAdd",templateUrl:"ui/builds/quick-add.html"}});
"use strict";function reloadBuildCtrl(e,a,i,n,d,t,l,r){function o(){}function u(){if(!s.reloaded){var e=!0,a=l.getDntFiles(s.build);if(angular.forEach(a,function(a,i){if(!d.isLoaded(i))return void(e=!1)}),e&&r.isLoaded()){var i=l.reloadGroup(s.name,s.build);n.updatedSavedItems(s.name,i),s.build.items=i,s.reloaded=!0}}}var s=this;"name"in a&&(s.name=a.name);var m=n.getSavedItems();s.name in m&&(s.build=m[s.name]),s.reloaded=!1,s.reload=function(){t(),s.reloaded=!1,r.init(o,u);var e=l.getDntFiles(s.build);angular.forEach(e,function(e,a){d.init(a,e,o,u)})},s.goToBuild=function(){e.path("/build"),e.search("buildName",s.name)}}angular.module("dnsim").controller("ReloadBuildCtrl",["$location","$routeParams","$timeout","saveHelper","dntData","dntReset","groupHelper","translations",reloadBuildCtrl]);
"use strict";angular.module("dnsim").controller("ViewGroupCtrl",["$scope","$window","region","$location","$routeParams","saveHelper","dntData","$timeout","translations","dntReset","exportLinkHelper","groupHelper","jobs","character","statHelper","hCodeValues",function(e,t,a,s,l,n,o,i,r,d,m,p,u,y,b,v){function c(){var t=!0;angular.forEach(p.getDntFiles(e.build),function(e,a){o.isLoaded(a)||(t=!1)}),t&&!o.anyLoading()&&r.isLoaded()&&u.isLoaded()&&i(function(){var t=e.buildName,a=e.build;e.job=u.getById(e.job.id),e.enemyStatCaps=y.getStatCaps(e.enemyLevel),e.playerStatCaps=y.getStatCaps(e.playerLevel),e.job&&(e.conversions=y.getConversions(e.job.id),e.baseStats=y.getBaseStats(e.playerLevel,e.job.id)),e.heroStats=y.getHeroStats(e.heroLevel);var s=p.reloadGroup(t,a);e.savedItems={},e.build={items:s,lastUpdate:a.lastUpdate,enemyLevel:e.enemyLevel,playerLevel:e.playerLevel,heroLevel:e.heroLevel,job:e.job,damageType:e.damageType,element:e.element,secondaryElement:e.secondaryElement,enemyStatCaps:e.enemyStatCaps,playerStatCaps:e.playerStatCaps,conversions:e.conversions,baseStats:e.baseStats,heroStats:e.heroStats},e.savedItems[t]=e.build,e.stats=b.getBuildStats(e.build);var l=m.createGroupLink(e.buildName,e.build);e.build.shortUrl=sessionStorage.getItem(l)})}function g(){}if(document.body.className="saved-back",a.setLocationByName(l.region),e.buildName="",e.build={},"g"in l&&"i"in l){e.buildName=l.g,t.document.title="dngearsim | "+l.g,e.enemyLevel=l.e,e.playerLevel=l.p,e.heroLevel=l.h,e.job={id:l.j},e.damageType=v.damageTypes[l.d],e.element=v.elements[l.t],e.secondaryElement=v.elements[l.s];var L=[],S=l.i;angular.forEach(S.split(","),function(e,t){var a=m.decodeItem(e);a.id>0&&L.push(a)}),e.build={},e.savedItems={},e.savedItems[e.buildName]=e.build,e.build.items=L,e.isLoading=!0,angular.forEach(p.getDntFiles(e.build),function(e,t){o.init(t,e,g,c)}),r.init(g,c),u.init(g,c),y.init(c),i()}e.anyItems=Object.keys(e.savedItems).length>0,e.copyGroup=function(){var t=n.importGroup(e.buildName,e.build.items);n.saveBuild(t,t,{enemyLevel:e.enemyLevel,playerLevel:e.playerLevel,heroLevel:e.heroLevel,job:e.job,damageType:e.damageType,element:e.element,secondaryElement:e.secondaryElement,critResist:e.critResist,eleResist:e.eleResist,enemyStatCaps:e.enemyStatCaps,playerStatCaps:e.playerStatCaps,conversions:e.conversions,baseStats:e.baseStats,heroStats:e.heroStats}),s.url("/build?buildName="+encodeURIComponent(t))}}]);
"use strict";!function(){function t(t,e,a,n,r,i,m){function s(t,e){return t&&e?Math.round((t-e)/e*1e4)/100:0}function u(){a.saveBuildSelection(o.groupName,o.savedItems)}var o=this;if(this.savedItems=a.getSavedItems(),this.groupNames=Object.keys(this.savedItems),this.groupName||(this.groupName=a.getCurrentBuild()),this.groupName in this.savedItems||(this.groupName=null),!this.groupName&&this.savedItems)for(var c in this.savedItems){this.groupName=c;break}if(this.groupName){this.summaryStatIds=[];for(var f in t.stats)t.stats[f].summaryDisplay&&this.summaryStatIds.push(f);this.clearGroup=function(){o.addAffectAmount=null,o.newAffectAmount=null,o.oldAffectAmount=null,o.replaceAffectAmount={},o.groupItems=null,o.groupCalcStats=null},o.tryToSetItem=function(t){if(!m.anyLoading()){var e=!0;angular.forEach(t,function(t,a){m.isLoaded(a)||(e=!1)}),e&&(o.item=i.reloadItem(o.item))}};var l=i.getDntFiles(o.item);angular.forEach(l,function(t,e){o.item.fileName&&0==e.indexOf(o.item.fileName)&&m.isLoaded(o.item.fileName+".optimised.json")?delete l[e]:m.init(e,t,function(){},function(){o.tryToSetItem(l)})}),o.tryToSetItem(l),r.$watch("editCtrl.item",function(){o.clearGroup()}),this.getAddAffectAmount=function(t){return this.initAddAffects(),this.addAffectAmount[t]},this.getNewAffectAmount=function(t){return this.initAddAffects(),this.newAffectAmount[t]},this.getOldAffectAmount=function(t){return this.initAddAffects(),this.oldAffectAmount[t]},this.getReplaceAffectAmount=function(t,e,a){return this.initReplaceAffects(e,a),this.replaceAffectAmount[e][t]},this.getGroupCalcStats=function(){if(null==this.groupCalcStats){var t=o.savedItems[o.groupName];t&&(this.groupCalcStats=e.getCalculatedStatsFromItems(t,t.items))}return this.groupCalcStats},this.getBuild=function(){return o.savedItems[o.groupName]},this.initAddAffects=function(){if(!o.addAffectAmount){var a=o.getGroupCalcStats(),n=o.savedItems[o.groupName],r=[];n.items&&(r=n.items.concat([o.item]));var i=e.getCalculatedStatsFromItems(n,r);this.addAffectAmount={},this.newAffectAmount={},this.oldAffectAmount={};for(var m in t.stats)t.stats[m].summaryDisplay&&(o.newAffectAmount[m]=o.getStat(m,i).max,o.oldAffectAmount[m]=o.getStat(m,a).max,o.addAffectAmount[m]=s(o.newAffectAmount[m],o.oldAffectAmount[m]))}},this.initReplaceAffects=function(a,n){if(!o.replaceAffectAmount[a]){var r=o.savedItems[o.groupName],i=[o.item];angular.forEach(r.items,function(t,e){n!==t&&i.push(t)});var m=e.getCalculatedStatsFromItems(r,i),u=o.getGroupCalcStats();this.replaceAffectAmount[a]={};for(var c in t.stats)t.stats[c].summaryDisplay&&(o.replaceAffectAmount[a][c]=s(o.getStat(c,m).max,o.getStat(c,u).max))}},this.getStat=function(t,e){for(var a=e.length,n=0;n<a;++n)if(e[n].id==t)return e[n];return{id:t,max:0}},this.getStatName=function(e){var a="";if("primary"==t.stats[e].element){var n=0;o.savedItems[o.groupName].element&&(n=o.savedItems[o.groupName].element.id),a+=t.elements[n].name}else if("secondary"==t.stats[e].element){var n=0;o.savedItems[o.groupName].secondaryElement&&(n=o.savedItems[o.groupName].secondaryElement.id),a+=t.elements[n].name}return a+" "+t.stats[e].name},this.getGroupItems=function(){function t(t){if(t){for(var a=0,n=0;n<e.length;++n)t.indexOf(e[n])>0&&a++;return a}return-1}var e;if(null==o.groupItems&&o.groupName&&o.groupName in o.savedItems&&o.item&&o.item.typeName){o.groupItems=[];var a;"plate"!=o.item.itemSource&&"tman"!=o.item.itemSource||(a=_.find(o.savedItems[o.groupName].items,function(t){return t.sparkTypeId==o.item.sparkTypeId&&o.item.itemSource==t.itemSource}));var n=[];a?n.push(a):(_.each(o.savedItems[o.groupName].items,function(t){t.exchangeType&&"gem"!=t.itemSource&&"plate"!=t.itemSource&&"plate95"!=t.itemSource&&"tman"!=t.itemSource?t.exchangeType==o.item.exchangeType&&n.push(t):t.typeName==o.item.typeName&&n.push(t)}),o.item.name&&(e=o.item.name.split(" ")),n.sort(function(e,a){return t(a.name)-t(e.name)})),angular.forEach(n,function(t,e){t.name==o.item.name&&o.groupItems.push(t)}),angular.forEach(n,function(t,e){t.name!=o.item.name&&o.groupItems.push(t)})}return o.groupItems},this.hasMaxExchangable=function(){var t=n.byName(this.item.typeName),e=this.getGroupItems();if(("plate"==o.item.itemSource||"tman"==o.item.itemSource)&&_.find(e,function(t){return t.sparkTypeId==o.item.sparkTypeId}))return!0;if(t&&t.maxCat&&e.length>=t.maxCat)return!0;if(t&&t.maxExchange&&e.length>=t.maxExchange){for(var a=0;a<e.length;++a)if(!e[a].exchangeType)return!1;return!0}return!1},this.nextGroup=function(){var t=!1,e=null;angular.forEach(o.groupNames,function(a,n){t&&null==e&&(e=a),a==o.groupName&&(t=!0)}),null==e&&(e=o.groupNames[0]),o.groupName=e,u(),o.clearGroup()},this.prevGroup=function(){var t=!1,e=null;angular.forEach(o.groupNames,function(a,n){a==o.groupName&&(t=!0),t||(e=a)}),null==e&&(e=o.groupNames[o.groupNames.length-1]),o.groupName=e,u(),o.clearGroup()},this.addToGroup=function(){a.saveItem(o.groupName,o.item),this.savedItems=a.getSavedItems(),o.clearGroup(),o.onChange()},this.replace=function(t){t.replaceItem=!0;var e=[];angular.forEach(o.savedItems[o.groupName].items,function(t,a){t.replaceItem?e.push(o.item):e.push(t)}),a.updatedSavedItems(o.groupName,e),this.savedItems=a.getSavedItems(),o.clearGroup(),o.onChange()}}}t.$inject=["hCodeValues","statHelper","saveHelper","itemCategory","$scope","exportLinkHelper","dntData"],angular.module("dnsim").directive("dngearsimGroupAssignment",function(){return{scope:!0,bindToController:{item:"=item",compact:"=compact",onChange:"&onChange"},controller:t,controllerAs:"editCtrl",templateUrl:"ui/item/group-assignment.html"}})}();
"use strict";angular.module("dnsim").controller("itemEditCustomCtrl",["hCodeValues","$scope",function(t,i){if(null!=this.item&&("custom"==this.item.itemSource||"custom"==this.item.typeName)){var e=this;this.statMap={},_.forEach(e.item.stats,function(t){e.statMap[t.id]=t.max});for(var a in t.stats)i.$watch("editCtrl.statMap["+a+"]",function(t,i){if(t!=i){var a=!1,s=[];for(var m in e.statMap)if(e.statMap[m]&&Number(e.statMap[m])){s.push({id:Number(m),max:Number(e.statMap[m])});var o=!1;_.each(e.item.stats,function(t){t.id==m&&(o=!0,m in e.statMap&&t.max==e.statMap[m]||(a=!0))}),o||(a=!0)}else _.each(e.item.stats,function(t){t.id==m&&(a=!0)});a&&(e.item.stats=s,e.onChange())}})}}]).directive("dngearsimItemEditCustom",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditCustomCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-custom.html"}});
"use strict";angular.module("dnsim").controller("itemEditEnchantmentCtrl",["dntData","hCodeValues","items","$timeout","translations","itemColumnsToLoad","itemFactory",function(n,t,e,m,a,i,h){function c(n){return"petLevelDnt"in s.itemType?s.enchantments[n].PetLevel:s.enchantments[n].EnchantLevel}var s=this;if(s.item&&s.item.enchantmentId&&("itemSource"in this.item&&(s.itemType=e[s.item.itemSource]),s.itemType&&("enchantDnt"in s.itemType||"petLevelDnt"in s.itemType))){s.itemType.enchantDnt&&n.init(s.itemType.enchantDnt,i.enchantDnt,null,s.getEnchantments),s.itemType.enchantDnt2&&n.init(s.itemType.enchantDnt2,i.enchantDnt,null,s.getEnchantments),s.itemType.petLevelDnt&&(n.init(s.itemType.petDnt,i.petDnt,null,s.getEnchantments),n.init(s.itemType.petLevelDnt,i.petLevelDnt,null,s.getEnchantments)),s.enchantments=null,s.enchantment=null,s.enchantmentAfter=null,s.enchantmentCost="",s.enhancementOptions=[],null==s.item.enchantmentStats&&(s.item.enchantmentStats=[]),this.setEnchantment=function(){if(s.item.enchantmentStats=[],s.enchantments&&s.enchantments.length>0){"number"!=typeof s.item.enchantmentNum&&(s.item.enchantmentNum=0,s.onChange());for(var n=0;n<s.enchantments.length;++n)s.item.enchantmentNum==c(n)?(s.enchantment=s.enchantments[n],s.item.enchantmentStats=t.getStats(s.enchantment)):s.item.enchantmentNum+1==c(n)&&(s.enchantmentAfter=s.enchantments[n],s.enchantmentAfter.NeedCoin<1e4?s.enchantmentCost=Math.round(s.enchantmentAfter.NeedCoin/1e3)/10+"g":s.enchantmentCost=Math.round(s.enchantmentAfter.NeedCoin/1e4)+"g")}},this.setPetLevel=function(){if(s.item.enchantmentStats=[],s.enchantments&&s.enchantments.length>0){"number"!=typeof s.item.enchantmentNum&&(s.item.enchantmentNum=6,s.onChange());for(var n=0;n<s.enchantments.length;++n)s.item.enchantmentNum==s.enchantments[n].PetLevel&&(s.enchantment=s.enchantments[n],s.item.enchantmentStats=t.getStats(s.enchantment))}},this.isMaxEnchantLevel=function(){if(null!=s.enchantments&&s.enchantments.length>0&&"number"==typeof s.item.enchantmentNum){for(var n=0;n<s.enchantments.length;++n)if(s.item.enchantmentNum+1==c(n))return!1;return!0}return!1},this.setEnchantmentNum=function(n){s.item.enchantmentNum=n,s.enhancementOptions=[],"petLevelDnt"in s.itemType?s.setPetLevel():s.setEnchantment(),s.onChange()},this.nextEnchantment=function(){for(var n=s.item.enchantmentNum;0==n||s.enchantments[n-1];++n)0==n?s.enhancementOptions.push({number:0}):s.enhancementOptions.push(s.getOption(n-1))},this.prevEnchantment=function(){s.enhancementOptions=[];for(var n=s.item.enchantmentNum;n>0;--n)s.enhancementOptions.push(s.getOption(n-1));s.enhancementOptions.push({number:0})},this.getOption=function(n){return{number:c(n),stats:t.getStats(s.enchantments[n])}},this.getEnchantments=function(){return!s.enchantments&&s.item&&s.item.enchantmentId&&(s.itemType.enchantDnt&&n.isLoaded(s.itemType.enchantDnt)&&(s.enchantments=n.find(s.itemType.enchantDnt,"EnchantID",s.item.enchantmentId),!s.enchantments.length&&s.itemType.enchantDnt2&&(s.enchantments=n.find(s.itemType.enchantDnt2,"EnchantID",s.item.enchantmentId)),s.setEnchantment()),s.itemType.petLevelDnt&&n.isLoaded(s.itemType.petLevelDnt)&&(s.enchantments=n.find(s.itemType.petLevelDnt,"PetLevelTypeID",s.item.enchantmentId),s.setPetLevel())),s.enchantments};this.showMaterials=function(){n.init("all-items.json",null,function(){},function(){m(function(){if(s.enchantmentAfter){s.materials=[];for(var t=1;t<=5;++t){var e=s.enchantmentAfter["NeedItemID"+t],m=s.enchantmentAfter["NeedItemCount"+t];if(e>0&&m>0){var a=n.find("all-items.json","id",e);if(0==a.length)s.materials.push({num:m,name:"unknown ("+e+")"});else{var i=a[0];if(i){var c={item:h.createBasicItem(i),num:m};s.materials.push(c)}}}}}})})},n.isLoaded("all-items.json")&&this.showMaterials()}}]).directive("dngearsimItemEditEnchantment",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditEnchantmentCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-enchantment.html"}});
"use strict";angular.module("dnsim").controller("itemEditPotentialCtrl",["dntData","items","hCodeValues","itemColumnsToLoad",function(t,i,n,e){function l(){var t={},i=null;return null!=o.potentials&&angular.forEach(o.potentials,function(e,l){var o=[];angular.forEach(n.getStats(e),function(t,i){n.stats[t.id].hide||o.push(t)}),o.length>0?t[e.id]=o:i||(t[e.id]=[],i=e.id)}),t}var o=this;this.potentials=null,this.potential=null,this.changingPotentials=!1,this.potentialStats={},null!=this.item&&("itemSource"in this.item&&(this.itemType=i[this.item.itemSource]),this.itemType&&this.item.pid&&"potentialDnt"in this.itemType&&(o.itemType.potentialDnt&&t.init(o.itemType.potentialDnt,e.potentialDnt,null,o.getPotentials),this.getPotentials=function(){if(!o.potentials&&o.item&&o.item.pid&&"potentialDnt"in o.itemType){var i=t.find(o.itemType.potentialDnt,"id",o.item.pid);1==i.length?(o.potential=i[0],o.potentials=t.find(o.itemType.potentialDnt,"PotentialID",o.potential.PotentialID),o.potentialStats=l(o.potentials)):"potentialDntEx"in o.itemType&&(i=t.find(o.itemType.potentialDntEx,"id",o.item.pid),1==i.length&&(o.potential=i[0],o.potentials=t.find(o.itemType.potentialDntEx,"PotentialID",o.potential.PotentialID),o.potentialStats=l(o.potentials)))}return o.potentials},this.nextPotential=function(){for(var t=0;t<o.potentials.length;++t)if(o.potential.id==o.potentials[t].id)return o.potential=o.potentials[t+1],o.item.pid=o.potential.id,o.onChange(),void(this.changingPotentials=!0)},this.prevPotential=function(){for(var t=0;t<o.potentials.length;++t)if(o.potential.id==o.potentials[t].id)return o.potential=o.potentials[t-1],o.item.pid=o.potential.id,o.onChange(),void(this.changingPotentials=!0)},this.changePotential=function(t){for(var i=0;i<o.potentials.length;++i)if(t==o.potentials[i].id)return o.potential=o.potentials[i],o.item.pid=o.potential.id,o.changingPotentials=!1,void o.onChange()},this.isFirstPotential=function(){return this.getPotentials(),!o.potentials||o.potentials.length<=1||!o.potential||o.potential.id==o.potentials[0].id},this.isLastPotential=function(){return this.getPotentials(),!o.potentials||o.potentials.length<=1||!o.potential||o.potential.id==o.potentials[o.potentials.length-1].id}))}]).directive("dngearsimItemEditPotential",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditPotentialCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-potential.html"}});
"use strict";angular.module("dnsim").controller("itemEditSkillCtrl",["$timeout","dntData",function(t,i){function n(){return"skillleveltable_character"+l.item.baseJobName+l.item.pve+".json"}function e(t){}if(null!=this.item&&"skills"==this.item.itemSource){this.item.enchantmentNum||(this.item.enchantmentNum=1);var l=this;this.initSkills=function(){var m=n();i.init(m,null,e,function(){t(function(){l.skillData=i.find(m,"SkillIndex",l.item.id)})})},this.nextEnchantment=function(){this.skillData&&this.item.enchantmentNum<this.skillData.length&&(this.item.enchantmentNum++,l.onChange())},this.isMaxSkillLevel=function(){return this.skillData&&this.item&&this.item.enchantmentNum>=this.skillData.length},this.prevEnchantment=function(){this.item.enchantmentNum>0?this.item.enchantmentNum--:this.item.enchantmentNum=0,l.onChange()},i.init(n(),null,null,l.initSkills)}}]).directive("dngearsimItemEditSkill",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditSkillCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-skill.html"}});
"use strict";angular.module("dnsim").controller("itemEditTalismanCtrl",["hCodeValues",function(t){null!=this.item&&"tman"==this.item.itemSource&&(this.setTalisman=function(e){if(0==e)this.item.enchantmentNum=null,this.item.enchantmentStats=[];else{this.item.enchantmentNum=e;var i=[],n=t.mergeStats(this.item.stats,[]);angular.forEach(n,function(t,n){i.push({id:t.id,max:t.max*(e/100)})}),this.item.enchantmentStats=i}this.onChange()})}]).directive("dngearsimItemEditTalisman",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditTalismanCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-talisman.html"}});
"use strict";angular.module("dnsim").controller("itemEditCtrl",["hCodeValues",function(t){var e=this;e.item&&(e.onUpdateItem=function(){e.updateItem()})}]).directive("dngearsimItemEdit",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange",updateItem:"&updateItem"},controller:"itemEditCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-edit.html"}});
"use strict";angular.module("dnsim").controller("itemViewAttainmentCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(t,n,i,e,a){if(null!=this.item){var o=this;o.attainments=[];for(var l=["itemgaintable.json","itemgaintable_dragonjewel.json","itemgaintable_enchant.json","itemgaintable_etc.json","itemgaintable_reboot.json","itemgaintable_talisman.json"],r=0;r<l.length;++r)n.init(l[r],null,function(){},function(){t(function(){o.init()})});this.init=function(){for(var t=0;t<l.length;++t)if(!n.isLoaded(l[t])&&!n.hasFailed(l[t]))return;o.attainments=[],l.forEach(function(t){var i=n.find(t,"id",o.item.id);i.length&&i.forEach(function(t){var n=t.ItemGainText;if(n){n.split("{").forEach(function(t){var n=t.split("}");n.length&&n[0].indexOf("#")==-1&&o.attainments.push(a.translate(n[0]))})}})})}}}]).directive("dngearsimItemViewAttainment",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewAttainmentCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-attainment.html"}});
"use strict";angular.module("dnsim").controller("itemViewBoxCtrl",["$timeout","dntData","itemFactory","region",function(t,e,i,o){if(null!=this.item){if(46!=this.item.typeId&&8!=this.item.typeId&&112!=this.item.typeId&&122!=this.item.typeId&&142!=this.item.typeId&&160!=this.item.typeId)return void console.log("not box item type "+this.item.typeId);var n=this,m=["itemdroptable.json","itemdroptable_abyss.json","itemdroptable_apprentice.json","itemdroptable_cook.json","itemdroptable_darklair.json","itemdroptable_dimension.json","itemdroptable_disjoint.json","itemdroptable_dnexpedition.json","itemdroptable_event.json","itemdroptable_farm.json","itemdroptable_fishing.json","itemdroptable_guildwar.json","itemdroptable_item.json","itemdroptable_monsteritem.json","itemdroptable_propdrop.json","itemdroptable_pvp.json","itemdroptable_randomcompound.json","itemdroptable_stageclear.json","itemdroptable_themepark.json","itemdroptable_union.json"];this.usedFiles={},this.lookupId=null;var s;46==this.item.typeId||112==this.item.typeId||122==this.item.typeId||142==this.item.typeId||160==this.item.typeId?s=["all-items.json","charmitemtable.json","charmitemtable_common.json"]:8==this.item.typeId&&(s=["all-items.json"].concat(m));for(var r=0;r<s.length;++r)e.init(s[r],null,function(){},function(){t(function(){n.initBoxContents()})});this.initBoxContents=function(){for(var t=0;t<s.length;++t)if(!e.isLoaded(s[t]))return;var i=e.find(this.item.fileName+".json","id",this.item.id);if(i.length>0){var o=i[0];this.lookupId=o.TypeParam1,n.items=[],46==n.item.typeId||112==n.item.typeId||122==n.item.typeId||142==n.item.typeId||160==n.item.typeId?n.getCharmItems(o.TypeParam1):8==n.item.typeId&&n.getPouchItems(o.TypeParam1)}},this.getPouchItems=function(t){for(var e=0;e<m.length;++e)n.getPouchItemsFromFile(t,m[e])},this.getPouchItemsFromFile=function(t,o){var m=e.find(o,"id",t);if(0==m.length);else{var s=m[0].GoldMin,r=0;do{r++;var a=m[0]["IsGroup"+r],l=m[0]["Item"+r+"Index"],d=m[0]["Item"+r+"Info"];if(l)if(a)n.getPouchItems(l,o);else{var p=e.find("all-items.json","id",l);if(p.length>0){var h=i.createBasicItem(p[0]);n.items.push({count:d,gold:s,item:h}),this.usedFiles[o]=!0}}}while(l)}},this.getCharmItems=function(t){for(var o=["charmitemtable.json","charmitemtable_common.json"],m=0;m<o.length;++m)for(var s=e.getData(o[m]),r=0;r<s.length;++r){var a=s[r];if(a.CharmNum==t&&a.Look)if(a.CharmType)this.getCharmItems(a.ItemID);else{var l=e.find("all-items.json","id",a.ItemID);l.length>0&&(n.items.push({count:a.Count,gold:a.Gold,item:i.createBasicItem(l[0])}),this.usedFiles[o[m]]=!0)}}},this.getFileLink=function(t){return"https://spacem.github.io/dntviewer/#dnt="+t+"&location="+o.dntLocation.url}}}]).directive("dngearsimItemViewBox",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewBoxCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-box.html"}});
"use strict";angular.module("dnsim").controller("itemViewCraftCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(t,e,i,n,r){if(null!=this.item){var o=this;o.crafts=[];for(var a=["itemcompoundtable.json","itemcompoundtable_custom.json","itemcompoundtable_glyph.json","itemcompoundtable_glyph95.json","itemcompoundtable_jewel.json","itemcompoundtable_renewal.json","itemcompoundtable_set.json"],s=a.concat(["all-items.json","itemdroptable.json"]),l=0;l<s.length;++l)e.init(s[l],null,function(){},function(){t(function(){o.initCrafts()})});this.initCrafts=function(){for(var t=0;t<s.length;++t)if(!e.isLoaded(s[t])&&!e.hasFailed(s[t]))return;o.crafts=[];for(var t=0;t<a.length;++t)o.initCraft(a[t],o.item.id);for(var i=1;i<=20;++i){var n=e.find("itemdroptable.json","Item"+i+"Index",o.item.id);n.length&&n.forEach(function(t){for(var e=0;e<a.length;++e)o.initCraft(a[e],t.id)})}for(var r=[],t=0;t<o.crafts.length;++t){for(var l=!1,m=0;m<r.length;++m)if(o.crafts[t].gold==r[m].gold&&o.crafts[t].items.length==r[m].items.length){l=!0;for(var f=0;f<o.crafts[t].items.length;++f)o.crafts[t].items[f].item.id==r[m].items[f].item.id&&o.crafts[t].items[f].num==r[m].items[f].num||(l=!1)}l||r.push(o.crafts[t])}o.crafts=r},this.initCraft=function(t,n){for(var r=e.find(t,"SuccessItemID1",n),a=0;a<r.length;++a){for(var s=r[a],l={id:s.id,fileName:t.replace(".json",""),gold:s.Cost/100/100,items:[]},m=0;;){m++;var f="Slot"+m+"Id",c="Slot"+m+"Num";if(!(f in s))break;var d=e.find("all-items.json","id",s[f]);d.length>0&&l.items.push({item:i.createBasicItem(d[0]),num:s[c]})}o.crafts.push(l)}}}}]).directive("dngearsimItemViewCraft",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewCraftCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-craft.html"}});
"use strict";angular.module("dnsim").controller("itemViewExtractionCtrl",["$timeout","dntData","itemFactory","items",function(t,n,i,e){if(null!=this.item){for(var r=this,o=["itemdroptable_disjoint.json","all-items.json"],a=0;a<o.length;++a)n.init(o[a],null,function(){},function(){t(function(){r.initExtract()})});this.initExtract=function(){for(var t=0;t<o.length;++t)if(!n.isLoaded(o[t]))return;var a,m=i.getItemData(r.item);m&&m.DisjointDrop1>0&&(a=m.DisjointDrop1);var l=e[r.item.itemSource];if(l&&m.EnchantID){var c=n.find(l.enchantDnt,"EnchantID",m.EnchantID);!c.length&&l.enchantDnt2&&(c=n.find(l.enchantDnt2,"EnchantID",m.EnchantID));for(var t=0;t<c.length;++t)if(c[t].EnchantLevel==r.item.enchantmentNum){a=c[t].DisjointDrop;break}}r.items=[],a&&r.getItems(a)},this.getGold=function(){var t=i.getItemData(this.item);return Number(t.Disjointamount)/100/100},this.getItems=function(t){var e=n.find("itemdroptable_disjoint.json","id",t);if(0==e.length);else for(var o=e[0].GoldMin,a=1;"Item"+a+"Index"in e[0];){var m=e[0]["IsGroup"+a],l=e[0]["Item"+a+"Index"],c=e[0]["Item"+a+"Info"];if(l)if(m)r.getItems(l);else{var s=n.find("all-items.json","id",l);s.length>0&&r.items.push({count:c,gold:o,item:i.createBasicItem(s[0])})}a++}}}}]).directive("dngearsimItemViewExtraction",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewExtractionCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-extraction.html"}});
"use strict";angular.module("dnsim").controller("itemViewPlateCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(t,e,i){function n(){for(var t=e.find(r,"ItemID",l.item.id),n=0;n<t.length;++n)for(var a=t[n],m=0;;){m++;var s="CompoundTableIndex"+m;if(!(s in a))break;var u=e.find(o,"id",a[s]);u.length>0&&l.items.push(i.createBasicItem(u[0]))}}if(null!=this.item){var l=this;l.items=[];for(var r="platetable.json",o="all-items.json",a=[r,o],m=0;m<a.length;++m)e.init(a[m],null,function(){},function(){t(function(){l.initSets()})});this.initSets=function(){for(var t=0;t<a.length;++t)if(!e.isLoaded(a[t]))return;l.items=[],n()}}}]).directive("dngearsimItemViewPlate",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewPlateCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-plate.html"}});
"use strict";angular.module("dnsim").controller("itemViewSetCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(t,e,o){function n(t){for(var n=e.find(t,"SetItemID",i.item.setId),s=0;s<n.length;++s){var l=e.find(a,"id",n[s].id);l.length>0&&i.items.push(o.createBasicItem(l[0]))}}if(null!=this.item){var i=this;i.items=[];for(var s=["partstable.optimised.json","partstable_cash.optimised.json","partstable_common2014.optimised.json","partstable_common2015.optimised.json","partstable_common2016.json","partstable_commoncash.json","partstable_equipment.optimised.json","partstable_event.json","partstable_guild.json","partstable_pvp.optimised.json","partstable_reboot.optimised.json","partstable_skilllevelup.json","weapontable.optimised.json","weapontable_cash.optimised.json","weapontable_common2014.optimised.json","weapontable_common2015.optimised.json","weapontable_common2016.json","weapontable_commoncash.json","weapontable_equipment.optimised.json","weapontable_event.json","weapontable_guild.json","weapontable_pvp.optimised.json","weapontable_reboot.optimised.json"],a="all-items.json",l=s.concat([a]),m=0;m<l.length;++m)e.init(l[m],null,function(){},function(){t(function(){i.initSets()})});this.initSets=function(){for(var t=0;t<l.length;++t)if(!e.isLoaded(l[t]))return;i.items=[];for(var t=0;t<s.length;++t)n(s[t])}}}]).directive("dngearsimItemViewSet",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewSetCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-set.html"}});
"use strict";angular.module("dnsim").controller("itemViewShopCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(e,t,s,o,a){function i(e){for(var i=t.find(e,"itemindex",n.item.id),h=0;h<i.length;++h){var r=i[h],u=t.find(m,"id",r.PurchaseItem1),l=t.find(m,"id",r.PurchaseItem2),c={shopName:r.ShopID,tabName:a.translate(r.TabNameID),gold:0,nightmarePoints:0,dungeonPoints:0,nestPoints:0,ladderPoints:0,item1:s.createBasicItem(u[0]),item2:s.createBasicItem(l[0]),numItem1:0,numItem2:0};c.shopName in o.shopNames&&(c.shopName=o.shopNames[c.shopName]),1==r.PurchaseType1?c.gold+=r.PurchaseItemValue1:3==r.PurchaseType1?c.ladderPoints+=r.PurchaseItemValue1:8==r.PurchaseType1?c.nightmarePoints+=r.PurchaseItemValue1:13==r.PurchaseType1?c.nestPoints+=r.PurchaseItemValue1:14==r.PurchaseType1?c.dungeonPoints+=r.PurchaseItemValue1:(c.numItem1=r.PurchaseItemValue1,c.pointsId1=r.PurchaseType1),1==r.PurchaseType2?c.gold+=r.PurchaseItemValue2:3==r.PurchaseType2?c.ladderPoints+=r.PurchaseItemValue2:8==r.PurchaseType2?c.nightmarePoints+=r.PurchaseItemValue2:13==r.PurchaseType1?c.nestPoints+=r.PurchaseItemValue2:14==r.PurchaseType1?c.dungeonPoints+=r.PurchaseItemValue2:(c.numItem2=r.PurchaseItemValue2,c.pointsId2=r.PurchaseType2),c.gold=c.gold/100/100,n.shopCosts.push(c)}}if(null!=this.item){var n=this;n.shopCosts=[];for(var m="all-items.json",h=["combinedshoptable_cash.json","combinedshoptable_system.json","combinedshoptable.json",m],r=0;r<h.length;++r)t.init(h[r],null,function(){},function(){e(function(){n.initShops()})});this.initShops=function(){for(var e=0;e<h.length;++e)if(!t.isLoaded(h[e]))return;n.shopCosts=[],i("combinedshoptable.json"),i("combinedshoptable_system.json"),i("combinedshoptable_cash.json");for(var s=[],e=0;e<n.shopCosts.length;++e){for(var o=!1,a=0;a<s.length;++a)if(n.shopCosts[e].tabName==s[a].tabName&&n.shopCosts[e].gold==s[a].gold&&n.shopCosts[e].item1.id==s[a].item1.id&&n.shopCosts[e].numItem1.id==s[a].numItem1.id&&n.shopCosts[e].item2.id==s[a].item2.id&&n.shopCosts[e].numItem2.id==s[a].numItem2.id){o=!0;break}o||s.push(n.shopCosts[e])}n.shopCosts=s}}}]).directive("dngearsimItemViewShop",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewShopCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-shop.html"}});
"use strict";angular.module("dnsim").controller("itemViewTransferCtrl",["$timeout","dntData","itemFactory","hCodeValues",function(e,t,n,i){if(null!=this.item){var r=this;r.matchingTransfers=[];for(var a=["enchanttransfertable.json","all-items.json","enchanttransferitemtable.json"],l=0;l<a.length;++l)t.init(a[l],null,function(){},function(){e(function(){r.initTransfers()})});this.initTransfers=function(){for(var e=0;e<a.length;++e)if(!t.isLoaded(a[e]))return;r.matchingTransfers=[];var l=t.find("enchanttransferitemtable.json","ItemID",r.item.id);if(l&&l.length>0)for(var m=t.find("enchanttransfertable.json","EnchantLevel",r.item.enchantmentNum),e=0;e<m.length;++e){var s=m[e];if(s.Rank==r.item.rank.id&&s.LevelLimit==r.item.levelLimit){var o=t.find("all-items.json","id",s.NeedItemID1),f=t.find("all-items.json","id",s.NeedItemID2);r.matchingTransfers.push({level:s.ResultLevel,enchantmentNum:s.ResultEnchantLevel,gold:s.NeedCoin/100/100,rank:i.rankNames[s.ResultRank],numItem1:s.NeedItemCount1,item1:n.createBasicItem(o[0]),numItem2:s.NeedItemCount2,item2:n.createBasicItem(f[0])})}}}}}]).directive("dngearsimItemViewTransfer",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewTransferCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-transfer.html"}});
"use strict";angular.module("dnsim").controller("itemViewTuningCtrl",["$timeout","dntData","itemFactory","hCodeValues",function(e,t,i,n){if(null!=this.item){var r=this;r.rewardItems=[];for(var l=["all-items.json","itemchangetable.json"],a=0;a<l.length;++a)t.init(l[a],null,function(){},function(){e(function(){r.initTransfers()})});this.initTransfers=function(){for(var e=0;e<l.length;++e)if(!t.isLoaded(l[e]))return;r.rewardItems=[];var n=t.find("itemchangetable.json","OriginalItemID",r.item.id);if(n&&n.length>0)for(var e=0;e<n.length;++e){var a=n[e];if(a.OriginalLevel==r.item.enchantmentNum||!a.OriginalLevel){var m=t.find("all-items.json","id",a.RewardItemID);r.rewardItems.push({rewardItem:i.createBasicItem(m[0])})}}}}}]).directive("dngearsimItemViewTuning",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewTuningCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-tuning.html"}});
"use strict";angular.module("dnsim").controller("ItemCtrl",["$scope","$window","dntData","hCodeValues","items","jobs","exportLinkHelper","$routeParams","translations","$location","region","itemFactory","$timeout","statHelper","saveHelper",function(e,t,i,n,a,r,o,m,s,l,u,c,d,f,p){function g(){var t=r.getAllJobs();angular.forEach(t,function(t,i){t.id==e.item.needJobClass&&(e.jobName=t.name)})}function I(){var t=!1;return angular.forEach(o.getDntFiles(e.preInitItem),function(e,n){i.isLoaded(n)||(t=!0)}),!t&&s.isLoaded()&&r.isLoaded()}function v(){if(I()){if(e.item=o.reloadItem(e.preInitItem),null==e.item)return;D(),t.document.title="dngearsim | "+e.item.name,"custom"!=e.item.itemSource&&("skills"==e.item.typeName?e.item.pve&&"pvp"==e.item.pve?e.item.pve="pvp":e.item.pve="pve":e.item.needJobClass>0&&g(),h()),S()}}function S(){var t=c.getItemData(e.item);t.DisjointDrop1>0&&(e.canExtract=!0),(0==t.Type||1==t.Type)&&e.item.enchantmentNum>0&&(e.canTransfer=!0),0!=t.Type&&1!=t.Type||(e.canTune=!0),e.item.setId&&(e.isInSet=!0),5==e.item.typeId&&(e.isPlate=!0),46==e.item.typeId||8==e.item.typeId||112==e.item.typeId||122==e.item.typeId||142==e.item.typeId||160==e.item.typeId?(e.hasContents=!0,e.detail="contents"):null!=e.item.typeName?(e.canUse=!0,e.detail="use"):e.canExtract?e.detail="extract":e.canTransfer?e.detail="transfer":e.canTune?e.detail="tuning":e.isPlate?e.detail="plate":e.detail="attainment"}function h(){e.item.fileName||e.item.itemSource in a&&a[e.item.itemSource].mainDnt&&(e.item.fileName=a[e.item.itemSource].mainDnt.replace(".json","").replace(".json","").replace(".optimised",""))}function D(){e.item.fullStats=e.item.stats,null!=e.item.enchantmentStats&&e.item.enchantmentStats.length>0&&(e.item.fullStats=n.mergeStats(e.item.enchantmentStats,e.item.fullStats)),null!=e.item.sparkStats&&e.item.sparkStats.length>0&&(e.item.fullStats=n.mergeStats(e.item.sparkStats,e.item.fullStats))}function y(e){}function b(){var t=p.getSavedItems();e.builds=t}u.setLocationByName(m.region),t.scrollTo(0,0),e.jobName=null,e.item=o.decodeItem(m.i),"itemSource"in e.item&&(e.itemType=a[e.item.itemSource]),e.item.setStats=null,e.item.setId=null,e.detail=null,e.getDescription=function(){if(e.item.description)return e.item.description;if(e.itemType&&"title"==e.itemType.name&&s.isLoaded()&&i.isLoaded(e.itemType.mainDnt)){var t=i.find(e.itemType.mainDnt,"id",e.item.id);if(t&&t.length>0&&t[0].DescriptionID>0)return s.translate(t[0].DescriptionID,t[0].DescriptionIDParam)}else if(e.item.fileName&&i.isLoaded(e.item.fileName+".json")){var t=i.find(e.item.fileName+".json","id",e.item.id);if(t&&t.length>0&&t[0].DescriptionID>0)return s.translate(t[0].DescriptionID,t[0].DescriptionIDParam)}return""},e.getExchangeType=function(){if(s.isLoaded()&&i.isLoaded("exchange.json")&&e.item.exchangeType>0){var t=i.find("exchange.json","ExchangeType",e.item.exchangeType);if(t&&t.length>0&&t[0].NameID>0)return s.translate(t[0].NameID).toLowerCase()}return""},e.setDetail=function(t){e.detail=t},e.getNumInSet=function(){var t=e.getBuildName();return t&&e.item&&e.item.setId?f.getNumItemsForSet(e.builds[t].items,e.item.setId):0},e.getBuildName=function(){var t=p.getCurrentBuild();if(e.builds&&!(t&&t in e.builds)){var i=Object.keys(e.builds);i.length&&(t=i[0])}return t},e.getSellingPrice=function(){var t=c.getItemData(e.item),i="";if("SellAmount"in t&&t.SellAmount>0){var n=Math.floor(t.SellAmount/1e4);n&&(i+=n+"gold ");var a=Math.floor(t.SellAmount/100)%100;a&&(i+=a+"silver ");var r=t.SellAmount%100;r&&(i+=r+"copper ")}return i},e.getServerStorage=function(){var t=c.getItemData(e.item),i="";return t&&"IsCash"in t&&0==t.IsCash&&(t&&"AbleWStorage"in t&&(1==t.AbleWStorage?i="can server storage":0==t.AbleWStorage&&t&&"Reversion"in t&&t.Reversion&&(i="not transferable")),t&&"Reversion"in t&&(i.length&&(i+=", "),0==t.Reversion?i+="can trade":1==t.Reversion&&(i+="not tradable "))),i},e.getMoreInfo=function(){var t=0,n=0;if(e.moreInfoLoaded()){var a=c.getItemData(e.item);if(a&&"IsCash"in a&&0==a.IsCash){if(a&&"SealID"in a&&"SealCount"in a){t=a.SealCount;var r=i.find("sealcounttable.json","Type2",a.SealID);if(r&&r.length>0&&0==r[0].Type1){var o="Count0";e.item.enchantmentNum&&(o="Count"+e.item.enchantmentNum),o in r[0]&&(n=r[0][o])}}}else if(a&&"IsCash"in a&&"CashTradeCount"in a&&"Reversion"in a&&"AbleWStorage"in a)return 2==a.Reversion?a.CashTradeCount?"can server storage, cash trade count: "+a.CashTradeCount:"can server storage, can use warranty":a.AbleWStorage?"can server storage":"not tradable"}return t&&n?"can stamp "+t+" times using "+n+"  stamps":""},e.moreInfoLoaded=function(){return i.isLoaded(e.item.fileName+".json")&&i.isLoaded("sealcounttable.json")},e.loadMoreInfo=function(){i.init(e.item.fileName+".json",null,d),i.init("sealcounttable.json",null,d)},e.handleChange=function(){"custom"!=e.item.itemSource?l.search("i",o.encodeItem(e.item)):(D(),e.item=angular.copy(e.item)),b()},function(){b(),e.preInitItem=e.item,e.item=null;var t=!1;angular.forEach(o.getDntFiles(e.preInitItem),function(e,n){i.isLoaded(n)||(i.init(n,e,y,v),t=!0)}),s.isLoaded()||(s.init(y,v),t=!0),r.isLoaded()||(r.init(y,v),t=!0),t||v()}()}]);
"use strict";angular.module("dnsim").controller("ExportCtrl",["$scope","$window","saveHelper",function(e,t,a){document.body.className="default-back",t.document.title="dngearsim | EXPORT";var o=a.getSavedItems();e.exportData=JSON.stringify(o,null,1),e.save=function(){localStorage.setItem("savedItems",LZString.compressToUTF16(e.exportData))}}]);
"use strict";angular.module("dnsim").controller("HeaderCtrl",[function(){var e=this;e.doClose=function(){localStorage.setItem("notice1",!0),e.isClosed=!0},e.isClosed=!0}]).directive("dngearsimHeader",function(){return{templateUrl:"ui/nav/header.html",controller:"HeaderCtrl",controllerAs:"ctrl"}});
"use strict";angular.module("dnsim").controller("NavCtrl",["$scope","$location","translations","region","itemCategory","saveHelper",function(t,n,e,a,o,r){try{var i=[],l=[{path:"builds",name:"builds",icon:"menu-hamburger"},{path:"search",name:"search",icon:"search"}],s={path:"build",name:"build"},c=[{path:"builds",name:"builds",icon:"menu-hamburger"},{path:"search",name:"search",icon:"search"},s];a.init(),t.isSearch=function(){return 0==n.path().indexOf("/search")},t.isLoading=function(){return e.startedLoading&&!e.isLoaded()&&null!=a.tlocation&&""!=a.tlocation.url&&!t.noRegion()},t.noRegion=function(){return null==a.dntLocation},t.isHttpOnly=function(){return"https:"!=location.protocol&&"localhost"!=location.hostname},t.getActions=function(){try{var e=null,o=r.getCurrentBuild();o&&(t.savedItems&&o in t.savedItems||(t.savedItems=r.getSavedItems()),o in t.savedItems||(o=null)),null!=a.dntLocation&&""==a.dntLocation.url?e=i:null!=a.tlocation&&""==a.tlocation.url?e=i:o&&"null"!=o?(e=c,s.path="build?buildName="+encodeURIComponent(o),s.name=o,o in t.savedItems&&(s.build=t.savedItems[o])):e=("/view-group"==n.path()||a.dntLocation,l);var u=n.path;return angular.forEach(e,function(t,n){delete t.extraCss,u&&1==u.length?1==t.path.length&&(t.extraCss="active"):t.path&&t.path.length>1&&0==u.indexOf("/"+t.path)&&("builds"==t.path&&"/builds"!=u||(t.extraCss="active"))}),e}catch(n){t.simError=n.message,console.error(n)}}}catch(n){t.simError=n.message,console.error(n)}}]).directive("dngearsimNav",function(){return{templateUrl:"ui/nav/nav.html"}});
"use strict";angular.module("dnsim").controller("SetupCtrl",["$scope","$window","$route","$timeout","translations","dntInit","dntReset","region",function(t,n,o,e,i,s,a,l){function c(){u("current translations contain words like "+i.translate(329)+", "+i.translate(323)+" and "+i.translate(335)),t.isLoading=!1}function r(n){e(function(){null!=t.testResults&&t.testResults.push(n)})}function u(n){e(function(){null!=t.translationResults&&t.translationResults.push(n)})}document.body.className="default-back",n.document.title="dngearsim | SETUP",t.advancedSetup=!1,t.isLoading=i.startedLoading&&!i.isLoaded(),t.translationResults=[],t.hostedFiles=l.hostedFiles;var d=l.alternativeFiles.url;null==d&&(d=""),t.location=d,""==t.location?t.testResults=["No location set"]:t.testResults=["Using location "+t.location],t.setLocation=function(n){t.location=n,t.isLoading=!0,t.saveLocation(),a(),t.translationResults=[];var o=localStorage.getItem("UIStrings_file");null!=o&&o.indexOf(n)!=-1||sessionStorage.removeItem("UIStrings"),i.reset(),i.location=n,i.init(u,c)},t.resetSessionData=function(){t.testResults=["session data reset.. reloading page"],l.tlocation=null,l.dntLocation=null,i.reset(),sessionStorage.clear(),localStorage.clear(),this.saveLocation(),e(function(){location.hash="",location.reload(!0)})},t.loadUiString=function(){t.translationResults=[],sessionStorage.removeItem("UIStrings"),a(),i.reset(),i.location=l.tlocation.url,i.region=l.tlocation.region,i.init(u,c)},t.saveLocation=function(){a(),""!=t.location&&(l.setCustomUrl(t.location),l.init(),l.alternativeFiles.region==l.tlocation.region&&(i.reset(),i.init(u,c)),t.testResults=["Location saved","Using location "+t.location])},t.testLocation=function(){""!=t.location&&(t.testResults=["Using location "+t.location,"Loading all data used by the app"],i.init(r,function(){s(r)}))}}]);
"use strict";!function(){function l(l,t,e,s,i){function u(){o.job&&s.getClassBuilds(o.job).then(function(l){o.jobBuilds=l?l:{}})}var o=this;o.maxDisplay=15,o.totalNumResults=0,i.init(null,function(){l.jobId&&(o.job=i.getById(l.jobId),u())}),this.setJob=function(){e(function(){t.search("jobId",o.job.id)})},this.showMoreResults=function(l){o.maxDisplay=o.totalNumResults+l,o.totalNumResults=0},o.allResults=null,o.getFilteredBuilds=function(){if(null==o.allResults){o.allResults=[];for(var l in o.jobBuilds)for(var t in o.jobBuilds[l])o.allResults.push({uid:l,name:t,data:o.jobBuilds[l][t]})}for(var e=[],s=0;s<o.allResults.length;++s){var i=o.allResults[s];if(o.filter&&o.filter.length>0){var u=o.filter.toUpperCase();if(i.name.toUpperCase().indexOf(u)==-1&&(!i.data.guild||i.data.guild.toUpperCase().indexOf(u)==-1))continue}if(e.push(i),e.length>=o.maxDisplay)break}return o.totalNumResults=e.length,e}}angular.module("dnsim").controller("BuildSearchCtrl",["$routeParams","$location","$timeout","onlineService","jobs",l])}();
"use strict";!function(){function i(i,t,e,n){var u=this;u.uid=t.uid,function(){e.getUserBuilds(u.uid).then(function(i){u.storedBuilds=i?i:{}})}(),function(){e.getProfile(u.uid).then(function(i){u.profile=i?i:{}})}(),this.load=function(t,e){var o=n.importGroup(t,e.items);n.saveBuild(o,o,e),u.builds=n.getSavedItems(),i.path("/build"),i.search("buildName",o)}}angular.module("dnsim").controller("ProfileCtrl",["$location","$routeParams","onlineService",i])}();
"use strict";!function(){function e(e,t,i,l,u){function s(){var e=r.getUser();e&&i.getUserBuilds(e.uid).then(function(e){r.storedBuilds=e?e:{}})}function n(){var e=r.getUser();e&&i.getProfile(e.uid).then(function(e){r.profile=e?e:{}})}function o(e){console.log(e)}var r=this;r.show=l.show,i.login().then(function(e){s(),n(),r.builds=t.getSavedItems()}),this.saveProfile=function(){i.saveProfile(r.profile).then(n).catch(o)},this.getUser=function(){return i.getUser()},this.save=function(e,t){t.lastUpdate=(new Date).getTime(),i.saveBuild(e,t).then(s).catch(o),r.publishBuild=null},this.startPublish=function(e){e in r.storedBuilds&&(r.builds[e].region||(r.builds[e].region=r.storedBuilds[e].region),r.builds[e].about||(r.builds[e].about=r.storedBuilds[e].about),r.builds[e].guild||(r.builds[e].guild=r.storedBuilds[e].guild)),r.builds[e].region||(r.builds[e].region=u.dntLocation.region),r.publishBuild=e},this.deleteAccount=function(){i.deleteAccount(r.storedBuilds)},this.getBuildLimit=function(){return r.profile&&r.profile.maxBuilds?r.profile.maxBuilds:15},this.getNumStoredBuilds=function(){return _.size(r.storedBuilds)},this.getNumBuilds=function(){return _.size(r.builds)},this.load=function(e,i){var l=t.importGroup(e,i.items);t.saveBuild(l,l,i),r.builds=t.getSavedItems()},this.signOut=function(){i.signOut()},r.deleteLocal=function(e){r.localToDelete=e},r.getAllBuildNames=function(){var e=_.keys(r.builds).concat(_.keys(r.storedBuilds));return _.uniq(e.sort(),!0)},r.reallyDeleteLocal=function(e){t.updatedSavedItems(e,[]),r.localToDelete=null,r.builds=t.getSavedItems()},r.deleteServer=function(e){r.serverToDelete=e},r.reallyDeleteServer=function(e){i.deleteBuild(e,r.storedBuilds[e]).then(s),r.serverToDelete=null}}angular.module("dnsim").controller("PublishCtrl",["$location","saveHelper","onlineService","$routeParams","region",e])}();
"use strict";!function(){function i(i,u,e,t,l){var n=this;n.uid=e.uid,n.buildName=e.buildName,function(){i.getBuild(n.uid,n.buildName).then(function(i){i?(n.build=i,n.stats=l.getBuildStats(i)):n.build={}})}(),function(){i.getProfile(n.uid).then(function(i){n.profile=i?i:{}})}(),n.copyLocally=function(){var i=t.importGroup(n.buildName,n.build.items);t.saveBuild(i,i,n.build),u.path("/build"),u.search("buildName",i)}}angular.module("dnsim").controller("PublishedCtrl",["onlineService","$location","$routeParams","saveHelper","statHelper",i])}();
"use strict";angular.module("dnsim").controller("RegionCtrl",["$timeout","$route","$routeParams","$location","translations","region","$http",function(t,n,o,i,e,r,a){function c(){d.region.dntLocation&&d.region.dntLocation.url&&a.get(d.region.dntLocation.url+"/Version.cfg").then(function(t){if(t&&t.data){var n=t.data.split("\r\n");if(n.length){var o=n[0].split(" ");o.length>1&&(d.dntVersion="v"+o[1])}}})}var d=this;d.override=r.getOverride(),r.init(),e.init(function(t){},function(){t()}),d.region=r,d.tHoverLocation=r.tlocation,d.hoverLocation=r.dntLocation,d.edit=null==r.dntLocation,d.dntVersion="",c(),d.getDntLocation=function(){return r.dntLocation},d.getTlocation=function(){return r.tlocation},d.getHostedFiles=function(){return r.hostedFiles},d.getWorldName=function(){return e.isLoaded()?e.translate(10169):""},d.setTLocation=function(t){r.setTLocation(t),d.edit=!1},d.setLocation=function(t){d.override||d.setTLocation(null),o.region?(o.region=t.region,n.updateParams(o),n.reload()):r.setLocation(t),d.edit=!1,c()},d.setOverride=function(t){r.setOverride(t),d.override=t,d.edit=t}}]).directive("dngearsimRegion",function(){return{templateUrl:"ui/region/region.html",controllerAs:"ctrl"}});
"use strict";!function(){function t(t,e,s,n,i,m){this.customItems=n.customItems,this.maxDisplay=10,this.currentResults=0,null==this.nameSearch&&(this.nameSearch=""),this.getResults=function(){return this.customItems},this.getNewStatName=function(){return""==this.nameSearch||null==this.nameSearch?"unnamed custom item":this.nameSearch},this.createCustomItem=function(){""!=this.nameSearch&&null!=this.nameSearch||(this.nameSearch=this.getNewStatName()),s.path("/item/_custom:."+this.nameSearch)}}angular.module("dnsim").directive("dngearsimCustomItems",function(){return{scope:{},bindToController:{},controller:["$window","saveHelper","$location","hCodeValues","itemCategory","$timeout",t],controllerAs:"customItems",templateUrl:"ui/search/custom-items.html"}})}();
"use strict";!function(){function e(e,n,a,i,r,t,l,m){var o=this;o.everything=null,o.maxDisplay=32,o.currentResults=0,o.results=null,o.minLevel=1,o.maxLevel=99,o.version="all",o.versions=[o.version];var v=Number(localStorage.getItem("minLevel"));a.minLevel&&(v=Number(a.minLevel)),v>0&&v<100&&(o.minLevel=v),o.origMinLevel=v;var s=Number(localStorage.getItem("maxLevel"));a.maxLevel&&(s=Number(a.maxLevel)),s>0&&s<100&&(o.maxLevel=s),o.origMaxLevel=s,o.nameSearch||(o.nameSearch=localStorage.getItem("nameSearch"),a.name&&(o.nameSearch=a.name),null==o.nameSearch&&(o.nameSearch="")),e.document.title="dngearsim | ALL ITEM SEARCH",o.initeverything=function(){if(m.isLoaded(c)&&l.isLoaded()&&!o.everything){o.everything=[];for(var e={},a=m.getData(c),i=0;i<a.length;++i){var t=a[i];if(t.NameID>0){var v={id:t.id,name:l.translate(t.NameID,t.NameIDParam),rank:r.rankNames[t.Rank],icon:t.IconImageIndex,levelLimit:t.LevelLimit,fileName:t.fileName,version:t.version};o.everything.push(v),t.version&&(e[t.version]=!0)}}for(var s in e)o.versions.push(s);o.everything=_.sortBy(o.everything,"name"),n(function(){o.showMoreResults()})}},o.getResults=function(){if(null==o.everything&&o.initeverything(),null==o.everything)return[];for(var e=[],n=o.everything.length,a=0,i=0;i<n&&a<o.maxDisplay;++i){var r=o.everything[i];if(!(r.levelLimit<o.minLevel||r.levelLimit>o.maxLevel)&&r.levelLimit&&("all"==o.version||o.version==r.version)){if(""!=o.nameSearch){var t=o.nameSearch.split(" ");0==t.length&&(t=[o.nameSearch]);for(var l=!0,m=0;m<t.length;++m)if(r.name&&r.name.toString().toUpperCase().indexOf(t[m].toUpperCase())==-1){l=!1;break}if(!l)continue}e.push(r),a++}}return o.totalNumResults=e.length,e},o.changeSearch=function(){o.minLevel!=o.origMinLevel&&(localStorage.setItem("minLevel",o.minLevel),i.search("minLevel",o.minLevel),o.origMinLevel=o.minLevel),o.maxLevel!=o.origMaxLevel&&(localStorage.setItem("maxLevel",o.maxLevel),i.search("maxLevel",o.maxLevel),o.origMaxLevel=o.maxLevel),localStorage.setItem("nameSearch",o.nameSearch),i.search("name",o.nameSearch),o.maxDisplay=64,o.results=o.getResults()},o.showMoreResults=function(){n(function(){o.maxDisplay+=18,o.results=o.getResults()})};var c="all-items.json";m.init(c,null,function(){},function(){o.initeverything()},!1),l.init(null,o.initeverything)}e.$inject=["$window","$timeout","$routeParams","$location","hCodeValues","region","translations","dntData"],angular.module("dnsim").directive("dngearsimEverythingSearch",function(){return{scope:{},bindToController:{nameSearch:"=nameSearch"},controller:e,controllerAs:"items",templateUrl:"ui/search/everything-search.html"}})}();
"use strict";!function(){function e(e,a,t,i,r,o,l,n,s,m,c,g,u){function v(){s.init(d,h)}function d(e){}function h(){if(l.isLoaded()&&s.isLoaded()){var e=s.getFinalJobs();e.splice(0,0,L.jobs[0]),L.jobs=e,L.allJobs=s.getAllJobs();var a=Number(localStorage.getItem("jobNumber"));t.job&&t.job&&(a=Number(t.job)),null!=a&&angular.forEach(e,function(e,t){if(e.id==a)return void(L.job=e)}),n.init(L.itemCategory.name,b)}}function b(){L.maxDisplay=24,L.results=S()}function S(){var e=n.getItems(L.itemCategory.name);if(null==e)return null;e=e.sort(function(e,a){return a.levelLimit-e.levelLimit});var a=-1;"pc"in L.stat&&(a=L.stat.pc);var t=-1;"altStat"in L.stat&&(t=L.stat.altStat);for(var i=[],r=[],o=e.length,l=0,s=0;s<o&&(l<L.maxDisplay||L.stat.id>=0);++s){var m=e[s];if(m){if(!L.itemCategory.hideLevel&&(m.levelLimit<L.minLevel||m.levelLimit>L.maxLevel))continue;if(!L.itemCategory.hideRank&&m.rank&&!L.rankChecked[m.rank.id])continue;if(!L.itemCategory.hideJob&&L.job&&L.job.id>-1&&!L.job.isClassJob(m.needJobClass))continue;if(c.initItem(m),m.typeName!=L.itemCategory.name)continue;if(""!=L.nameSearch){var g=L.nameSearch.split(" ");g.length||(g=[L.nameSearch]);for(var u=!0,v=0;v<g.length;++v)if(m.name.toUpperCase().indexOf(g[v].toUpperCase())==-1){u=!1;break}if(!u)continue}if(L.stat.id>=0){for(var d=!1,h={},b=0;b<m.stats.length;++b){var S=m.stats[b];if(S.id==L.stat.id){d=!0,h.i=l,h.s=Number(S.max);break}S.id==a?(d=!0,h.i=l,h.s=Number(S.max)):S.id==t&&(d=!0,h.i=l,h.s=Number(S.max))}if(!d)continue;i.push(h)}r.push(m),l++}}if(L.stat.id>=0){var f=Math.min(l,L.maxDisplay);i=i.sort(function(e,a){return a.s-e.s});for(var y=[],s=0;s<f;++s)y.push(r[i[s].i]);r=y}return L.totalNumResults=r.length,r}var L=this;if(L.itemCategory=n.byPath(t.cat),!L.itemCategory){var f=localStorage.getItem("selectedItemCategory");return f||(f="titles"),L.itemCategory=n.byName(f),L.itemCategory&&!L.itemCategory.hideInSearch||(f="titles",L.itemCategory=n.byName("titles")),void(L.itemCategory&&(r.search("cat",L.itemCategory.path),o.reload()))}a.document.title="dngearsim | SEARCH "+L.itemCategory.name.toUpperCase(),L.job={id:-1,name:""},L.jobs=[L.job],L.allJobs=[],L.minLevel=1,L.maxLevel=99,L.maxDisplay=10,L.totalNumResults=0,L.grades=m.rankNames,L.stat={id:-1,name:""},L.stats=[L.stat],L.results=null,angular.forEach(m.stats,function(e,a){e.searchable&&L.stats.push(e)});var y=Number(localStorage.getItem("minLevel"));t.minLevel&&(y=Number(t.minLevel)),y>0&&y<100&&(L.minLevel=y),L.origMinLevel=y;var C=Number(localStorage.getItem("maxLevel"));t.maxLevel&&(C=Number(t.maxLevel)),C>0&&C<100&&(L.maxLevel=C),L.origMaxLevel=C,L.nameSearch=localStorage.getItem("nameSearch"),t.name&&(L.nameSearch=t.name),L.nameSearch||(L.nameSearch=""),L.origSavedSearchStatId=localStorage.getItem("searchStat"),t.stat&&(L.origSavedSearchStatId=t.stat),L.origSavedSearchStatId>-1&&L.origSavedSearchStatId in m.stats&&(L.stat=m.stats[L.origSavedSearchStatId]),L.navigate=function(){var e=localStorage.getItem("selectedItemCategory");e&&(L.itemCategory=n.byName(e),L.itemCategory&&(r.search("cat",L.itemCategory.path),L.save(),o.reload()))},L.save=function(){L.itemCategory.hideLevel?(r.search("minLevel",null),r.search("maxLevel",null)):(L.minLevel!=L.origMinLevel&&(localStorage.setItem("minLevel",L.minLevel),r.search("minLevel",L.minLevel),L.origMinLevel=L.minLevel),L.maxLevel!=L.origMaxLevel&&(localStorage.setItem("maxLevel",L.maxLevel),r.search("maxLevel",L.maxLevel),L.origMaxLevel=L.maxLevel)),L.itemCategory.hideJob?r.search("job",null):null!=L.job&&L.origJobNumber!=L.job.id&&(localStorage.setItem("jobNumber",L.job.id),L.job.id>-1?r.search("job",L.job.id):r.search("job",null),L.origJobNumber=L.job.id),L.stat&&L.origSavedSearchStatId!=L.stat.id&&(localStorage.setItem("searchStat",L.stat.id),L.stat.id>-1?r.search("stat",L.stat.id):r.search("stat",null),L.origSavedSearchStatId=L.stat.id),localStorage.setItem("nameSearch",L.nameSearch),r.search("name",L.nameSearch)},L.rankChecked=m.checkedRank,L.changeSearch=function(){L.save(),b()},L.showMoreResults=function(){i(function(){L.maxDisplay+=18,L.results=S()})},g.init(),l.init(d,v)}var a=["$scope","$window","$routeParams","$timeout","$location","$route","translations","itemCategory","jobs","hCodeValues","itemFactory","region","saveHelper",e];angular.module("dnsim").controller("ItemSearchCtrl",a)}();
"use strict";!function(){function e(e,a,o,n,t,i,l,r,s){function c(e){return null!=e?"skilltable_character"+e.toLowerCase()+".json":null}function u(e){return null!=e?"skillleveltable_character"+e.toLowerCase()+"pve.json":null}function d(){if(h.loadedJobId==h.job.id)return h.skills;var a=[];if(h.job.id>=0){var n=o.getBaseJobName(h.job);a.push(n)}angular.forEach(a,function(o,n){var i=c(o),l=u(o);i&&(t.isLoaded(i)?t.isLoaded(l)?f(a,h.job):t.init(l,null,b,function(){e()}):t.init(i,null,b,function(){e()}))})}function f(e,a){h.skills=[];var o=!0;angular.forEach(e,function(e,a){var n=c(e);t.isLoaded(n)||(o=!1)}),o&&(angular.forEach(e,function(e,a){for(var o=c(e),l=t.getData(o),r=l.length,u=0;u<r;++u)if(0!=l[u].NameID&&(l[u].EffectClass1>0||l[u].EffectClass2>0||l[u].EffectClass3>0||l[u].EffectClass4>0||l[u].EffectClass5>0||l[u].EffectClass6>0)){var d={d:l[u]};d.id=l[u].id,d.typeName="skills",d.itemSource="skills",d.name=n.translate(l[u].NameID,l[u].NameIDParam),d.needJobClass=l[u].NeedJob,d.rank=i.rankNames[0],d.baseJobName=e.toLowerCase(),d.icon=l[u].IconImageIndex,h.skills.push(s.reloadSkill(d))}}),h.loadedJobId=a.id)}function b(e){}function m(){if(n.isLoaded()&&o.isLoaded()){var e=o.getFinalJobs();h.jobs&&h.jobs.length&&e.splice(0,0,h.jobs[0]),h.jobs=e,h.allJobs=o.getAllJobs();var a=Number(localStorage.getItem("jobNumber"));null!=a&&angular.forEach(e,function(e,o){if(e.id==a)return void(h.job=e)}),h.getResults()}}function g(){o.isLoaded()?e(m):o.init(b,function(){e(m)})}var h=this;h.allJobs=[],h.dntName="",h.skills=[],h.loadedJobId=-1,h.itemCategory=l.byName("skills"),h.nameSearch=localStorage.getItem("nameSearch"),h.nameSearch||(h.nameSearch=""),a.init(),n.isLoaded()?g():n.init(b,function(){e(g)}),h.navigate=function(){e(function(){h.itemCategory&&r.path(h.itemCategory.path)})},h.isLoading=function(){if(!n.isLoaded())return n.startedLoading||n.init(b,function(){}),!0;var e=o.getBaseJobName(h.job),a=c(e);return!(!a||t.isLoaded(a))},h.getResults=function(){var e=d();if(null==e)return[];h.job&&h.job.id>=0&&localStorage.setItem("jobNumber",h.job.id),localStorage.setItem("nameSearch",h.nameSearch);for(var a=[],o=e.length,n=0;n<o;++n){var t=e[n];if(""!=h.nameSearch){var i=h.nameSearch.split(" ");i.length||(i=[h.nameSearch]);for(var l=!0,r=0;r<i.length;++r)if(t.name&&t.name.toString().toUpperCase().indexOf(i[r].toUpperCase())==-1){l=!1;break}if(!l)continue}h.job.id>=0&&!h.job.isClassJob(t.needJobClass)||a.push(t)}return a}}angular.module("dnsim").directive("dngearsimSkillSearch",function(){return{scope:{},bindToController:{job:"=job",jobs:"=jobs"},controller:["$timeout","region","jobs","translations","dntData","hCodeValues","itemCategory","$location","exportLinkHelper",e],controllerAs:"skillSearch",templateUrl:"ui/search/skill-search.html"}})}();
"use strict";!function(){function t(){return{restrict:"E",scope:{},bindToController:{job:"=job",onSetJob:"&onSetJob"},templateUrl:"ui/widgets/choose-class.html",controllerAs:"ctrl",controller:["$window","$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad","character",o]}}function o(t,o,e,n,s,i,r,a,l,u){function c(t){}this.getFinalJobs=function(){for(var t=r.getFinalJobs(),o=[],e=0;e<t.length;++e)r.getBaseJobName(t[e])==this.bJob&&o.push(t[e]);return o},this.getBaseJobs=function(){return r.getBaseJobs()},this.getJobName=function(t){for(var o=r.getAllJobs(),e=0;e<o.length;++e)if(o[e].d.EnglishName==t)return o[e].name},this.setJob=function(t){this.job=t,t&&this.onSetJob()},r.init(c,n)}angular.module("dnsim").directive("dnsimChooseClass",t)}();
"use strict";!function(){function e(){return{restrict:"E",scope:{},bindToController:{collapse:"=collapse",cat:"=cat",buildScreen:"=buildScreen",onChange:"&onChange"},templateUrl:"ui/widgets/dnsim-category-links.html",controller:t,controllerAs:"ctrl"}}function t(e,t,n,o){var a=this;a.categories=e.categories,a.collapsed=!0,a.shouldShow=function(e){return a.buildScreen?!e.hideInBuild:!e.hideInSearch},a.isLoading=function(){return!n.loaded},a.setCategory=function(e){a.collapse&&(a.collapsed=!a.collapsed,t.scrollTo(0,0)),a.cat!=e&&(a.cat=e,localStorage.setItem("selectedItemCategory",e.name),a.onChange&&a.onChange())},a.getName=function(e){return e.tId?n.translate(e.tId).toLowerCase():o.instant(e.name)}}t.$inject=["itemCategory","$window","translations","$translate"],angular.module("dnsim").directive("dnsimCategoryLinks",e)}();
"use strict";!function(){function i(i,t,n){return{restrict:"E",scope:{item:"=item"},templateUrl:"ui/widgets/dnsim-item-icon.html",link:function(i,t,n){i.$watch("item",function(t,n){t&&(i.iconImage=i.getIcon())}),i.getIcon=function(){if(i.item&&i.item.icon>0){var t,n=Math.floor(i.item.icon/200+1);return t="skills"==i.item.typeName?"skillicon":"itemicon",n>9?t+n+".png":t+"0"+n+".png"}return null},i.iconImage=i.getIcon(),i.getIconXPostion=function(){return i.item&&i.item.icon>0?i.item.icon%10*40+5:0},i.getIconYPostion=function(){return i.item&&i.item.icon>0?40*Math.floor(i.item.icon%200/10)+4:0}}}}angular.module("dnsim").directive("dnsimItemIcon",["exportLinkHelper","$location","region",i])}();
"use strict";!function(){function i(i,e,t){return{restrict:"E",scope:{item:"=item",noClick:"=noClick"},templateUrl:"ui/widgets/dnsim-item-link.html",link:function(e,n,o){e.itemLink="item/?region="+t.dntLocation.region+"&i="+i.encodeItem(e.item),e.$watch("item",function(n,o){n&&(e.itemLink="item/?region="+t.dntLocation.region+"&i="+i.encodeItem(e.item))})}}}angular.module("dnsim").directive("dnsimItemLink",["exportLinkHelper","$location","region",i])}();
"use strict";!function(){function i(){return{restrict:"E",scope:{},bindToController:{item:"=item",small:"=small"},templateUrl:"ui/widgets/dnsim-job-icon.html",controller:t,controllerAs:"ctrl"}}function t(){this.small?(this.sizeValue="205px 205px",this.iconSize=22,this.iconOffset=0):(this.sizeValue="410px 410px",this.iconSize=44,this.iconOffset=5),this.getIconXPostion=function(){return this.item&&this.item.d&&this.item.d.JobIcon>0?this.item.d.JobIcon%9*this.iconSize+this.iconOffset:0},this.getIconYPostion=function(){return this.item&&this.item.d&&this.item.d.JobIcon>0?Math.floor(this.item.d.JobIcon/9)*this.iconSize+this.iconOffset:0}}angular.module("dnsim").directive("dnsimJobIcon",[i])}();
"use strict";!function(){function o(o,n,t,i){return{restrict:"E",transclude:!0,scope:{alsoShowFor:"=alsoShowFor"},templateUrl:"ui/widgets/dnsim-loading.html",link:function(a,d,u){a.$on("TRANSLATION_LOAD_EVENT",function(){a.setLoadCount()}),a.$on("DNTDATA_LOAD_EVENT",function(){a.setLoadCount()}),a.$on("DNTDATA_LOAD_ERROR",function(){t(function(){a.loadError=!0})}),a.$on("TRANSLATION_LOAD_ERROR",function(){t(function(){a.loadError=!0})}),a.numLoading=0,a.setLoadCount=function(){a.noRegion=!i.dntLocation;var d=o.anyLoading();n.isLoaded()||d++,(a.numLoading<d||!a.totalToLoad)&&(a.totalToLoad=d),a.numLoading=d,t()},a.loadError=!1,a.setLoadCount()}}}angular.module("dnsim").directive("dnsimLoading",["dntData","translations","$timeout","region",o])}();
"use strict";!function(){function t(){return{restrict:"A",link:function(t,n,i){var c=!1;n.on("click",function(t){if(!c)try{this.selectionStart=0,this.selectionEnd=this.value.length+1,c=!0}catch(t){this.select(),c=!0}}),n.on("blur",function(t){c=!1})}}}angular.module("dnsim").directive("dnsimSelectAllOnClick",[t])}();
"use strict";!function(){function n(n,t){return{restrict:"A",scope:{stats:"=stats",build:"=build",altStats:"=altStats",separator:"=separator",filter:"=filter",numInSet:"=numInSet"},link:function(i,e,a){function r(){function a(n){var t=e.clone();t.css("display",u),t.html(n),f.after(t),f=t,d.push(t)}e.css("display","none");var r=i.stats;r||(r=i.altStats),angular.forEach(d,function(n,t){n.remove()});var o=!0,f=e,l={};angular.forEach(r,function(t,i){var e=n.stats[t.id];e&&e.summaryFor&&(l[e.summaryFor]=t)}),angular.forEach(r,function(e,d){var u="";if(e.id in n.stats){var f=n.stats[e.id];if(!i.filter&&"hide"in f&&f.hide)return;if(i.filter&&!f[i.filter])return;if(f.summaryFor)return;if("hideIf"in f&&f.hideIf>0){if(_.find(r,function(n){return n.id==f.hideIf}))return}if(_.find(r,function(t){var i=n.stats[t.id];if(i)return i.addTo==f.id;console.log("cannot find stat id",t.id)}))return;if("addTo"in f&&f.addTo>0){var m=_.find(r,function(n){return n.id==f.addTo});m&&(e=_.clone(e),e.max+=m.max)}if(o||(u+=s),o=!1,"needSetNum"in e&&(e.needSetNum<=i.numInSet&&(u+="*"),u+=e.needSetNum+"&nbsp;"),u+="<strong>",i.build)if("primary"==f.element){var c=0;i.build.element&&(c=i.build.element.id),u+=t.instant(n.elements[c].name)+"&nbsp;"}else if("secondary"==f.element){var c=0;i.build.secondaryElement&&(c=i.build.secondaryElement.id),u+=t.instant(n.elements[c].name)+"&nbsp;"}if(u+=t.instant(f.name)+":</strong>&nbsp;"+f.display(e),f.combineWith>0&&angular.forEach(r,function(n,t){if(n.id==f.combineWith){if("addTo"in f&&f.addTo>0){var i=_.find(r,function(n){return n.id==f.addTo});i&&(n=_.clone(n),n.max+=i.max)}n.max!=e.max&&(u+="-"+f.display(n))}}),e.id in l){var p=l[e.id];u+="&nbsp;|&nbsp;<em>"+n.stats[p.id].display(p),u+="</em>"}}else o||(u+=s),o=!1,"needSetNum"in e&&(u+=e.needSetNum+"-Increases&nbsp;"),u+=e.id+":&nbsp;"+e.max;a(u)})}var s;s=i.separator?"&nbsp;"+i.separator+" ":"";var d=[],u=e.css("display");i.$watch("stats",function(n,t){n&&r()}),i.$watch("altStats",function(n,t){n&&r()}),i.$watch("numInSet",function(n,t){n>=0&&r()})}}}angular.module("dnsim").directive("dnsimStats",["hCodeValues","$translate",n])}();
"use strict";!function(){function n(){return{require:"ngModel",link:function(n,r,t,u){u.$parsers.push(function(n){return""+n}),u.$formatters.push(function(n){return parseFloat(n,10)})}}}angular.module("dnsim").directive("dnsimStringToNumber",n)}();
"use strict";!function(){function n(){return{require:"ngModel",link:function(n,r,t,e){e.$parsers.push(function(n){return""+n/100}),e.$formatters.push(function(n){return 100*parseFloat(n,10)})}}}angular.module("dnsim").directive("dnsimStringToPercent",n)}();
"use strict";!function(){function e(e){return{restrict:"A",link:function(n,i,t){var r=e(t.fileChange),a=function(e){n.$apply(function(){r(n,{$event:e,files:e.target.files})})};i[0].addEventListener("change",a,!1)}}}angular.module("dnsim").directive("fileChange",["$parse",e])}();
"use strict";!function(){function t(t,e,n,o){function i(t){}var a="rebootplayerweighttable.json",l="playercommonleveltable.json",r="playerleveltable.optimised.json";return{init:function(o){n.init(i,o),t.init(a,e.jobConversionColsToLoad,i,o,!1),t.init(l,e.statCapColsToLoad,i,o,!1),t.init(r,e.jobBaseStatColsToLoad,i,o,!1),t.init("heroleveltable.json",null,i,o,!1),t.init("potentialtable_herolevel.json",null,i,o,!1)},getHeroStats:function(e){var n=[];if(e>0){var i=t.findFast("heroleveltable.json","id",e);if(1==i.length){var a=t.getRow("heroleveltable.json",i[0]);if(a){var l=t.findFast("potentialtable_herolevel.json","PotentialID",a.HeroLevelAbilityID);if(1==l.length){var r=t.getRow("potentialtable_herolevel.json",l[0]);r&&(n=o.getStats(r))}}}}return n},getStatCaps:function(e){if(e>0){var n=t.findFast(l,"id",e);if(1==n.length)return t.getRow(l,n[0])}return{}},getConversions:function(e){if(e>0){var n=t.findFast(a,"id",e);if(1==n.length)return t.getRow(a,n[0])}return{}},getBaseStats:function(e,n){if(e>0&&n>0){var o=t.findFast(r,"id",100*Number(n)+Number(e)-100);if(1==o.length)return t.getRow(r,o[0])}return{}}}}t.$inject=["dntData","itemColumnsToLoad","jobs","hCodeValues"],angular.module("dnsim").factory("character",t)}();
"use strict";!function(){function t(){return{mainDnt:{NameID:!0,DescriptionID:!0,NameIDParam:!0,DescriptionIDParam:!0,Type:!0,TypeParam1:!0,TypeParam2:!0,TypeParam3:!0,LevelLimit:!0,NeedJobClass:!0,Rank:!0,State1:!0,StateValue1:!0,State1_Max:!0,State2:!0,StateValue2:!0,State2_Max:!0,State3:!0,StateValue3:!0,State3_Max:!0,State4:!0,StateValue4:!0,State4_Max:!0,State5:!0,StateValue5:!0,State5_Max:!0,State6:!0,StateValue6:!0,State6_Max:!0,State7:!0,StateValue7:!0,State7_Max:!0,State8:!0,StateValue8:!0,State8_Max:!0,State9:!0,StateValue9:!0,State9_Max:!0,State10:!0,StateValue10:!0,State10_Max:!0,EnchantID:!0,SkillID:!0,dragonjeweltype:!0,AbleWStorage:!0,ExchangeType:!0,IconImageIndex:!0,IsCash:!0,DisjointDrop1:!0,Disjointamount:!0,TierName:!0},partsDnt:{SetItemID:!0},enchantDnt:{EnchantID:!0,EnchantLevel:!0,EnchantRatio:!0,BreakRatio:!0,MinDown:!0,MaxDown:!0,NeedCoin:!0,DisjointDrop:!0,NeedItemID1:!0,NeedItemCount1:!0,NeedItemID2:!0,NeedItemCount2:!0,NeedItemID3:!0,NeedItemCount3:!0,NeedItemID4:!0,NeedItemCount4:!0,NeedItemID5:!0,NeedItemCount5:!0,ProtectItemCount:!0,State1:!0,State1Value:!0,State2:!0,State2Value:!0,State3:!0,State3Value:!0,State4:!0,State4Value:!0,State5:!0,State5Value:!0,State6:!0,State6Value:!0,State7:!0,State7Value:!0,State8:!0,State8Value:!0,State9:!0,State9Value:!0,State10:!0,State10Value:!0},potentialDnt:{PotentialID:!0,PotentialNo:!0,PotentialRatio:!0,State1:!0,State1Value:!0,State2:!0,State2Value:!0,State3:!0,State3Value:!0,State4:!0,State4Value:!0,State5:!0,State5Value:!0,State6:!0,State6Value:!0,State7:!0,State7Value:!0,State8:!0,State8Value:!0,State9:!0,State9Value:!0,State10:!0,State10Value:!0,State11:!0,State11Value:!0,State12:!0,State12Value:!0,State13:!0,State13Value:!0,State14:!0,State14Value:!0,State15:!0,State15Value:!0,State16:!0,State16Value:!0},gemDnt:{Type:!0},setDnt:null,jobsDnt:{JobName:!0,JobNumber:!0,BaseClass:!0,ParentJob:!0,EnglishName:!0,JobIcon:!0},jobBaseStatColsToLoad:{Strength:!0,Agility:!0,Intelligence:!0,Stamina:!0,AggroperPvE:!0,BaseMP:!0},statCapColsToLoad:{Cbase:!0,Cdefense:!0,Ccritical:!0,Cfinaldamage:!0,CcriticalDamage:!0},jobConversionColsToLoad:{HP:!0,StrengthAttack:!0,AgilityAttack:!0,IntelligenceAttack:!0,PhysicalDefense:!0,MagicDefense:!0,Critical:!0,CriticalResistance:!0,Stiff:!0,StiffResistance:!0,Stun:!0,StunResistance:!0,MoveSpeed:!0,MoveSpeedRevision:!0,DownDelay:!0,ElementAttack:!0,ElementDefense:!0,ElementDefenseMin:!0,ElementDefenseMax:!0,StrengthIntelligenceToCriticalDamage:!0}}}angular.module("dnsim").factory("itemColumnsToLoad",[t])}();
"use strict";!function(){function t(t,e){function n(n,a,i){return{reader:new DntReader,loaded:!1,startedLoading:!1,file:a,dntLocation:n,completeCallbacks:[],init:function(n,o,r){if(this.loaded)o&&o();else if(o&&this.completeCallbacks.push(o),!this.startedLoading){this.startedLoading=!0;var s=this;this.reader.colsToLoad=i,this.dntLocation&&this.dntLocation.url&&this.dntLocation.url.length&&(t.$broadcast("DNTDATA_LOAD_EVENT"),e(function(){s.reader.loadDntFromServerFile(s.dntLocation.url+"/"+a,function(t){},function(e,n){s.loaded=!0,angular.forEach(s.completeCallbacks,function(t,e){t&&t()}),s.completeCallbacks=[],t.$broadcast("DNTDATA_LOAD_EVENT")},function(e){s.failed=!0,r?(s.loaded=!0,console.log("ignoring the error - this file may not exist yet for the region"),angular.forEach(s.completeCallbacks,function(t,e){t&&t()}),s.completeCallbacks=[],t.$broadcast("DNTDATA_LOAD_EVENT")):(s.startedLoading=!1,s.loaded=!1,t.$broadcast("DNTDATA_LOAD_ERROR"))})}))}},reset:function(){this.reader=new DntReader,this.loaded=!1,this.startedLoading=!1}}}return{loaders:{},findIndexes:{},dntLocation:null,setLocation:function(t){this.dntLocation=t;var e=this;angular.forEach(this.loaders,function(n,a){n.dntLocation!=t&&(n.dntLocation=t,e.reset(a))})},init:function(t,e,a,i,o){o!==!1&&(o=!0),a||(a=function(){}),t in this.loaders||t.length>0&&(this.loaders[t]=n(this.dntLocation,t,e)),this.loaders[t].init(a,i,o)},getData:function(t){if(this.isLoaded(t)){for(var e=this.loaders[t].reader,n=new Array(e.numRows),a=0;a<e.numRows;++a)n[a]=e.getRow(a);return n}return[]},find:function(t,e,n){for(var a=this.findFast(t,e,n),i=[],o=a.length,r=0;r<o;++r)i.push(this.getRow(t,a[r]));return i},findFast:function(t,e,n){if(this.isLoaded(t)){t in this.findIndexes||(this.findIndexes[t]={});var a=this.loaders[t].reader,i=a.columnIndexes[e],o=this.findIndexes[t];if(!(e in o)){var r={};o[e]=r;for(var s=a.data,d=s.length,l=0;l<d;++l){var u=s[l][i];u in r?r[u].push(l):r[u]=[l]}}return n in o[e]?Array.isArray(o[e][n])?o[e][n]:[o[e][n]]:[]}return[]},isLoaded:function(t){return t in this.loaders&&this.loaders[t].loaded},hasFailed:function(t){return t in this.loaders&&this.loaders[t].failed},hasStartedLoading:function(t){return this.isLoaded(t)||t in this.loaders&&this.loaders[t].startedLoading},reset:function(t){t in this.loaders&&(this.loaders[t].reset(),delete this.loaders[t],delete this.findIndexes[t])},resetAll:function(){var t=this;angular.forEach(this.loaders,function(e,n){t.reset(n)})},anyLoading:function(){var t=0;return angular.forEach(this.loaders,function(e,n){!e.loaded&&e.startedLoading&&t++}),t},getNumRows:function(t){return this.isLoaded(t)?this.loaders[t].reader.numRows:0},getRow:function(t,e){return this.isLoaded(t)?this.loaders[t].reader.getRow(e):{}},lookupValue:function(t,e,n){return this.isLoaded(t)?e[this.loaders[t].reader.columnNames[n]]:null},convertData:function(t,e){return this.isLoaded(t)?this.loaders[t].reader.convertData(e):null},getValue:function(t,e,n){return this.isLoaded(t)?this.loaders[t].reader.getValue(e,n):null},saveMemory:function(){for(var t in this.loaders)this.loaders[t].saveReaderMemory()}}}angular.module("dnsim").factory("dntData",["$rootScope","$timeout",t])}();
"use strict";!function(){function n(n,i,t,a){return function(a){function e(n){n<o.length?o[n].init(a,function(){o[n].isLoaded()&&("fileName"in o[n]&&a("dnt loaded: "+o[n].fileName),e(n+1))}):a("Full initialise complete")}a("starting init");var o=[i];angular.forEach(n,function(n,i){"all"!=i&&angular.forEach(n,function(n,i){if(i.indexOf("Dnt")==i.length-3){var a={init:function(i,a){t.init(n,null,i,a)},isLoaded:function(){return t.isLoaded(n)},fileName:n};o.push(a)}})}),e(0)}}angular.module("dnsim").factory("dntInit",["items","jobs","dntData","itemFactory",n])}();
"use strict";!function(){function t(t,n,e){return function(){angular.forEach(t,function(t,n){t.reset()}),n.reset(),e.resetAll()}}angular.module("dnsim").factory("dntReset",["items","jobs","dntData",t])}();
"use strict";!function(){function t(){function t(t){return n[t.id]||"unknown"}function a(t){return 100*t}function r(t){var a=s[t.id];return a?a(t.max):t.max}var n={0:"statStr",1:"statAgi",2:"statInt",3:"statVit",4:"statPDmgMin",5:"statPDmgMax",6:"statMDmgMin",7:"statMDmgMax",8:"statPDef",9:"statMDef",12:"statCrit",16:"statFire",17:"statIce",18:"statLight",19:"statDark",25:"statHp",26:"statMana",29:"statFD",103:"statCritDmg"},s={16:a,17:a,18:a,19:a};return{convertStats:function(a,n,s){var e={characterName:n,remark:"Imported from DNGearsim",classId:a.job.id,statHeroLevel:a.heroLevel};for(var i in s){var o=s[i];e[t(o)]=r(o)}return e},cardImportUrl:"https://redirect.divinitor.com/dngsimport"}}angular.module("dnsim").factory("dvStatcardHelper",t)}();
"use strict";!function(){function e(e,t,n,a,i,r,l,o,s){return{encodeItem:function(e,t){if(e){var n;return"custom"==e.typeName?(n="_custom",angular.forEach(e.stats,function(e,t){n+=t>0?"|":":C",n+=e.id.toString(36)+"="+e.max})):e.id&&(n="I"+e.id.toString(36)+":_","itemSource"in e?n+=e.itemSource:"itemTypeName"in e?n+=e.itemTypeName:e.fileName&&(n+=":F"+e.fileName),(e.enchantmentNum||0==e.enchantmentNum)&&(n+=":E"+e.enchantmentNum.toString(36)),e.pid>0&&(n+=":P"+e.pid.toString(36)),e.sparkId>0&&(n+=":H"+e.sparkId.toString(36)),"skills"==e.typeName&&(n+=":J"+e.baseJobName),e.pve&&(n+=":V"+e.pve)),e.name&&!t&&(n+=":."+e.name.replace(/ /g,"-").replace(/\//g," ")),n}return""},decodeItem:function(t){var n={};return t&&angular.forEach(t.split(":"),function(t,a){if("I"==t.charAt(0))n.id=parseInt(t.substr(1),36);else if("E"==t.charAt(0))n.enchantmentNum=parseInt(t.substr(1),36);else if("P"==t.charAt(0))n.pid=parseInt(t.substr(1),36);else if("S"==t.charAt(0))n.setId=parseInt(t.substr(1),36);else if("H"==t.charAt(0))n.sparkId=parseInt(t.substr(1),36);else if("J"==t.charAt(0))n.baseJobName=t.substr(1);else if("V"==t.charAt(0))n.pve=t.substr(1);else if("_"==t.charAt(0))n.itemSource=t.substr(1);else if("."==t.charAt(0))n.name=t.substr(1).replace("-"," ");else if("C"==t.charAt(0)){n.stats=[];var i=t.substr(1);angular.forEach(i.split("|"),function(e,t){var a=e.split("=");n.stats.push({id:parseInt(a[0],36),max:Number(a[1])})})}else"F"==t.charAt(0)&&(n.fileName=t.substr(1),angular.forEach(e,function(e,t){e.mainDnt&&0==e.mainDnt.indexOf(n.fileName+".")&&(n.itemSource=t)}))}),n},createGroupLink:function(e,t){var n=[],a=this;if(null==t)return"";angular.forEach(t.items,function(e,t){var i=a.encodeItem(e,!0);i&&i.length&&n.push(i)});var i="view-group?region=";return s.dntLocation&&s.dntLocation.region&&(i+=s.dntLocation.region),t.enemyLevel&&(i+="&e="+t.enemyLevel),t.playerLevel&&(i+="&p="+t.playerLevel),t.heroLevel&&(i+="&h="+t.heroLevel),t.job&&t.job.id&&(i+="&j="+t.job.id),t.damageType&&t.damageType.id&&(i+="&d="+t.damageType.id),t.element&&t.element.id&&(i+="&t="+t.element.id),t.secondaryElement&&t.secondaryElement.id&&(i+="&s="+t.secondaryElement.id),i+="&g="+encodeURI(e)+"&i="+n.join(",")},reloadSkill:function(e){e.enchantmentNum||(e.enchantmentNum=1);var n="skilltable_character"+e.baseJobName+".json",i="pve";"pvp"==e.pve&&(i="pvp");var o="skillleveltable_character"+e.baseJobName+i+".json",s=t.find(n,"id",e.id)[0];s||console.log("cannot get skill data from ",n);var m=t.getData(o),c={};angular.forEach(m,function(t,n){t.SkillIndex==e.id&&t.SkillLevel==e.enchantmentNum&&(c=t)});var u={id:e.id,itemSource:e.itemSource,typeName:e.itemSource,needJobClass:s.NeedJob,baseJobName:e.baseJobName,rank:a.rankNames[0],enchantmentNum:e.enchantmentNum,name:l.translate(s.NameID,s.NameIDParam),description:l.translate(c.SkillExplanationID,c.SkillExplanationIDParam),icon:s.IconImageIndex,pve:e.pve};return u.stats=r.getSkillStats(u,s,m),u},reloadSourceItem:function(i){var r=e[i.itemSource],l=t.findFast(r.mainDnt,"id",i.id);if(!l.length)return void console.log("item "+i.id+" not found in "+r.mainDnt);var s=l[0],m=t.getValue(r.mainDnt,s,"TypeParam1"),c=null,u=t.find(r.potentialDnt,"id",i.pid);u.length||(u=t.find(r.potentialDnt,"PotentialID",m)),u.length||(u=t.find(r.potentialDntEx,"id",i.pid),u.length||(u=t.find(r.potentialDntEx,"PotentialID",m))),u.length>0&&(c=u[0],c.PotentialID!=m&&(c=null,console.log("bad potential")));var d=n.createItem(r,s,c);n.initItem(d),o.setItemCategory(d),d.gemSlot=i.gemSlot;var f=null;if((f="weapons"!=d.typeName&&0!=d.typeId?"partsDnt":"weaponDnt")&&t.isLoaded(r[f])&&t.isLoaded(r.setDnt)){d.setStats=[];var h=t.find(r[f],"id",i.id);if(h.length>0){d.setId=h[0].SetItemID;var p=t.find(r.setDnt,"id",h[0].SetItemID);p.length>0&&(d.setStats=a.getStats(p[0]))}}if(d.fullStats=d.stats,i.enchantmentNum>=0)if(d.enchantmentNum=i.enchantmentNum,"skills"==d.typeName);else if("talisman"==d.typeName){var g=[],S=a.mergeStats(d.stats,[]);angular.forEach(S,function(e,t){g.push({id:e.id,max:e.max*(d.enchantmentNum/100)})}),d.enchantmentStats=g}else if(r.enchantDnt){var v=t.find(r.enchantDnt,"EnchantID",d.enchantmentId);!v.length&&r.enchantDnt2&&(v=t.find(r.enchantDnt2,"EnchantID",d.enchantmentId)),angular.forEach(v,function(e,t){e.EnchantLevel==d.enchantmentNum&&(d.enchantmentStats=a.getStats(e))})}else if(r.petLevelDnt){var N=t.find(r.petLevelDnt,"PetLevelTypeID",d.enchantmentId);angular.forEach(N,function(e,t){e.PetLevel==d.enchantmentNum&&(d.enchantmentStats=a.getStats(e))})}if(d.enchantmentStats&&(d.fullStats=a.mergeStats(d.enchantmentStats,d.stats)),d.dragonjeweltype){d.offensiveGemSlots=0,d.increasingGemSlots=0;var D=t.find("dragonjewelslottable.json","DragonJewelID",d.dragonjeweltype);D&&D.length>0&&(1==D[0].DragonJewelSlot1&&d.offensiveGemSlots++,1==D[0].DragonJewelSlot2&&d.offensiveGemSlots++,1==D[0].DragonJewelSlot3&&d.offensiveGemSlots++,1==D[0].DragonJewelSlot4&&d.offensiveGemSlots++,2==D[0].DragonJewelSlot1&&d.increasingGemSlots++,2==D[0].DragonJewelSlot2&&d.increasingGemSlots++,2==D[0].DragonJewelSlot3&&d.increasingGemSlots++,2==D[0].DragonJewelSlot4&&d.increasingGemSlots++)}return d},reloadItem:function(a){if(null!=a){if("itemTypeName"in a&&!a.itemSource&&(a.itemSource=a.itemTypeName),"rbTech"==a.itemSource&&(a.itemSource="tech"),"custom"==a.itemSource||"custom"==a.typeName)return a.typeName="custom",a;if("skills"==a.itemSource||"skills"==a.typeName)return this.reloadSkill(a);if(a.itemSource in e){var i=e[a.itemSource];if(t.findFast(i.mainDnt,"id",a.id).length)return this.reloadSourceItem(a)}if(a.fileName){var r=t.findFast(a.fileName+".json","id",a.id);if(r.length>0){var o=r[0],s=t.getRow(a.fileName+".json",o),m=n.createBasicItem(s);return m.row=o,m.needJobClass=s.NeedJobClass,m.exchangeType=s.ExchangeType,m.fileName=a.fileName,m.gemSlot=a.gemSlot,m.description=l.translate(s.DescriptionID,s.DescriptionIDParam),n.initItem(m),m}return{name:"unknown item"}}return{name:"unknown item source: "+a.itemSource}}},getDntFiles:function(t){if(null==t)return{};var n={};if(!t.itemSource&&t.itemTypeName in e&&(t.itemSource=t.itemTypeName),"rbTech"==t.itemSource&&(t.itemSource="tech"),t.itemSource in e){var a=e[t.itemSource];n["exchange.json"]=null,n[a.mainDnt]=i.mainDnt;for(var r in a)r.indexOf("Dnt")>0&&("enchantDnt"!=r||"enchantDnt2"!=r||t.enchantmentNum)&&(n[a[r]]=i[r])}if("skills"==t.itemSource||"skills"==t.typeName){n["skilltable_character"+t.baseJobName+".json"]=null;var l="skillleveltable_character"+t.baseJobName+"pve.json";n[l]=null,l="skillleveltable_character"+t.baseJobName+"pvp.json",n[l]=null}return t.fileName&&(n[t.fileName+".json"]=null),n}}}e.$inject=["items","dntData","itemFactory","hCodeValues","itemColumnsToLoad","statHelper","translations","itemCategory","region"],angular.module("dnsim").factory("exportLinkHelper",e)}();
"use strict";!function(){function r(r){return{reloadGroup:function(n,t){var e=[];return angular.forEach(t.items,function(n,t){var u=r.reloadItem(n);u&&e.push(u)}),e},getDntFiles:function(n){var t={};return angular.forEach(n.items,function(n,e){var u=r.getDntFiles(n);angular.forEach(u,function(r,n){t[n]=r})}),t}}}angular.module("dnsim").factory("groupHelper",["exportLinkHelper",r])}();
"use strict";!function(){function e(e,t,a){return{categories:[{path:"everything",name:"everything",searchType:"everything",hideInBuild:!0},{path:"titles",name:"titles",sourceType:"titles",hideRank:!0,hideJob:!0,hideLevel:!0,numItemText:"1",maxCat:1},{path:"weapons",name:"weapons",sourceType:"equipment",numItemText:"2",maxExchange:1,maxCat:2,limitExchange:[1,2]},{path:"armour",name:"armour",sourceType:"equipment",numItemText:"5",maxExchange:1,maxCat:5,limitExchange:[3,4,5,6,7]},{path:"accessories",name:"accessories",sourceType:"equipment",hideJob:!0,maxCat:4,maxExchange:2,limitExchange:[8,9,10],tId:7604},{path:"techs",name:"techs",sourceType:"techs",maxCat:4,maxExchange:2,limitExchange:[8,9,10],hideJob:!0},{path:"offensive-gems",name:"offensive gems",sourceType:"gems",hideJob:!0,limitExchange:[54],limitGemType:1},{path:"increasing-gems",name:"increasing gems",sourceType:"gems",hideJob:!0,limitExchange:[54],limitGemType:2},{path:"enhancement-plates",name:"enhancement plates",sourceType:"plates",hideJob:!0,numItemText:"8+3",maxCat:11,maxExchange:15,limitExchange:[33],limitRank:[0,1,2,3]},{path:"expedition-plates",name:"expedition plates",sourceType:"plates",hideRank:!0,hideJob:!0,numItemText:"4",maxCat:4,maxExchange:15,limitExchange:[33],limitRank:[4,5]},{path:"talisman",name:"talisman",sourceType:"talisman",hideJob:!0,numItemText:"8+4",maxCat:12,maxExchange:12,limitExchange:[52,53],tId:1000054149},{path:"costume",name:"costume",sourceType:"cash",numItemText:"7",maxCat:7,maxExchange:1,hideLevel:!0,limitExchange:[16,17,18,19,20,21,22],tId:7607},{path:"imprint",name:"imprint",sourceType:"imprint",numItemText:"7",maxCat:7,hideLevel:!0,hideJob:!0,tId:1000108314},{path:"cash",name:"cash",sourceType:"cash",numItemText:"8",maxCat:8,maxExchange:2,hideJob:!0,hideLevel:!0,limitExchange:[23,24,25,26,27,28,29],tId:7608},{path:"extras",name:"extras",sourceType:"xtras",limitExchange:[47],hideJob:!0,hideLevel:!0,tId:4504},{path:"skills",name:"skills",searchType:"skills"},{path:"custom",name:"custom",searchType:"custom",hideInSearch:!0}],byName:function(e){var t=null;return angular.forEach(this.categories,function(a,n){a.name==e&&(t=a)}),t},byPath:function(e){var t=null;return angular.forEach(this.categories,function(a,n){a.path==e&&(t=a)}),t},getItems:function(a){var n=this.byName(a);if(n&&"sourceType"in n){var i=[];angular.forEach(t,function(t,a){t.type==n.sourceType&&i&&(t.items||t.loading||e.loadItems(t),i=t.items?i.concat(t.items):null)});var m=[];if(i){var r=this;angular.forEach(i,function(e,t){e.typeName==a?m.push(e):r.isItemForCat(n,e,e.data)&&(e.typeName=a,m.push(e))})}return m}return null},isItemForCat:function(e,n){if(!(n.itemSource in t))return!1;if(t[n.itemSource].type!=e.sourceType)return!1;if(n.itemType==e.name)return!0;var i;if(e.limitExchange){i=!1;for(var m=0;m<e.limitExchange.length;++m)(e.limitExchange[m]==n.exchangeType||n.rawData&&e.limitExchange[m]==n.rawData.ExchangeType)&&(i=!0);if(!i)return!1}if(e.limitRank){i=!1;for(var m=0;m<e.limitRank.length;++m)(n.rank&&e.limitRank[m]==n.rank.id||n.rawData&&e.limitRank[m]==n.rawData.Rank)&&(i=!0);if(!i)return!1}if(e.limitGemType){var r=a.find(t.gem.gemDnt,"id",n.id);if(r.length>0&&r[0].Type!=e.limitGemType)return!1}return!0},init:function(e,a){var n=this.byName(e);if(n&&"sourceType"in n){var i=_.filter(t,function(e){return e.type==n.sourceType}),m=0;_.each(i,function(e){e.init(function(){},function(){++m==i.length&&a()})})}},setItemCategory:function(e,t){var a=this;angular.forEach(this.categories,function(n,i){a.isItemForCat(n,e,t)&&(e.typeName=n.name)})},getItemsByCategory:function(e){var t={};if(e){var a={};angular.forEach(e,function(e,t){e&&(e.typeName in a||(a[e.typeName]=[]),a[e.typeName].push(e))}),angular.forEach(this.categories,function(e,n){if(e.name in a){var i=a[e.name].sort(function(t,a){if("talisman"==e.name){var n=t.enchantmentNum;n||(n=0);var i=a.enchantmentNum;if(i||(i=0),n!=i)return i-n}else if("gem"==t.itemSource||"plate"==t.itemSource){if(t.gemSlot||a.gemSlot)return t.gemSlot?a.gemSlot?t.gemSlot-a.gemSlot:-1:1;if(a.levelLimit!=t.levelLimit)return a.levelLimit-t.levelLimit}else if("exchangeType"in t&&"exchangeType"in a)return t.exchangeType-a.exchangeType;return t.name.localeCompare(a.name)});t[e.name]=i}else t[e.name]=[]})}return t}}}angular.module("dnsim").factory("itemCategory",["itemFactory","items","dntData",e])}();
"use strict";!function(){function n(){return{ids:[{name:"unbound plates",min:0,max:0}]}}angular.module("dnsim").factory("excludeService",n)}();
"use strict";!function(){function e(e,t,n,a){function i(e,a,i){return{row:a,potential:i,id:t.getValue(e.mainDnt,a,"id"),itemSource:e.name,levelLimit:Number(t.getValue(e.mainDnt,a,"LevelLimit")),needJobClass:Number(t.getValue(e.mainDnt,a,"NeedJobClass")),typeId:t.getValue(e.mainDnt,a,"Type"),exchangeType:t.getValue(e.mainDnt,a,"ExchangeType"),rank:n.rankNames[t.getValue(e.mainDnt,a,"Rank")],pid:null,name:null,stats:null,potentialRatio:null,typeName:null,sparkId:null}}function l(n){return!!t.isLoaded(n.mainDnt)&&(!!e.isLoaded()&&(!("potentialDnt"in n&&!t.isLoaded(n.potentialDnt))&&!("potentialDntEx"in n&&!t.isLoaded(n.potentialDntEx))))}function r(e){if(!l(e))return null;var n=(new Date).getTime();e.items=[];for(var a=t.getNumRows(e.mainDnt),r=0;r<a;++r){var m=t.getValue(e.mainDnt,r,"Type"),o=t.getValue(e.mainDnt,r,"State1_Max"),u=t.getValue(e.mainDnt,r,"StateValue1"),d=t.getValue(e.mainDnt,r,"TypeParam1");if(o>0||u>0||d>0||35==m||1==m){var s=[];d>0&&"potentialDnt"in e&&(s=t.find(e.potentialDnt,"PotentialID",d),!s.length&&"potentialDntEx"in e&&(s=t.find(e.potentialDntEx,"PotentialID",d)));var c=s.length;c||(s=[null],c=1);for(var f=0;f<c;++f){e.items.push(i(e,r,s[f],0))}}}var D=(new Date).getTime(),p=D-n;console.log("item init time: "+p/1e3+"s for "+e.name)}function m(i){if(i.row>=0){var l;i.itemSource&&i.itemSource in a?l=t.getRow(a[i.itemSource].mainDnt,i.row):i.fileName&&(l=t.getRow(i.fileName+".json",i.row)),delete i.row;var r=i.potential;if(null==i.name&&(i.name=e.translate(l.NameID,l.NameIDParam),l.TierName&&(i.name+=" ("+e.translate(l.TierName)+")")),!i.sparkTypeId&&l.TypeParam2>0&&(i.sparkTypeId=l.TypeParam2),null==i.stats){var m=n.getStats(l);if(r){var o=n.getStats(r);m=n.mergeStats(m,o)}i.stats=m}if(l.SkillID&&!i.skillId&&(i.skillId=l.SkillID),null==i.iconIndex&&(i.icon=l.IconImageIndex,i.icon||"title"!=i.itemSource||(i.icon=12417)),l.dragonjeweltype>=0&&(i.dragonjeweltype=l.dragonjeweltype),l.EnchantID&&!i.enchantmentId&&(i.enchantmentId=l.EnchantID),l.EnchantID&&!i.enchantmentId)i.enchantmentId=l.EnchantID;else if(35==l.Type){i.itemSource="xtras";var u=a[i.itemSource];if(u){var d=t.find(u.petDnt,"id",l.id);d&&d.length&&(i.enchantmentId=d[0].PetLevelTypeID)}}r&&(i.pid=r.id),delete i.potential}}function o(e){var n=a[e.itemSource];if(e.fileName&&t.isLoaded(e.fileName+".json")){var i=u(e.fileName+".json",e);if(i)return i}if(e.fileName&&t.isLoaded(e.fileName+".optimised.json")){var i=u(e.fileName+".optimised.json",e);if(i)return i}if(n&&t.isLoaded(n.mainDnt)){var i=u(n.mainDnt,e);if(i)return i}return[]}function u(e,n){if(e){var a=t.find(e,"id",n.id);if(a&&a.length>0)return a[0]}return null}function d(t){return t?{id:t.id,name:e.translate(t.NameID,t.NameIDParam),rank:n.rankNames[t.Rank],icon:t.IconImageIndex,levelLimit:t.LevelLimit,fileName:t.fileName,typeId:t.Type}:[]}return{loadItems:r,initItem:m,createItem:i,getItemData:o,createBasicItem:d}}e.$inject=["translations","dntData","hCodeValues","items"],angular.module("dnsim").factory("itemFactory",e)}();
"use strict";!function(){function t(t,e,n){function i(i,a){var s=this;s.loading=!0,s.items?a():(t.init(i,function(){o(s,a)}),e.init(s.mainDnt,n.mainDnt,i,function(){o(s,a)},s.ignoreErrors),"potentialDnt"in s&&e.init(s.potentialDnt,n.potentialDnt,i,function(){o(s,a)},s.ignoreErrors),"potentialDntEx"in s&&e.init(s.potentialDntEx,n.potentialDnt,i,function(){o(s,a)},s.ignoreErrors),"gemDnt"in s&&e.init(s.gemDnt,n.gemDnt,i,function(){o(s,a)},s.ignoreErrors),o(s,a))}function o(n,i){!t.isLoaded()||!e.isLoaded(n.mainDnt)||"potentialDnt"in n&&!e.isLoaded(n.potentialDnt)&&!e.hasFailed(n.potentialDnt)||"potentialDntEx"in n&&!e.isLoaded(n.potentialDntEx)&&!e.hasFailed(n.potentialDntEx)||"gemDnt"in n&&!e.isLoaded(n.gemDnt)&&!e.hasFailed(n.gemDnt)||(i(),n.loading=!1)}var a={title:{mainDnt:"appellationtable.optimised.json",type:"titles",minLevel:0,minRank:0},tech:{mainDnt:"itemtable_skilllevelup.optimised.json",potentialDnt:"potentialtable.optimised.json",potentialDntEx:"potentialtable_reboot.optimised.json",gemSlotDnt:"dragonjewelslottable.json",type:"techs",minLevel:60,minRank:0},tman:{mainDnt:"itemtable_talisman.optimised.json",type:"talisman",potentialDnt:"potentialtable_talismanitem.optimised.json",minLevel:24,minRank:0},gem:{mainDnt:"itemtable_dragonjewel.optimised.json",potentialDnt:"potentialtable_dragonjewel.optimised.json",potentialDntEx:"potentialtable_reboot.optimised.json",enchantDnt:"enchanttable_dragonjewel.optimised.json",gemDnt:"dragonjeweltable.optimised.json",type:"gems",minLevel:24,minRank:3},plate:{mainDnt:"itemtable_glyph.optimised.json",potentialDnt:"potentialtable_glyph.optimised.json",type:"plates",minLevel:16,minRank:2},plate95:{mainDnt:"itemtable_glyph95.json",potentialDnt:"potentialtable_glyph95.json",type:"plates",minLevel:1,minRank:1,ignoreErrors:!0},items:{mainDnt:"itemtable.optimised.json",partsDnt:"partstable.optimised.json",weaponDnt:"weapontable.optimised.json",enchantDnt:"enchanttable.optimised.json",potentialDnt:"potentialtable.optimised.json",setDnt:"setitemtable.optimised.json",gemSlotDnt:"dragonjewelslottable.json",type:"equipment",minLevel:80,minRank:3},eq:{mainDnt:"itemtable_equipment.optimised.json",partsDnt:"partstable_equipment.optimised.json",weaponDnt:"weapontable_equipment.optimised.json",enchantDnt:"enchanttable.optimised.json",potentialDnt:"potentialtable.optimised.json",setDnt:"setitemtable.optimised.json",gemSlotDnt:"dragonjewelslottable.json",type:"equipment",minLevel:21,minRank:3},rbeq:{mainDnt:"itemtable_reboot.optimised.json",partsDnt:"partstable_reboot.optimised.json",weaponDnt:"weapontable_reboot.optimised.json",enchantDnt:"enchanttable_reboot.optimised.json",enchantDnt2:"enchanttable_95.json",potentialDnt:"potentialtable_reboot.optimised.json",setDnt:"setitemtable.optimised.json",gemSlotDnt:"dragonjewelslottable.json",type:"equipment",minLevel:24,minRank:3},pvpeq:{mainDnt:"itemtable_pvp.optimised.json",partsDnt:"partstable_pvp.optimised.json",weaponDnt:"weapontable_pvp.optimised.json",enchantDnt:"enchanttable.optimised.json",setDnt:"setitemtable.optimised.json",type:"equipment",gemSlotDnt:"dragonjewelslottable.json",minLevel:24,minRank:3},cCommon:{mainDnt:"itemtable_commoncash.json",partsDnt:"partstable_commoncash.json",weaponDnt:"weapontable_commoncash.json",setDnt:"setitemtable_cash.json",type:"cash",minLevel:0,ignoreErrors:!0,minRank:4},cClone:{mainDnt:"itemtable_cashclone.optimised.json",partsDnt:"partstable_cashclone.optimised.json",type:"cash",minLevel:0,ignoreErrors:!0,minRank:4},c2016:{mainDnt:"itemtable_common2016.optimised.json",partsDnt:"partstable_common2016.optimised.json",weaponDnt:"weapontable_common2016.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,minRank:0},c2017:{mainDnt:"itemtable_common2017.optimised.json",partsDnt:"partstable_common2017.optimised.json",weaponDnt:"weapontable_common2017.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,ignoreErrors:!0,minRank:0},c2015:{mainDnt:"itemtable_common2015.optimised.json",partsDnt:"partstable_common2015.optimised.json",weaponDnt:"weapontable_common2015.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,minRank:0},c2014:{mainDnt:"itemtable_common2014.optimised.json",partsDnt:"partstable_common2014.optimised.json",weaponDnt:"weapontable_common2014.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,minRank:0},cash:{mainDnt:"itemtable_cash.optimised.json",partsDnt:"partstable_cash.optimised.json",weaponDnt:"weapontable_cash.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,minRank:0},event:{mainDnt:"itemtable_event.optimised.json",partsDnt:"partstable_event.optimised.json",weaponDnt:"weapontable_event.optimised.json",setDnt:"setitemtable_cash.optimised.json",type:"cash",minLevel:0,minRank:0},xtras:{mainDnt:"itemtable_vehicle.optimised.json",partsDnt:"vehiclepartstable.optimised.json",setDnt:"setitemtable_cash.optimised.json",petDnt:"vehicletable.json",petLevelDnt:"petleveltable.json",type:"xtras",minLevel:0,minRank:0},imprint:{mainDnt:"itemtable_imprinting.optimised.json",type:"imprint",minLevel:0,minRank:0}};return angular.forEach(a,function(t,e){t.name=e,t.loading=!1,t.items=null,t.init=i,t.reset=function(){t.items=null,t.loading=!1}}),a}angular.module("dnsim").factory("items",["translations","dntData","itemColumnsToLoad",t])}();
"use strict";!function(){function t(t,n,i){var a="jobtable.json",s=i.jobsDnt;return{fileName:a,allJobs:null,isLoaded:function(){return t.isLoaded(a)},hasStartedLoading:function(){return t.hasStartedLoading(a)},init:function(n,i){t.init(a,s,n,function(){i()},!1)},reset:function(){this.allJobs=null,t.reset(a)},getFinalJobs:function(){var t=[],n=this.getAllJobs();if(n)for(var i=n.length,a=0;a<i;++a)2==n[a].d.JobNumber&&n[a].d.JobIcon>0&&t.push(n[a]);return t},getBaseJobs:function(){var t=[],n={},i=this;return angular.forEach(this.getFinalJobs(),function(t,a){n[i.getBaseJobName(t)]=t}),angular.forEach(n,function(n,i){t.push(i)}),t},getAllJobs:function(){if(null==this.allJobs&&this.isLoaded()&&n.isLoaded()){for(var i=[],s=t.getData(a),e=s.length,o=0;o<e;++o)i[i.length]=this.createJob(s[o]);this.allJobs=i}return this.allJobs},getById:function(t){var n=this.getAllJobs();if(n)for(var i=n.length,a=0;a<i;++a)if(n[a].id==t)return n[a]},createJob:function(t){var i=this;return{d:t,id:t.id,name:n.translate(t.JobName),isClassJob:function(n){return i.isClassJob(t,n)}}},isClassJob:function(t,n){if(!n)return!0;if(t.id==n)return!0;var i=t.ParentJob;if(!i)return!1;if(i==n)return!0;var a=this.getById(i);return!!a&&this.isClassJob(a.d,n)},getBaseJobName:function(t){if(this.isLoaded()){var n=this.getAllJobs();if(n)for(var i=n.length,a=0;a<i;++a)if(n[a].id==t.d.BaseClass+1&&n[a].d.EnglishName)return n[a].d.EnglishName}return null}}}angular.module("dnsim").factory("jobs",["dntData","translations","itemColumnsToLoad",t])}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t,n){function a(){return t(function(t,n){firebase.auth().onAuthStateChanged(function(n){null==n?e.location.href="login.html":t(n)})})}function i(e){return t(function(t,n){firebase.database().ref("profile/"+e).once("value",function(e){t(e?e.val():{})})})}function r(e,n){return t(function(t,a){firebase.database().ref("builds/"+e+"/"+v(n)).once("value",function(e){t(e?l(e.val()):{})})})}function u(e){return t(function(t,n){var a=m.getUser();a&&(e=angular.copy(e),b(e,!0),firebase.database().ref("profile/"+a.uid).set(e).then(t))})}function o(e){return t(function(t,n){firebase.database().ref("builds/"+e).once("value",function(e){if(e){var n={},a=e.val();for(var i in a)n[i]=l(a[i]);t(n)}else t({})})})}function s(e){return t(function(t,n){firebase.database().ref("job-builds/"+e.id).once("value",function(e){t(e?e.val():{})})})}function f(e){e.items&&_.each(e.items,function(e){delete e.fullStats});var t=JSON.stringify(e);return LZString.compressToUTF16(t)}function l(e){var t=LZString.decompressFromUTF16(e),a=JSON.parse(t);return a.items&&_.each(a.items,function(e){e.fullStats=e.stats,e.enchantmentStats&&e.enchantmentStats.length&&(e.fullStats=n.mergeStats(e.enchantmentStats,e.fullStats)),e.sparkStats&&e.sparkStats.length&&(e.fullStats=n.mergeStats(e.sparkStats,e.fullStats))}),a}function c(e,n){var a=m.getUser(),i=[];if(a&&(n=angular.copy(n),b(n,!0),i.push(firebase.database().ref("builds/"+a.uid+"/"+v(e)).set(f(n))),n.job&&n.job.id)){var r={};n.playerLevel&&(r.lev=n.playerLevel),n.region&&(r.region=n.region),n.guild&&(r.guild=n.guild),n.about&&(r.about=n.about),b(r,!0),i.push(firebase.database().ref("job-builds/"+n.job.id+"/"+a.uid+"/"+v(e)).set(r))}return t.all(i)}function b(e,t){for(var n in e)void 0===e[n]?delete e[n]:t&&"object"===_typeof(e[n])&&b(e[n],t)}function d(){var e=firebase.auth();return t(function(t,n){e.signOut().then(function(){t()},function(e){n()})})}function p(e){var n=firebase.auth(),a=m.getUser();return t(function(i,r){var u=[firebase.database().ref("builds/"+a.uid).remove(),firebase.database().ref("profile/"+a.uid).remove(),firebase.database().ref("private/"+a.uid).remove()],o=[];for(var s in e)e[s].job&&o.push(e[s].job.id);o=_.uniq(o),_.each(o,function(e){u.push(firebase.database().ref("job-builds/"+e+"/"+a.uid).remove())}),t.all(u).then(function(){a.delete().then(function(){n.signOut().then(function(){i()},function(e){r()})})})})}function g(e,n){var a=[],i=m.getUser();return i&&(a.push(firebase.database().ref("builds/"+i.uid+"/"+v(e)).remove()),n.job&&a.push(firebase.database().ref("job-builds/"+n.job.id+"/"+i.uid+"/"+v(e)).remove())),t.all(a)}function v(e){return e.replace(/[.$\[\]#\/]/g,"")}var m={login:a,getUser:function(){return firebase.auth().currentUser},signOut:d,deleteAccount:p,getUserBuilds:o,deleteBuild:g,saveBuild:c,getBuild:r,getClassBuilds:s,getProfile:i,saveProfile:u,stripBuildName:v};return function(){firebase.initializeApp({apiKey:"AIzaSyC-Mckgho1xAI2SQzsKnpsr2ObDKOhdSrE",authDomain:"dngearsim.firebaseapp.com",databaseURL:"https://dngearsim.firebaseio.com",storageBucket:"dngearsim.appspot.com"})}(),m}angular.module("dnsim").factory("onlineService",["$window","$q","hCodeValues",e])}();
"use strict";!function(){function e(e,t,n,a,r,l,i){function o(e){for(var t=null,n=0;n<e.length;++n)e[n].def.isItemStep&&(t=e[n].value);for(var n=0;n<e.length;++n)e[n].def.alterItem&&e[n].def.alterItem(e[n].value.id,t);return t}function s(e,t,n,i){i||(i=9999);for(var o=a.getItems(e.name),s=[],f=o.length,m=null,d=null,c=0;c<f;++c){var h=o[c];if(!(!e.hideJob&&t.job.id>0&&h.needJobClass>0)||l.isClassJob(t.job.d,h.needJobClass)){r.initItem(h);for(var v=!0,g=0;g<n.length;++g){if(n[g].def.matchesItem&&!n[g].def.matchesItem(n[g].value.id,h)){v=!1;break}"sortFunc"in n[g].def&&(m=n[g].def.sortFunc,d=n[g].value.id)}if(v&&s.push(h),s.length>=i)break}}return s=u(s),s=s.sort(function(e,t){return m?m(d,e,t):e.name.localeCompare(t.name)})}function u(e){for(var t=[],n=0;n<e.length;++n){for(var a=!1,r=0;r<n;++r)if(f(e[n],e[r])){a=!0;break}a||t.push(e[n])}return t}function f(e,t){return e.name==t.name&&e.stats.length==t.stats.length&&e.rank==t.rank&&e.levelLimit==e.levelLimit&&_.isEqual(e.stats,t.stats)}return{getItem:o,findData:s}}e.$inject=["dntData","translations","itemColumnsToLoad","itemCategory","itemFactory","jobs","hCodeValues"],angular.module("dnsim").factory("quickAddHelper",e)}();
"use strict";!function(){function e(e,t){return{categorySteps:{titles:["titleStep"],weapons:["exchangeStep","levelStep","rankStep","itemNameStep","hasStatStep","itemStep","enhanceEqStep"],armour:["exchangeStep","levelStep","rankStep","itemNameStep","hasStatStep","itemStep","enhanceEqStep"],accessories:["accExchangeStep","levelStep","rankStep","itemNameStep","hasStatStep","itemStep"],techs:["exchangeStep","levelStep","rankStep","techSkillStep","itemNameStep","hasStatStep","itemStep"],"offensive gems":["levelStep","gemRankStep","itemNameStep","hasStatStep","hasStatStep","itemStep","enhanceGemStep"],"increasing gems":["levelStep","gemRankStep","itemNameStep","hasStatStep","hasStatStep","itemStep","enhanceGemStep"],"enhancement plates":["levelStep","rankStep","distinctItemNameStep","numStatsStep","hasStatStep","itemStep"],"expedition plates":["levelStep","distinctItemNameStep","numStatsStep","highStatStep","hasStatStep","itemStep"],talisman:["levelStep","talismanRankStep","distinctItemNameStep","numStatsStep","hasStatStep","itemStep","enhanceTalismanStep"],costume:["exchangeStep","rankStep","itemNameStep","itemStep"],imprint:["rankStep","itemNameStep","highStatStep","itemStep"],cash:["accExchangeStep","rankStep","itemNameStep","itemStep"],custom:[]},getOptions:function(a,n,p){var S=this;if(a.name in this.categorySteps){var i=this.getStepName(a,p.length),m=e[i],s=m.getOptions(a,n,p);if(m.isItemStep)return s;if(m.minOptions)var r=t.findData(a,n,p,50);var h=_.filter(s,function(e){var i,h=p.concat([S.createData(e,a,p.length)]);if(m.minOptions){if(s[0]==e)return!0;if(i=t.findData(a,n,h,50),i.length>0&&i.length<50)return i.length<r.length}else i=t.findData(a,n,h,1);return i.length});return m.minOptions&&h.length<m.minOptions?[s[0]]:h}return[]},hasOptions:function(t,a,n){if(t.name in this.categorySteps){var p=this.getStepName(t,n.length);return e[p].hasOptions?e[p].hasOptions(t,a,n):e[p].getOptions(t,a,n).length>0}return!1},isValidStepNumber:function(e,t){return this.categorySteps[e.name].length>t},createData:function(t,a,n){var p=this.getStepName(a,n);return{step:p,value:t,def:e[p]}},getItem:t.getItem,getStepName:function(e,t){return this.categorySteps[e.name][t]}}}e.$inject=["quickAddSteps","quickAddHelper"],angular.module("dnsim").factory("quickAdd",e)}();
"use strict";!function(){function e(e,n,t,a,i){return{exchangeStep:{name:"type",getOptions:function(t,a,i){for(var r=[],m=0;m<t.limitExchange.length;++m){var s=t.limitExchange[m],o=0;if(a.items)for(var c=0;c<a.items.length;++c)a.items[c].exchangeType==s&&o++;if(!(o>=t.maxExchange)){var h=e.find("exchange.json","ExchangeType",s),d="";h&&h.length>0&&h[0].NameID>0&&(d=n.translate(h[0].NameID).toLowerCase()),r.push({id:s,name:d.toLowerCase()})}}return r},matchesItem:function(e,n){return n.exchangeType==e}},accExchangeStep:{name:"type",getOptions:function(t,a,i){for(var r=[],m=0;m<t.limitExchange.length;++m){for(var s=t.limitExchange[m],o=0,c=0;c<a.items.length;++c)a.items[c]&&a.items[c].exchangeType==s&&o++;if(10==s||25==s){if(o>=2)continue}else if(o>=1)continue;var h=e.find("exchange.json","ExchangeType",s);if(h&&h.length>0&&h[0].NameID>0){var d=n.translate(h[0].NameID).toLowerCase();r.push({id:s,name:d.toLowerCase()})}}return r},matchesItem:function(e,n){return n.exchangeType==e}},levelStep:{name:"level",getOptions:function(e,n,t){return[{id:95,name:"level 95"},{id:93,name:"level 93"},{id:90,name:"level 90"},{id:80,name:"level 80"}]},matchesItem:function(e,n){return n.levelLimit==e}},talismanRankStep:{name:"rank",getOptions:function(e,n,t){return[{id:3,name:"epic"},{id:2,name:"rare"},{id:999,name:"quality high grade"},{id:1,name:"magic"},{id:0,name:"normal"}]},matchesItem:function(e,n){if(t.initItem(n),n.name){var a=Math.max(n.name.indexOf("Quality"),n.name.indexOf("High Grade"));return 999==e?0===a:n.rank&&n.rank.id==e&&0!=a}return!1}},gemRankStep:{name:"rank",getOptions:function(e,n,t){return[{id:5,name:"legendary"},{id:4,name:"unique"},{id:999,name:"quality high grade epic"},{id:3,name:"epic"}]},matchesItem:function(e,n){if(t.initItem(n),n.name){var a=Math.max(n.name.indexOf("Quality"),n.name.indexOf("High Grade"));return 999==e?n.rank&&3==n.rank.id&&a>=0:n.rank&&n.rank.id==e&&a<0}return!1}},rankStep:{name:"rank",getOptions:function(e,n,t){var i=[];for(var r in a.rankNames)i.push(a.rankNames[r]);return i},matchesItem:function(e,n){return n.rank&&n.rank.id==e}},enhanceTalismanStep:{name:"slot",getOptions:function(e,n,t){return[{id:100,name:"+100% slot"},{id:75,name:"+75% slot"},{id:25,name:"+25% slot"},{id:0,name:"+0% slot"}]},alterItem:function(e,n){n.enchantmentNum=e}},titleStep:{name:"select",getOptions:function(e,n,t){for(var a=i.findData(e,n,t,9999),r=[],m=0;m<a.length;++m)switch(a[m].id){case 1975:case 1973:case 1008:case 230:case 279:case 2032:case 2033:case 1313:case 2188:case 2252:r.push(a[m])}return r},hasOptions:function(e,n,t){return!0},isItemStep:!0},enhanceEqStep:{name:"enhance",getOptions:function(e,n,t){var a=i.getItem(t);return a&&a.enchantmentId?[{id:20,name:"enhance to +20"},{id:19,name:"enhance to +19"},{id:18,name:"enhance to +18"},{id:17,name:"enhance to +17"},{id:16,name:"enhance to +16"},{id:15,name:"enhance to +15"},{id:14,name:"enhance to +14"},{id:13,name:"enhance to +13"},{id:12,name:"enhance to +12"},{id:11,name:"enhance to +11"},{id:10,name:"enhance to +10"},{id:9,name:"enhance to +9"},{id:8,name:"enhance to +8"},{id:7,name:"enhance to +7"},{id:6,name:"enhance to +6"},{id:5,name:"enhance to +5"},{id:4,name:"enhance to +4"},{id:3,name:"enhance to +3"},{id:2,name:"enhance to +2"},{id:1,name:"enhance to +1"},{id:0,name:"not enhanced"}]:[{id:0,name:"not enhanced"}]},alterItem:function(e,n){n.enchantmentNum=e}},enhanceGemStep:{name:"enhance",getOptions:function(e,n,t){var a=i.getItem(t);return a&&a.enchantmentId?[{id:15,name:"enhance to +15"},{id:14,name:"enhance to +14"},{id:13,name:"enhance to +13"},{id:12,name:"enhance to +12"},{id:11,name:"enhance to +11"},{id:10,name:"enhance to +10"},{id:9,name:"enhance to +9"},{id:8,name:"enhance to +8"},{id:7,name:"enhance to +7"},{id:6,name:"enhance to +6"},{id:5,name:"enhance to +5"},{id:4,name:"enhance to +4"},{id:3,name:"enhance to +3"},{id:2,name:"enhance to +2"},{id:1,name:"enhance to +1"},{id:0,name:"not enhanced"}]:[{id:0,name:"not enhanced"}]},alterItem:function(e,n){n.enchantmentNum=e}},itemStep:{name:"select",getOptions:function(e,n,t){return i.findData(e,n,t)},isItemStep:!0,hideName:!0},namedItemStep:{name:"select",getOptions:function(e,n,t){return i.findData(e,n,t)},isItemStep:!0},techSkillStep:{name:"skill",getOptions:function(e,n,t){var a=i.findData(e,n,t,1);return a.length>0?[{id:a[0].skillId,name:a[0].skillId}]:[]},matchesItem:function(e,n){return n.skillId==e}},itemNameStep:{name:"item",getOptions:function(e,n,t){for(var a=i.findData(e,n,t),r={},m=[],s=0;s<a.length;++s){var o=a[s].name;o in r||(r[o]=!0,m.push({id:o,name:o}))}return m},matchesItem:function(e,n){return n.name==e},isItemStep:!0},distinctItemNameStep:{name:"item",getOptions:function(e,n,t){for(var a=i.findData(e,n,t),r={},m=[],s=0;s<n.items.length;++s){r[n.items[s].name]=!0}for(var s=0;s<a.length;++s){var o=a[s].name;o in r||(r[o]=!0,m.push({id:o,name:o}))}return m},matchesItem:function(e,n){return n.name==e},isItemStep:!0},numStatsStep:{name:"Num Stats",getOptions:function(e,n,t){for(var r=i.findData(e,n,t),m={},s=0;s<r.length;++s){for(var o=0,c=0;c<r[s].stats.length;++c){var h=a.stats[r[s].stats[c].id];h&&!h.hide&&o++}m[o+"x stats"]=o}var d=[];for(var u in m)d.push({id:m[u],name:u});return d=d.sort(function(e,n){return e.id-n.id})},matchesItem:function(e,n){for(var t=0,i=0;i<n.stats.length;++i){var r=a.stats[n.stats[i].id];r&&!r.hide&&t++}return t==e},isItemStep:!0},highStatStep:{name:"High Stat",getOptions:function(e,n,t){var r=i.findData(e,n,t),m={id:-1,name:"all"},s=[m];if(r.length>1){for(var o={},c=0;c<r.length;++c)for(var h=0;h<r[c].stats.length;++h){var d=a.stats[r[c].stats[h].id];!d||!d.quickHigh||"high "+d.name in o||(o["high "+d.name]=d.id)}for(var u in o)s.push({id:o[u],name:u});s=s.length<=2?[m]:s.sort(function(e,n){return e.id-n.id})}return s},matchesItem:function(e,n){if(e==-1)return!0;for(var t=0,i=0,r=0;r<n.stats.length;++r){var m=n.stats[r];a.stats[m.id].quickHigh&&(m.id==e?i+=m.max:m.max>t&&(t=m.max))}return i>t},sortFunc:function(e,n,t){for(var a=0,i=0,r=0;r<n.stats.length;++r)if(n.stats[r].id==e){a=n.stats[r].max;break}for(var m=0;m<t.stats.length;++m)if(t.stats[m].id==e){i=t.stats[m].max;break}return i-a},isItemStep:!1,minOptions:3},hasStatStep:{name:"Has Stat",getOptions:function(e,n,t){var r=i.findData(e,n,t),m={id:-1,name:"all"},s=[m];if(r.length>1){for(var o={},c=0;c<r.length;++c)for(var h=0;h<r[c].stats.length;++h){var d=a.stats[r[c].stats[h].id];!d||!d.searchable||"high "+d.name in o||(o["has "+d.name]=d.id)}for(var u in o)s.push({id:o[u],name:u});s=s.length<=2?[m]:s.sort(function(e,n){return e.id-n.id})}return s},matchesItem:function(e,n){if(e==-1)return!0;for(var t=0;t<n.stats.length;++t){var i=n.stats[t];if(a.stats[i.id].searchable&&i.id==e)return!0}return!1},sortFunc:function(e,n,t){for(var a=0,i=0,r=0;r<n.stats.length;++r)if(n.stats[r].id==e){a=n.stats[r].max;break}for(var m=0;m<t.stats.length;++m)if(t.stats[m].id==e){i=t.stats[m].max;break}return i-a},isItemStep:!1,minOptions:3},customStep:{name:"misc",getOptions:function(e,n,t){return a.customItems},isItemStep:!0}}}e.$inject=["dntData","translations","itemFactory","hCodeValues","quickAddHelper"],angular.module("dnsim").factory("quickAddSteps",e)}();
"use strict";!function(){function t(t,i,n,e){var o={region:"ALT",name:"Alternative user specified files",url:""},a=[{region:"sea",name:"south east asia",url:"https://seadnfiles.netlify.com/public"},{region:"na",name:"north america",url:"https://nadnfiles.netlify.com/public"},{region:"eu",name:"europe",url:"https://eudnfiles.netlify.com/public"},{region:"th",name:"thailand",url:"https://thdnfiles.netlify.com/public"},{region:"tw",name:"taiwan 臺灣",url:"https://tdnfiles.netlify.com/public"},{region:"cdn",name:"china 中國",url:"https://cdnfiles.netlify.com/public"},{region:"kdn",name:"korea 대한민국",url:"https://kdnfiles.netlify.com/public"},{region:"br",name:"brazil",url:"https://dnbr.netlify.com/public"}],r=localStorage.getItem("lastDNTRegion"),l=null;r&&angular.forEach(a,function(t,i){t.region==r&&(l=t)});var s=localStorage.getItem("UIStrings_file"),c=null;return s&&angular.forEach(a,function(t,i){t.region!=o.region&&s.indexOf(t.url)>-1&&(c=t)}),null==c&&(c=l),{hostedFiles:a,alternativeFiles:o,dntLocation:l,tlocation:c,setCustomUrl:function(t){this.alternativeFiles.url=t;var i=[];angular.forEach(a,function(t,n){t.region!=o.region&&i.push(t)}),i.push(o),a=i,this.hostedFiles=i},setLocationByName:function(t){var i=null;angular.forEach(a,function(n,e){n.region==t&&(i=n)}),this.setLocation(i)},setLocation:function(t){t&&t!=this.dntLocation&&(this.dntLocation=t,i(),localStorage.setItem("lastDNTRegion",t.region),i(),e.reload());var n=this.getOverride();null!=this.tlocation&&n||this.setTLocation(t),this.init()},setTLocation:function(n){if(n!=this.tlocation&&(this.tlocation=n,sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file"),i(),t.reset(),n)){var o=this.getOverride();t.small=!o,t.location=this.tlocation.url,t.region=this.tlocation.region,t.init(function(){},function(){e.reload()})}},getOverride:function(){return!!localStorage.getItem("tOverride")},setOverride:function(t){t?localStorage.setItem("tOverride","1"):localStorage.removeItem("tOverride"),this.setTLocation(this.dntLocation)},init:function(){this.getOverride()?t.small=!1:(this.tLocation=this.dntLocation,t.small=!0),this.tlocation&&(t.location=this.tlocation.url,t.region=this.tlocation.region),n.setLocation(this.dntLocation)}}}angular.module("dnsim").factory("region",["translations","dntReset","dntData","$route",t])}();
"use strict";!function(){function e(e){return{saveItem:function(e,t){var r=this.getSavedItems();e in r&&Array.isArray(r[e].items)?(r[e].items.push(t),r[e].lastUpdate=(new Date).getTime(),this.updatedSavedItems(e,r[e].items)):this.updatedSavedItems(e,[t])},saveBuildSelection:function(e,t){this.setCurrentBuild(e),t&&e in t&&t[e].job&&t[e].job.id&&localStorage.setItem("jobNumber",t[e].job.id)},importGroup:function(e,t){var r=this.getSavedItems();return e=this.getUniqueGroupName(e,r),this.updatedSavedItems(e,t),e},getUniqueGroupName:function(e,t){var r=0;if(e.lastIndexOf(")")==e.length-1){var s=e.lastIndexOf("(");if(s>0){var i=Number(e.substr(s+1,e.length-s-2));i>0&&(r=i+1,e=e.substr(0,s-1))}}for(var a=e;;){var e=a;if(r>0&&(e=a+" ("+r+")"),!(e in t))break;r++}return e},deleteBuild:function(e){var t=this.getSavedItems();e in t&&(delete t[e],this.setCurrentBuild(null),this.saveBuilds(t))},updatedSavedItems:function(e,t){var r=this.getSavedItems();e in r?(r[e].items=t,r[e].lastUpdate=(new Date).getTime()):r[e]={items:t,lastUpdate:(new Date).getTime()},this.saveBuilds(r)},saveBuilds:function(e){var t=JSON.stringify(e);localStorage.setItem("savedItems",LZString.compressToUTF16(t))},saveBuild:function(e,t,r){this.updateBuild(e,t,r.enemyLevel,r.playerLevel,r.heroLevel,r.job,r.damageType,r.element,r.secondaryElement,r.critResist,r.eleResist,r.enemyStatCaps,r.playerStatCaps,r.conversions,r.baseStats,r.heroStats)},updateBuild:function(e,t,r,s,i,a,n,u,l,o,d,m,c,v,p,g){var h=this.getSavedItems();if(t in h||e==t)t=e;else if(e in h){var S=h[e];h[t]=S,delete h[e]}h[t].enemyLevel=r,h[t].playerLevel=s,h[t].heroLevel=i,h[t].job=a,h[t].damageType=n,h[t].element=u,h[t].secondaryElement=l,h[t].critResist=o,h[t].eleResist=d,h[t].enemyStatCaps=m,h[t].playerStatCaps=c,h[t].conversions=v,h[t].baseStats=p,h[t].heroStats=g,this.saveBuilds(h)},getSavedItems:function(){try{var e=LZString.decompressFromUTF16(localStorage.getItem("savedItems"));return JSON.parse(e)}catch(e){}return{}},currentBuild:null,getCurrentBuild:function(){if(!this.currentBuild&&(this.currentBuild=localStorage.getItem("currentGroup"),this.currentBuild)){var e=this.getSavedItems();this.currentBuild in e||(localStorage.removeItem("currentGroup"),this.currentBuild=null)}return this.currentBuild},setCurrentBuild:function(e){this.currentBuild=e,e?localStorage.setItem("currentGroup",e):localStorage.removeItem("currentGroup",e)}}}angular.module("dnsim").factory("saveHelper",["itemCategory",e])}();
"use strict";!function(){function a(a){return{getSetStats:function(t){var e=[],m={};return angular.forEach(t,function(a,t){null!==a&&null!=a.setStats&&(a.setId in m?m[a.setId].numItems++:m[a.setId]={numItems:1,stats:a.setStats})}),angular.forEach(m,function(a,t){angular.forEach(a.stats,function(t,m){t.needSetNum<=a.numItems&&e.push(t)})}),a.mergeStats(e)},getNumItemsForSet:function(a,t){var e=0;return angular.forEach(a,function(a,m){a&&a.setId&&a.setId==t&&e++}),e},getCombinedStats:function(t){var e=[];return angular.forEach(t,function(a,t){a&&(a.fullStats?e=e.concat(a.fullStats):a.stats&&(e=e.concat(a.stats)))}),a.mergeStats(e)},getCalculatedStatsFromItems:function(t,e){var m=this.getNakedStats(t),r=this.getCombinedStats(e),n=this.getSetStats(e),s=m.concat(r).concat(n);return null!=t.heroStats&&t.heroStats.length>0&&(s=s.concat(t.heroStats)),s=a.mergeStats(s),this.getCalculatedStats(t,s)},getCalculatedStats:function(t,e){function m(t){var e=a.stats[t.id];return l[e.pc]?Number(l[e.pc].max):0}function r(t){var e=a.stats[t.id];return l[e.skPc]?Number(l[e.skPc].max):0}function n(a){a.max=Math.floor(a.max*(1+m(a))*(1+r(a)))}function s(a){var t=l[a];return t?{id:a,max:Number(t.max),pc:t.pc}:{id:a,max:0,pc:0}}function i(a){a.max>0&&o.push(a)}function x(a,t,e){var m=(t+e)/2;m+=w*(J+1)*m*(1-c),m*=1+U.max;var r=m;if(X>0){var n=l[X];n&&(r=r*(1+Number(n.max))*(1-Number(u)))}if(i({id:a,max:r}),W!=X)if(W>0){var s=l[W];if(s){var x=m*(1+Number(s.max))*(1-Number(u));i({id:a+1e3,max:x})}}else i({id:a+1e3,max:m})}var o=[],l={};if(!t.conversions||!t.enemyStatCaps||!t.playerStatCaps)return[];angular.forEach(e,function(a,t){l[a.id]=a});var c;c="critResist"in t?t.critResist/100:.2;var u;u="eleResist"in t?t.eleResist/100:0;var d=s(0);n(d);var f=s(1);n(f);var g=s(2);n(g);var S=s(3);n(S);var h=s(25);h.max+=S.max*Number(t.conversions.HP),n(h);var v=s(8);v.max+=S.max*Number(t.conversions.PhysicalDefense),n(v);var p=s(1008);p.max=Math.min(.85,v.max/Number(t.enemyStatCaps.Cdefense)),i(p);var y=s(9);y.max+=g.max*Number(t.conversions.MagicDefense),n(y);var b=s(1009);b.max=Math.min(.85,y.max/Number(t.enemyStatCaps.Cdefense)),i(b);var N=s(3e3),M=s(4),C=s(5);if(!t.damageType||2!=t.damageType.id&&5!=t.damageType.id){var T=s(32),k=s(101),I=s(3001),E=s(10164),A=s(103721);M.max+=T.max,M.max+=Math.floor(d.max*Number(t.conversions.StrengthAttack)),M.max+=Math.floor(f.max*Number(t.conversions.AgilityAttack)),M.max=Math.floor(M.max*(1+(m(M)+k.max))),M.max=Math.floor(M.max*(1+N.max+I.max)),M.max+=Math.floor(E.max*g.max),M.max+=Math.floor(A.max*d.max),i(M),C.max+=T.max,C.max+=Math.floor(d.max*Number(t.conversions.StrengthAttack)),C.max+=Math.floor(f.max*Number(t.conversions.AgilityAttack)),C.max=Math.floor(C.max*(1+(m(C)+k.max))),C.max=Math.floor(C.max*(1+N.max+I.max)),C.max+=Math.floor(E.max*g.max),C.max+=Math.floor(A.max*d.max),i(C)}var V=s(6),D=s(7);if(!t.damageType||1!=t.damageType.id&&4!=t.damageType.id){var P=s(33),R=s(102),F=s(3002),H=s(10165),B=s(10372);V.max+=P.max,V.max+=Math.floor(g.max*Number(t.conversions.IntelligenceAttack)),V.max=Math.floor(V.max*(1+(m(V)+R.max))),V.max=V.max*(1+N.max+F.max),V.max+=Math.floor(H.max*d.max),V.max+=Math.floor(B.max*g.max),i(V),D.max+=P.max,D.max+=g.max*Number(t.conversions.IntelligenceAttack),D.max=Math.floor(D.max*(1+(m(D)+R.max))),D.max=D.max*(1+N.max+F.max),D.max+=Math.floor(H.max*d.max),D.max+=Math.floor(B.max*g.max),i(D)}var L=s(12);L.max+=f.max*Number(t.conversions.Critical),n(L);var j=s(4012);L.max+=j.max,i(L);var q=s(1012),w=Math.min(.89,L.max/Number(t.enemyStatCaps.Ccritical)+q.max);o.push({id:1012,max:w});var z=s(103);z.max+=(d.max+g.max)*Number(t.conversions.StrengthIntelligenceToCriticalDamage),n(z),i(z);var G=s(1103),J=Math.min(1,z.max/t.playerStatCaps.CcriticalDamage+G.max);i({id:1103,max:J+2});var K=s(29);i(K);var O=Number(t.enemyStatCaps.Cfinaldamage),Q=s(10389),U=s(1030);U.max+=Q.max+Math.min(1,K.max/O),i(U);var W=0,X=0;X=t.element?a.elements[t.element.id].dmgStat:0,W=t.secondaryElement?a.elements[t.secondaryElement.id].dmgStat:0;var Y=s(88),Z=s(16);Z.max+=Y.max,Z.id!=X&&Z.id!=W||i(Z);var $=s(17);$.max+=Y.max,$.id!=X&&$.id!=W||i($);var _=s(18);_.max+=Y.max,_.id!=X&&_.id!=W||i(_);var aa=s(19);aa.max+=Y.max,aa.id!=X&&aa.id!=W||i(aa),t.damageType&&1!=t.damageType.id&&0!=t.damageType.id&&4!=t.damageType.id||x(1004,M.max,C.max),t.damageType&&2!=t.damageType.id&&0!=t.damageType.id&&5!=t.damageType.id||x(1006,V.max,D.max),t.damageType&&3!=t.damageType.id||x(1001,V.max+M.max,D.max+C.max),t.damageType&&4==t.damageType.id&&i({id:1005,max:(M.max+C.max)/2}),t.damageType&&5==t.damageType.id&&i({id:1007,max:(V.max+D.max)/2});var ta=s(2008);ta.max=h.max/(1-p.max),s(2009).max=h.max/(1-b.max);var ea=s(3008);return ea.max=ta.max,i(ea),i(d),i(f),i(g),i(S),i(h),i(v),i(y),o},getNakedStats:function(a){return a.baseStats&&a.baseStats.Strength>0?[{id:0,max:a.baseStats.Strength},{id:1,max:a.baseStats.Agility},{id:2,max:a.baseStats.Intelligence},{id:3,max:a.baseStats.Stamina}]:[]},getSkillStats:function(t,e,m){var r=null;if(angular.forEach(m,function(a,e){if(a.SkillIndex==t.id&&a.SkillLevel==t.enchantmentNum)return void(r=a)}),!r)return null;for(var n=1,s=[],i=!0;i;){var x="EffectClass"+n,o="EffectClassValue"+n;if(e&&x in e&&o in r){if(e[x]>0){var l=e[x],c=r[o],u=a.skillEffectMapping[l];if(u&&u.getVals&&u.getVals(c))for(var d=u.getVals(c),f=0;f<d.length;++f)s.push(d[f]);else u&&u.mapTo&&s.push({id:u.mapTo,effect:l,max:c})}}else i=!1;n++}return s},getBuildStats:function(t){var e={};return e.nakedStats=this.getNakedStats(t),e.combinedStats=this.getCombinedStats(t.items),e.setStats=this.getSetStats(t.items),e.allStats=e.nakedStats.concat(e.combinedStats).concat(e.setStats),t.heroStats&&t.heroStats.length&&(e.heroStats=t.heroStats,e.allStats=e.allStats.concat(t.heroStats)),e.allStats=a.mergeStats(e.allStats),e.calculatedStats=this.getCalculatedStats(t,e.allStats),e}}}angular.module("dnsim").factory("statHelper",["hCodeValues",a])}();
"use strict";!function(){function t(t,a,e){var i=new DnTranslations,n=[],o=[];return{getRawData:function(){return i.data},reset:function(){i=new DnTranslations,i.sizeLimit=100,this.loaded=!1,this.startedLoading=!1,n=[],o=[]},getFileName:function(){return this.small?"uistring.optimised.json":"uistring.json"},loaded:!1,startedLoading:!1,small:!1,location:null,region:null,init:function(s,r){if(this.isLoaded())r();else if(o=[],s&&o.push(s),r&&n.push(r),!this.startedLoading){this.startedLoading=!0;var l=this,d=null;this.location&&""!=this.location&&(d=this.location+"/"+this.getFileName())!=localStorage.getItem("UIStrings_file")&&(sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file")),t.$broadcast("TRANSLATION_LOAD_EVENT"),i.loadDefaultFile(d,function(t){angular.forEach(o,function(a,e){a(t)})},function(){a.addTranslations(l.region,l.getRawData()),e.use(l.region),l.loaded=!0,angular.forEach(n,function(t,a){t()}),n=[],t.$broadcast("TRANSLATION_LOAD_EVENT")},function(a){angular.forEach(o,function(t,e){t(a)}),t.$broadcast("TRANSLATION_LOAD_ERROR"),l.startedLoading=!1,l.loaded=!1})}},isLoaded:function(){if(!this.loaded){this.location+"/"+this.getFileName()!=localStorage.getItem("UIStrings_file")&&(sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file")),this.loaded=i.loadFromSession(),this.loaded&&(a.addTranslations(this.region,this.getRawData()),e.use(this.region),this.startedLoading=!0)}return this.loaded},translate:function(t,a){if(this.loaded)try{var e;if(!t)return"";if("string"!=typeof(e=i.translate(t)))return"m"+e;if(a&&e)if("string"==typeof a)for(var n=a.split(","),o=0;o<n.length;++o){var s=n[o];0==s.indexOf("{")&&(s=n[o].replace(/\{|\}/g,""),s=i.translate(s)),e=e.replace("{"+o+"}",s)}else e=e.replace("{0}",a);return e}catch(e){console.log("unable to translate",t,a,e)}return"m"+t}}}angular.module("dnsim").factory("translations",["$rootScope","uiTranslations","$translate",t])}();
"use strict";!function(){function e(e,i){return{addTranslations:function(e,i){if(e&&i&&e in a){var n=a[e];for(var s in n)i[s]=n[s]}}}}e.$inject=["$routeParams","$rootScope"],angular.module("dnsim").factory("uiTranslations",e);var a={na:{1000128908:"Tier 3",1000128979:"t4?"},cdn:{"dragon nest gear simulator":"龙之谷配装模拟器","enemy lvl":"敌人等级","damage type":"伤害类型","player lvl":"玩家等级","hero level stats":"英雄等级状态","naked stats":"裸装状态","stat affects":"状态影响",str:"力量",agi:"敏捷",int:"智力",builds:"方案",search:"搜索","select region":"选择地区","create a new build":"创建一个新方案",import:"输入",publish:"发布","find a build":"寻找一个新方案",about:"关于","import a build from a json build file":"从一个json文件导入方案","log in and publish your builds online":"登录并发布您的方案",vit:"体质",fd:"最终伤害",pdmg:"物理攻击力",mdmg:"魔法攻击力",crit:"致命一击",cdmg:"致命一击伤害","fire%":"火攻击","ice%":"水攻击","light%":"光攻击","dark%":"暗攻击",pdef:"物理防御力",mdef:"魔法防御力",weapons:"武器",armour:"防具",techs:"技巧饰品",titles:"称号","expedition plates":"远征队纹章","enhancement plates":"强化纹章","increasing gems":"强化龙玉","offensive gems":"属性龙玉",back:"返回",cancel:"取消",epic:"A级",unique:"S级",legendary:"L级","quick add":"快速添加","hero lvl":"英雄等级"},sea:{"offensive gems":"offensive jades","increasing gems":"increasing jades","expedition plates":"unique heraldry","enhancement plates":"normal heraldry",techs:"skill accessory"}}}();
"use strict";!function(){function a(){function a(a){return Math.floor(a.max)}function e(a){var e=Number(a.max);return e<100?e:e<1e5?Math.round(e/100)/10+"k":e<1e6?Math.round(e/1e3)+"k":e<1e8?Math.round(e/1e4)/100+"m":Math.round(e/1e6)+"m"}function d(a){return Math.round(1e4*a.max)/100+"%"}return{stats:{0:{id:0,name:"str",display:e,dps:!0,pc:50,skPc:4050,searchable:!0,quickHigh:!0},1:{id:1,name:"agi",display:e,dps:!0,pc:51,skPc:4051,searchable:!0,quickHigh:!0},2:{id:2,name:"int",display:e,dps:!0,pc:52,skPc:4052,searchable:!0,quickHigh:!0},3:{id:3,name:"vit",display:e,def:!0,pc:53,skPc:4053,searchable:!0,quickHigh:!0},4:{id:4,name:"pdmg",display:e,combineWith:5,dps:!0,pc:54,searchable:!0,altStat:32,quickHigh:!0,addTo:32},5:{id:5,name:"maxPdmg",display:e,hide:!0,pc:55,addTo:32},6:{id:6,name:"mdmg",display:e,combineWith:7,dps:!0,pc:56,searchable:!0,altStat:33,quickHigh:!0,addTo:33},7:{id:7,name:"maxMdmg",display:e,hide:!0,pc:57,addTo:33},8:{id:8,name:"pdef",display:e,def:!0,pc:58,searchable:!0},9:{id:9,name:"mdef",display:e,def:!0,pc:59,searchable:!0},10:{id:10,name:"para",display:e,pc:60,noCustom:!0},11:{id:11,name:"para resist",display:e,pc:61,noCustom:!0},12:{id:12,name:"crit",display:e,dps:!0,pc:62,searchable:!0},13:{id:13,name:"crit resist",display:e,pc:63,noCustom:!0},14:{id:14,name:"stun",display:e,pc:64,noCustom:!0},15:{id:15,name:"stun resist",display:e,pc:65,noCustom:!0},16:{id:16,name:"fire%",display:d,dps:!0,searchable:!0,altStat:88,addTo:88},17:{id:17,name:"ice%",display:d,dps:!0,searchable:!0,altStat:88,addTo:88},18:{id:18,name:"light%",display:d,dps:!0,searchable:!0,altStat:88,addTo:88},19:{id:19,name:"dark%",display:d,dps:!0,searchable:!0,altStat:88,addTo:88},20:{id:20,name:"fire def",display:d,def:!0,searchable:!0},21:{id:21,name:"ice def",display:d,def:!0,searchable:!0},22:{id:22,name:"light def",display:d,def:!0,searchable:!0},23:{id:23,name:"dark def",display:d,def:!0,searchable:!0},25:{id:25,name:"hp",display:e,def:!0,pc:75,skPc:4075,searchable:!0},26:{id:26,name:"mp",display:e,def:!0,pc:76,skPc:4076},29:{id:29,name:"fd",display:a,dps:!0,pc:1030,searchable:!0},32:{id:32,name:"pdmg",display:e,dps:!0,pc:54,quickHigh:!0,hideIf:4},33:{id:33,name:"mdmg",display:e,dps:!0,pc:56,quickHigh:!0,hideIf:6},50:{id:50,name:"str%",display:d,dps:!0},51:{id:51,name:"agi%",display:d,dps:!0},52:{id:52,name:"int%",display:d,dps:!0},53:{id:53,name:"vit%",display:d,def:!0},54:{id:54,name:"pdmg%",display:d,combineWith:55,dps:!0},55:{id:55,name:"maxPdmg%",display:d,hide:!0},56:{id:56,name:"mdmg%",display:d,combineWith:57,dps:!0},57:{id:57,name:"maxMdmg%",display:d,hide:!0},58:{id:58,name:"pdef%",display:d,def:!0},59:{id:59,name:"mdef%",display:d,def:!0},60:{id:60,name:"para%",display:d,noCustom:!0,def:!0},61:{id:61,name:"para resist%",display:d,noCustom:!0,def:!0},62:{id:62,name:"crit%",display:d,dps:!0},63:{id:63,name:"crit resist%",display:d,def:!0},64:{id:64,name:"stun%",display:d,noCustom:!0,def:!0},65:{id:65,name:"stun resist%",display:d,noCustom:!0,def:!0},74:{id:74,name:"move%",display:d,noCustom:!0,def:!0},75:{id:75,name:"hp%",display:d,def:!0,searchable:!0},76:{id:76,name:"mp%",display:d,def:!0},77:{id:77,name:"mp recover%",display:d,def:!0},81:{id:81,name:"safe move%",display:d,noCustom:!0,def:!0},88:{id:88,name:"all element%",display:d,noCustom:!0,def:!1,dps:!0},101:{id:101,name:"pdmg%",display:d,noCustom:!0,dps:!0,quickHigh:!0,searchable:!0},102:{id:102,name:"mdmg%",display:d,noCustom:!0,dps:!0,quickHigh:!0,searchable:!0},103:{id:103,name:"cdmg",display:e,dps:!0,pc:104,searchable:!0},104:{id:104,name:"crit dmg%",display:d,noCustom:!0,dps:!0},105:{id:104,name:"pvp dmg",display:e,noCustom:!0,dps:!0},106:{id:106,name:"pvp def",display:e,noCustom:!0,def:!0},107:{id:107,name:"mp?",display:a,noCustom:!0,hide:!0,def:!0},1001:{id:1001,name:"avg dmg",display:e,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1004:{id:1004,name:"avg pdmg",display:e,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1005:{id:1005,name:"avg pheal",display:e,summaryDisplay:!0,noCustom:!0,hide:!0},1006:{id:1006,name:"avg mdmg",display:e,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1007:{id:1007,name:"mheal",display:e,summaryDisplay:!0,noCustom:!0,hide:!0},1008:{id:1008,name:"pdef",display:d,noCustom:!0,summaryFor:8},1009:{id:1009,name:"mdef",display:d,noCustom:!0,summaryFor:9},1012:{id:1012,name:"crit chance",display:d,noCustom:!0,dps:!0,summaryFor:12,summaryDisplay:!0},1030:{id:1030,name:"fd%",display:d,noCustom:!0,dps:!0,summaryFor:29,summaryDisplay:!0},1103:{id:1103,name:"crit dmg",display:d,noCustom:!0,dps:!0,summaryFor:103,summaryDisplay:!0},2001:{id:2001,name:"dmg",display:e,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2004:{id:2004,name:"pdmg",display:e,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2006:{id:2006,name:"mdmg",display:e,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2008:{id:2008,name:"pdef eqhp",display:e,noCustom:!0},2009:{id:2009,name:"mdef eqhp",display:e,noCustom:!0},3e3:{id:3e3,name:"skDmg%",display:d,dps:!0},3001:{id:3001,name:"skPDmg%",display:d,dps:!0},3002:{id:3002,name:"skMDmg%",display:d,dps:!0},3008:{id:3008,name:"eqhp",display:e,summaryDisplay:!0,noCustom:!0,hide:!0},4012:{id:4012,name:"skCrit",display:e,dps:!0},4050:{id:4050,name:"skStr%",display:d,dps:!0},4051:{id:4051,name:"skAgi%",display:d,dps:!0},4052:{id:4052,name:"skInt%",display:d,dps:!0},4053:{id:4053,name:"skVit%",display:d,def:!0},4075:{id:4075,name:"skHp%",display:d,def:!0},4076:{id:4076,name:"skMp%",display:d,def:!0},10164:{id:10164,name:"intToPdmg",display:d,noCustom:!0,dps:!0},10165:{id:10165,name:"strToMdmg",display:d,noCustom:!0,dps:!0},10372:{id:10372,name:"intToMdmg",display:d,noCustom:!0,dps:!0},103721:{id:103721,name:"strToPdmg",display:d,noCustom:!0,dps:!0},10389:{id:10389,name:"fd%",display:d,dps:!0}},rankNames:{0:{id:0,name:"normal"},1:{id:1,name:"magic"},2:{id:2,name:"rare"},3:{id:3,name:"epic"},4:{id:4,name:"unique"},5:{id:5,name:"legend"},6:{id:6,name:"divine"},7:{id:7,name:"ancient"}},shopNames:{28001:"lament",28002:"lament",28003:"lament",28004:"lament",28005:"lament",28006:"lament",28007:"lament",28008:"lament",28009:"lament",28101:"lament",29001:"aura",29002:"aura",29003:"aura",29004:"aura",29005:"aura",29006:"aura",29007:"aura",29008:"aura",29009:"aura",5001:"medal",5002:"medal",5003:"medal",5004:"medal",5005:"medal",5006:"medal",5007:"medal",5008:"medal",5009:"medal",5101:"ladder",5102:"ladder",5103:"ladder",5104:"ladder",5105:"ladder",5106:"ladder",5107:"ladder",5108:"ladder",5109:"ladder",59001:"garden bunny",52001:"nightmare",52002:"nightmare",52003:"nightmare",52004:"nightmare",52005:"nightmare",52006:"nightmare",52007:"nightmare",52008:"nightmare",52009:"nightmare",21:"blacksmith",22:"blacksmith",23:"blacksmith",24:"blacksmith",25:"blacksmith",26:"blacksmith",27:"blacksmith",28:"blacksmith",29:"blacksmith",89001:"guild master",88001:"battlefield",88002:"battlefield",88003:"battlefield",88004:"battlefield",88005:"battlefield",88006:"battlefield",88007:"battlefield",88008:"battlefield",88009:"battlefield",66001:"erosion",35006:"plate",14051:"abyss",14052:"abyss",14053:"abyss",14054:"abyss",14055:"abyss",14056:"abyss",14057:"abyss",14058:"abyss",14059:"abyss",40011:"daredevil faire",40012:"daredevil faire",40013:"daredevil faire",40014:"daredevil faire",40015:"daredevil faire",40016:"daredevil faire",40017:"daredevil faire",40018:"daredevil faire",40001:"daredevil faire",40002:"daredevil faire",40111:"daredevil faire",91001:"wrath",45001:"farm",100004:"event",89e3:"nightmare"},checkedRank:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0},typeNames:{0:"weapons",1:"equipment",5:"plates",8:"pouch",38:"plates",90:"welspring",132:"talisman",139:"gems"},elements:{0:{id:0,name:"non-ele"},1:{id:1,name:"fire",dmgStat:16},2:{id:2,name:"ice",dmgStat:17},3:{id:3,name:"light",dmgStat:18},4:{id:4,name:"dark",dmgStat:19}},damageTypes:{0:{id:0,name:"both separate"},1:{id:1,name:"physical"},2:{id:2,name:"magical"},3:{id:3,name:"both combined"},4:{id:4,name:"physical healing"},5:{id:5,name:"magical healing"}},skillEffectMapping:{2:{id:2,name:"phyisical attack power",mapTo:3001},13:{id:13,name:"mp",mapTo:26},25:{id:25,name:"action speed"},29:{id:29,name:"magic attack power",mapTo:3002},32:{id:32,name:"fire %",mapTo:16},33:{id:33,name:"ice %",mapTo:17},34:{id:34,name:"light %",mapTo:18},35:{id:35,name:"dark %",mapTo:19},36:{id:36,name:"fire def",mapTo:20},37:{id:37,name:"ice def",mapTo:21},38:{id:38,name:"light def",mapTo:22},39:{id:39,name:"dark def",mapTo:23},58:{id:58,name:"hp%",mapTo:4075},59:{id:59,name:"mp%",mapTo:4076},65:{id:65,name:"range"},76:{id:76,name:"movement speed",mapTo:74},87:{id:87,name:"str%",mapTo:4050},88:{id:88,name:"agi%",mapTo:4051},89:{id:89,name:"int%",mapTo:4052},90:{id:90,name:"vit%",mapTo:4053},185:{id:185,name:"wots attack power",mapTo:3e3},251:{id:251,name:"critical chance%",mapTo:1012},164:{id:164,name:"intToPdmg",mapTo:10164},165:{id:165,name:"strToMdmg",mapTo:10165},222:{id:222,name:"hellfire",getVals:function(a){if(a.indexOf(";")>0){var e=a.split(";");return[{id:62,effect:222,max:Number(e[0])/100},{id:4012,effect:222,max:Number(e[1])}]}return[{id:62,effect:222,max:Number(a)/100}]}},372:{id:372,name:"statConversion",getVals:function(a){if(a.indexOf(";")>0){var e=a.split(";");if(3==e.length&&2==e[0]&&6==e[2])return[{id:10372,name:"intToMdmg",max:Number(e[1])}];if(3==e.length&&0==e[0]&&5==e[2])return[{id:103721,name:"strToPdmg",max:Number(e[1])}]}return[]}},389:{id:389,name:"fd buff or sader cm1",getVals:function(a){return a&&a.indexOf&&a.indexOf(";")>0?[]:[{id:10389,name:"fd buf",max:Number(a)}]}},404:{id:404,name:"critical damage%",mapTo:1103}},gemExchanges:[{id:2,exchange:1,name:"Weapon"},{id:3,exchange:2,name:"Off-Hand Weapon"},{id:4,exchange:3,name:"Headgear"},{id:5,exchange:4,name:"Body Armor"},{id:6,exchange:5,name:"Leg Armor"},{id:7,exchange:6,name:"Gloves"},{id:8,exchange:7,name:"Shoes"},{id:101,exchange:8,name:"Necklace"},{id:102,exchange:9,name:"Earrings"},{id:103,exchange:10,name:"Ring"}],customItems:[{id:0,typeName:"custom",name:"hp unified",stats:[{id:4075,max:.05}]}],getStats:function(a){var e=!1,d=!1,i=!0,m="State1_Max";m in a?e=!0:(m="State1Value")in a&&(d=!0);for(var s=0,n=[];;){s++;var t="State"+s;if(!(t in a))break;var l=a[t];if(l==-1)break;if(107==l);else{var m,p={id:l};if(e?(m="State"+s+"_Max",p.max=a[m]):d?(m="State"+s+"Value",p.max=a[m]):(m="StateValue"+s,p.max=Number(a[m])),p.max>0||p.max<0){if(i)if((m="NeedSetNum"+s)in a){if(0==a[m])break;p.needSetNum=a[m]}else i=!1;n.push(p)}}}return n},setupStat:function(a,e){a.id=Number(e)},mergeStats:function(a,e){function d(a){var e=Number(a.max);m.stats[a.id]&&"pc"in m.stats[a.id]&&(e=Math.floor(e)),a.id in i?i[a.id]+=e:i[a.id]=e}var i={},m=this;angular.forEach(a,function(a,e){a&&d(a)}),e&&angular.forEach(e,function(a,e){a&&d(a)});var s=[];for(var n in i){var t={max:i[n],id:Number(n)};s.push(t)}return s}}}angular.module("dnsim").factory("hCodeValues",[a])}();
//# sourceMappingURL=app.min.js.map
