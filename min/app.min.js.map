{"version":3,"sources":["routes.js","builds/build-actions.js","builds/build-export-action.js","builds/build-import.js","builds/build-item-list.js","builds/build-item.js","builds/build-list.js","builds/build-stats.js","builds/build-summary.js","builds/build-talismans.js","builds/build.js","builds/delete-build.js","builds/edit-build.js","builds/quick-add.js","builds/reload-build.js","builds/view-group.js","filters/escape.filter.js","filters/percentage.filter.js","about/about.js","item/group-assignment.js","item/item-edit-custom.js","item/item-edit-enchantment.js","item/item-edit-potential.js","item/item-edit-skill.js","item/item-edit-spark.js","item/item-edit-talisman.js","item/item-edit.js","item/item-view-attainment.js","item/item-view-box.js","item/item-view-craft.js","item/item-view-extraction.js","item/item-view-plate.js","item/item-view-set.js","item/item-view-shop.js","item/item-view-transfer.js","item/item.js","nav/export.js","nav/header.js","nav/nav.js","nav/setup.js","online/build-search.js","online/profile.js","online/publish.js","online/published.js","region/region.js","search/custom-items.js","search/everything-search.js","search/search.js","search/skill-search.js","widgets/choose-class.js","widgets/dnsim-category-links.js","widgets/dnsim-item-icon.js","widgets/dnsim-item-link.js","widgets/dnsim-job-icon.js","widgets/dnsim-loading.js","widgets/dnsim-select-all-on-click.js","widgets/dnsim-stats.js","widgets/dnsim-string-to-number.js","widgets/dnsim-string-to-percent.js","widgets/file-change.js","characterService.js","columnsToLoadService.js","dntDataService.js","dntInitService.js","dntResetService.js","dvStatcardService.js","exportLinkServices.js","groupServices.js","itemCategoryService.js","itemExcludeService.js","itemFactoryService.js","itemSourceService.js","jobService.js","onlineService.js","quickAddHelperService.js","quickAddService.js","quickAddStepsService.js","regionService.js","saveService.js","statService.js","translationService.js","uiTranslationService.js","valueServices.js"],"names":["angular","module","config","$routeProvider","when","templateUrl","controller","reloadOnSearch","otherwise","redirectTo","$location","saveHelper","exportLinkHelper","vm","deleteGroup","path","search","buildName","editGroup","copyGroup","newGroupName","importGroup","build","items","saveBuild","reloaded","reloadGroup","progress","setShortUrl","longUrl","createGroupLink","shortUrl","sessionStorage","getItem","directive","scope","bindToController","onChange","controllerAs","$timeout","hCodeValues","statHelper","itemCategory","groupHelper","translations","dntData","dntReset","export","exportBuild","blob","Blob","JSON","stringify","type","saveAs","onFileChange","copyLocally","event","files","target","console","log","length","fileName","name","reader","FileReader","readAsText","onload","parse","result","substr","replace","buildItemListController","$inject","category","server","getCategoryItems","itemsByCat","getItemsByCategory","subCats","subCatCatName","getSubCategories","subCatList","sort","item1","item2","exchangeType","_","filter","item","increasingGemSlots","offensiveGemSlots","costumeCat","byName","isItemForCat","each","names","slots","push","getNumTaken","subCat","retVal","exchangeId","gemExchange","find","gemExchanges","e","exchange","id","gemSlot","isInSubCat","allSubCatItems","foundSubCatItem","subCatItem","canMove","getGemSlot","move","moveItem","destination","updatedSavedItems","handleChange","allowMoreItems","maxCat","handleItemEdit","cancelEdit","canEdit","typeName","removeItem","newItemList","forEach","gItem","index","updateItem","setFullStats","gemSlots","getGemSlotName","i","fullStats","stats","enchantmentStats","mergeStats","sparkStats","editMode","$window","$routeParams","document","body","className","setupBuilds","savedItems","getSavedItems","buildNames","Object","keys","builds","currentGroup","saveBuildSelection","title","anyItems","createGroup","toggleGroup","url","publish","buildStatsController","dvStatcardHelper","exportStatCard","dvCardStatHash","convertStats","calculatedStats","cardImportUrl","btoa","window","open","getBuildStats","itemsByCategory","getSaveDate","group","lastUpdate","Date","toLocaleDateString","getSaveTime","toLocaleTimeString","getBuildSummary","summary","typeCounts","cashItems","titles","itemsByType","jobs","itemColumnsToLoad","character","scrollTo","groupNames","groupName","getCurrentBuild","getGroupCalcStats","groupCalcStats","getCalculatedStatsFromItems","getBuild","pickup","selectedIndex","replaceHPAffectAmount","replaceMDmgAffectAmount","replacePDmgAffectAmount","replaceAvgDmgAffectAmount","saveGroup","headers","summaryStatIds","summaryDisplay","pcIndexes","rows","updateRows","pcIndex","enchantmentNum","rowIndex","makeFakeCells","data","makeCell","num","click","col","swapEnchantmentNumber","setTalisman","splice","replaceAffectAmount","newEnhancementNum","extraStats","stat","max","getReplaceAffectAmount","statId","itemIndex","initReplaceAffects","fullStats1","fullStats2","newItems","newStats","origStats","calcStatPercent","getStat","getStatName","element","eleId","elements","secondaryElement","len","newVal","origVal","Math","round","save","bulidController","selectedCategory","localStorage","hideInBuild","changeCategory","xsView","categoryChanging","getCategories","categories","setSelectedCategory","value","setItem","getItemCount","itemCountText","allItems","numOffensiveSlots","numOffensiveGems","totalIncreasingGems","numIncreasingSlots","numIncreasingGems","gemType","sparkTypeId","number","numItems","cat","numItemText","newCustom","concat","newGroup","delete","deleteBuild","editBuildCtrl","region","oldGroupName","heroStats","damageTypes","initDamageType","job","damageType","d","DamageType","initDefaultElement","defaultElement","defaultSecondaryElement","jobName","EnglishName","critResist","eleResist","enemyLevel","playerLevel","heroLevel","init","newJobs","getFinalJobs","key","setHeroStats","setJob","getStatCap","colName","useLevel","getStatCaps","getJobConversion","getConversions","getJobBaseStat","getBaseStats","invalidGroupName","ok","enemyStatCaps","playerStatCaps","conversions","baseStats","getHeroStats","input","getElementById","focus","setSelectionRange","quickAdd","startedForCat","stepNumber","datas","options","setOptions","hasStarted","getOptions","selectOption","createData","isValidStepNumber","newItem","dntFiles","getDntFiles","columns","tryToAddItem","anyLoading","allLoaded","isLoaded","cancel","reloadItem","saveItem","reset","start","hasOptions","back","pop","testOptions","reloadBuildCtrl","reload","tryInit","goToBuild","$scope","setLocationByName","g","p","h","j","t","s","itemString","split","itemStr","decodeItem","isLoading","allInit","getById","newBuildName","escapeFilter","encodeURIComponent","percentageFilter","$stateful","groupAssignment","compact","savedGroup","clearGroup","addAffectAmount","groupItems","tryToSetItem","$watch","getAddAffectAmount","initAddAffects","getGroupItems","itemSplit","numMatches","str","matches","indexOf","existing","itemSource","a","b","hasMaxExchangable","maxExchange","nextGroup","uptoItem","prevGroup","foundGroup","addToGroup","replaceItem","statMap","newValue","oldValue","anyChange","Number","found","itemFactory","enchantmentId","itemType","enchantDnt","getEnchantments","enchantDnt2","petLevelDnt","petDnt","enchantments","enchantment","enchantmentAfter","enchantmentCost","enhancementOptions","setEnchantment","getEnchantLevel","getStats","NeedCoin","PetLevel","EnchantLevel","setPetLevel","isMaxEnchantLevel","setEnchantmentNum","enhancementOption","nextEnchantment","getOption","prevEnchantment","showMaterials","materials","itemId","itemCount","material","createBasicItem","reportProgress","msg","potentials","potential","changingPotentials","potentialStats","pid","potentialDnt","getPotentials","PotentialID","getPotentialStats","potentialDntEx","nextPotential","prevPotential","changePotential","isFirstPotential","isLastPotential","pStats","emptyStatId","sIndex","hide","getDntFile","baseJobName","pve","initSkills","dntFile","skillData","isMaxSkillLevel","sparkDnt","getSparks","sparks","nextSpark","getPotentialIndex","spark","sparkId","isMoreSparks","isFirstSpark","prevSpark","removeSpark","sid","potentialIndex","amount","onUpdateItem","attainments","hasFailed","file","attainment","text","ItemGainText","texts","singleText","splitVal","translate","typeId","pouchFileNames","allItemFileName","charmItemtable","commonCharmItemtable","usedFiles","lookupId","initBoxContents","TypeParam1","getCharmItems","getPouchItems","boxType","f","getPouchItemsFromFile","pouchFileName","pouchData","gold","GoldMin","isGroup","pouchItem","pouchItemCount","itemds","basicItem","count","charmFiles","charmData","getData","c","cd","CharmNum","Look","CharmType","ItemID","Count","Gold","getFileLink","dntLocation","crafts","cFiles","dropFile","initCrafts","initCraft","di","drops","drop","newCrafts","k","fCrafts","craft","Cost","itemColName","qtyColName","extractFileName","initExtract","disjoint","getItemData","DisjointDrop1","EnchantID","DisjointDrop","getItems","getGold","Disjointamount","plateFile","allFiles","initSets","getPlates","r","row","itemData","getSetItems","setId","shopCosts","cShopFileName","cSysShopFileName","cCashShopFileName","initShops","getCombinedCosts","newShopCosts","tabName","numItem1","numItem2","shops","item1s","PurchaseItem1","item2s","PurchaseItem2","shopCost","shopName","ShopID","TabNameID","nightmarePoints","dungeonPoints","nestPoints","ladderPoints","shopNames","PurchaseType1","PurchaseItemValue1","pointsId1","PurchaseType2","PurchaseItemValue2","pointsId2","matchingTransfers","transferFileName","transferItemsFileName","initTransfers","transferItem","transfers","Rank","rank","LevelLimit","levelLimit","NeedItemID1","NeedItemID2","level","ResultLevel","ResultEnchantLevel","rankNames","ResultRank","NeedItemCount1","NeedItemCount2","setStats","detail","getDescription","description","mainDnt","DescriptionID","DescriptionIDParam","getExchangeType","exchangeDnt","NameID","toLowerCase","setDetail","getNumInSet","getBuildName","getNumItemsForSet","allBuildNames","getSellingPrice","SellAmount","floor","silver","copper","getServerStorage","IsCash","AbleWStorage","Reversion","getMoreInfo","sealTimes","numStamps","moreInfoLoaded","SealCount","sealData","SealID","Type1","CashTradeCount","loadMoreInfo","encodeItem","copy","getBuilds","getJobName","allJobs","getAllJobs","needJobClass","preInitItem","anyToLoad","anyDntToLoad","setFileName","setupTabs","canExtract","Type","canTransfer","isInSet","isPlate","hasContents","canUse","rawSavedData","exportData","LZString","compressToUTF16","noLocationMenu","normalMenu","icon","buildAction","withBuildMenu","isSearch","startedLoading","tlocation","noRegion","isHttpOnly","location","protocol","hostname","getActions","menu","currentBuild","extraCss","ex","simError","message","error","$route","dntInit","advancedSetup","translationResults","hostedFiles","noLocation","sessionLocation","alternativeFiles","testResults","setLocation","saveLocation","existingFile","progressTranslations","translationsStatus","resetSessionData","clear","hash","loadUiString","setCustomUrl","testLocation","buildSearch","onlineService","maxDisplay","totalNumResults","jobId","getClassBuilds","showMoreResults","extra","allResults","getFilteredBuilds","uid","jobBuilds","results","toUpperCase","guild","then","profile","getSavedBuilds","getProfile","getUserBuilds","storedBuilds","load","show","login","user","getUser","saveProfile","catch","handleError","getTime","publishBuild","startPublish","about","err","deleteAccount","getBuildLimit","maxBuilds","getNumStoredBuilds","size","getNumBuilds","signOut","deleteLocal","localToDelete","getAllBuildNames","allKeys","uniq","reallyDeleteLocal","deleteServer","serverToDelete","reallyDeleteServer","published","$http","override","getOverride","tHoverLocation","hoverLocation","edit","dntVersion","setDntVersion","get","res","newLineDetails","spaceDetails","getDntLocation","getTlocation","getHostedFiles","getWorldName","setTLocation","updateParams","setOverride","customItemCtrl","customItems","currentResults","nameSearch","getResults","getNewStatName","createCustomItem","everythingSearchCtrl","everything","minLevel","maxLevel","version","versions","origMinLevel","origMaxLevel","initeverything","versionMap","NameIDParam","IconImageIndex","sortBy","newResults","numeverything","curDisplay","nameSearches","allMatch","ns","toString","changeSearch","controllerParams","itemSearchCtrl","byPath","catName","hideInSearch","grades","searchable","origSavedSearchStatId","navigate","hideLevel","hideJob","origJobNumber","jobInit","lastJobNumber","loadResults","rankChecked","checkedRank","pcStatId","pc","altStatId","altStat","statVals","numEquip","hideRank","isClassJob","initItem","statFound","statVal","min","value1","value2","statResults","skillSearchCtrl","dntName","skills","loadedJobId","baseName","getBaseJobName","getDntName","baseClassName","getSkills","baseJobNames","setupSkills","allReady","numSkills","EffectClass1","EffectClass2","EffectClass3","EffectClass4","EffectClass5","EffectClass6","NeedJob","chooseClass","restrict","onSetJob","chooseClassController","finalJobs","bJob","getBaseJobs","englishName","dnsimCategoryLinksController","dnsimCategoryLinks","collapse","buildScreen","$translate","collapsed","shouldShow","action","loaded","setCategory","getName","tId","instant","dnsimItemIcon","link","attrs","iconImage","getIcon","fileIndex","prefix","getIconXPostion","getIconYPostion","dnsimItemLink","noClick","itemLink","dnsimJobIcon","small","dnsimJobIconController","sizeValue","iconSize","iconOffset","JobIcon","dnsimLoading","transclude","alsoShowFor","$on","setLoadCount","loadError","numLoading","n","totalToLoad","dnsimSelectAllOnClick","hasSelectedAll","on","$event","selectionStart","selectionEnd","select","dnsimStats","altStats","separator","numInSet","sep","addedElements","originalDisplay","css","showStats","remove","first","lastElement","append","newElement","clone","html","after","summaryForStats","def","summaryFor","output","needSetNum","display","combineWith","stat2","key2","sStat","sDef","dnsimStringToNumber","require","ngModel","$parsers","$formatters","parseFloat","fileChangeFunction","$parse","attrHandler","handler","$apply","addEventListener","factory","jobConversions","statCaps","jobBaseStats","heroLevels","heroLevelPotentials","complete","jobConversionColsToLoad","statCapColsToLoad","jobBaseStatColsToLoad","findFast","getRow","pIndex","HeroLevelAbilityID","TypeParam2","TypeParam3","NeedJobClass","State1","StateValue1","State1_Max","State2","StateValue2","State2_Max","State3","StateValue3","State3_Max","State4","StateValue4","State4_Max","State5","StateValue5","State5_Max","State6","StateValue6","State6_Max","State7","StateValue7","State7_Max","State8","StateValue8","State8_Max","State9","StateValue9","State9_Max","State10","StateValue10","State10_Max","SkillID","dragonjeweltype","ExchangeType","TierName","partsDnt","SetItemID","EnchantRatio","BreakRatio","MinDown","MaxDown","NeedItemID3","NeedItemCount3","NeedItemID4","NeedItemCount4","NeedItemID5","NeedItemCount5","ProtectItemCount","State1Value","State2Value","State3Value","State4Value","State5Value","State6Value","State7Value","State8Value","State9Value","State10Value","PotentialNo","PotentialRatio","State11","State11Value","State12","State12Value","State13","State13Value","State14","State14Value","State15","State15Value","State16","State16Value","gemDnt","setDnt","jobsDnt","JobName","JobNumber","BaseClass","ParentJob","Strength","Agility","Intelligence","Stamina","AggroperPvE","BaseMP","Cbase","Cdefense","Ccritical","Cfinaldamage","CcriticalDamage","HP","StrengthAttack","AgilityAttack","IntelligenceAttack","PhysicalDefense","MagicDefense","Critical","CriticalResistance","Stiff","StiffResistance","Stun","StunResistance","MoveSpeed","MoveSpeedRevision","DownDelay","ElementAttack","ElementDefense","ElementDefenseMin","ElementDefenseMax","StrengthIntelligenceToCriticalDamage","$rootScope","createLoader","colsToLoad","loader","DntReader","completeCallbacks","ignoreErrors","$broadcast","loadDntFromServerFile","failed","loaders","findIndexes","Array","numRows","column","numResults","colIndex","columnIndexes","findIndex","val","isArray","hasStartedLoading","resetAll","getNumRows","lookupValue","columnName","columnNames","convertData","getValue","saveMemory","saveReaderMemory","allFactories","prop","newFactory","initFactory","source","convertStat","ret","convertPercentToNum","adjustments","adjustStat","func","calcStats","characterName","remark","classId","statHeroLevel","v","itemTypeName","itemBit","bitIndex","charAt","parseInt","statString","statBit","statBitIndex","splitStat","itemStrings","self","encodeURI","join","reloadSkill","skillDnt","pv","skillLevelDnt","skillLevelDatas","skillLevelVals","SkillIndex","SkillLevel","SkillExplanationID","SkillExplanationIDParam","getSkillStats","reloadSourceItem","ds","rowNum","typeParam1","ps","createItem","setItemCategory","usePartDnt","parts","sets","petLevels","DragonJewelSlot1","DragonJewelSlot2","DragonJewelSlot3","DragonJewelSlot4","fileType","allDntFiles","key1","searchType","sourceType","limitExchange","limitGemType","limitRank","sourceName","loading","loadItems","catItems","anyMatch","rawData","gemTypes","gem","sources","numComplete","itemMap","types","sorted","enh1","enh2","localeCompare","excludeService","ids","potentialRatio","isDataLoaded","dType","state1Max","dStateValue1","dTypeParam1","numPotentials","end","time","skillId","iconIndex","petData","PetLevelTypeID","getItemDataFromFile","itemSources","minRank","tech","gemSlotDnt","tman","plate","plate95","weaponDnt","eq","rbeq","pvpeq","cCommon","cClone","c2016","c2017","c2015","c2014","cash","xtras","imprint","doComplete","alljobs","baseJobs","createJob","parentJob","parentJobData","$q","service","firebase","auth","currentUser","stripBuildName","initializeApp","apiKey","authDomain","databaseURL","storageBucket","resolve","reject","onAuthStateChanged","href","database","ref","once","storedProfile","decompressBuild","deleteNullProperties","set","compressBuild","stringifiedData","compressedBuild","decompressFromUTF16","actions","lev","all","test","recurse","undefined","pList","jobIds","quickAddHelper","findData","isItemStep","alterItem","maxItems","sortFunc","sortId","addItem","matchesItem","filterDuplicates","areSameItem","isEqual","quickAddSteps","categorySteps","weapons","armour","accessories","techs","talisman","costume","custom","stepName","getStepName","stepDef","allOptions","minOptions","unfilteredItems","newOptions","option","tempDatas","step","exchangeStep","exchanges","exId","numExchange","exName","accExchangeStep","levelStep","talismanRankStep","gemRankStep","rankStep","values","enhanceTalismanStep","titleStep","allTitles","usefulTitles","enhanceEqStep","enhanceGemStep","itemStep","hideName","namedItemStep","techSkillStep","itemNameStep","itemNames","itemNamesList","distinctItemNameStep","numStatsStep","numStats","highStatStep","allItem","allStats","quickHigh","largestVal","selectedVal","val1","val2","hasStatStep","customStep","dntLocationRegion","hostedFile","lastTFile","newFiles","locationName","newLocation","tLocation","groups","setCurrentBuild","updatedItems","getUniqueGroupName","existingGroups","groupNameIndex","lastIndexOf","startIndex","foundIndex","originalName","saveBuilds","updateBuild","getSetStats","getCombinedStats","nakedStats","getNakedStats","combinedStats","getCalculatedStats","statLookup","getPc","statDef","getSkillPc","skPc","applyPc","dupeStat","addStat","agi","int","vit","hp","defpc","mdef","mdefpc","aPwr","minPdmg","maxPdmg","extraPdmg","extraPdmgMod","paPwr","intToPdmg","minMdmg","maxMdmg","extraMdmg","extraMdmgMod","maPwr","strToMdmg","intToMdmg","crit","skCrit","itemCrit","critChance","cDmg","itemCtriDmg","critDamagePc","fd","maxFd","fdPc","pow","firePc","icePc","lightPc","darkPc","addAvgDamageStat","nonEleDamage","avgDmg","elementStat","dmgStat","secElementId","priElementId","secondaryElementStat","secAvgDmg","pdefEqHp","mdefEqHp","eqHp","effects","stillCols","valColName","effectId","map","skillEffectMapping","getVals","vals","mapTo","effect","uiTranslations","dnTranslations","DnTranslations","smallFile","bigFile","completeCallback","progressCallback","getRawData","sizeLimit","getFileName","loadDefaultFile","addTranslations","use","loadFromSession","idParam","params","uiTranslationLookup","cdn","sea","regionData","toOneDec","toNoDec","inThousands","toPercent","dps","noCustom","typeNames","useMax","useStateXVal","mightHaveSets","currentState","stateProp","stateId","currentData","setupStat","stats1","stats2","add"],"mappings":"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","file":"app.min.js","sourcesContent":["(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').config(['$routeProvider', config]);\r\n\r\nfunction config($routeProvider) {\r\n\r\n  $routeProvider.\r\n  \r\n    when('/about', {\r\n      templateUrl: 'ui/about/about.html',\r\n      controller: 'AboutCtrl as about'\r\n    }).\r\n    \r\n    when('/setup', {\r\n      templateUrl: 'ui/nav/setup.html',\r\n      controller: 'SetupCtrl'\r\n    }).\r\n    when('/test', {\r\n      templateUrl: 'ui/nav/test.html',\r\n      controller: 'TestCtrl'\r\n    }).\r\n    \r\n    when('/items', {\r\n      templateUrl: 'ui/search/everything-search.html',\r\n      controller: 'ItemsCtrl as items',\r\n      reloadOnSearch: false,\r\n    }).\r\n    \r\n    when('/', {\r\n      templateUrl: 'ui/welcome.html',\r\n    }).\r\n    when('/builds', {\r\n      templateUrl: 'ui/builds/build-list.html',\r\n      controller: 'BuildListCtrl as buildList'\r\n    }).\r\n    when('/build', {\r\n      templateUrl: 'ui/builds/build-list.html',\r\n      controller: 'BuildListCtrl as buildList'\r\n    }).\r\n    when('/view-group', {\r\n      templateUrl: 'ui/builds/view-group.html',\r\n      controller: 'ViewGroupCtrl'\r\n    }).\r\n    when('/edit-build', {\r\n      templateUrl: 'ui/builds/edit-build.html',\r\n      controller: 'EditBuildCtrl as editGroup',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    when('/new-build', {\r\n      templateUrl: 'ui/builds/edit-build.html',\r\n      controller: 'EditBuildCtrl as editGroup',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    when('/delete-build', {\r\n      templateUrl: 'ui/builds/delete-build.html',\r\n      controller: 'DeleteBuildCtrl as deleteBuild',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    when('/reload-build', {\r\n      templateUrl: 'ui/builds/reload-build.html',\r\n      controller: 'ReloadBuildCtrl as ctrl',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    \r\n    when('/search', {\r\n      templateUrl: 'ui/search/search.html',\r\n      controller: 'ItemSearchCtrl as ctrl',\r\n      reloadOnSearch: false,\r\n    }).\r\n    \r\n    when('/item', {\r\n      templateUrl: 'ui/item/item.html',\r\n      controller: 'ItemCtrl',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    when('/item', {\r\n      templateUrl: 'ui/item/item.html',\r\n      controller: 'ItemCtrl',\r\n      // reloadOnSearch: false,\r\n    }).\r\n    \r\n    when('/export', {\r\n      templateUrl: 'ui/nav/export.html',\r\n      controller: 'ExportCtrl',\r\n    }).\r\n    \r\n    when('/talismans', {\r\n      templateUrl: 'ui/builds/build-talismans.html',\r\n      controller: 'BuildTalismansCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/publish', {\r\n      templateUrl: 'ui/online/publish.html',\r\n      controller: 'PublishCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/profile', {\r\n      templateUrl: 'ui/online/profile.html',\r\n      controller: 'ProfileCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/published', {\r\n      templateUrl: 'ui/online/published.html',\r\n      controller: 'PublishedCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/import', {\r\n      templateUrl: 'ui/builds/build-import.html',\r\n      controller: 'BuildImportCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/published', {\r\n      templateUrl: 'ui/online/published.html',\r\n      controller: 'PublishedCtrl as ctrl',\r\n    }).\r\n    \r\n    when('/build-search', {\r\n      templateUrl: 'ui/online/build-search.html',\r\n      controller: 'BuildSearchCtrl as ctrl',\r\n    }).\r\n    \r\n    otherwise({\r\n      redirectTo: '/'\r\n    });\r\n}\r\n\r\n})();","angular.module('dnsim').controller('buildActionsCtrl',\r\n\r\n['$location','saveHelper','exportLinkHelper',\r\nfunction($location,saveHelper,exportLinkHelper) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  this.deleteGroup = function() {\r\n    $location.path('/delete-build');\r\n    $location.search('name', vm.buildName);\r\n  }\r\n  \r\n  this.editGroup = function() {\r\n    $location.path('/edit-build');\r\n    $location.search('buildName', vm.buildName);\r\n  }\r\n  \r\n  this.copyGroup = function() {\r\n    var newGroupName = saveHelper.importGroup(vm.buildName, vm.build.items);\r\n    \r\n    saveHelper.saveBuild(\r\n      newGroupName, \r\n      newGroupName,\r\n      vm.build);\r\n    \r\n    $location.path('/build');\r\n    $location.search('buildName', newGroupName);\r\n  }\r\n  \r\n  this.reloaded = false;\r\n  this.reloadGroup = function() {\r\n    $location.path('/reload-build');\r\n    $location.search('name', vm.buildName);\r\n  }\r\n  \r\n  function progress() {\r\n  }\r\n    \r\n  this.setShortUrl = function() {\r\n    if(vm.build) {\r\n      var longUrl = exportLinkHelper.createGroupLink(vm.buildName, vm.build);\r\n      vm.build.shortUrl = sessionStorage.getItem(longUrl);\r\n    }\r\n  }\r\n  \r\n  this.setShortUrl();\r\n}])\r\n.directive('dngearsimBuildActions', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      buildName: '=buildName',\r\n      build: '=build',\r\n      onChange: '&onChange'\r\n    },\r\n    controller: 'buildActionsCtrl',\r\n    controllerAs: 'buildActions',\r\n    templateUrl: 'ui/builds/build-actions.html'\r\n  };\r\n});","angular.module('dnsim').controller('buildExportActionCtrl',\r\n\r\n['$timeout','$location','hCodeValues','statHelper','itemCategory','saveHelper','exportLinkHelper','groupHelper','translations','dntData','dntReset',\r\nfunction($timeout,$location,hCodeValues,statHelper,itemCategory,saveHelper,exportLinkHelper,groupHelper,translations,dntData,dntReset) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.export = exportBuild;\r\n  \r\n  function exportBuild() {\r\n    var blob = new Blob([JSON.stringify(vm.build, null, 1)], {type: \"text/plain;charset=utf-8\"});\r\n    saveAs(blob, 'dngearsim-' + vm.buildName + '.json');\r\n  }\r\n}])\r\n.directive('dngearsimBuildExportAction', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      buildName: '=buildName',\r\n      build: '=build'\r\n    },\r\n    controller: 'buildExportActionCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/builds/build-export-action.html'\r\n  };\r\n});","angular.module('dnsim').controller('BuildImportCtrl',\r\n\r\n['$timeout','$location','hCodeValues','statHelper','itemCategory','saveHelper','exportLinkHelper','groupHelper','translations','dntData','dntReset',\r\nfunction($timeout,$location,hCodeValues,statHelper,itemCategory,saveHelper,exportLinkHelper,groupHelper,translations,dntData,dntReset) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.onFileChange = onFileChange;\r\n  vm.copyLocally = copyLocally;\r\n  \r\n  function onFileChange(event) {\r\n    var files = event.target.files;\r\n    console.log('importing files', files);\r\n    if(files && files.length) {\r\n      \r\n      var fileName = files[0].name;\r\n      var reader = new FileReader();\r\n      reader.readAsText(files[0]);\r\n      reader.onload = function() {\r\n        vm.build = JSON.parse(reader.result);\r\n        if(fileName && fileName.length > 5) {\r\n          vm.buildName = fileName.substr(0, fileName.length-5);\r\n          vm.buildName = vm.buildName.replace('dngearsim-', '')\r\n        }\r\n        else {\r\n          vm.buildName = 'imported build';\r\n        }\r\n        $timeout();\r\n      }\r\n    }\r\n  }\r\n  \r\n  function copyLocally() {\r\n    var newGroupName = saveHelper.importGroup(vm.buildName, vm.build.items);\r\n    \r\n    saveHelper.saveBuild(\r\n      newGroupName, \r\n      newGroupName,\r\n      vm.build);\r\n      \r\n    $location.path('/build');\r\n    $location.search('buildName', newGroupName);\r\n  }\r\n}]);","'use strict';\r\n  \r\nangular.module('dnsim').directive('dngearsimBuildItemList', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      buildName: '=buildName',\r\n      build: '=build',\r\n      category: '=category',\r\n      server: '=server',\r\n      onChange: '&onChange'\r\n    },\r\n    controller: buildItemListController,\r\n    controllerAs: 'buildCtrl',\r\n    templateUrl: 'ui/builds/build-item-list.html'\r\n  };\r\n});\r\n\r\nfunction buildItemListController(hCodeValues, itemCategory, saveHelper) {\r\n\r\n  var vm = this;\r\n\r\n  vm.getCategoryItems = function() {\r\n    var itemsByCat = itemCategory.getItemsByCategory(vm.build.items);\r\n    if(vm.category.name in itemsByCat) {\r\n      return itemsByCat[vm.category.name];\r\n    }\r\n    else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  var subCats = {};\r\n  var subCatCatName = '';\r\n  vm.getSubCategories = function() {\r\n    if(subCatCatName != vm.category.name) {\r\n      subCats = {};\r\n      subCatCatName = vm.category.name;\r\n      var subCatList = [];\r\n\r\n      var items = vm.build.items.sort(function(item1, item2) {\r\n        return item1.exchangeType - item2.exchangeType;\r\n      });\r\n      if(vm.category.name == 'increasing gems') {\r\n        subCatList = _.filter(items, function(item) {\r\n          return item.increasingGemSlots > 0;\r\n        });\r\n      }\r\n      else if(vm.category.name == 'offensive gems') {\r\n        subCatList = _.filter(items, function(item) {\r\n          return item.offensiveGemSlots > 0;\r\n        });\r\n      }\r\n      else if(vm.category.name == 'imprint') {  \r\n        var costumeCat = itemCategory.byName('costume');\r\n        subCatList = _.filter(items, function(item) {\r\n          return itemCategory.isItemForCat(costumeCat, item);\r\n        });\r\n      }\r\n      _.each(subCatList, function(item) {\r\n        if(!(item.exchangeType in subCats)) {\r\n          subCats[item.exchangeType] = {\r\n            names: [],\r\n            slots: 0,\r\n            exchangeType: item.exchangeType\r\n          };\r\n        }\r\n\r\n        subCats[item.exchangeType].names.push(item.name);\r\n        if(vm.category.name == 'increasing gems') {\r\n          subCats[item.exchangeType].slots += item.increasingGemSlots;\r\n        }\r\n        else if(vm.category.name == 'offensive gems') {\r\n          subCats[item.exchangeType].slots += item.offensiveGemSlots;\r\n        }\r\n        else {\r\n            subCats[item.exchangeType].slots = 1;\r\n        }\r\n      });\r\n      subCats[0] = null;\r\n    }\r\n    \r\n    return subCats;\r\n  }\r\n\r\n  vm.getNumTaken = function(subCat) {\r\n    var retVal = 0;\r\n    var exchangeId;\r\n    if(vm.category.name == 'imprint') {\r\n      exchangeId = subCat.exchangeType;\r\n    }\r\n    else {\r\n      var gemExchange = _.find(hCodeValues.gemExchanges, function(e) {\r\n        return e.exchange == subCat.exchangeType;\r\n      });\r\n\r\n      exchangeId = gemExchange.id;\r\n    }\r\n\r\n    if(exchangeId) {\r\n      var items = vm.getCategoryItems();\r\n      _.each(items, function(item) {\r\n        if(item.gemSlot == exchangeId) {\r\n          ++retVal;\r\n        }\r\n      });\r\n    }\r\n    return retVal;\r\n  }\r\n\r\n  vm.isInSubCat = function(item, subCat) {\r\n    if(!subCat && !item.gemSlot) {\r\n      return true;\r\n    }\r\n    else {\r\n      var exchangeId;\r\n      if(vm.category.name == 'imprint') {\r\n        exchangeId = item.gemSlot;\r\n      }\r\n      else {\r\n        var gemExchange = _.find(hCodeValues.gemExchanges, function(e) {\r\n          return e.id == item.gemSlot;\r\n        });\r\n        if(gemExchange) {\r\n          exchangeId = gemExchange.exchange;\r\n        }\r\n      }\r\n\r\n      if(!subCat && exchangeId) {\r\n        // check for invalid slot\r\n        var allSubCatItems = vm.getSubCategories();\r\n        var foundSubCatItem = _.find(allSubCatItems, function(subCatItem) {\r\n          return subCatItem != null && exchangeId == subCatItem.exchangeType;\r\n        });\r\n\r\n        if(!foundSubCatItem) {\r\n          return true;\r\n        }\r\n      }\r\n      else if(subCat && exchangeId) {\r\n        return exchangeId == subCat.exchangeType;\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  vm.canMove = function() {\r\n    return vm.category.name == 'increasing gems' || vm.category.name == 'offensive gems' || vm.category.name == 'imprint';\r\n  }\r\n\r\n  vm.getGemSlot = function(subCat) {\r\n    if(vm.category.name == 'imprint') {\r\n      return subCat.exchangeType;\r\n    }\r\n    else if(subCat) {\r\n      var gemExchange = _.find(hCodeValues.gemExchanges, function(e) {\r\n        return e.exchange == subCat.exchangeType;\r\n      });\r\n\r\n      if(!gemExchange) {\r\n          console.log('cannot find exchange for', subCat);\r\n      }\r\n      return gemExchange.id;\r\n    }\r\n  }\r\n\r\n  vm.move = function(moveItem, destination) {\r\n    moveItem.gemSlot = vm.getGemSlot(destination);\r\n    saveHelper.updatedSavedItems(vm.buildName, vm.build.items);\r\n    vm.handleChange();\r\n  }\r\n  \r\n  vm.allowMoreItems = function() {\r\n    return !vm.category.maxCat || vm.getCategoryItems().length < vm.category.maxCat;\r\n  }\r\n  \r\n  vm.handleChange = function() {\r\n    subCatCatName = '';\r\n    vm.onChange();\r\n  }\r\n  \r\n  vm.handleItemEdit = function() {\r\n    saveHelper.updatedSavedItems(vm.buildName, vm.build.items);\r\n    vm.handleChange();\r\n  }\r\n  \r\n  vm.cancelEdit = function() {\r\n    vm.onChange();\r\n  }\r\n  \r\n  vm.canEdit = function(item) {\r\n    return item.typeName == 'custom' || item.typeName == 'weapons' || item.typeName == 'armour' || item.typeName == 'offensive gems' || item.typeName == 'increasing gems';\r\n  }\r\n  \r\n  vm.removeItem = function(item) {\r\n    subCatCatName = '';\r\n    item.removeItem = true;\r\n    var newItemList = [];\r\n    angular.forEach(vm.build.items, function(gItem, index) {\r\n      if(gItem && !gItem.removeItem) {\r\n        newItemList.push(gItem);\r\n      }\r\n    });\r\n\r\n    vm.build.items = newItemList;\r\n    saveHelper.updatedSavedItems(vm.buildName, newItemList);\r\n    vm.handleChange();\r\n  }\r\n}","angular.module('dnsim').controller('buildItemCtrl',\r\n\r\n['$timeout','statHelper','saveHelper','hCodeValues',\r\nfunction($timeout,statHelper,saveHelper,hCodeValues) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.updateItem = setFullStats;\r\n  vm.gemSlots = hCodeValues.gemExchanges;\r\n  vm.getGemSlotName = getGemSlotName;\r\n  \r\n  function getGemSlotName(item) {\r\n    if(item.gemSlot) {\r\n      for(var i=0;i<vm.gemSlots.length;++i) {\r\n        if(vm.gemSlots[i].id == item.gemSlot) {\r\n          return vm.gemSlots[i].name;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  function setFullStats() {\r\n    // full stats are cleared when publishing builds\r\n    vm.item.fullStats = vm.item.stats;\r\n    \r\n    if(vm.item.enchantmentStats != null && vm.item.enchantmentStats.length > 0) {\r\n      vm.item.fullStats = hCodeValues.mergeStats(vm.item.enchantmentStats, vm.item.fullStats);\r\n    }\r\n    \r\n    if(vm.item.sparkStats != null && vm.item.sparkStats.length > 0) {\r\n      vm.item.fullStats = hCodeValues.mergeStats(vm.item.sparkStats, vm.item.fullStats);\r\n    }\r\n  }\r\n  \r\n}])\r\n.directive('dngearsimBuildItem', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      editMode: '=editMode',\r\n      onChange: '&onChange',\r\n      cancelEdit: '&cancelEdit'\r\n    },\r\n    controller: 'buildItemCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/builds/build-item.html'\r\n  };\r\n});","angular.module('dnsim').controller('BuildListCtrl', \r\n  [ '$window','$location','$routeParams','$timeout','saveHelper',\r\n  function($window,$location,$routeParams,$timeout,saveHelper) {\r\n    'use strict';\r\n    \r\n    var vm = this;\r\n    document.body.className = 'saved-back';\r\n    this.setupBuilds = function() {\r\n      vm.savedItems = saveHelper.getSavedItems();\r\n      vm.buildNames = Object.keys(vm.savedItems).sort();\r\n      vm.builds = [];\r\n      for(var i=0;i<vm.buildNames.length;++i) {\r\n        vm.builds.push({\r\n          name: vm.buildNames[i],\r\n          build: vm.savedItems[vm.buildNames[i]],\r\n        });\r\n      }\r\n    }\r\n    this.setupBuilds();\r\n    \r\n    if('buildName' in $routeParams) {\r\n      if($routeParams.buildName in vm.savedItems) {\r\n        if($routeParams.buildName != this.currentGroup) {\r\n          this.currentGroup = $routeParams.buildName;\r\n          saveHelper.saveBuildSelection(this.currentGroup, this.savedItems);\r\n        }\r\n      }\r\n      else {\r\n        this.currentGroup = null;\r\n      }\r\n    }\r\n    else if(this.currentGroup && this.currentGroup in this.savedItems) {\r\n      $location.path('/build');\r\n      $location.search('buildName', this.currentGroup);\r\n    }\r\n    else {\r\n      this.currentGroup = null;\r\n    }\r\n    \r\n    if(this.currentGroup) {\r\n      $window.document.title = 'dngearsim | ' + this.currentGroup;\r\n    }\r\n    else {\r\n      $window.document.title = 'dngearsim | BUILDS';\r\n    }\r\n\r\n    this.anyItems = function() {\r\n      return Object.keys(this.savedItems).length > 0;\r\n    }\r\n\r\n    this.createGroup = function() {\r\n      $location.path('/new-build');\r\n    }\r\n    \r\n    this.handleChange = function() {\r\n      vm.setupBuilds();\r\n      $timeout();\r\n      // console.log('change');\r\n    }\r\n  \r\n    this.toggleGroup = function(buildName) {\r\n      saveHelper.saveBuildSelection(buildName, this.savedItems);\r\n      $location.url('/build?buildName=' + buildName);\r\n    }\r\n    \r\n    this.publish = function() {\r\n      $location.url('/publish');\r\n    }\r\n    \r\n    this.search = function() {\r\n      $location.url('/build-search');\r\n    }\r\n  }]\r\n);\r\n","'use strict';\r\n\r\nangular.module('dnsim').directive('dngearsimBuildStats', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      stats: '=stats',\r\n      build: '=build',\r\n      buildName: '=buildName',\r\n    },\r\n    controller: buildStatsController,\r\n    controllerAs: 'statsCtrl',\r\n    templateUrl: 'ui/builds/build-stats.html'\r\n  };\r\n});\r\n\r\nfunction buildStatsController(statHelper,dvStatcardHelper) {\r\n  var vm = this;\r\n\r\n  vm.exportStatCard = function() {\r\n    var dvCardStatHash = dvStatcardHelper.convertStats(vm.build, vm.buildName, vm.stats.calculatedStats);\r\n    var url = dvStatcardHelper.cardImportUrl + '?dngsimport=' + btoa(JSON.stringify(dvCardStatHash));\r\n    window.open(url);\r\n  }\r\n}","angular.module('dnsim').controller('buildSummaryCtrl',\r\n\r\n['$routeParams','$location','hCodeValues','statHelper','itemCategory',\r\nfunction($routeParams,$location,hCodeValues,statHelper,itemCategory) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  this.stats = statHelper.getBuildStats(this.build);\r\n  this.itemsByCategory = itemCategory.getItemsByCategory(this.build.items);\r\n  \r\n  this.getSaveDate = function(group) {\r\n    if(vm.build.lastUpdate > 0) {\r\n      var lastUpdate = new Date(vm.build.lastUpdate);\r\n      return lastUpdate.toLocaleDateString();\r\n    }\r\n  }\r\n  \r\n  this.getSaveTime = function(group) {\r\n    if(vm.build.lastUpdate > 0) {\r\n      var lastUpdate = new Date(vm.build.lastUpdate);\r\n      return lastUpdate.toLocaleTimeString();\r\n    }\r\n  }\r\n  \r\n  this.getBuildSummary = function(group) {\r\n    var summary = '';\r\n    \r\n    var typeCounts = {};\r\n    var cashItems = 0;\r\n    var titles = 0;\r\n    angular.forEach(vm.itemsByCategory, function(itemsByType, type) {\r\n      if(itemsByType.length > 0) {\r\n        if(summary.length > 0) {\r\n          summary += ', ';\r\n        }\r\n        summary += itemsByType.length + ' ' + type;\r\n      }\r\n    });\r\n    \r\n    return summary;\r\n  }\r\n}])\r\n.directive('dngearsimBuildSummary', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      buildName: '=buildName',\r\n      build: '=build'\r\n    },\r\n    controller: 'buildSummaryCtrl',\r\n    controllerAs: 'buildCtrl',\r\n    templateUrl: 'ui/builds/build-summary.html'\r\n  };\r\n});","angular.module('dnsim').controller('BuildTalismansCtrl',\r\n\r\n['$window','$location','$routeParams','$timeout','saveHelper','statHelper','jobs','hCodeValues','itemColumnsToLoad','character',\r\nfunction($window,$location,$routeParams,$timeout,saveHelper,statHelper,jobs,hCodeValues,itemColumnsToLoad,character) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  $window.document.title = 'dngearsim | TALISMANS';\r\n  $window.scrollTo(0, 0);\r\n  \r\n  this.savedItems = saveHelper.getSavedItems();\r\n  this.groupNames = Object.keys(this.savedItems);\r\n  if(!this.groupNames) {\r\n    this.groupNames = [];\r\n  }\r\n  if(this.groupNames.length > 0) {\r\n    this.groupName = saveHelper.getCurrentBuild();\r\n  }\r\n  else {\r\n    this.groupName = null;\r\n  }\r\n  \r\n  if(!this.groupName || !(this.groupName in this.savedItems)) {\r\n    if(this.groupNames.length > 0) {\r\n      this.groupName = this.groupNames[0];\r\n    }\r\n  }\r\n  \r\n  if(!this.groupName) {\r\n    // console.log('cannot find build');\r\n    return;\r\n  }\r\n  \r\n  this.getGroupCalcStats = function() {\r\n    if(this.groupCalcStats == null) {\r\n      var group = vm.savedItems[vm.groupName];\r\n      if(group) {\r\n        this.groupCalcStats = statHelper.getCalculatedStatsFromItems(group, group.items);\r\n      }\r\n    }\r\n    \r\n    return this.groupCalcStats;\r\n  }\r\n  \r\n  this.getBuild = function() {\r\n    return vm.savedItems[vm.groupName];\r\n  }\r\n  \r\n  this.pickup = function(index) {\r\n    vm.selectedIndex = index;\r\n    \r\n    vm.replaceHPAffectAmount = [];\r\n    vm.replaceMDmgAffectAmount = [];\r\n    vm.replacePDmgAffectAmount = [];\r\n    vm.replaceAvgDmgAffectAmount = [];\r\n  }\r\n  \r\n  function saveGroup() {\r\n    saveHelper.saveBuildSelection(vm.groupName, vm.savedItems);\r\n  }\r\n  \r\n  this.headers = [\r\n    '+100%',\r\n    '+75%',\r\n    '+25%',\r\n    '+0%',\r\n    ];\r\n  \r\n  this.summaryStatIds = [];\r\n  for(var id in hCodeValues.stats) {\r\n    if(hCodeValues.stats[id].summaryDisplay) {\r\n      this.summaryStatIds.push(id);\r\n    }\r\n  }\r\n  \r\n  this.pcIndexes = {};\r\n  this.pcIndexes['100'] = 0;\r\n  this.pcIndexes['75'] = 1;\r\n  this.pcIndexes['25'] = 2;\r\n  this.pcIndexes['0'] = 3;\r\n  \r\n  this.selectedIndex = -1;\r\n  \r\n  this.rows = [];\r\n  \r\n  this.updateRows = function() {\r\n    vm.rows = [];\r\n        \r\n    angular.forEach(vm.savedItems[vm.groupName].items, function(item, index) {\r\n      if(item.typeName == 'talisman') {\r\n        var pcIndex = vm.pcIndexes[item.enchantmentNum];\r\n        if(!pcIndex && pcIndex != 0) {\r\n          pcIndex = 3;\r\n        }\r\n        \r\n        var rowIndex = 0;\r\n        for(;;) {\r\n          if(!vm.rows[rowIndex]) {\r\n            vm.rows[rowIndex] = vm.makeFakeCells();\r\n          }\r\n          \r\n          if(vm.rows[rowIndex][pcIndex].index < 0) {\r\n            if(!item.enchantmentNum) {\r\n              item.enchantmentNum = 0;\r\n            }\r\n            \r\n            var data = vm.makeCell(item, index);\r\n            vm.rows[rowIndex][pcIndex] = data;\r\n            break;\r\n          }\r\n          else {\r\n            rowIndex++;\r\n          }\r\n        }\r\n      }\r\n      \r\n    });\r\n    \r\n    if(vm.rows.length < 3) {\r\n      vm.rows[vm.rows.length+1] = vm.makeFakeCells();\r\n    }\r\n  };\r\n  \r\n  this.makeFakeCells = function(num) {\r\n    return [vm.makeCell({enchantmentNum:100},-1),vm.makeCell({enchantmentNum:75},-2),vm.makeCell({enchantmentNum:25},-3),vm.makeCell({enchantmentNum:0},-4)];\r\n  };\r\n  \r\n  this.makeCell = function(item, index) {\r\n    return { item: item, index: index };\r\n  };\r\n  \r\n  this.click = function(col) {\r\n    if(vm.selectedIndex == -1) {\r\n      if(col.index >= 0) {\r\n        vm.pickup(col.index);\r\n      }\r\n    }\r\n    else {\r\n      vm.move(col);\r\n    }\r\n  };\r\n  \r\n  this.move = function(col) {\r\n    \r\n    var items = vm.savedItems[vm.groupName].items;\r\n    if(col.index >= 0) {\r\n      var swapEnchantmentNumber = col.item.enchantmentNum;\r\n      \r\n      vm.setTalisman(col.item, items[vm.selectedIndex].enchantmentNum);\r\n      vm.setTalisman(items[vm.selectedIndex], swapEnchantmentNumber);\r\n      items[col.index] = items[vm.selectedIndex];\r\n      items[vm.selectedIndex] = col.item;\r\n    }\r\n    else {\r\n      var item = items[vm.selectedIndex];\r\n      vm.setTalisman(item, col.item.enchantmentNum);\r\n      items.splice(vm.selectedIndex, 1);\r\n      items.push(item);\r\n    }\r\n\r\n    vm.groupCalcStats = null;\r\n    vm.selectedIndex = -1;\r\n    vm.updateRows();\r\n    vm.replaceAffectAmount = {};\r\n    $timeout();\r\n  };\r\n  \r\n  this.setTalisman = function(item, newEnhancementNum) {\r\n    var extraStats = [];\r\n    angular.forEach(item.stats, function(stat, index) {\r\n      if(newEnhancementNum) {\r\n        extraStats.push({id: stat.id, max: stat.max * (newEnhancementNum/100)});\r\n      }\r\n    });\r\n    \r\n    item.enchantmentStats = extraStats;\r\n    item.enchantmentNum = newEnhancementNum;\r\n    \r\n    item.fullStats = hCodeValues.mergeStats(item.enchantmentStats, item.stats);\r\n  };\r\n  \r\n    \r\n  this.replaceAffectAmount = {};\r\n  this.getReplaceAffectAmount = function(statId, itemIndex, item) {\r\n    this.initReplaceAffects(itemIndex, item);\r\n    if(this.replaceAffectAmount[itemIndex]) {\r\n      return this.replaceAffectAmount[itemIndex][statId];\r\n    }\r\n  };\r\n  \r\n  this.initReplaceAffects = function(itemIndex, item) {\r\n    if(vm.replaceAffectAmount[itemIndex] || vm.selectedIndex == -1) {\r\n      return;\r\n    }\r\n    this.replaceAffectAmount[itemIndex] = {};\r\n    \r\n    var group = vm.savedItems[vm.groupName];\r\n    var item2 = group.items[vm.selectedIndex];\r\n    \r\n    var extraStats = [];\r\n    var fullStats1 = [];\r\n    if(item.stats) {\r\n      angular.forEach(item.stats, function(stat, index) {\r\n        extraStats.push({id: stat.id, max: stat.max * (item2.enchantmentNum/100)});\r\n      });\r\n      fullStats1 = hCodeValues.mergeStats(extraStats, item.stats);\r\n    }\r\n    \r\n    extraStats = [];\r\n    angular.forEach(item2.stats, function(stat, index) {\r\n      extraStats.push({id: stat.id, max: stat.max * (item.enchantmentNum/100)});\r\n    });\r\n    var fullStats2 = hCodeValues.mergeStats(extraStats, item2.stats);\r\n\r\n    var newItems = [{stats: fullStats1}, {stats: fullStats2}];\r\n    angular.forEach(group.items, function(gItem , index) {\r\n      if(item !== gItem && item2 !== gItem) {\r\n        newItems.push(gItem);\r\n      }\r\n    });\r\n    \r\n    var newStats = statHelper.getCalculatedStatsFromItems(group, newItems);\r\n    var origStats = vm.getGroupCalcStats();\r\n    \r\n    for(var id in hCodeValues.stats) {\r\n      if(hCodeValues.stats[id].summaryDisplay) {\r\n        vm.replaceAffectAmount[itemIndex][id] = calcStatPercent(vm.getStat(id, newStats).max, vm.getStat(id, origStats).max);\r\n      }\r\n    }\r\n  };\r\n  \r\n  this.getStatName = function(id) {\r\n    var retVal = '';\r\n    if(hCodeValues.stats[id].element == 'primary') {\r\n      var eleId = 0;\r\n      if(vm.savedItems[vm.groupName].element) {\r\n        eleId = vm.savedItems[vm.groupName].element.id;\r\n      }\r\n      retVal += hCodeValues.elements[eleId].name;\r\n    }\r\n    else if(hCodeValues.stats[id].element == 'secondary') {\r\n      var eleId = 0;\r\n      if(vm.savedItems[vm.groupName].secondaryElement) {\r\n        eleId = vm.savedItems[vm.groupName].secondaryElement.id;\r\n      }\r\n      retVal += hCodeValues.elements[eleId].name;\r\n    }\r\n    return retVal + ' ' + hCodeValues.stats[id].name;\r\n  };\r\n  \r\n  this.getStat = function(id, stats) {\r\n    var len = stats.length;\r\n    for(var i=0;i<len;++i) {\r\n      if(stats[i].id == id) {\r\n        return stats[i];\r\n      }\r\n    }\r\n    return {id: id, max:0};\r\n  };\r\n  \r\n  function calcStatPercent(newVal, origVal) {\r\n    if(newVal && origVal) {\r\n      return Math.round(10000 * (1 - (origVal / newVal))) / 100;\r\n    }\r\n    else {\r\n      return 0;\r\n    }\r\n  }\r\n  \r\n  this.save = function() {\r\n    saveHelper.updatedSavedItems(vm.groupName, vm.savedItems[vm.groupName].items);\r\n    $location.path('/build');\r\n    $location.search('buildName', vm.groupName);\r\n  };\r\n  \r\n  this.updateRows();\r\n  \r\n}]); ","angular.module('dnsim').directive('dngearsimBuild', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      buildName: '=buildName',\r\n      build: '=build',\r\n      onChange: '&onChange',\r\n      server: '=server'\r\n    },\r\n    controller: bulidController,\r\n    controllerAs: 'buildCtrl',\r\n    templateUrl: 'ui/builds/build.html'\r\n  };\r\n});\r\n\r\nfunction bulidController($timeout, statHelper, itemCategory, saveHelper) {\r\n  'use strict';  \r\n  var vm = this;\r\n  \r\n  vm.stats = statHelper.getBuildStats(vm.build);\r\n  \r\n  var selectedCategory = localStorage.getItem('selectedItemCategory');\r\n  vm.category = itemCategory.byName(selectedCategory);\r\n  if(!vm.category || vm.category.hideInBuild) {\r\n    selectedCategory = 'titles';\r\n    vm.category = itemCategory.byName('titles');\r\n  }\r\n  \r\n  vm.getCategoryItems = function() {\r\n    var itemsByCat = itemCategory.getItemsByCategory(vm.build.items);\r\n    if(vm.category.name in itemsByCat) {\r\n      return itemsByCat[vm.category.name];\r\n    }\r\n    else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  vm.changeCategory = function() {\r\n    vm.xsView = null;\r\n    vm.moveItem = null;\r\n    vm.categoryChanging = true;\r\n    $timeout(function() {\r\n      vm.categoryChanging = false;\r\n    }, 0);\r\n  }\r\n  \r\n  vm.getCategories = function() {\r\n    return itemCategory.categories;\r\n  }\r\n    \r\n  vm.setSelectedCategory = function(value) {\r\n    vm.category = itemCategory.byName(value);\r\n    localStorage.setItem('selectedItemCategory', value);\r\n  }\r\n  \r\n  vm.getSaveDate = function(group) {\r\n    if(vm.build.lastUpdate > 0) {\r\n      var lastUpdate = new Date(vm.build.lastUpdate);\r\n      return lastUpdate.toLocaleDateString();\r\n    }\r\n  }\r\n  \r\n  vm.getSaveTime = function(group) {\r\n    if(vm.build.lastUpdate > 0) {\r\n      var lastUpdate = new Date(vm.build.lastUpdate);\r\n      return lastUpdate.toLocaleTimeString();\r\n    }\r\n  }\r\n  \r\n  vm.allowMoreItems = function() {\r\n    return !vm.category.maxCat || vm.getCategoryItems().length < vm.category.maxCat;\r\n  }\r\n  \r\n  vm.getItemCount = function() {\r\n    var itemCountText = '';\r\n    var allItems = vm.build.items;\r\n    \r\n    if(vm.category.name == 'offensive gems') {\r\n      var numOffensiveSlots = 0;\r\n      var numOffensiveGems = 0;\r\n      angular.forEach(allItems, function(item, index) {\r\n        if(item.typeName == vm.category.name) {\r\n          numOffensiveGems++;\r\n        }\r\n        else if(item.offensiveGemSlots) {\r\n          numOffensiveSlots += item.offensiveGemSlots;\r\n        }\r\n      });\r\n      \r\n      itemCountText = numOffensiveGems + ' / ' + numOffensiveSlots;\r\n    }\r\n    else if(vm.category.name == 'increasing gems') {\r\n      \r\n      var totalIncreasingGems = 0;\r\n      var numIncreasingSlots = 0;\r\n      var numIncreasingGems = {};\r\n      angular.forEach(allItems, function(item, index) {\r\n        if(item.typeName == vm.category.name) {\r\n          var gemType = item.sparkTypeId;\r\n          if(!gemType) {\r\n            gemType = 0;\r\n          }\r\n          \r\n          if(!(gemType in numIncreasingGems)) {\r\n            numIncreasingGems[gemType] = 0;\r\n          }\r\n          numIncreasingGems[gemType]++;\r\n          totalIncreasingGems++;\r\n        }\r\n        else if(item.increasingGemSlots) {\r\n          numIncreasingSlots += item.increasingGemSlots;\r\n        }\r\n      });\r\n      \r\n      itemCountText = ''\r\n      angular.forEach(numIncreasingGems, function(number, gemType) {\r\n        if(itemCountText.length > 0) {\r\n          itemCountText += '+';\r\n        }\r\n        itemCountText += number;\r\n      });\r\n      \r\n      itemCountText = totalIncreasingGems + ' (' + itemCountText + ') / ' + numIncreasingSlots;\r\n    }\r\n    else {\r\n      var numItems = 0;\r\n      angular.forEach(allItems, function(item, index) {\r\n        if(item && item.typeName == vm.category.name) {\r\n          numItems++;\r\n        }\r\n      });\r\n      \r\n      itemCountText = numItems;\r\n      var cat = itemCategory.byName(vm.category.name);\r\n      if(cat && 'numItemText' in cat) {\r\n        itemCountText += ' / ' + cat.numItemText;\r\n      }\r\n    }\r\n    \r\n    return itemCountText;\r\n  }\r\n  \r\n  vm.newCustom = function() {\r\n    var newCustom = {id: 0, typeName:'custom', name: 'new custom item', stats: []};\r\n    vm.build.items = vm.build.items.concat(newCustom);\r\n    saveHelper.updatedSavedItems(vm.buildName, vm.build.items);\r\n    vm.handleChange();\r\n  }\r\n  \r\n  vm.handleChange = function() {\r\n    vm.stats = statHelper.getBuildStats(vm.build);\r\n    vm.onChange();\r\n  }\r\n}","angular.module('dnsim').controller('DeleteBuildCtrl',\r\n\r\n['$location','$routeParams','$timeout','saveHelper','dntData','jobs','hCodeValues','itemColumnsToLoad',\r\nfunction($location,$routeParams,$timeout,saveHelper,dntData,jobs,hCodeValues,itemColumnsToLoad) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  this.newGroup = true;\r\n  if('name' in $routeParams) {\r\n      this.name = $routeParams.name;\r\n  }\r\n  \r\n  this.delete = function() {\r\n    saveHelper.deleteBuild(this.name);\r\n    $location.path('/builds/');\r\n  }\r\n    \r\n}]); ","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').controller('EditBuildCtrl', editBuildCtrl);\r\n\r\nfunction editBuildCtrl($window,$location,$routeParams,$timeout,saveHelper,dntData,jobs,hCodeValues,itemColumnsToLoad,character,region) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  vm.savedItems = saveHelper.getSavedItems();\r\n  vm.group = {};\r\n  vm.newGroup = true;\r\n  if('buildName' in $routeParams) {\r\n      vm.groupName = $routeParams.buildName;\r\n      if(vm.groupName in vm.savedItems) {\r\n        vm.group = vm.savedItems[vm.groupName];\r\n        vm.newGroup = false;\r\n      }\r\n  }\r\n  else {\r\n    vm.groupName = '';\r\n  }\r\n  vm.oldGroupName = vm.groupName;\r\n  vm.heroStats = [];\r\n  vm.elements = hCodeValues.elements;\r\n  vm.damageTypes = hCodeValues.damageTypes;\r\n  \r\n  vm.initDamageType = function() {\r\n    if(vm.job) {\r\n      if(vm.group.damageType) {\r\n        vm.damageType = vm.group.damageType;\r\n      }\r\n      else if(vm.newGroup && 'DamageType' in vm.job.d) {\r\n        if(vm.job.d.DamageType) {\r\n          vm.damageType = hCodeValues.damageTypes[2];\r\n        }\r\n        else {\r\n          vm.damageType = hCodeValues.damageTypes[1];\r\n        }\r\n      }\r\n      else {\r\n        vm.damageType = hCodeValues.damageTypes[0];\r\n      }\r\n    }\r\n  }\r\n\r\n  vm.initDefaultElement = function() {\r\n    var defaultElement = hCodeValues.elements[0];\r\n    var defaultSecondaryElement = hCodeValues.elements[0];\r\n\r\n    if(vm.job && vm.job.d) {\r\n      var jobName = vm.job.d.EnglishName;\r\n      if(jobName == 'CRUSADES' || jobName == 'INQUISITOR' || jobName == 'GUARDIAN' || jobName == 'SAINT' || jobName == 'SILVERHUNTER' || jobName == 'STINGBREEZER') {\r\n        defaultElement = hCodeValues.elements[3];\r\n        defaultSecondaryElement = hCodeValues.elements[3];\r\n      }\r\n      else if(jobName == 'RAVEN' || jobName == 'MAJESTY' || jobName == 'SOULEATER' || jobName == 'DARKSUMMONER' || jobName == 'ABYSSWALKER' || jobName == 'BLACKMARA' || jobName == 'PHYSICIAN') {\r\n        defaultElement = hCodeValues.elements[4];\r\n        defaultSecondaryElement = hCodeValues.elements[4];\r\n      }\r\n      else if(jobName == 'SALEANA' || jobName == 'RIPPER' || jobName == 'DARKAVENGER') {\r\n        defaultElement = hCodeValues.elements[1];\r\n        defaultSecondaryElement = hCodeValues.elements[1];\r\n      }\r\n      else if(jobName == 'ELESTRA') {\r\n        defaultElement = hCodeValues.elements[2];\r\n        defaultSecondaryElement = hCodeValues.elements[2];\r\n      }\r\n      else if(jobName == 'ADEPT') {\r\n        defaultElement = hCodeValues.elements[1];\r\n        defaultSecondaryElement = hCodeValues.elements[2];\r\n      }\r\n      else if(jobName == 'LIGHTFURY') {\r\n        defaultElement = hCodeValues.elements[3];\r\n        defaultSecondaryElement = hCodeValues.elements[4];\r\n      }\r\n    }\r\n\r\n    if(vm.newGroup) {\r\n      vm.element = defaultElement;\r\n      vm.secondaryElement = defaultSecondaryElement;\r\n    }\r\n    \r\n    if(!vm.element) {\r\n      vm.element = defaultElement;\r\n    }\r\n\r\n    if(!vm.secondaryElement) {\r\n      vm.secondaryElement = defaultElement;\r\n    }\r\n  }\r\n    \r\n  if(vm.group.element) {\r\n    vm.element = vm.group.element;\r\n  }\r\n  else {\r\n    vm.element = hCodeValues.elements[0];\r\n  }\r\n    \r\n  if(vm.group.secondaryElement) {\r\n    vm.secondaryElement = vm.group.secondaryElement;\r\n  }\r\n  else {\r\n    vm.secondaryElement = hCodeValues.elements[0];\r\n  }\r\n\r\n  if(!('critResist' in vm.group)) {\r\n    vm.critResist = 20;\r\n  }\r\n  else {\r\n    vm.critResist = vm.group.critResist;\r\n  }\r\n\r\n  if(!('eleResist' in vm.group)) {\r\n    vm.eleResist = 0;\r\n  }\r\n  else {\r\n    vm.eleResist = vm.group.eleResist;\r\n  }\r\n\r\n  if(vm.group.enemyLevel) {\r\n    vm.enemyLevel = vm.group.enemyLevel;\r\n  }\r\n  else {\r\n    vm.enemyLevel = 93;\r\n  }\r\n  \r\n  if(vm.group.playerLevel) {\r\n    vm.playerLevel = vm.group.playerLevel;\r\n  }\r\n  else {\r\n    vm.playerLevel = 93;\r\n  }\r\n  \r\n  if(vm.group.heroLevel && vm.group.heroLevel > 0) {\r\n    vm.heroLevel = vm.group.heroLevel;\r\n  }\r\n  else {\r\n    vm.heroLevel = 1;\r\n  }\r\n  \r\n  vm.init = function() {\r\n    var newJobs = jobs.getFinalJobs();\r\n    if(newJobs.length > 0) {\r\n      $timeout( function() {\r\n        \r\n        if('job' in vm.group) {\r\n          angular.forEach(newJobs, function(value, key) {\r\n            if(value.id == vm.group.job.id) {\r\n              vm.job = value;\r\n            }\r\n          });\r\n        }\r\n\r\n        vm.initDamageType();\r\n        vm.initDefaultElement();\r\n        vm.setHeroStats();\r\n      });\r\n    }\r\n  }\r\n  \r\n  vm.setJob = function() {\r\n    $window.scrollTo(0, 0);\r\n    $timeout(function() {\r\n      vm.initDamageType();\r\n      vm.initDefaultElement();\r\n    });\r\n  }\r\n  \r\n  region.init();\r\n  character.init(function() {\r\n    vm.init();\r\n  });\r\n  \r\n  vm.getStatCap = function(colName, useLevel) {\r\n    return character.getStatCaps(useLevel)[colName];\r\n  }\r\n  vm.getJobConversion = function(colName) {\r\n    return character.getConversions(vm.job.id)[colName];\r\n  }\r\n  vm.getJobBaseStat = function(colName) {\r\n    return character.getBaseStats(vm.playerLevel, vm.job.id)[colName];\r\n  }\r\n  \r\n  vm.invalidGroupName = function() {\r\n    if(!vm.groupName) {\r\n      return true;\r\n    }\r\n    \r\n    if(vm.groupName in vm.savedItems) {\r\n      if(vm.newGroup || vm.groupName != vm.oldGroupName) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  }\r\n  \r\n  vm.ok = function() {\r\n    var enemyStatCaps = character.getStatCaps(vm.enemyLevel);\r\n    var playerStatCaps = character.getStatCaps(vm.playerLevel);\r\n    var conversions = character.getConversions(vm.job.id);\r\n    var baseStats = character.getBaseStats(vm.playerLevel, vm.job.id);\r\n    var heroStats = character.getHeroStats(vm.heroLevel);\r\n    \r\n    if(vm.newGroup) {\r\n      vm.oldGroupName = vm.groupName;\r\n      saveHelper.importGroup(vm.groupName, []);\r\n    }\r\n    \r\n    saveHelper.saveBuild(\r\n      vm.oldGroupName, \r\n      vm.groupName,\r\n      {\r\n      enemyLevel: vm.enemyLevel,\r\n      playerLevel: vm.playerLevel,\r\n      heroLevel: vm.heroLevel,\r\n      job: vm.job,\r\n      damageType: vm.damageType,\r\n      element: vm.element,\r\n      secondaryElement: vm.secondaryElement,\r\n      critResist: vm.critResist,\r\n      eleResist: vm.eleResist,\r\n      enemyStatCaps: enemyStatCaps, \r\n      playerStatCaps: playerStatCaps, \r\n      conversions: conversions,\r\n      baseStats: baseStats,\r\n      heroStats: heroStats\r\n      });\r\n    \r\n    $location.path('/build');\r\n    $location.search('buildName', vm.groupName);\r\n  }\r\n  \r\n  vm.setHeroStats = function() {\r\n    vm.heroStats = character.getHeroStats(vm.heroLevel);\r\n    // console.log('got ' + vm.heroStats.length + ' hero stats');\r\n  }\r\n  \r\n  $timeout(function() {\r\n    var input = document.getElementById('groupNameInput');\r\n    if(input) {\r\n      input.focus();\r\n      input.setSelectionRange(0, 9999);\r\n    }\r\n  });\r\n}\r\n\r\n})();","angular.module('dnsim').controller('quickAddCtrl',\r\n\r\n['$timeout','statHelper','saveHelper','quickAdd','itemCategory','jobs','dntData','exportLinkHelper',\r\nfunction($timeout,statHelper,saveHelper,quickAdd,itemCategory,jobs,dntData,exportLinkHelper) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  vm.startedForCat = '';\r\n  vm.stepNumber = 0;\r\n  vm.datas = [];\r\n  vm.options = [];\r\n  \r\n  this.setOptions = function() {\r\n    if(vm.hasStarted()) {\r\n      vm.options = quickAdd.getOptions(vm.category, vm.build, vm.datas);\r\n      if(vm.options.length == 1) {\r\n        vm.selectOption(vm.options[0]);\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.selectOption = function(value) {\r\n    var data = quickAdd.createData(value, vm.category, vm.stepNumber)\r\n    vm.datas.push(data);\r\n    vm.stepNumber++;\r\n    if(!quickAdd.isValidStepNumber(vm.category, vm.stepNumber)) {\r\n      \r\n      var newItem = quickAdd.getItem(vm.datas);\r\n      var dntFiles = exportLinkHelper.getDntFiles(newItem);\r\n      angular.forEach(dntFiles, function(columns, fileName) {\r\n        dntData.init(fileName, columns, function() {}, function() { vm.tryToAddItem(dntFiles, newItem) });\r\n      });\r\n      vm.tryToAddItem(dntFiles, newItem);\r\n    }\r\n    else {\r\n      vm.setOptions();\r\n      // console.log('setup next step');\r\n    }\r\n  }\r\n  \r\n  this.tryToAddItem = function(dntFiles, item) {\r\n    if(!dntData.anyLoading()) {\r\n      \r\n      var allLoaded = true;\r\n      angular.forEach(dntFiles, function(columns, fileName) {\r\n        if(!dntData.isLoaded(fileName)) {\r\n          allLoaded = false;\r\n        }\r\n      });\r\n      \r\n      if(allLoaded) {\r\n        if(vm.datas.length > 0) {\r\n          vm.cancel();\r\n          var newItem = exportLinkHelper.reloadItem(item);\r\n          newItem.gemSlot = vm.gemSlot;\r\n          saveHelper.saveItem(vm.buildName, newItem);\r\n          vm.build.items.push(newItem);\r\n          vm.onChange();\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.reset = function() {\r\n    vm.stepNumber = 0;\r\n    vm.datas = [];\r\n    $timeout(function() {\r\n      vm.setOptions();\r\n    });\r\n  }\r\n  \r\n  this.hasStarted = function() {\r\n    return vm.startedForCat == vm.category.name;\r\n  }\r\n  \r\n  this.start = function() {\r\n    vm.startedForCat = vm.category.name;\r\n    \r\n    jobs.init(function() {}, vm.reset);\r\n    itemCategory.init(vm.category.name, vm.reset);\r\n  }\r\n  \r\n  this.hasOptions = function() {\r\n    return quickAdd.hasOptions(vm.category, vm.build, []);\r\n  }\r\n  \r\n  this.cancel = function() {\r\n    vm.startedForCat = '';\r\n    vm.reset();\r\n  }\r\n  \r\n  this.back = function() {\r\n    if(vm.stepNumber == 0) {\r\n      vm.cancel();\r\n    }\r\n    else {\r\n      do {\r\n        vm.stepNumber--;\r\n        vm.datas.pop();\r\n        \r\n        var testOptions = quickAdd.getOptions(vm.category, vm.build, vm.datas);\r\n      } while(testOptions.length <= 1 && vm.stepNumber > 0);\r\n      \r\n      vm.setOptions();\r\n    }\r\n  }\r\n  dntData.init('exchange.lzjson', null, function() {}, vm.reset);\r\n  \r\n}])\r\n.directive('dngearsimQuickAdd', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      category: '=category',\r\n      build: '=build',\r\n      buildName: '=buildName',\r\n      gemSlot: '=gemSlot',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'quickAddCtrl',\r\n    controllerAs: 'quickAdd',\r\n    templateUrl: 'ui/builds/quick-add.html'\r\n  };\r\n});","angular.module('dnsim').controller('ReloadBuildCtrl',\r\n['$location','$routeParams','$timeout','saveHelper','dntData','dntReset','groupHelper','translations',reloadBuildCtrl]);\r\n\r\nfunction reloadBuildCtrl($location,$routeParams,$timeout,saveHelper,dntData,dntReset,groupHelper,translations) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  if('name' in $routeParams) {\r\n      vm.name = $routeParams.name;\r\n  }\r\n  \r\n  var savedItems = saveHelper.getSavedItems();\r\n  if(vm.name in savedItems) {\r\n    vm.build = savedItems[vm.name];\r\n  }\r\n  \r\n  vm.reloaded = false;\r\n  vm.reload = function() {\r\n    dntReset();\r\n    vm.reloaded = false;\r\n    \r\n    translations.init(progress, tryInit);\r\n\r\n    var files = groupHelper.getDntFiles(vm.build);\r\n    angular.forEach(files, function(columns, fileName) {\r\n      dntData.init(fileName, columns, progress, tryInit);\r\n    });\r\n  }\r\n  \r\n  vm.goToBuild = function() {\r\n    $location.path('/build');\r\n    $location.search('buildName', vm.name);\r\n  }\r\n  \r\n  function progress() {\r\n  }\r\n\r\n  function tryInit() {\r\n    if(vm.reloaded) {\r\n      return;\r\n    }\r\n    \r\n    var allLoaded = true;\r\n    var files = groupHelper.getDntFiles(vm.build);\r\n    angular.forEach(files, function(columns, fileName) {\r\n      if(!dntData.isLoaded(fileName)) {\r\n        allLoaded = false;\r\n        return;\r\n      }\r\n    });\r\n    \r\n    if(allLoaded && translations.isLoaded()) {\r\n      var newItems = groupHelper.reloadGroup(vm.name, vm.build);\r\n      saveHelper.updatedSavedItems(vm.name, newItems);\r\n      vm.build.items = newItems;\r\n      \r\n      vm.reloaded = true;\r\n    }\r\n  }\r\n    \r\n}","angular.module('dnsim').controller('ViewGroupCtrl', \r\n  ['$scope','$window','region','$location','$routeParams','saveHelper','dntData','$timeout','translations','dntReset','exportLinkHelper','groupHelper','jobs','character','statHelper','hCodeValues',\r\n  function($scope,$window,region,$location,$routeParams,saveHelper,dntData,$timeout,translations,dntReset,exportLinkHelper,groupHelper,jobs,character,statHelper,hCodeValues) {\r\n    'use strict';\r\n  \r\n    document.body.className = 'saved-back';\r\n    \r\n    region.setLocationByName($routeParams.region);\r\n    \r\n    $scope.buildName = '';\r\n    $scope.build = {};\r\n    \r\n\r\n    if('g' in $routeParams && 'i' in $routeParams) {\r\n      $scope.buildName = $routeParams.g;\r\n      $window.document.title = 'dngearsim | ' + $routeParams.g;\r\n      \r\n      $scope.enemyLevel = $routeParams.e;\r\n      $scope.playerLevel = $routeParams.p;\r\n      $scope.heroLevel = $routeParams.h;\r\n      $scope.job = { id: $routeParams.j };\r\n      $scope.damageType = hCodeValues.damageTypes[$routeParams.d];\r\n      $scope.element = hCodeValues.elements[$routeParams.t];\r\n      $scope.secondaryElement = hCodeValues.elements[$routeParams.s];\r\n        \r\n      var items = [];\r\n      \r\n      var itemString = $routeParams.i;\r\n      \r\n      angular.forEach(itemString.split(','), function(itemStr, index) {\r\n        var item = exportLinkHelper.decodeItem(itemStr);\r\n        \r\n        if(item.id > 0) {\r\n          items.push(item);\r\n        }\r\n      });\r\n\r\n      $scope.build = {};\r\n      $scope.savedItems = {};\r\n      $scope.savedItems[$scope.buildName] = $scope.build;\r\n      $scope.build.items = items;\r\n      $scope.isLoading = true;\r\n      \r\n      angular.forEach(groupHelper.getDntFiles($scope.build), function(columns, fileName) {\r\n        dntData.init(fileName, columns, progress, tryInit);\r\n      });\r\n      \r\n      translations.init(progress, tryInit);\r\n      jobs.init(progress, tryInit);\r\n      character.init(tryInit);\r\n      \r\n      $timeout();\r\n    }\r\n    \r\n    $scope.anyItems = Object.keys($scope.savedItems).length > 0;\r\n    \r\n    function tryInit() {\r\n      \r\n      var allInit = true;\r\n      angular.forEach(groupHelper.getDntFiles($scope.build), function(columns, fileName) {\r\n        if(!dntData.isLoaded(fileName)) {\r\n          allInit = false;\r\n        }\r\n      });\r\n      \r\n      if(!allInit || dntData.anyLoading() || !translations.isLoaded() || !jobs.isLoaded()) {\r\n        return;\r\n      }\r\n      \r\n      $timeout(function() {\r\n        var groupName = $scope.buildName;\r\n        var group = $scope.build;\r\n        \r\n        $scope.job = jobs.getById($scope.job.id);\r\n        \r\n        $scope.enemyStatCaps = character.getStatCaps($scope.enemyLevel);\r\n        $scope.playerStatCaps = character.getStatCaps($scope.playerLevel);\r\n        if($scope.job) {\r\n          $scope.conversions = character.getConversions($scope.job.id);\r\n          $scope.baseStats = character.getBaseStats($scope.playerLevel, $scope.job.id);\r\n        }\r\n        $scope.heroStats = character.getHeroStats($scope.heroLevel);\r\n        \r\n        var newItems = groupHelper.reloadGroup(groupName, group);\r\n      \r\n        $scope.savedItems = {};\r\n        $scope.build = {\r\n          items: newItems,\r\n          lastUpdate: group.lastUpdate,\r\n\r\n          enemyLevel: $scope.enemyLevel,\r\n          playerLevel: $scope.playerLevel,\r\n          heroLevel: $scope.heroLevel,\r\n          job: $scope.job,\r\n          damageType: $scope.damageType,\r\n          element: $scope.element,\r\n          secondaryElement: $scope.secondaryElement,\r\n          enemyStatCaps: $scope.enemyStatCaps,\r\n          playerStatCaps: $scope.playerStatCaps,\r\n          conversions: $scope.conversions,\r\n          baseStats: $scope.baseStats,\r\n          heroStats: $scope.heroStats,\r\n        };\r\n        $scope.savedItems[groupName] = $scope.build;\r\n        $scope.stats = statHelper.getBuildStats($scope.build);\r\n        \r\n        var longUrl = exportLinkHelper.createGroupLink($scope.buildName, $scope.build);\r\n        $scope.build.shortUrl = sessionStorage.getItem(longUrl);\r\n      });\r\n    }\r\n    \r\n    function progress() {\r\n    }\r\n    \r\n    $scope.copyGroup = function() {\r\n      var newBuildName = saveHelper.importGroup($scope.buildName, $scope.build.items);\r\n      // console.log('copying in as ' + newBuildName);\r\n      \r\n      saveHelper.saveBuild(\r\n        newBuildName, \r\n        newBuildName,\r\n        {\r\n          enemyLevel: $scope.enemyLevel,\r\n          playerLevel: $scope.playerLevel,\r\n          heroLevel: $scope.heroLevel,\r\n          job: $scope.job,\r\n          damageType: $scope.damageType,\r\n          element: $scope.element,\r\n          secondaryElement: $scope.secondaryElement,\r\n          critResist: $scope.critResist,\r\n          eleResist: $scope.eleResist,\r\n          enemyStatCaps: $scope.enemyStatCaps,\r\n          playerStatCaps: $scope.playerStatCaps,\r\n          conversions: $scope.conversions,\r\n          baseStats: $scope.baseStats,\r\n          heroStats: $scope.heroStats\r\n        });\r\n      \r\n      $location.url('/build?buildName=' + newBuildName);\r\n    }\r\n  }]\r\n);\r\n","(function () {\r\n'use strict';\r\nangular.module('dnsim').filter('escape', [function() {\r\n  'use strict';\r\n\r\n  function escapeFilter(input) {\r\n      if(input) {\r\n          return window.encodeURIComponent(input);\r\n      }\r\n      return '';\r\n  }\r\n\r\n  return escapeFilter;\r\n}]);\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim').filter('percentage', [function() {\r\n  'use strict';\r\n\r\n  function percentageFilter(input) {\r\n    if(typeof input == 'number') {\r\n      return (Math.round(input * 100 * 100) / 100) + '%';\r\n    }\r\n    else {\r\n      return input;\r\n    }\r\n  }\r\n  percentageFilter.$stateful = false;\r\n\r\n  return percentageFilter;\r\n}]);\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim')\r\n.controller('AboutCtrl', \r\n  ['$window',\r\n  function($window) {\r\n    'use strict';\r\n    document.body.className = 'default-back';\r\n    $window.document.title = 'dngearsim | ABOUT/FAQ';\r\n  }]\r\n);\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dngearsimGroupAssignment', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      compact: '=compact',\r\n      onChange: '&onChange'\r\n    },\r\n    controller: groupAssignment,\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/group-assignment.html'\r\n  };\r\n});\r\n\r\nfunction groupAssignment(hCodeValues,statHelper,saveHelper,itemCategory,$scope,exportLinkHelper,dntData) {\r\n  \r\n  var vm = this;\r\n  \r\n  this.savedItems = saveHelper.getSavedItems();\r\n  this.groupNames = Object.keys(this.savedItems);\r\n  if(!this.groupName) {\r\n    this.groupName = saveHelper.getCurrentBuild();\r\n  }\r\n\r\n  if(!(this.groupName in this.savedItems)) {\r\n    this.groupName = null;\r\n  }\r\n\r\n  if(!this.groupName && this.savedItems) {\r\n    for(var savedGroup in this.savedItems) {\r\n      this.groupName = savedGroup;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if(!this.groupName) {\r\n    return;\r\n  }\r\n  \r\n  this.summaryStatIds = [];\r\n  for(var id in hCodeValues.stats) {\r\n    if(hCodeValues.stats[id].summaryDisplay) {\r\n      this.summaryStatIds.push(id);\r\n    }\r\n  }\r\n    \r\n  this.clearGroup = function() {\r\n    vm.addAffectAmount = null;\r\n    vm.replaceAffectAmount = {};\r\n\r\n    vm.groupItems = null;\r\n    vm.groupCalcStats = null;\r\n  }\r\n\r\n  vm.tryToSetItem = function(dntFiles) {\r\n    if(!dntData.anyLoading()) {\r\n      \r\n      var allLoaded = true;\r\n      angular.forEach(dntFiles, function(columns, fileName) {\r\n        if(!dntData.isLoaded(fileName)) {\r\n          allLoaded = false;\r\n        }\r\n      });\r\n      \r\n      if(allLoaded) {\r\n        vm.item = exportLinkHelper.reloadItem(vm.item);\r\n      }\r\n    }\r\n  }\r\n\r\n  var dntFiles = exportLinkHelper.getDntFiles(vm.item);\r\n  angular.forEach(dntFiles, function(columns, fileName) {\r\n    dntData.init(fileName, columns, function() {}, function() {\r\n      vm.tryToSetItem(dntFiles);\r\n    });\r\n  });\r\n  vm.tryToSetItem(dntFiles);\r\n\r\n  $scope.$watch('editCtrl.item', function() {\r\n    vm.clearGroup();\r\n  });\r\n  \r\n  this.getAddAffectAmount = function(stat) {\r\n    this.initAddAffects();\r\n    // console.log('add affect: ', this.addAffectAmount[stat], this.item);\r\n    return this.addAffectAmount[stat];\r\n  };\r\n  \r\n  this.getReplaceAffectAmount = function(statId, itemIndex, item) {\r\n    this.initReplaceAffects(itemIndex, item);\r\n    return this.replaceAffectAmount[itemIndex][statId];\r\n  };\r\n  \r\n  this.getGroupCalcStats = function() {\r\n    \r\n    if(this.groupCalcStats == null) {\r\n      \r\n      var group = vm.savedItems[vm.groupName];\r\n      if(group) {\r\n        this.groupCalcStats = statHelper.getCalculatedStatsFromItems(group, group.items);\r\n      }\r\n    }\r\n    \r\n    return this.groupCalcStats;\r\n  };\r\n  \r\n  this.getBuild = function() {\r\n    return vm.savedItems[vm.groupName];\r\n  };\r\n  \r\n  this.initAddAffects = function() {\r\n    \r\n    if(vm.addAffectAmount) {\r\n      return;\r\n    }\r\n    \r\n    // console.log('initialising add affects ');\r\n    \r\n    var origStats = vm.getGroupCalcStats();\r\n    var group = vm.savedItems[vm.groupName];\r\n    var newItems = [];\r\n    if(group.items) {\r\n      newItems = group.items.concat([vm.item]);\r\n    }\r\n    var newStats = statHelper.getCalculatedStatsFromItems(group, newItems);\r\n    \r\n    this.addAffectAmount = {};\r\n    for(var id in hCodeValues.stats) {\r\n      if(hCodeValues.stats[id].summaryDisplay) {\r\n        vm.addAffectAmount[id] = calcStatPercent(vm.getStat(id, newStats).max, vm.getStat(id, origStats).max);\r\n      }\r\n    }\r\n  };\r\n  \r\n  this.initReplaceAffects = function(itemIndex, item) {\r\n    if(vm.replaceAffectAmount[itemIndex]) {\r\n      return;\r\n    }\r\n    \r\n    var group = vm.savedItems[vm.groupName];\r\n    var newItems = [vm.item];\r\n    angular.forEach(group.items, function(gItem , index) {\r\n      if(item !== gItem) {\r\n        newItems.push(gItem);\r\n      }\r\n    });\r\n    \r\n    var newStats = statHelper.getCalculatedStatsFromItems(group, newItems);\r\n    var origStats = vm.getGroupCalcStats();\r\n    \r\n    this.replaceAffectAmount[itemIndex] = {};\r\n    for(var id in hCodeValues.stats) {\r\n      if(hCodeValues.stats[id].summaryDisplay) {\r\n        vm.replaceAffectAmount[itemIndex][id] = calcStatPercent(vm.getStat(id, newStats).max, vm.getStat(id, origStats).max);\r\n      }\r\n    }\r\n  };\r\n  \r\n  function calcStatPercent(newVal, origVal) {\r\n    if(newVal && origVal) {\r\n      // console.log('orig: ' + origVal + ',new: ' + newVal);\r\n      return Math.round(10000 * (1 - (origVal / newVal))) / 100;\r\n    }\r\n    else {\r\n      return 0;\r\n    }\r\n  }\r\n  \r\n  this.getStat = function(id, stats) {\r\n    var len = stats.length;\r\n    for(var i=0;i<len;++i) {\r\n      if(stats[i].id == id) {\r\n        return stats[i];\r\n      }\r\n    }\r\n    return {id: id, max:0};\r\n  };\r\n  \r\n  this.getStatName = function(id) {\r\n    var retVal = '';\r\n    if(hCodeValues.stats[id].element == 'primary') {\r\n      var eleId = 0;\r\n      if(vm.savedItems[vm.groupName].element) {\r\n        eleId = vm.savedItems[vm.groupName].element.id;\r\n      }\r\n      retVal += hCodeValues.elements[eleId].name;\r\n    }\r\n    else if(hCodeValues.stats[id].element == 'secondary') {\r\n      var eleId = 0;\r\n      if(vm.savedItems[vm.groupName].secondaryElement) {\r\n        eleId = vm.savedItems[vm.groupName].secondaryElement.id;\r\n      }\r\n      retVal += hCodeValues.elements[eleId].name;\r\n    }\r\n    return retVal + ' ' + hCodeValues.stats[id].name;\r\n  };\r\n  \r\n  this.getGroupItems = function() {\r\n\r\n    var itemSplit;\r\n    function numMatches(str) {\r\n      if(str) {\r\n        var matches = 0;\r\n        for(var i=0;i<itemSplit.length;++i) {\r\n          if(str.indexOf(itemSplit[i]) > 0) {\r\n            matches++;\r\n          }\r\n        }\r\n        return matches;\r\n      }\r\n      else {\r\n        return -1;\r\n      }\r\n    }\r\n    \r\n    if(vm.groupItems == null && vm.groupName && vm.groupName in vm.savedItems && vm.item && vm.item.typeName) {\r\n      vm.groupItems = [];\r\n\r\n      var existing;\r\n      if(vm.item.itemSource == 'plate' || vm.item.itemSource == 'tman') {\r\n        existing = _.find(vm.savedItems[vm.groupName].items, function(item) {\r\n          return item.sparkTypeId == vm.item.sparkTypeId && vm.item.itemSource == item.itemSource;\r\n        });\r\n      }\r\n\r\n      var items = [];\r\n      if(existing) {\r\n        items.push(existing);\r\n      }\r\n      else {\r\n        _.each(vm.savedItems[vm.groupName].items, function(item) {\r\n          if(item.exchangeType && item.itemSource != 'gem' && item.itemSource != 'plate' && item.itemSource != 'tman') {\r\n            if(item.exchangeType == vm.item.exchangeType) {\r\n              items.push(item);\r\n            }\r\n          }\r\n          else if(item.typeName == vm.item.typeName) {\r\n            items.push(item);\r\n          }\r\n        });\r\n        \r\n        if(vm.item.name) {\r\n          itemSplit = vm.item.name.split(' ');\r\n        }\r\n        items.sort(function(a,b) {\r\n          return numMatches(b.name)-numMatches(a.name);\r\n        });\r\n      }\r\n      \r\n      angular.forEach(items, function(item, index) {\r\n        if(item.name == vm.item.name) {\r\n          vm.groupItems.push(item);\r\n        }\r\n      });\r\n      \r\n      angular.forEach(items, function(item, index) {\r\n        if(item.name != vm.item.name) {\r\n          vm.groupItems.push(item);\r\n        }\r\n      });\r\n    }\r\n    return vm.groupItems;\r\n  };\r\n  \r\n  this.hasMaxExchangable = function() {\r\n    var cat = itemCategory.byName(this.item.typeName);\r\n    var items = this.getGroupItems();\r\n\r\n    if(vm.item.itemSource == 'plate' || vm.item.itemSource == 'tman') {\r\n      if(_.find(items, function(item) {\r\n        return item.sparkTypeId == vm.item.sparkTypeId;\r\n      })) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    if(cat && cat.maxCat) {\r\n      if(items.length >= cat.maxCat) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    if(cat && cat.maxExchange) {\r\n      if(items.length >= cat.maxExchange) {\r\n        for(var i=0;i<items.length;++i) {\r\n          if(!items[i].exchangeType) {\r\n            return false;\r\n          }\r\n        }\r\n        // console.log('maxexchange reached ' + items.length + '>=' + cat.maxExchange + ' for ' + cat.name);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n  \r\n  this.nextGroup = function() {\r\n    \r\n    var uptoItem = false;\r\n    var nextGroup = null;\r\n    angular.forEach(vm.groupNames, function(groupName, index) {\r\n      if(uptoItem) {\r\n        if(nextGroup == null) {\r\n          nextGroup = groupName;\r\n        }\r\n      }\r\n      if(groupName == vm.groupName) {\r\n        uptoItem = true;\r\n      }\r\n    });\r\n    \r\n    if(nextGroup == null) {\r\n      nextGroup = vm.groupNames[0];\r\n    }\r\n    \r\n    vm.groupName = nextGroup;\r\n    saveGroup();\r\n    vm.clearGroup();\r\n  };\r\n  \r\n  this.prevGroup = function() {\r\n    \r\n    var foundGroup = false;\r\n    var prevGroup = null;\r\n    angular.forEach(vm.groupNames, function(groupName, index) {\r\n      if(groupName == vm.groupName) {\r\n        foundGroup = true;\r\n      }\r\n      \r\n      if(!foundGroup) {\r\n        prevGroup = groupName;\r\n      }\r\n    });\r\n    \r\n    if(prevGroup == null) {\r\n      prevGroup = vm.groupNames[vm.groupNames.length-1];\r\n    }\r\n    \r\n    vm.groupName = prevGroup;\r\n    saveGroup();\r\n    vm.clearGroup();\r\n  };\r\n  \r\n  this.addToGroup = function() {\r\n    saveHelper.saveItem(vm.groupName, vm.item);\r\n    this.savedItems = saveHelper.getSavedItems();\r\n    vm.clearGroup();\r\n    vm.onChange();\r\n  };\r\n  \r\n  this.replace = function(item) {\r\n    item.replaceItem = true;\r\n    var newItemList = [];\r\n    angular.forEach(vm.savedItems[vm.groupName].items, function(gItem, index) {\r\n      if(gItem.replaceItem) {\r\n        // console.log('found replace item');\r\n        newItemList.push(vm.item);\r\n      }\r\n      else {\r\n        newItemList.push(gItem);\r\n      }\r\n    });\r\n    \r\n    saveHelper.updatedSavedItems(vm.groupName, newItemList);\r\n    this.savedItems = saveHelper.getSavedItems();\r\n    vm.clearGroup();\r\n    vm.onChange();\r\n  };\r\n  \r\n  function saveGroup() {\r\n    saveHelper.saveBuildSelection(vm.groupName, vm.savedItems);\r\n  }\r\n  \r\n};\r\n\r\n})();","angular.module('dnsim').controller('itemEditCustomCtrl',\r\n\r\n['hCodeValues','$scope',\r\nfunction(hCodeValues,$scope) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  if(this.item.itemSource != 'custom' && this.item.typeName != 'custom') {\r\n    return;\r\n  }\r\n  \r\n  var vm = this;\r\n\r\n  this.statMap = {};\r\n  \r\n  // console.log(vm.item.stats);\r\n  _.forEach(vm.item.stats, function(stat) {\r\n    // console.log('got stat', stat.id);\r\n    vm.statMap[stat.id] = stat.max;\r\n  });\r\n  \r\n  for(var statId in hCodeValues.stats) {\r\n    $scope.$watch('editCtrl.statMap[' + statId + ']', function(newValue, oldValue) { \r\n\r\n      if(newValue != oldValue) {\r\n        // console.log(statId);\r\n        // console.log('watch got stat value', newValue);\r\n\r\n        var anyChange = false;\r\n        var newStats = [];\r\n        for(var statId in vm.statMap) {\r\n\r\n          if(!vm.statMap[statId] || !Number(vm.statMap[statId])) {\r\n            _.each(vm.item.stats, function(stat) { \r\n              if(stat.id == statId) {\r\n                anyChange = true;\r\n              }\r\n            });\r\n          }\r\n          else {\r\n            newStats.push({\r\n              id: Number(statId),\r\n              max: Number(vm.statMap[statId])\r\n            });\r\n\r\n            var found = false;\r\n            _.each(vm.item.stats, function(stat) {\r\n              if(stat.id == statId) {\r\n                found = true;\r\n                // console.log('comparing', stat.max, vm.statMap[statId]);\r\n                if(!(statId in vm.statMap) || stat.max != vm.statMap[statId]) {\r\n                  anyChange = true;\r\n                }\r\n              } \r\n            });\r\n\r\n            if(!found) {\r\n              anyChange = true;\r\n            }\r\n          }\r\n        }\r\n\r\n        if(anyChange) {\r\n          // console.log('GOT CHANGES!', newStats);\r\n          vm.item.stats = newStats;\r\n          vm.onChange();\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n}])\r\n.directive('dngearsimItemEditCustom', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditCustomCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-custom.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditEnchantmentCtrl',\r\n\r\nfunction(dntData,hCodeValues,items,$timeout,translations,itemColumnsToLoad,itemFactory) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  if(!vm.item || !vm.item.enchantmentId) {\r\n    return;\r\n  }\r\n  \r\n  if('itemSource' in this.item) {\r\n    vm.itemType = items[vm.item.itemSource];\r\n  }\r\n  \r\n  if(!vm.itemType) {\r\n    return;\r\n  }\r\n  if(!('enchantDnt' in vm.itemType) && !('petLevelDnt' in vm.itemType)) {\r\n    return;\r\n  }\r\n  \r\n  if(vm.itemType.enchantDnt) {\r\n    dntData.init(vm.itemType.enchantDnt, itemColumnsToLoad.enchantDnt, null, vm.getEnchantments);\r\n  }\r\n  if(vm.itemType.enchantDnt2) {\r\n    dntData.init(vm.itemType.enchantDnt2, itemColumnsToLoad.enchantDnt, null, vm.getEnchantments);\r\n  }\r\n  \r\n  if(vm.itemType.petLevelDnt) {\r\n    dntData.init(vm.itemType.petDnt, itemColumnsToLoad.petDnt, null, vm.getEnchantments);\r\n    dntData.init(vm.itemType.petLevelDnt, itemColumnsToLoad.petLevelDnt, null, vm.getEnchantments);\r\n  }\r\n  \r\n  vm.enchantments = null;\r\n  vm.enchantment = null;\r\n  vm.enchantmentAfter = null;\r\n  vm.enchantmentCost = '';\r\n  vm.enhancementOptions = [];\r\n  if(vm.item.enchantmentStats == null) {\r\n    vm.item.enchantmentStats = [];\r\n  }\r\n  \r\n  this.setEnchantment = function() {\r\n    vm.item.enchantmentStats = [];\r\n\r\n    if(vm.enchantments && vm.enchantments.length > 0) {\r\n\r\n      if(typeof vm.item.enchantmentNum != 'number') {\r\n        vm.item.enchantmentNum = 0;\r\n        vm.onChange();\r\n      }\r\n      \r\n      for(var i=0;i<vm.enchantments.length;++i) {\r\n        if(vm.item.enchantmentNum == getEnchantLevel(i)) {\r\n          vm.enchantment = vm.enchantments[i];\r\n          \r\n          vm.item.enchantmentStats = hCodeValues.getStats(vm.enchantment);\r\n        }\r\n        else if(vm.item.enchantmentNum + 1 == getEnchantLevel(i)) {\r\n          vm.enchantmentAfter = vm.enchantments[i];\r\n          if(vm.enchantmentAfter.NeedCoin < 10000) {\r\n            vm.enchantmentCost = Math.round(vm.enchantmentAfter.NeedCoin / 1000)/10 + 'g';\r\n          }\r\n          else {\r\n            vm.enchantmentCost = Math.round(vm.enchantmentAfter.NeedCoin / 10000) + 'g';\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  function getEnchantLevel(num) {\r\n    if('petLevelDnt' in vm.itemType) {\r\n      return vm.enchantments[num].PetLevel;\r\n    }\r\n    else {\r\n      return vm.enchantments[num].EnchantLevel;\r\n    }\r\n  }\r\n  \r\n  this.setPetLevel = function() {\r\n    vm.item.enchantmentStats = [];\r\n\r\n    if(vm.enchantments && vm.enchantments.length > 0) {\r\n\r\n      if(typeof vm.item.enchantmentNum != 'number') {\r\n        vm.item.enchantmentNum = 6;\r\n        vm.onChange();\r\n      }\r\n      \r\n      for(var i=0;i<vm.enchantments.length;++i) {\r\n        if(vm.item.enchantmentNum == vm.enchantments[i].PetLevel) {\r\n          vm.enchantment = vm.enchantments[i];\r\n          \r\n          vm.item.enchantmentStats = hCodeValues.getStats(vm.enchantment);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.isMaxEnchantLevel = function() {\r\n\r\n    if(vm.enchantments != null &&\r\n      vm.enchantments.length > 0 &&\r\n      typeof vm.item.enchantmentNum == 'number') {\r\n\r\n      for(var i=0;i<vm.enchantments.length;++i) {\r\n        if(vm.item.enchantmentNum + 1 == getEnchantLevel(i)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  this.setEnchantmentNum = function(enhancementOption) {\r\n    vm.item.enchantmentNum = enhancementOption;\r\n    vm.enhancementOptions = [];\r\n    if('petLevelDnt' in vm.itemType) {\r\n      vm.setPetLevel();\r\n    }\r\n    else {\r\n      vm.setEnchantment();\r\n    }\r\n    vm.onChange();\r\n  }\r\n  \r\n  this.nextEnchantment = function() {\r\n    for(var i=vm.item.enchantmentNum;i==0||vm.enchantments[i-1];++i) {\r\n      if(i == 0) {\r\n        vm.enhancementOptions.push({number: 0});\r\n      }\r\n      else {\r\n        vm.enhancementOptions.push(vm.getOption(i-1));\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.prevEnchantment = function() {\r\n    vm.enhancementOptions = [];\r\n    for(var i=vm.item.enchantmentNum;i>0;--i) {\r\n      vm.enhancementOptions.push(vm.getOption(i-1));\r\n    }\r\n    \r\n    vm.enhancementOptions.push({number: 0});\r\n  }\r\n  \r\n  this.getOption = function(enchantmentNum) {\r\n    return {\r\n      number: getEnchantLevel(enchantmentNum),\r\n      stats: hCodeValues.getStats(vm.enchantments[enchantmentNum])\r\n    };\r\n  }\r\n  \r\n  this.getEnchantments = function() {\r\n    if(!vm.enchantments && vm.item && vm.item.enchantmentId) {\r\n      if(vm.itemType.enchantDnt && dntData.isLoaded(vm.itemType.enchantDnt)) {\r\n        vm.enchantments = dntData.find(vm.itemType.enchantDnt, 'EnchantID', vm.item.enchantmentId);\r\n        if(!vm.enchantments.length && vm.itemType.enchantDnt2) {\r\n          vm.enchantments = dntData.find(vm.itemType.enchantDnt2, 'EnchantID', vm.item.enchantmentId);\r\n        }\r\n        vm.setEnchantment();\r\n      }\r\n      if(vm.itemType.petLevelDnt && dntData.isLoaded(vm.itemType.petLevelDnt)) {\r\n        vm.enchantments = dntData.find(vm.itemType.petLevelDnt, 'PetLevelTypeID', vm.item.enchantmentId);\r\n        vm.setPetLevel();\r\n      }\r\n    }\r\n    \r\n    return vm.enchantments;\r\n  }\r\n  \r\n  var fileName = 'all-items.lzjson';\r\n  \r\n  this.showMaterials = function() {\r\n    dntData.init(fileName, null, function() {}, function() {\r\n      $timeout(function() {\r\n        \r\n        if(!vm.enchantmentAfter) {\r\n          return;\r\n        }\r\n        \r\n        vm.materials = [];\r\n        for(var i=1;i<=5;++i) {\r\n          var itemId = vm.enchantmentAfter['NeedItemID' + i];\r\n          var itemCount = vm.enchantmentAfter['NeedItemCount' + i];\r\n          if(itemId > 0 && itemCount > 0) {\r\n            \r\n            var items = dntData.find(fileName, 'id', itemId);\r\n            if(items.length == 0) {\r\n              vm.materials.push({num: itemCount, name: 'unknown (' + itemId + ')'});\r\n            }\r\n            else {\r\n              var item = items[0];              \r\n              if(item) {\r\n                var material = {\r\n                  item: itemFactory.createBasicItem(item),\r\n                  num: itemCount,\r\n                };\r\n                vm.materials.push(material);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  if(dntData.isLoaded(fileName)) {\r\n    this.showMaterials();\r\n  }\r\n\r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n})\r\n.directive('dngearsimItemEditEnchantment', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditEnchantmentCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-enchantment.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditPotentialCtrl',\r\n\r\n['dntData','items','hCodeValues','itemColumnsToLoad',\r\nfunction(dntData,items,hCodeValues,itemColumnsToLoad) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  this.potentials = null;\r\n  this.potential = null;\r\n  this.changingPotentials = false;\r\n  this.potentialStats = {};\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  if('itemSource' in this.item) {\r\n    this.itemType = items[this.item.itemSource];\r\n  }\r\n  \r\n  if(!this.itemType || !this.item.pid || !('potentialDnt' in this.itemType)) {\r\n    return;\r\n  }\r\n  \r\n  if(vm.itemType.potentialDnt) {\r\n    dntData.init(vm.itemType.potentialDnt, itemColumnsToLoad.potentialDnt, null, vm.getPotentials);\r\n  }\r\n  \r\n  this.getPotentials = function() {\r\n    if(!vm.potentials) {\r\n      if(vm.item && vm.item.pid && 'potentialDnt' in vm.itemType) {\r\n        var potentials = dntData.find(vm.itemType.potentialDnt, 'id', vm.item.pid);\r\n        \r\n        if(potentials.length == 1) {\r\n          vm.potential = potentials[0];\r\n          vm.potentials = dntData.find(vm.itemType.potentialDnt, 'PotentialID', vm.potential.PotentialID);\r\n          vm.potentialStats = getPotentialStats(vm.potentials);\r\n        }\r\n        else if('potentialDntEx' in vm.itemType) {\r\n          potentials = dntData.find(vm.itemType.potentialDntEx, 'id', vm.item.pid);\r\n        \r\n          if(potentials.length == 1) {\r\n            vm.potential = potentials[0];\r\n            vm.potentials = dntData.find(vm.itemType.potentialDntEx, 'PotentialID', vm.potential.PotentialID);\r\n            vm.potentialStats = getPotentialStats(vm.potentials);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    return vm.potentials;\r\n  }\r\n  \r\n  this.nextPotential = function() {\r\n    for(var i=0;i<vm.potentials.length;++i) {\r\n      if(vm.potential.id == vm.potentials[i].id) {\r\n        vm.potential = vm.potentials[i+1];\r\n        vm.item.pid = vm.potential.id;\r\n        vm.onChange();\r\n        this.changingPotentials = true;\r\n        return;\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.prevPotential = function() {\r\n    for(var i=0;i<vm.potentials.length;++i) {\r\n      if(vm.potential.id == vm.potentials[i].id) {\r\n        vm.potential = vm.potentials[i-1];\r\n        vm.item.pid = vm.potential.id;\r\n        vm.onChange();\r\n        this.changingPotentials = true;\r\n        return;\r\n      }\r\n    }\r\n  }\r\n    \r\n  this.changePotential = function(pid) {\r\n    for(var i=0;i<vm.potentials.length;++i) {\r\n      if(pid == vm.potentials[i].id) {\r\n        vm.potential = vm.potentials[i];\r\n        vm.item.pid = vm.potential.id;\r\n        vm.changingPotentials = false;\r\n        vm.onChange();\r\n        return;\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.isFirstPotential = function() {\r\n    this.getPotentials();\r\n    return !vm.potentials || vm.potentials.length <= 1 || !vm.potential || vm.potential.id == vm.potentials[0].id;\r\n  }\r\n  \r\n  this.isLastPotential = function() {\r\n    this.getPotentials();\r\n    return !vm.potentials || vm.potentials.length <= 1 || !vm.potential || vm.potential.id == vm.potentials[vm.potentials.length-1].id;\r\n  }\r\n  \r\n  function getPotentialStats() {\r\n    var pStats = {};\r\n    var emptyStatId = null;\r\n    \r\n    if(vm.potentials != null) {\r\n      angular.forEach(vm.potentials, function(p, index) {\r\n        var stats = [];\r\n        angular.forEach(hCodeValues.getStats(p), function(stat, sIndex) {\r\n          if(!hCodeValues.stats[stat.id].hide) {\r\n            stats.push(stat);\r\n          }\r\n        });\r\n        \r\n        if(stats.length > 0) {\r\n          pStats[p.id] = stats;\r\n        }\r\n        else if(!emptyStatId) {\r\n          pStats[p.id] = [];\r\n          emptyStatId = p.id;\r\n        }\r\n      });\r\n    }\r\n    \r\n    return pStats;\r\n  }\r\n  \r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemEditPotential', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditPotentialCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-potential.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditSkillCtrl',\r\n\r\n['$timeout','dntData','statHelper',\r\nfunction($timeout,dntData,statHelper) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  if(this.item.itemSource != 'skills') {\r\n    return;\r\n  }\r\n  \r\n  if(!this.item.enchantmentNum) {\r\n    this.item.enchantmentNum = 1;\r\n  }\r\n  \r\n  var vm = this;\r\n  \r\n  function getDntFile() {\r\n    return 'skillleveltable_character' + vm.item.baseJobName + vm.item.pve + '.lzjson';\r\n  }\r\n  \r\n  this.initSkills = function() {\r\n    var dntFile = getDntFile();\r\n    dntData.init(dntFile, null, reportProgress, function() { $timeout(function() {\r\n      vm.skillData = dntData.find(dntFile, 'SkillIndex', vm.item.id);\r\n    })});\r\n  }\r\n  \r\n  this.nextEnchantment = function() {\r\n    if(this.skillData && this.item.enchantmentNum < this.skillData.length) {\r\n      this.item.enchantmentNum++;\r\n      vm.onChange();\r\n    }\r\n  }\r\n  \r\n  this.isMaxSkillLevel = function() {\r\n    return this.skillData && this.item && this.item.enchantmentNum >= this.skillData.length;\r\n  }\r\n  \r\n  this.prevEnchantment = function() {\r\n    if(this.item.enchantmentNum > 0) {\r\n      this.item.enchantmentNum--;\r\n    }\r\n    else {\r\n      this.item.enchantmentNum = 0;\r\n    }\r\n\r\n    vm.onChange();\r\n  }\r\n  \r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n  \r\n  dntData.init(getDntFile(), null, null, vm.initSkills);\r\n\r\n}])\r\n.directive('dngearsimItemEditSkill', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditSkillCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-skill.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditSparkCtrl',\r\n\r\n['dntData','hCodeValues','items','itemColumnsToLoad',\r\nfunction(dntData,hCodeValues,items,itemColumnsToLoad) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  if(this.item == null) return;\r\n  if('itemSource' in this.item) {\r\n    this.itemType = items[this.item.itemSource];\r\n  }\r\n  \r\n  if(!vm.itemType || !vm.itemType.sparkDnt) {\r\n    return\r\n  }\r\n  \r\n  if(vm.itemType.sparkDnt) {\r\n    dntData.init(vm.itemType.sparkDnt, itemColumnsToLoad.sparkDnt, null, vm.getSparks);\r\n  }\r\n  \r\n  this.sparks = null;\r\n\r\n  this.nextSpark = function() {\r\n    var index = getPotentialIndex();\r\n    index++;\r\n    if(index >= vm.sparks.length) {\r\n      index = 0;\r\n    }\r\n    var spark = vm.sparks[index]; \r\n    vm.item.sparkId = spark.id;\r\n    vm.item.sparkStats = hCodeValues.getStats(spark);\r\n    vm.onChange();\r\n  }\r\n  \r\n  this.isMoreSparks = function() {\r\n    return vm.sparks != null && getPotentialIndex() >= vm.sparks.length-1;\r\n  }\r\n  \r\n  this.isFirstSpark = function() {\r\n    return getPotentialIndex() == 0;\r\n  }\r\n  \r\n  this.prevSpark = function() {\r\n    var index = getPotentialIndex();\r\n    index--;\r\n    if(index < 0) {\r\n      index = vm.sparks.length-1;\r\n    }\r\n    var spark = vm.sparks[index]; \r\n    vm.item.sparkId = spark.id;\r\n    vm.item.sparkStats = hCodeValues.getStats(spark);\r\n    vm.onChange();\r\n  }\r\n  \r\n  this.removeSpark = function() {\r\n    vm.item.sparkId = null;\r\n    vm.item.sparkStats = null;\r\n    vm.onChange();\r\n  }\r\n  \r\n  this.getSparks = function() {\r\n    if(vm.item == null || vm.itemType == null) return null;\r\n    if(vm.sparks == null) {\r\n      var sid = vm.item.sparkTypeId;\r\n      if(sid) {\r\n        if(dntData.isLoaded(vm.itemType.sparkDnt)) {\r\n          vm.sparks = dntData.find(vm.itemType.sparkDnt, 'PotentialID', sid);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return vm.sparks;\r\n  }\r\n\r\n  function getPotentialIndex() {\r\n    var potentialIndex = -1;\r\n    if(vm.item.sparkId > 0) {\r\n      angular.forEach(vm.sparks, function(spark, index) {\r\n        if(spark.id == vm.item.sparkId) {\r\n          potentialIndex = index;\r\n          return;\r\n        }\r\n      });\r\n    }\r\n      \r\n    return potentialIndex;\r\n  }\r\n\r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n}])\r\n.directive('dngearsimItemEditSpark', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditSparkCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-spark.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditTalismanCtrl',\r\n\r\n[function() {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  if(this.item.itemSource != 'tman') {\r\n    return;\r\n  }\r\n  \r\n  this.setTalisman = function(amount) {\r\n    if(amount == 0) {\r\n      this.item.enchantmentNum = null;\r\n      this.item.enchantmentStats = [];\r\n    }\r\n    else {\r\n      this.item.enchantmentNum = amount;\r\n      \r\n      var extraStats = [];\r\n      angular.forEach(this.item.stats, function(stat, index) {\r\n        extraStats.push({id: stat.id, max: stat.max * (amount/100)});\r\n      });\r\n      \r\n      this.item.enchantmentStats = extraStats;\r\n    }\r\n    this.onChange();\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemEditTalisman', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n    },\r\n    controller: 'itemEditTalismanCtrl',\r\n    controllerAs: 'editCtrl',\r\n    templateUrl: 'ui/item/item-edit-talisman.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemEditCtrl',\r\n\r\n['hCodeValues',\r\nfunction(hCodeValues) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  if(!vm.item) {\r\n    return;\r\n  }\r\n  \r\n  vm.onUpdateItem = function() {\r\n    vm.updateItem();\r\n  }\r\n  \r\n}])\r\n.directive('dngearsimItemEdit', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n      onChange: '&onChange',\r\n      updateItem: '&updateItem'\r\n    },\r\n    controller: 'itemEditCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-edit.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewAttainmentCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues','translations',\r\n  function($timeout, dntData, itemFactory, hCodeValues, translations) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.attainments = [];\r\n\r\n  var files = [\r\n    'itemgaintable.lzjson',\r\n    'itemgaintable_dragonjewel.lzjson',\r\n    'itemgaintable_enchant.lzjson',\r\n    'itemgaintable_etc.lzjson',\r\n    'itemgaintable_reboot.lzjson',\r\n    'itemgaintable_talisman.lzjson'];\r\n\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.init();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.init = function() {\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i]) && !dntData.hasFailed(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    vm.attainments = [];\r\n    files.forEach(function(file) {\r\n      var attainments = dntData.find(file, 'id', vm.item.id);\r\n      if(attainments.length) {\r\n        attainments.forEach(function(attainment) {\r\n          var text = attainment.ItemGainText;\r\n          if(text) {\r\n            var texts = text.split('{');\r\n            texts.forEach(function(singleText) {\r\n              var splitVal = singleText.split('}');\r\n              if(splitVal.length) {\r\n                if(splitVal[0].indexOf('#') == -1) {\r\n                  vm.attainments.push(translations.translate(splitVal[0]));\r\n                }\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewAttainment', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewAttainmentCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-attainment.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewBoxCtrl',\r\n\r\n['$timeout','dntData','itemFactory','region',\r\n  function($timeout, dntData, itemFactory, region) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  if(this.item.typeId != 46 && this.item.typeId != 8 && this.item.typeId != 112 && this.item.typeId != 122 && this.item.typeId != 142 && this.item.typeId != 160) {\r\n    console.log('not box item type ' + this.item.typeId);\r\n    return;\r\n  }\r\n  \r\n  var vm = this;\r\n  \r\n  var pouchFileNames = [\r\n    'itemdroptable.lzjson',\r\n    'itemdroptable_abyss.lzjson',\r\n    'itemdroptable_apprentice.lzjson',\r\n    'itemdroptable_cook.lzjson',\r\n    'itemdroptable_darklair.lzjson',\r\n    'itemdroptable_dimension.lzjson',\r\n    'itemdroptable_disjoint.lzjson',\r\n    'itemdroptable_dnexpedition.lzjson',\r\n    'itemdroptable_event.lzjson',\r\n    'itemdroptable_farm.lzjson',\r\n    'itemdroptable_fishing.lzjson',\r\n    'itemdroptable_guildwar.lzjson',\r\n    'itemdroptable_item.lzjson',\r\n    'itemdroptable_monsteritem.lzjson',\r\n    'itemdroptable_propdrop.lzjson',\r\n    'itemdroptable_pvp.lzjson',\r\n    'itemdroptable_randomcompound.lzjson',\r\n    'itemdroptable_stageclear.lzjson',\r\n    'itemdroptable_themepark.lzjson',\r\n    'itemdroptable_union.lzjson']\r\n  \r\n  var allItemFileName = 'all-items.lzjson';\r\n  var charmItemtable = 'charmitemtable.lzjson';\r\n  var commonCharmItemtable = 'charmitemtable_common.lzjson';\r\n  this.usedFiles = {};\r\n  this.lookupId = null;\r\n  \r\n  var files;\r\n  if(this.item.typeId == 46 || this.item.typeId == 112 || this.item.typeId == 122 || this.item.typeId == 142 || this.item.typeId == 160) {\r\n    files = [allItemFileName, charmItemtable, commonCharmItemtable];\r\n  }\r\n  else if (this.item.typeId == 8) {\r\n    files = [allItemFileName].concat(pouchFileNames);\r\n  }\r\n\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initBoxContents();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initBoxContents = function() {\r\n    // console.log('init contents', this.item.fileName);\r\n\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    var datas = dntData.find(this.item.fileName + '.lzjson', 'id', this.item.id);\r\n    if(datas.length > 0) {\r\n      var d = datas[0];\r\n      this.lookupId = d.TypeParam1;\r\n      vm.items = [];\r\n      \r\n      \r\n      if(vm.item.typeId == 46 || vm.item.typeId == 112 || vm.item.typeId == 122 || vm.item.typeId == 142 || vm.item.typeId == 160) {\r\n        vm.getCharmItems(d.TypeParam1);\r\n      }\r\n      else if (vm.item.typeId == 8) {\r\n        vm.getPouchItems(d.TypeParam1);\r\n      }\r\n      \r\n    }\r\n  }\r\n  \r\n  this.getPouchItems = function(boxType) {\r\n    for(var f=0;f<pouchFileNames.length;++f) {\r\n      vm.getPouchItemsFromFile(boxType, pouchFileNames[f]);\r\n    }\r\n  }\r\n  \r\n  this.getPouchItemsFromFile = function(boxType, pouchFileName) {\r\n    \r\n    var pouchData = dntData.find(pouchFileName, 'id', boxType);\r\n    if(pouchData.length == 0) {\r\n    }\r\n    else {\r\n      var gold = pouchData[0].GoldMin;\r\n\r\n      var itemIndex = 0;\r\n      do {\r\n        itemIndex++;\r\n        var isGroup = pouchData[0]['IsGroup' + itemIndex];\r\n        var pouchItem = pouchData[0]['Item' + itemIndex + 'Index'];\r\n        var pouchItemCount = pouchData[0]['Item' + itemIndex + 'Info'];\r\n        //console.log('pouch contains ' + pouchItem);\r\n        if(pouchItem) {\r\n          if(isGroup) {\r\n            vm.getPouchItems(pouchItem, pouchFileName);\r\n          }\r\n          else {\r\n            // console.log('adding item ' + pouchItem);\r\n            var itemds = dntData.find(allItemFileName, 'id', pouchItem);\r\n            if(itemds.length > 0) {\r\n              var basicItem = itemFactory.createBasicItem(itemds[0]);\r\n              // console.log('found item ' + basicItem.name);\r\n  \r\n              vm.items.push({\r\n                count: pouchItemCount,\r\n                gold: gold,\r\n                item: basicItem\r\n              });\r\n              this.usedFiles[pouchFileName] = true;\r\n            }\r\n          }\r\n        }\r\n      } while(pouchItem);\r\n    }\r\n  }\r\n  \r\n  this.getCharmItems = function(boxType) {\r\n    var charmFiles = [charmItemtable, commonCharmItemtable];\r\n    for(var i=0;i<charmFiles.length;++i) {\r\n\r\n      var charmData = dntData.getData(charmFiles[i]);\r\n      // console.log('box: ' + boxType, charmData);\r\n      \r\n      for(var c=0;c<charmData.length;++c) {\r\n        var cd = charmData[c];\r\n        if(cd.CharmNum == boxType && cd.Look) {\r\n          \r\n          if(cd.CharmType) {\r\n            this.getCharmItems(cd.ItemID)\r\n          }\r\n          else {\r\n            var itemds = dntData.find(allItemFileName, 'id', cd.ItemID);\r\n            if(itemds.length > 0) {\r\n              vm.items.push({\r\n                count: cd.Count,\r\n                gold: cd.Gold,\r\n                item: itemFactory.createBasicItem(itemds[0])\r\n              });\r\n              this.usedFiles[charmFiles[i]] = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  this.getFileLink = function(fileName) {\r\n    return 'https://spacem.github.io/dntviewer/#dnt=' + fileName + '&location=' + region.dntLocation.url;\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewBox', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewBoxCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-box.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewCraftCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues','translations',\r\n  function($timeout, dntData, itemFactory, hCodeValues, translations) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.crafts = [];\r\n\r\n  var cFiles = [\r\n    'itemcompoundtable.lzjson',\r\n    'itemcompoundtable_custom.lzjson',\r\n    'itemcompoundtable_glyph.lzjson',\r\n    'itemcompoundtable_glyph95.lzjson',\r\n    'itemcompoundtable_jewel.lzjson',\r\n    'itemcompoundtable_renewal.lzjson',\r\n    'itemcompoundtable_set.lzjson'];\r\n  \r\n  var dropFile = 'itemdroptable.lzjson';\r\n  \r\n  var allItemFileName = 'all-items.lzjson';\r\n  \r\n  var files = cFiles.concat([allItemFileName, dropFile]);\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initCrafts();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initCrafts = function() {\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i]) && !dntData.hasFailed(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    vm.crafts = [];\r\n    for(var i=0;i<cFiles.length;++i) {\r\n      vm.initCraft(cFiles[i], vm.item.id);\r\n    }\r\n\r\n    for(var di=1;di<=20;++di) {\r\n      var drops = dntData.find(dropFile, 'Item' + di + 'Index', vm.item.id);\r\n      if(drops.length) {\r\n        drops.forEach(function(drop) {\r\n          for(var i=0;i<cFiles.length;++i) {\r\n            vm.initCraft(cFiles[i], drop.id);\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    var newCrafts = [];\r\n    for(var i=0;i<vm.crafts.length;++i) {\r\n      var found = false;\r\n      for(var j=0;j<newCrafts.length;++j) {\r\n        if(vm.crafts[i].gold == newCrafts[j].gold &&\r\n          vm.crafts[i].items.length == newCrafts[j].items.length) {\r\n            \r\n            found = true;\r\n            for(var k=0;k<vm.crafts[i].items.length;++k) {\r\n              if(vm.crafts[i].items[k].item.id != newCrafts[j].items[k].item.id ||\r\n                vm.crafts[i].items[k].num != newCrafts[j].items[k].num) {\r\n                  found = false;\r\n              }\r\n            }\r\n        }\r\n      }\r\n      \r\n      if(!found) {\r\n        newCrafts.push(vm.crafts[i]);\r\n      }\r\n    }\r\n    \r\n    vm.crafts = newCrafts;\r\n  }\r\n\r\n  this.initCraft = function(fileName, id) {\r\n    var fCrafts = dntData.find(fileName, 'SuccessItemID1', id);\r\n    \r\n    for(var i=0;i<fCrafts.length;++i) {\r\n      var c = fCrafts[i];\r\n      \r\n      var craft = {\r\n        id: c.id,\r\n        fileName: fileName.replace('.lzjson', ''),\r\n        gold: c.Cost/100/100,\r\n        items: [],\r\n      };\r\n      \r\n      var j=0;\r\n      for(;;) {\r\n        j++;\r\n        var itemColName = 'Slot' + j +'Id';\r\n        var qtyColName = 'Slot' + j +'Num';\r\n        if(!(itemColName in c)) {\r\n          break;\r\n        }\r\n\r\n        var items = dntData.find(allItemFileName, 'id', c[itemColName]);\r\n        if(items.length > 0) {\r\n          craft.items.push({\r\n            item: itemFactory.createBasicItem(items[0]),\r\n            num: c[qtyColName],\r\n          });\r\n        }\r\n      }\r\n      \r\n      vm.crafts.push(craft);\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewCraft', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewCraftCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-craft.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewExtractionCtrl',\r\n\r\n['$timeout','dntData','itemFactory','items',\r\n  function($timeout, dntData, itemFactory, items) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  \r\n  var extractFileName = 'itemdroptable_disjoint.lzjson';\r\n  var allItemFileName = 'all-items.lzjson';\r\n  \r\n  var files = [extractFileName,allItemFileName];\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initExtract();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initExtract = function() {\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    var disjoint;\r\n    var d = itemFactory.getItemData(vm.item);\r\n    if(d && d.DisjointDrop1 > 0) {\r\n      disjoint = d.DisjointDrop1;\r\n    }\r\n    \r\n    var itemType = items[vm.item.itemSource];\r\n    if(itemType && d.EnchantID) {\r\n      var enchantments = dntData.find(itemType.enchantDnt, 'EnchantID', d.EnchantID);\r\n      if(!enchantments.length && itemType.enchantDnt2) {\r\n        enchantments = dntData.find(itemType.enchantDnt2, 'EnchantID', d.EnchantID);\r\n      }\r\n\r\n      for(var i=0;i<enchantments.length;++i) {\r\n        if(enchantments[i].EnchantLevel == vm.item.enchantmentNum) {\r\n          disjoint = enchantments[i].DisjointDrop;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    vm.items = [];\r\n    if(disjoint) {\r\n      vm.getItems(disjoint);\r\n    }\r\n  }\r\n  \r\n  this.getGold = function() {\r\n    var d = itemFactory.getItemData(this.item);\r\n    return Number(d.Disjointamount)/100/100;\r\n  }\r\n  \r\n  this.getItems = function(disjoint) {\r\n    // console.log('checking ' + pouchFileName + ' for ' + boxType);\r\n    \r\n    var pouchData = dntData.find(extractFileName, 'id', disjoint);\r\n    if(pouchData.length == 0) {\r\n    }\r\n    else {\r\n      var gold = pouchData[0].GoldMin;\r\n\r\n      var itemIndex = 1;\r\n      while('Item' + itemIndex + 'Index' in pouchData[0]) {\r\n        var isGroup = pouchData[0]['IsGroup' + itemIndex];\r\n        var pouchItem = pouchData[0]['Item' + itemIndex + 'Index'];\r\n        var pouchItemCount = pouchData[0]['Item' + itemIndex + 'Info'];\r\n        //console.log('pouch contains ' + pouchItem);\r\n        if(pouchItem) {\r\n          if(isGroup) {\r\n            vm.getItems(pouchItem);\r\n          }\r\n          else {\r\n            var itemds = dntData.find(allItemFileName, 'id', pouchItem);\r\n            if(itemds.length > 0) {\r\n              //console.log('found item ');\r\n  \r\n              vm.items.push({\r\n                count: pouchItemCount,\r\n                gold: gold,\r\n                item: itemFactory.createBasicItem(itemds[0]),\r\n              });\r\n            }\r\n          }\r\n        }\r\n        itemIndex++;\r\n      }\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewExtraction', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewExtractionCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-extraction.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewPlateCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues','translations',\r\n  function($timeout, dntData, itemFactory) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.items = [];\r\n  \r\n  var plateFile = 'platetable.lzjson';\r\n  var allItemFileName = 'all-items.lzjson';\r\n  \r\n  var allFiles = [plateFile,allItemFileName];\r\n  for(var i=0;i<allFiles.length;++i) {\r\n    dntData.init(allFiles[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initSets();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initSets = function() {\r\n    for(var i=0;i<allFiles.length;++i) {\r\n      if(!dntData.isLoaded(allFiles[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    vm.items = [];\r\n    getPlates();\r\n  }\r\n  \r\n  function getPlates() {\r\n    var rows = dntData.find(plateFile, 'ItemID', vm.item.id);\r\n    for(var r=0;r<rows.length;++r) {\r\n      var row = rows[r];\r\n      var col=0;\r\n      for(;;) {\r\n        col++;\r\n        var colName = 'CompoundTableIndex' + col;\r\n        if(!(colName in row)) {\r\n          break;\r\n        }\r\n\r\n        var itemData = dntData.find(allItemFileName, 'id', row[colName]);\r\n        if(itemData.length > 0) {\r\n          vm.items.push(itemFactory.createBasicItem(itemData[0]));\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewPlate', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewPlateCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-plate.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewSetCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues','translations',\r\n  function($timeout, dntData, itemFactory) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.items = [];\r\n  \r\n  var files = [\r\n  'partstable.optimised.json',\r\n  'partstable_cash.optimised.json',\r\n  'partstable_common2014.optimised.json',\r\n  'partstable_common2015.optimised.json',\r\n  'partstable_common2016.lzjson',\r\n  'partstable_commoncash.lzjson',\r\n  'partstable_equipment.optimised.json',\r\n  'partstable_event.lzjson',\r\n  'partstable_guild.lzjson',\r\n  'partstable_pvp.optimised.json',\r\n  'partstable_reboot.optimised.json',\r\n  'partstable_skilllevelup.lzjson',\r\n  'weapontable.optimised.json',\r\n  'weapontable_cash.optimised.json',\r\n  'weapontable_common2014.optimised.json',\r\n  'weapontable_common2015.optimised.json',\r\n  'weapontable_common2016.lzjson',\r\n  'weapontable_commoncash.lzjson',\r\n  'weapontable_equipment.optimised.json',\r\n  'weapontable_event.lzjson',\r\n  'weapontable_guild.lzjson',\r\n  'weapontable_pvp.optimised.json',\r\n  'weapontable_reboot.optimised.json',\r\n  //'weapontable_skilllevelup.lzjson'\r\n  ];\r\n  \r\n  var allItemFileName = 'all-items.lzjson';\r\n  \r\n  var allFiles = files.concat([allItemFileName]);\r\n  for(var i=0;i<allFiles.length;++i) {\r\n    dntData.init(allFiles[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initSets();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initSets = function() {\r\n    for(var i=0;i<allFiles.length;++i) {\r\n      if(!dntData.isLoaded(allFiles[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    vm.items = [];\r\n    for(var i=0;i<files.length;++i) {\r\n      getSetItems(files[i]);\r\n    }\r\n  }\r\n  \r\n  function getSetItems(fileName) {\r\n    var rows = dntData.find(fileName, 'SetItemID', vm.item.setId);\r\n    for(var r=0;r<rows.length;++r) {\r\n      var itemData = dntData.find(allItemFileName, 'id', rows[r].id);\r\n      if(itemData.length > 0) {\r\n        vm.items.push(itemFactory.createBasicItem(itemData[0]));\r\n      }\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewSet', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewSetCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-set.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewShopCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues','translations',\r\n  function($timeout, dntData, itemFactory, hCodeValues, translations) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.shopCosts = [];\r\n  \r\n  var cShopFileName = 'combinedshoptable.lzjson';\r\n  var cSysShopFileName = 'combinedshoptable_system.lzjson';\r\n  var cCashShopFileName = 'combinedshoptable_cash.lzjson';\r\n  // var shopFileName = 'shoptable.lzjson';\r\n  var allItemFileName = 'all-items.lzjson';\r\n  \r\n  var files = [cCashShopFileName,cSysShopFileName,cShopFileName,allItemFileName];\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initShops();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initShops = function() {\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    vm.shopCosts = [];\r\n    getCombinedCosts(cShopFileName);\r\n    getCombinedCosts(cSysShopFileName);\r\n    getCombinedCosts(cCashShopFileName);\r\n    // getShopCosts();\r\n    \r\n    var newShopCosts = [];\r\n    for(var i=0;i<vm.shopCosts.length;++i) {\r\n      var found = false;\r\n      for(var j=0;j<newShopCosts.length;++j) {\r\n        if(vm.shopCosts[i].tabName == newShopCosts[j].tabName &&\r\n          vm.shopCosts[i].gold == newShopCosts[j].gold &&\r\n          vm.shopCosts[i].item1.id == newShopCosts[j].item1.id &&\r\n          vm.shopCosts[i].numItem1.id == newShopCosts[j].numItem1.id &&\r\n          vm.shopCosts[i].item2.id == newShopCosts[j].item2.id &&\r\n          vm.shopCosts[i].numItem2.id == newShopCosts[j].numItem2.id) {\r\n            found = true;\r\n            break;\r\n        }\r\n      }\r\n      \r\n      if(!found) {\r\n        newShopCosts.push(vm.shopCosts[i]);\r\n      }\r\n    }\r\n    \r\n    vm.shopCosts = newShopCosts;\r\n  }\r\n  \r\n  /*\r\n  function getShopCosts() {\r\n    var shops = dntData.getData(shopFileName);\r\n    \r\n    for(var i=0;i<shops.length;++i) {\r\n      var s = shops[i];\r\n      \r\n      var c = 0;\r\n      for(;;) {\r\n        ++c;\r\n        \r\n        var colName = 'itemIndex' + c;\r\n        if(!(colName in s)) {\r\n          break;\r\n        }\r\n        \r\n        var itemId = s[colName];\r\n        if(!itemId) {\r\n          break;\r\n        }\r\n        \r\n        if(itemId == vm.item.id) {\r\n          s = {\r\n            shopName: s.ShopID,\r\n            tabName: translations.translate(s.TabNameID),\r\n            gold: s['Quantity' + c],\r\n          };\r\n          \r\n      \r\n          if(s.shopName in hCodeValues.shopNames) {\r\n            s.shopName = hCodeValues.shopNames[s.shopName];\r\n          }\r\n      \r\n          if(!s.shopName) {\r\n            s.shopName = s.ShopId;\r\n          }\r\n          vm.shopCosts.push(s);\r\n        }\r\n      }\r\n    }\r\n  }*/\r\n\r\n  function getCombinedCosts(fileName) {\r\n    var shops = dntData.find(fileName, 'itemindex', vm.item.id);\r\n    \r\n    for(var i=0;i<shops.length;++i) {\r\n      var s = shops[i];\r\n        \r\n      var item1s = dntData.find(allItemFileName, 'id', s.PurchaseItem1);\r\n      var item2s = dntData.find(allItemFileName, 'id', s.PurchaseItem2);\r\n      \r\n      var shopCost = {\r\n        shopName: s.ShopID,\r\n        tabName: translations.translate(s.TabNameID),\r\n        gold: 0,\r\n        nightmarePoints: 0,\r\n        dungeonPoints: 0,\r\n        nestPoints: 0,\r\n        ladderPoints: 0,\r\n        item1: itemFactory.createBasicItem(item1s[0]),\r\n        item2: itemFactory.createBasicItem(item2s[0]),\r\n        numItem1: 0,\r\n        numItem2: 0,\r\n      };\r\n      \r\n      if(shopCost.shopName in hCodeValues.shopNames) {\r\n        shopCost.shopName = hCodeValues.shopNames[shopCost.shopName];\r\n      }\r\n      \r\n      if(s.PurchaseType1 == 1) {\r\n        shopCost.gold += s.PurchaseItemValue1;\r\n      }\r\n      else if(s.PurchaseType1 == 3) {\r\n        shopCost.ladderPoints += s.PurchaseItemValue1;\r\n      }\r\n      else if(s.PurchaseType1 == 8) {\r\n        shopCost.nightmarePoints += s.PurchaseItemValue1;\r\n      }\r\n      else if(s.PurchaseType1 == 13) {\r\n        shopCost.nestPoints += s.PurchaseItemValue1;\r\n      }\r\n      else if(s.PurchaseType1 == 14) {\r\n        shopCost.dungeonPoints += s.PurchaseItemValue1;\r\n      }\r\n      else {\r\n        shopCost.numItem1 = s.PurchaseItemValue1;\r\n        shopCost.pointsId1 = s.PurchaseType1;\r\n      }\r\n      \r\n      if(s.PurchaseType2 == 1) {\r\n        shopCost.gold += s.PurchaseItemValue2;\r\n      }\r\n      else if(s.PurchaseType2 == 3) {\r\n        shopCost.ladderPoints += s.PurchaseItemValue2;\r\n      }\r\n      else if(s.PurchaseType2 == 8) {\r\n        shopCost.nightmarePoints += s.PurchaseItemValue2;\r\n      }\r\n      else if(s.PurchaseType1 == 13) {\r\n        shopCost.nestPoints += s.PurchaseItemValue2;\r\n      }\r\n      else if(s.PurchaseType1 == 14) {\r\n        shopCost.dungeonPoints += s.PurchaseItemValue2;\r\n      }\r\n      else {\r\n        shopCost.numItem2 = s.PurchaseItemValue2;\r\n        shopCost.pointsId2 = s.PurchaseType2;\r\n      }\r\n      \r\n      shopCost.gold = shopCost.gold/100/100;\r\n      \r\n      vm.shopCosts.push(shopCost);\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewShop', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewShopCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-shop.html'\r\n  };\r\n});","angular.module('dnsim').controller('itemViewTransferCtrl',\r\n\r\n['$timeout','dntData','itemFactory','hCodeValues',\r\n  function($timeout, dntData, itemFactory, hCodeValues) {\r\n  'use strict';\r\n  \r\n  if(this.item == null) return;\r\n  \r\n  var vm = this;\r\n  vm.matchingTransfers = [];\r\n  \r\n  var transferFileName = 'enchanttransfertable.lzjson';\r\n  var allItemFileName = 'all-items.lzjson';\r\n  var transferItemsFileName = 'enchanttransferitemtable.lzjson';\r\n  \r\n  var files = [transferFileName,allItemFileName,transferItemsFileName];\r\n  for(var i=0;i<files.length;++i) {\r\n    dntData.init(files[i], null, function() {}, function() {\r\n      $timeout(function() {\r\n        vm.initTransfers();\r\n      });\r\n    });\r\n  }\r\n  \r\n  this.initTransfers = function() {\r\n    for(var i=0;i<files.length;++i) {\r\n      if(!dntData.isLoaded(files[i])) {\r\n        return;\r\n      }\r\n    }\r\n    vm.matchingTransfers = [];\r\n    \r\n    var transferItem = dntData.find(transferItemsFileName, 'ItemID', vm.item.id);\r\n    if(transferItem && transferItem.length > 0) {\r\n      var transfers = dntData.find(transferFileName, 'EnchantLevel', vm.item.enchantmentNum);\r\n      \r\n      for(var i=0;i<transfers.length;++i) {\r\n        var t = transfers[i];\r\n        if(t.Rank == vm.item.rank.id && t.LevelLimit == vm.item.levelLimit) {\r\n          \r\n          var item1s = dntData.find(allItemFileName, 'id', t.NeedItemID1);\r\n          var item2s = dntData.find(allItemFileName, 'id', t.NeedItemID2);\r\n          \r\n          vm.matchingTransfers.push({\r\n            level: t.ResultLevel,\r\n            enchantmentNum: t.ResultEnchantLevel,\r\n            gold: t.NeedCoin/100/100,\r\n            rank: hCodeValues.rankNames[t.ResultRank],\r\n            numItem1: t.NeedItemCount1,\r\n            item1: itemFactory.createBasicItem(item1s[0]),\r\n            numItem2: t.NeedItemCount2,\r\n            item2: itemFactory.createBasicItem(item2s[0]),\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n}])\r\n.directive('dngearsimItemViewTransfer', function() {\r\n  return {\r\n    scope: true,\r\n    bindToController: {\r\n      item: '=item',\r\n    },\r\n    controller: 'itemViewTransferCtrl',\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'ui/item/item-view-transfer.html'\r\n  };\r\n});","angular.module('dnsim').controller('ItemCtrl',\r\n['$scope','$window','dntData','hCodeValues','items','jobs','exportLinkHelper','$routeParams','translations','$location','region','itemFactory','$timeout','statHelper','saveHelper',\r\nfunction($scope,$window,dntData,hCodeValues,items,jobs,exportLinkHelper,$routeParams,translations,$location,region,itemFactory,$timeout,statHelper,saveHelper) {\r\n  'use strict';\r\n  \r\n  region.setLocationByName($routeParams.region);\r\n  \r\n  $window.scrollTo(0, 0);\r\n  \r\n  $scope.jobName = null;\r\n  // console.log('search string: ', $routeParams.i);\r\n  $scope.item = exportLinkHelper.decodeItem($routeParams.i);\r\n  if('itemSource' in $scope.item) {\r\n    $scope.itemType = items[$scope.item.itemSource];\r\n  }\r\n  \r\n  $scope.item.setStats = null;\r\n  $scope.item.setId = null;\r\n  $scope.detail = null;\r\n  \r\n  $scope.getDescription = function() {\r\n    if($scope.item.description) {\r\n      return $scope.item.description;\r\n    }\r\n    else if($scope.itemType &&\r\n      $scope.itemType.name == 'title' &&\r\n      translations.isLoaded() &&\r\n      dntData.isLoaded($scope.itemType.mainDnt)) {\r\n\r\n      var itemData = dntData.find($scope.itemType.mainDnt, 'id', $scope.item.id);\r\n      if(itemData && itemData.length > 0 && itemData[0].DescriptionID > 0) {\r\n        return translations.translate(itemData[0].DescriptionID, itemData[0].DescriptionIDParam);\r\n      }\r\n    }\r\n    else if($scope.item.fileName &&\r\n      dntData.isLoaded($scope.item.fileName + '.lzjson')) {\r\n        \r\n      var itemData = dntData.find($scope.item.fileName + '.lzjson', 'id', $scope.item.id);\r\n      if(itemData && itemData.length > 0 && itemData[0].DescriptionID > 0) {\r\n        return translations.translate(itemData[0].DescriptionID, itemData[0].DescriptionIDParam);\r\n      } \r\n    }\r\n    return '';\r\n  }\r\n  \r\n  $scope.getExchangeType = function() {\r\n    // console.log('getting exchange');\r\n    var exchangeDnt = 'exchange.lzjson';\r\n    if(translations.isLoaded() &&\r\n      dntData.isLoaded(exchangeDnt) &&\r\n      $scope.item.exchangeType > 0) {\r\n        \r\n      // console.log('finding exchange ' + $scope.item.exchangeType);\r\n\r\n      var exchange = dntData.find(exchangeDnt, 'ExchangeType', $scope.item.exchangeType);\r\n      // console.log('got ' + exchange.length);\r\n      if(exchange && exchange.length > 0 && exchange[0].NameID > 0) {\r\n        // console.log('exchange name: ' + exchange[0].NameID);\r\n        return translations.translate(exchange[0].NameID).toLowerCase();\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n  \r\n  $scope.setDetail = function(detail) {\r\n    $scope.detail = detail;\r\n  }\r\n  \r\n  $scope.getNumInSet = function() {\r\n    \r\n    var buildName = $scope.getBuildName();\r\n    if(buildName && $scope.item && $scope.item.setId) {\r\n      return statHelper.getNumItemsForSet($scope.builds[buildName].items, $scope.item.setId);\r\n    }\r\n    \r\n    return 0;\r\n  }\r\n  \r\n  $scope.getBuildName = function() {\r\n    var buildName = saveHelper.getCurrentBuild();\r\n    if($scope.builds) {\r\n      if(!buildName || !(buildName in $scope.builds)) {\r\n        var allBuildNames = Object.keys($scope.builds);\r\n        if(allBuildNames.length) {\r\n          buildName = allBuildNames[0];\r\n        }\r\n      }\r\n    }\r\n    \r\n    return buildName;\r\n  }\r\n\r\n  $scope.getSellingPrice = function() {\r\n    var itemData = itemFactory.getItemData($scope.item);\r\n    var retVal = '';\r\n    if('SellAmount' in itemData && itemData.SellAmount > 0) {\r\n\r\n      var gold = Math.floor(itemData.SellAmount / 10000);\r\n      if(gold) {\r\n        retVal += gold + 'gold ';\r\n      }\r\n\r\n      var silver = Math.floor(itemData.SellAmount / 100) % 100;\r\n      if(silver) {\r\n        retVal += silver + 'silver ';\r\n      }\r\n\r\n      var copper = itemData.SellAmount % 100;\r\n      if(copper) {\r\n        retVal += copper + 'copper ';\r\n      }\r\n    }\r\n    return retVal;\r\n  }\r\n  \r\n  $scope.getServerStorage = function() {\r\n    var itemData = itemFactory.getItemData($scope.item);\r\n    var retVal = '';\r\n    \r\n    if(itemData && 'IsCash' in itemData && itemData.IsCash == 0) {\r\n      if(itemData && 'AbleWStorage' in itemData) {\r\n        if(itemData.AbleWStorage == 1) {\r\n          retVal = 'can server storage';\r\n        }\r\n        else if(itemData.AbleWStorage == 0) {\r\n          if(itemData && 'Reversion' in itemData && itemData.Reversion) {\r\n            retVal = 'not transferable';\r\n          }\r\n        }\r\n      }\r\n\r\n      if(itemData && 'Reversion' in itemData) {\r\n        if(retVal.length) {\r\n          retVal += ', ';\r\n        }\r\n        \r\n        if(itemData.Reversion == 0) {\r\n          retVal += 'can trade';\r\n        }\r\n        else if(itemData.Reversion == 1) {\r\n          retVal += 'not tradable ';\r\n        }\r\n      }\r\n    }\r\n    return retVal;\r\n  }\r\n  \r\n  $scope.getMoreInfo = function() {\r\n    var sealTimes = 0;\r\n    var numStamps = 0;\r\n    \r\n    if($scope.moreInfoLoaded()) {\r\n      var itemData = itemFactory.getItemData($scope.item);\r\n      \r\n      if(itemData && 'IsCash' in itemData && itemData.IsCash == 0) {\r\n        if(itemData && 'SealID' in itemData && 'SealCount' in itemData) {\r\n          sealTimes = itemData.SealCount;\r\n            \r\n          var sealData = dntData.find('sealcounttable.lzjson', 'Type2', itemData.SealID);\r\n          if(sealData && sealData.length > 0 && sealData[0].Type1 == 0) {\r\n            \r\n            var colName = 'Count0';\r\n            if($scope.item.enchantmentNum) {\r\n              colName = 'Count' + $scope.item.enchantmentNum;\r\n            }\r\n            \r\n            if(colName in sealData[0]) {\r\n              numStamps = sealData[0][colName];\r\n            }\r\n          }\r\n        }\r\n      }\r\n      else if(itemData && 'IsCash' in itemData && 'CashTradeCount' in itemData && 'Reversion' in itemData && 'AbleWStorage' in itemData) {\r\n        if(itemData.Reversion == 2) {\r\n          if(itemData.CashTradeCount) {\r\n            return 'can server storage, cash trade count: ' + itemData.CashTradeCount;\r\n          }\r\n          else {\r\n            return 'can server storage, can use warranty';\r\n          }\r\n        }\r\n        else if(itemData.AbleWStorage) {\r\n          return 'can server storage';\r\n        }\r\n        else {\r\n          return 'not tradable';\r\n        }\r\n      }\r\n    }\r\n    \r\n    if(sealTimes && numStamps) {\r\n      return 'can stamp ' + sealTimes + ' times using ' + numStamps + '  stamps';\r\n    }\r\n    else {\r\n      return '';\r\n    }\r\n  }\r\n  \r\n  $scope.moreInfoLoaded = function() {\r\n    return dntData.isLoaded($scope.item.fileName + '.lzjson') &&\r\n      dntData.isLoaded('sealcounttable.lzjson');\r\n  }\r\n  \r\n  $scope.loadMoreInfo = function() {\r\n    dntData.init($scope.item.fileName + '.lzjson', null, $timeout);\r\n    dntData.init('sealcounttable.lzjson', null, $timeout);\r\n  }\r\n  \r\n  $scope.handleChange = function() {\r\n    // console.log('changes');\r\n    if($scope.item.itemSource != 'custom') {\r\n      $location.search('i', exportLinkHelper.encodeItem($scope.item));\r\n    }\r\n    else {\r\n      setFullStats();\r\n      $scope.item = angular.copy($scope.item);\r\n    }\r\n    getBuilds();\r\n  }\r\n  \r\n  function getJobName() {\r\n    var allJobs = jobs.getAllJobs();\r\n    angular.forEach(allJobs, function(job, index) {\r\n      if(job.id == $scope.item.needJobClass) {\r\n        $scope.jobName = job.name;\r\n      }\r\n    });\r\n  }\r\n  \r\n  function init() {\r\n    getBuilds();\r\n    $scope.preInitItem = $scope.item;\r\n    $scope.item = null;\r\n  \r\n    var anyToLoad = false;\r\n    \r\n    angular.forEach(exportLinkHelper.getDntFiles($scope.preInitItem), function(columns, fileName) {\r\n      if(!dntData.isLoaded(fileName)) {\r\n        dntData.init(fileName, columns, reportProgress, tryInit);\r\n        anyToLoad = true;\r\n      }\r\n    });\r\n    \r\n    if(!translations.isLoaded()) {\r\n      translations.init(reportProgress, tryInit);\r\n      anyToLoad = true;\r\n    }\r\n    \r\n    if(!jobs.isLoaded()) {\r\n      jobs.init(reportProgress, tryInit);\r\n      anyToLoad = true;\r\n    }\r\n    \r\n    if(!anyToLoad) {\r\n      tryInit();\r\n    }\r\n  }\r\n  init();\r\n\r\n  function isLoaded() {\r\n    var anyDntToLoad = false;\r\n    angular.forEach(exportLinkHelper.getDntFiles($scope.preInitItem), function(columns, fileName) {\r\n      if(!dntData.isLoaded(fileName)) {\r\n        anyDntToLoad = true;\r\n      }\r\n    });\r\n\r\n    return !anyDntToLoad && translations.isLoaded() && jobs.isLoaded();\r\n  }\r\n  \r\n  function tryInit() {\r\n    if(isLoaded()) {\r\n      $scope.item = exportLinkHelper.reloadItem($scope.preInitItem);\r\n      if($scope.item == null) {\r\n        return;\r\n      }\r\n      \r\n      setFullStats();\r\n      $window.document.title = 'dngearsim | ' + $scope.item.name;\r\n      if($scope.item.itemSource != 'custom') {\r\n      \r\n        if($scope.item.typeName == 'skills') {\r\n          if(!$scope.item.pve || $scope.item.pve != 'pvp') {\r\n            $scope.item.pve = 'pve';\r\n          }\r\n          else {\r\n            $scope.item.pve = 'pvp';\r\n          }\r\n        }\r\n        else {\r\n          if($scope.item.needJobClass > 0) {\r\n            getJobName();\r\n          }\r\n        }\r\n        \r\n        setFileName();\r\n      }\r\n\r\n      setupTabs();\r\n    }\r\n  }\r\n\r\n  function setupTabs() {\r\n    var itemData = itemFactory.getItemData($scope.item);\r\n    if(itemData.DisjointDrop1 > 0) {\r\n      $scope.canExtract = true;\r\n    }\r\n    \r\n    if((itemData.Type == 0 || itemData.Type == 1) && $scope.item.enchantmentNum > 0) {\r\n      $scope.canTransfer = true;\r\n    }\r\n    \r\n    if($scope.item.setId) {\r\n      $scope.isInSet = true;\r\n    }\r\n    \r\n    if($scope.item.typeId == 5) {\r\n      $scope.isPlate = true;\r\n    }\r\n    \r\n    if($scope.item.typeId == 46 || $scope.item.typeId == 8 || $scope.item.typeId == 112 || $scope.item.typeId == 122 || $scope.item.typeId == 142 || $scope.item.typeId == 160) {\r\n      $scope.hasContents = true;\r\n      $scope.detail = 'contents';\r\n    }\r\n    else if($scope.item.typeName != null) {\r\n      $scope.canUse = true;\r\n      $scope.detail = 'use';\r\n    }\r\n    else if($scope.canExtract) {\r\n      $scope.detail = 'extract';\r\n    }\r\n    else if($scope.canTransfer) {\r\n      $scope.detail = 'transfer';\r\n    }\r\n    else if($scope.isPlate) {\r\n      $scope.detail = 'plate';\r\n    }\r\n    else {\r\n      $scope.detail = 'attainment';\r\n    }\r\n  }\r\n  \r\n  function setFileName() {\r\n    if(!$scope.item.fileName) {\r\n      if($scope.item.itemSource in items && items[$scope.item.itemSource].mainDnt) {\r\n        $scope.item.fileName = items[$scope.item.itemSource].mainDnt.replace('.lzjson', '').replace('.json', '').replace('.optimised', '');\r\n      }\r\n    }\r\n  }\r\n  \r\n  function setFullStats() {\r\n    // full stats are cleared when publishing builds\r\n    $scope.item.fullStats = $scope.item.stats;\r\n    \r\n    if($scope.item.enchantmentStats != null && $scope.item.enchantmentStats.length > 0) {\r\n      $scope.item.fullStats = hCodeValues.mergeStats($scope.item.enchantmentStats, $scope.item.fullStats);\r\n    }\r\n    \r\n    if($scope.item.sparkStats != null && $scope.item.sparkStats.length > 0) {\r\n      $scope.item.fullStats = hCodeValues.mergeStats($scope.item.sparkStats, $scope.item.fullStats);\r\n    }\r\n  }\r\n  \r\n  function reportProgress(msg) {\r\n    // $scope.progress += '|' + msg;\r\n    // console.log('progress: ' + msg);\r\n  }\r\n  \r\n  function getBuilds() {\r\n    var builds = saveHelper.getSavedItems();\r\n    $scope.builds = builds;\r\n  }\r\n}]);","angular.module('dnsim').controller('ExportCtrl', \r\n  ['$scope','$window','saveHelper',\r\n   function($scope, $window, saveHelper) {\r\n  'use strict';\r\n     \r\n  document.body.className = 'default-back';\r\n  $window.document.title = 'dngearsim | EXPORT';\r\n  \r\n  var rawSavedData = saveHelper.getSavedItems();\r\n  $scope.exportData = JSON.stringify(rawSavedData, null, 1);\r\n  \r\n  $scope.save = function() {\r\n    localStorage.setItem('savedItems', LZString.compressToUTF16($scope.exportData));\r\n  }\r\n}]);\r\n","angular.module('dnsim').controller('HeaderCtrl', \r\n[\r\n  function() {\r\n    'use strict';\r\n    var vm = this;\r\n  }\r\n]).directive('dngearsimHeader', function() {\r\n  return {\r\n    templateUrl: 'ui/nav/header.html',\r\n  };\r\n});","angular.module('dnsim').controller('NavCtrl', \r\n  ['$scope','$location','translations','region','itemCategory','saveHelper',\r\n  function($scope,$location,translations,region,itemCategory,saveHelper) {\r\n    'use strict';\r\n    \r\n    try {\r\n      var noLocationMenu = [];\r\n      var normalMenu = [\r\n        {path: 'builds', name:'builds', icon: 'menu-hamburger'},\r\n        {path: 'search', name:'search', icon: 'search'},\r\n        ];\r\n      \r\n      var buildAction = {path: 'build', name:'build'};\r\n      \r\n      var withBuildMenu = [\r\n        {path: 'builds', name:'builds', icon: 'menu-hamburger'},\r\n        {path: 'search', name:'search', icon: 'search'},\r\n        buildAction,\r\n        ];\r\n        \r\n      region.init();\r\n    \r\n      $scope.isSearch = function() {\r\n        return $location.path().indexOf('/search') == 0;\r\n      }\r\n  \r\n      $scope.isLoading = function() {\r\n        return translations.startedLoading && \r\n              !translations.isLoaded() &&\r\n              region.tlocation != null &&\r\n              region.tlocation.url != '' &&\r\n              !$scope.noRegion();\r\n      }\r\n      \r\n      $scope.noRegion = function() {\r\n        return region.dntLocation == null;\r\n      }\r\n      \r\n      $scope.isHttpOnly = function() {\r\n        return location.protocol != 'https:' && location.hostname != 'localhost';\r\n      }\r\n        \r\n      $scope.getActions = function() {\r\n        try {\r\n          var menu = null;\r\n          \r\n          var currentBuild = saveHelper.getCurrentBuild();\r\n          if(currentBuild) {\r\n            if(!$scope.savedItems || !(currentBuild in $scope.savedItems)) {\r\n              // console.log('loading saved items');\r\n              $scope.savedItems = saveHelper.getSavedItems();\r\n            }\r\n            \r\n            if(!(currentBuild in $scope.savedItems)) {\r\n              currentBuild = null;\r\n            }\r\n          }\r\n    \r\n          if(region.dntLocation != null && region.dntLocation.url == '') {\r\n            menu = noLocationMenu; \r\n          }\r\n          else if(region.tlocation != null && region.tlocation.url == '') {\r\n            menu = noLocationMenu; \r\n          }\r\n          else if(currentBuild && currentBuild != 'null') {\r\n            menu = withBuildMenu;\r\n            buildAction.path = 'build?buildName=' + currentBuild;\r\n            buildAction.name = currentBuild;\r\n            if(currentBuild in $scope.savedItems) {\r\n              buildAction.build = $scope.savedItems[currentBuild];\r\n            }\r\n          }\r\n          else if($location.path() == '/view-group' || region.dntLocation == null) {\r\n            menu = normalMenu;\r\n          }\r\n          else {\r\n            menu = normalMenu;\r\n          }\r\n          \r\n          var path = $location.path;\r\n          angular.forEach(menu, function(value, key) {\r\n            delete value.extraCss;\r\n            if(path && path.length == 1) {\r\n              if(value.path.length == 1) {\r\n                value.extraCss = 'active';\r\n              }\r\n            }\r\n            else if(value.path && value.path.length > 1 && path.indexOf('/' + value.path) == 0) {\r\n              if(value.path != 'builds' || path == '/builds') {\r\n                value.extraCss = 'active';\r\n              }\r\n            }\r\n          });\r\n          \r\n          return menu;\r\n        }\r\n        catch(ex) {\r\n          $scope.simError = ex.message;\r\n          console.error(ex);\r\n        }\r\n      };\r\n    }\r\n    catch(ex) {\r\n      $scope.simError = ex.message;\r\n      console.error(ex);\r\n    }\r\n  }\r\n])\r\n.directive('dngearsimNav', function() {\r\n  return {\r\n    templateUrl: 'ui/nav/nav.html'\r\n  };\r\n});","angular.module('dnsim').controller('SetupCtrl', \r\n  ['$scope','$window','$route','$timeout','translations','dntInit','dntReset','region',\r\n   function($scope, $window, $route, $timeout, translations, dntInit, dntReset, region) {\r\n  'use strict';\r\n     \r\n  document.body.className = 'default-back';\r\n  $window.document.title = 'dngearsim | SETUP';\r\n  \r\n  $scope.advancedSetup = false;\r\n  $scope.isLoading = translations.startedLoading && !translations.isLoaded();\r\n  $scope.translationResults = [];\r\n  $scope.hostedFiles = region.hostedFiles;\r\n  \r\n  var noLocation = '';\r\n  var sessionLocation = region.alternativeFiles.url;\r\n  if(sessionLocation == null) {\r\n    sessionLocation = noLocation;\r\n  }\r\n  \r\n  $scope.location = sessionLocation;\r\n  if($scope.location == noLocation) {\r\n    $scope.testResults = ['No location set'];\r\n  }\r\n  else {\r\n    $scope.testResults = ['Using location ' + $scope.location];\r\n  }\r\n  \r\n  $scope.setLocation = function(url) {\r\n    $scope.location = url;\r\n    $scope.isLoading = true;\r\n    $scope.saveLocation();\r\n    dntReset();\r\n\r\n    $scope.translationResults = [];\r\n    var existingFile = localStorage.getItem('UIStrings_file');\r\n    if(existingFile == null || existingFile.indexOf(url) == -1) {\r\n      sessionStorage.removeItem('UIStrings');\r\n    }\r\n    translations.reset();\r\n    translations.location = url;\r\n    translations.init(progressTranslations, translationsStatus);\r\n  }\r\n  \r\n  $scope.resetSessionData = function() {\r\n    $scope.testResults = ['session data reset.. reloading page'];\r\n    region.tlocation = null;\r\n    region.dntLocation = null;\r\n    translations.reset();\r\n    sessionStorage.clear();\r\n    localStorage.clear();\r\n    this.saveLocation();\r\n    $timeout(function() {   \r\n      location.hash = '';\r\n      location.reload(true);\r\n    });\r\n  }\r\n  \r\n  $scope.loadUiString = function() {\r\n    $scope.translationResults = [];\r\n    sessionStorage.removeItem('UIStrings');\r\n    dntReset();\r\n    translations.reset();\r\n    translations.location = region.tlocation.url;\r\n    translations.region = region.tlocation.region;\r\n    translations.init(progressTranslations, translationsStatus);\r\n  }\r\n  \r\n  function translationsStatus() {\r\n    progressTranslations('current translations contain words like ' + translations.translate(329) + ', ' + translations.translate(323) + ' and ' + translations.translate(335));\r\n    $scope.isLoading = false;\r\n  }\r\n  \r\n  function progress(msg) {\r\n    $timeout(\r\n      function() {\r\n        if($scope.testResults != null) {\r\n          $scope.testResults.push(msg);\r\n        }\r\n      });\r\n  }\r\n  \r\n  function progressTranslations(msg) {\r\n    $timeout(\r\n      function() {\r\n        if($scope.translationResults != null) {\r\n          $scope.translationResults.push(msg);\r\n        }\r\n      });\r\n  }\r\n  \r\n  $scope.saveLocation = function() {\r\n    dntReset();\r\n    if($scope.location != noLocation) {\r\n      region.setCustomUrl($scope.location);\r\n      \r\n      region.init();\r\n      if(region.alternativeFiles.region == region.tlocation.region) {\r\n        translations.reset();\r\n        translations.init(progressTranslations, translationsStatus);\r\n      }\r\n      $scope.testResults = [\r\n        'Location saved',\r\n        'Using location ' + $scope.location];\r\n    }\r\n  }\r\n  \r\n  $scope.testLocation = function() {\r\n    if($scope.location != noLocation) {\r\n      $scope.testResults = [\r\n        'Using location ' + $scope.location,\r\n        'Loading all data used by the app'];\r\n\r\n      translations.init(progress, function () {\r\n        dntInit(progress);\r\n      });\r\n    }\r\n  }\r\n}]);\r\n","(function () {\r\n'use strict';\r\nangular.module('dnsim').controller('BuildSearchCtrl', ['$routeParams','$location','$timeout','onlineService','jobs', buildSearch]);\r\n\r\nfunction buildSearch($routeParams,$location,$timeout,onlineService,jobs) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.maxDisplay = 15;\r\n  vm.totalNumResults = 0;\r\n  \r\n  jobs.init(null, function() {\r\n    if($routeParams.jobId) {\r\n      vm.job = jobs.getById($routeParams.jobId);\r\n      getClassBuilds();\r\n    } \r\n  })\r\n  \r\n  this.setJob = function() {\r\n    $timeout(function() {\r\n      $location.search('jobId', vm.job.id);\r\n    });\r\n  }\r\n  \r\n  this.showMoreResults = function(extra) {\r\n    vm.maxDisplay = vm.totalNumResults + extra;\r\n    vm.totalNumResults = 0;\r\n  }\r\n  \r\n  vm.allResults = null;\r\n  vm.getFilteredBuilds = function() {\r\n    \r\n    // init\r\n    if(vm.allResults == null) {\r\n      vm.allResults = [];\r\n      for(var uid in vm.jobBuilds) {\r\n        for(var buildName in vm.jobBuilds[uid]) {\r\n          vm.allResults.push({\r\n            uid: uid,\r\n            name: buildName,\r\n            data: vm.jobBuilds[uid][buildName]\r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    var results = [];\r\n    for(var i=0;i<vm.allResults.length;++i) {\r\n      \r\n      var result = vm.allResults[i];\r\n      if(vm.filter && vm.filter.length > 0) {\r\n        var f = vm.filter.toUpperCase();\r\n        if(result.name.toUpperCase().indexOf(f) == -1) {\r\n          if(!result.data.guild ||\r\n             result.data.guild.toUpperCase().indexOf(f) == -1) {\r\n\r\n            continue;\r\n          }\r\n        }\r\n      }\r\n      \r\n      results.push(result);\r\n\r\n      if(results.length >= vm.maxDisplay) {\r\n        break;\r\n      }\r\n    }\r\n    \r\n    vm.totalNumResults = results.length;\r\n    return results;\r\n  }\r\n  \r\n  function getClassBuilds() {\r\n    if(vm.job) {\r\n      onlineService.getClassBuilds(vm.job).then(function(builds) {\r\n        if(builds) {\r\n          // console.log('got builds', builds);\r\n          vm.jobBuilds = builds;\r\n        }\r\n        else {\r\n          // console.log('no builds');\r\n          vm.jobBuilds = {};\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim').controller('ProfileCtrl', ['$location', '$routeParams', 'onlineService', profile]);\r\n\r\nfunction profile($location, $routeParams, onlineService, saveHelper) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  vm.uid = $routeParams.uid;\r\n  \r\n  getSavedBuilds();\r\n  getProfile();\r\n  \r\n  function getSavedBuilds() {\r\n    onlineService.getUserBuilds(vm.uid).then(function(builds) {\r\n      if(builds) {\r\n        vm.storedBuilds = builds;\r\n      }\r\n      else {\r\n        vm.storedBuilds = {};\r\n      }\r\n    });\r\n  }\r\n  \r\n  function getProfile() {\r\n    onlineService.getProfile(vm.uid).then(function(profile) {\r\n      if(profile) {\r\n        vm.profile = profile;\r\n      }\r\n      else {\r\n        vm.profile = {};\r\n      }\r\n    });\r\n  }\r\n  \r\n  this.load = function(buildName, build) {\r\n\r\n    var newGroupName = saveHelper.importGroup(buildName, build.items);\r\n    \r\n    saveHelper.saveBuild(\r\n      newGroupName, \r\n      newGroupName,\r\n      build);\r\n      \r\n    vm.builds = saveHelper.getSavedItems();\r\n    \r\n    $location.path('/build');\r\n    $location.search('buildName', newGroupName);\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim').controller('PublishCtrl', ['$location', 'saveHelper', 'onlineService', '$routeParams', 'region', publish]);\r\n\r\nfunction publish($location, saveHelper, onlineService, $routeParams, region) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.show = $routeParams.show;\r\n  \r\n  onlineService.login().then(function(user) {\r\n    getSavedBuilds();\r\n    getProfile();\r\n  \r\n    vm.builds = saveHelper.getSavedItems();\r\n  });\r\n  \r\n  function getSavedBuilds() {\r\n    var user = vm.getUser();\r\n    if(user) {\r\n      onlineService.getUserBuilds(user.uid).then(function(builds) {\r\n        if(builds) {\r\n          vm.storedBuilds = builds;\r\n        }\r\n        else {\r\n          vm.storedBuilds = {};\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  function getProfile() {\r\n    var user = vm.getUser();\r\n    if(user) {\r\n      onlineService.getProfile(user.uid).then(function(profile) {\r\n        if(profile) {\r\n          vm.profile = profile;\r\n        }\r\n        else {\r\n          vm.profile = {};\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  this.saveProfile = function() {\r\n    onlineService.saveProfile(vm.profile).then(getProfile).catch(handleError);\r\n  }\r\n  \r\n  this.getUser = function() {\r\n    return onlineService.getUser();\r\n  }\r\n  \r\n  this.save = function(buildName, build) {\r\n    build.lastUpdate = (new Date()).getTime();\r\n    onlineService.saveBuild(buildName, build).then(getSavedBuilds).catch(handleError);\r\n    vm.publishBuild = null;\r\n  }\r\n  \r\n  this.startPublish = function(buildName) {\r\n    if(buildName in vm.storedBuilds) {\r\n      if(!vm.builds[buildName].region) {\r\n        vm.builds[buildName].region = vm.storedBuilds[buildName].region;\r\n      }\r\n      \r\n      if(!vm.builds[buildName].about) {\r\n        vm.builds[buildName].about = vm.storedBuilds[buildName].about;\r\n      }\r\n      \r\n      if(!vm.builds[buildName].guild) {\r\n        vm.builds[buildName].guild = vm.storedBuilds[buildName].guild;\r\n      }\r\n    }\r\n    \r\n    if(!vm.builds[buildName].region) {\r\n      vm.builds[buildName].region = region.dntLocation.region;\r\n    }\r\n    \r\n    vm.publishBuild = buildName;\r\n  }\r\n  \r\n  function handleError(err) {\r\n    console.log(err);\r\n  }\r\n  \r\n  this.deleteAccount = function() {\r\n    onlineService.deleteAccount(vm.storedBuilds);\r\n  }\r\n  \r\n  this.getBuildLimit = function() {\r\n    if(vm.profile && vm.profile.maxBuilds) {\r\n      return vm.profile.maxBuilds;\r\n    }\r\n    else {\r\n      return 15;\r\n    }\r\n  }\r\n  \r\n  this.getNumStoredBuilds = function() {\r\n    return _.size(vm.storedBuilds);\r\n  }\r\n  \r\n  this.getNumBuilds = function() {\r\n    return _.size(vm.builds);\r\n  }\r\n  \r\n  this.load = function(buildName, build) {\r\n\r\n    var newGroupName = saveHelper.importGroup(buildName, build.items);\r\n    \r\n    saveHelper.saveBuild(\r\n      newGroupName, \r\n      newGroupName,\r\n      build);\r\n      \r\n    vm.builds = saveHelper.getSavedItems();\r\n  }\r\n  \r\n  this.signOut = function() {\r\n    onlineService.signOut();\r\n  }\r\n  \r\n  vm.deleteLocal = function(buildName) {\r\n    vm.localToDelete = buildName;\r\n  }\r\n  \r\n  vm.getAllBuildNames = function() {\r\n    var allKeys = _.keys(vm.builds).concat(_.keys(vm.storedBuilds));\r\n    return _.uniq(allKeys.sort(), true);\r\n  }\r\n  \r\n  vm.reallyDeleteLocal = function(buildName) {\r\n    saveHelper.updatedSavedItems(buildName, []);\r\n    vm.localToDelete = null;\r\n    vm.builds = saveHelper.getSavedItems();\r\n  }\r\n  \r\n  vm.deleteServer = function(buildName) {\r\n    vm.serverToDelete = buildName;\r\n  }\r\n  \r\n  vm.reallyDeleteServer = function(buildName) {\r\n    onlineService.deleteBuild(buildName, vm.storedBuilds[buildName]).then(getSavedBuilds);\r\n    vm.serverToDelete = null;\r\n  }\r\n  \r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim').controller('PublishedCtrl', ['onlineService', '$location', '$routeParams', 'saveHelper', 'statHelper', published]);\r\n\r\nfunction published(onlineService, $location, $routeParams, saveHelper, statHelper) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  vm.uid = $routeParams.uid;\r\n  vm.buildName = $routeParams.buildName;\r\n  \r\n  getBuild();\r\n  getProfile();\r\n  \r\n  vm.copyLocally = function() {\r\n    var newGroupName = saveHelper.importGroup(vm.buildName, vm.build.items);\r\n    \r\n    saveHelper.saveBuild(\r\n      newGroupName, \r\n      newGroupName,\r\n      vm.build);\r\n      \r\n    $location.path('/build');\r\n    $location.search('buildName', newGroupName);\r\n  }\r\n  \r\n  function getProfile() {\r\n    onlineService.getProfile(vm.uid).then(function(profile) {\r\n      if(profile) {\r\n        vm.profile = profile;\r\n      }\r\n      else {\r\n        vm.profile = {};\r\n      }\r\n    });\r\n  }\r\n  \r\n  function getBuild() {\r\n    onlineService.getBuild(vm.uid, vm.buildName).then(function(build) {\r\n      if(build) {\r\n        vm.build = build;\r\n        vm.stats = statHelper.getBuildStats(build);\r\n      }\r\n      else {\r\n        vm.build = {};\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n})();","angular.module('dnsim').controller('RegionCtrl', \r\n  ['$timeout','$route','$routeParams','$location','translations','region','$http',\r\n  function($timeout,$route,$routeParams,$location,translations,region,$http) {\r\n    'use strict';\r\n    \r\n    var vm = this;\r\n\r\n    vm.override = region.getOverride();\r\n    region.init();\r\n    translations.init(\r\n      function(msg) { \r\n        // console.log(msg);\r\n      }, \r\n      function() {\r\n        $timeout();\r\n      });\r\n      \r\n    vm.region = region;\r\n    vm.tHoverLocation = region.tlocation;\r\n    vm.hoverLocation = region.dntLocation;\r\n    vm.edit = (region.dntLocation == null);\r\n    vm.dntVersion = '';\r\n    setDntVersion();\r\n    \r\n    function setDntVersion() {\r\n      // console.log('setting version for ', vm.region.dntLocation);\r\n      if(vm.region.dntLocation && vm.region.dntLocation.url) {\r\n        $http.get(vm.region.dntLocation.url + '/Version.cfg').then(function(res) {\r\n          if(res && res.data) {\r\n            var newLineDetails = res.data.split('\\r\\n');\r\n            if(newLineDetails.length) {\r\n              var spaceDetails = newLineDetails[0].split(' ');\r\n              if(spaceDetails.length > 1) {\r\n                vm.dntVersion = 'v' + spaceDetails[1];\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    vm.getDntLocation = function() {\r\n      return region.dntLocation;\r\n    };\r\n    vm.getTlocation = function() {\r\n      return region.tlocation;\r\n    };\r\n     \r\n    vm.getHostedFiles = function() {\r\n      // console.log('getting hosted files');\r\n      return region.hostedFiles;\r\n    };\r\n    \r\n    vm.getWorldName = function() {\r\n      if(translations.isLoaded()) {\r\n        return translations.translate(10169);\r\n      }\r\n      else {\r\n        return '';\r\n      }\r\n    };\r\n    \r\n    vm.setTLocation = function(location) {\r\n      region.setTLocation(location);\r\n      vm.edit = false;\r\n    };\r\n    \r\n    vm.setLocation = function(location) {\r\n      if(!vm.override) {\r\n        vm.setTLocation(null);\r\n      }\r\n      \r\n      if($routeParams.region) {\r\n        $routeParams.region = location.region;\r\n        $route.updateParams($routeParams);\r\n        $route.reload();\r\n      }\r\n      else {\r\n        region.setLocation(location);\r\n      }\r\n      vm.edit = false;\r\n      setDntVersion();\r\n    };\r\n    \r\n    vm.setOverride = function(value) {\r\n      region.setOverride(value);\r\n      vm.override = value;\r\n      vm.edit = value;\r\n    };\r\n  }\r\n])\r\n.directive('dngearsimRegion', function() {\r\n  return {\r\n    templateUrl: 'ui/region/region.html',\r\n    controllerAs: 'ctrl',\r\n  };\r\n});","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dngearsimCustomItems', function() {\r\n  return {\r\n    scope: {},\r\n    bindToController: {\r\n    },\r\n    controller: ['$window','saveHelper','$location','hCodeValues','itemCategory','$timeout', customItemCtrl],\r\n    controllerAs: 'customItems',\r\n    templateUrl: 'ui/search/custom-items.html'\r\n  };\r\n});\r\n\r\nfunction customItemCtrl($window,saveHelper,$location,hCodeValues,itemCategory,$timeout) {\r\n  'use strict';\r\n\r\n  var vm = this;\r\n  \r\n  this.customItems = hCodeValues.customItems;\r\n  \r\n  this.maxDisplay = 10;\r\n  this.currentResults = 0;\r\n  \r\n  if(this.nameSearch == null) {\r\n    this.nameSearch = '';\r\n  }\r\n  \r\n  this.getResults = function() {\r\n    return this.customItems;\r\n  }\r\n  \r\n  this.getNewStatName = function() {\r\n    if(this.nameSearch == '' || this.nameSearch == null) {\r\n      return 'unnamed custom item';\r\n    }\r\n    else {\r\n      return this.nameSearch;\r\n    }\r\n  }\r\n  \r\n  this.createCustomItem = function() {\r\n    if(this.nameSearch == '' || this.nameSearch == null) {\r\n      this.nameSearch = this.getNewStatName();\r\n    }\r\n    $location.path('/item/_custom:.' + this.nameSearch);\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dngearsimEverythingSearch', function() {\r\n  return {\r\n    scope: {},\r\n    bindToController: {\r\n      nameSearch: '=nameSearch'\r\n    },\r\n    controller: everythingSearchCtrl,\r\n    controllerAs: 'items',\r\n    templateUrl: 'ui/search/everything-search.html'\r\n  };\r\n});\r\n\r\n\r\nfunction everythingSearchCtrl ($window, $timeout, $routeParams, $location, hCodeValues, region, translations, dntData) {\r\n    \r\n  var vm = this;\r\n  \r\n  vm.everything = null;\r\n  vm.maxDisplay = 32;\r\n  vm.currentResults = 0;\r\n  vm.results = null;\r\n  vm.minLevel = 1;\r\n  vm.maxLevel = 99;\r\n  vm.version = 'all';\r\n  vm.versions = [vm.version];\r\n  \r\n  var minLevel = Number(localStorage.getItem('minLevel'));\r\n  if($routeParams.minLevel) {\r\n    minLevel = Number($routeParams.minLevel);\r\n  }\r\n  if(minLevel > 0 && minLevel < 100) {\r\n    vm.minLevel = minLevel;\r\n  }\r\n  vm.origMinLevel = minLevel;\r\n  \r\n  var maxLevel = Number(localStorage.getItem('maxLevel'));\r\n  if($routeParams.maxLevel) {\r\n    maxLevel = Number($routeParams.maxLevel);\r\n  }\r\n  if(maxLevel > 0 && maxLevel < 100) {\r\n    vm.maxLevel = maxLevel;\r\n  }\r\n  vm.origMaxLevel = maxLevel;\r\n\r\n  if(!vm.nameSearch) {\r\n    vm.nameSearch = localStorage.getItem('nameSearch');\r\n    if($routeParams.name) {\r\n      vm.nameSearch = $routeParams.name;\r\n    }\r\n    if(vm.nameSearch == null) {\r\n      vm.nameSearch = '';\r\n    }\r\n  }\r\n  \r\n  $window.document.title = 'dngearsim | ALL ITEM SEARCH';\r\n  \r\n  vm.initeverything = function() {\r\n    if(dntData.isLoaded(fileName) && translations.isLoaded() && !vm.everything) {\r\n      vm.everything = [];\r\n      \r\n      var versionMap = {};\r\n      var datas = dntData.getData(fileName);\r\n      // console.log(datas.length + ' everything');\r\n      for(var i=0;i<datas.length;++i) {\r\n        var data = datas[i];\r\n        if(data.NameID > 0) {\r\n          var item = {\r\n            id: data.id,\r\n            name: translations.translate(data.NameID, data.NameIDParam),\r\n            rank: hCodeValues.rankNames[data.Rank],\r\n            icon: data.IconImageIndex,\r\n            levelLimit: data.LevelLimit,\r\n            fileName: data.fileName,\r\n            version: data.version\r\n          }\r\n          vm.everything.push(item);\r\n\r\n          if(data.version) {\r\n            versionMap[data.version] = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      for(var version in versionMap) {\r\n        vm.versions.push(version);\r\n      }\r\n      \r\n      vm.everything = _.sortBy(vm.everything, 'name');\r\n      \r\n      $timeout(function() {\r\n        vm.showMoreResults();\r\n      });\r\n    }\r\n  }\r\n  \r\n  vm.getResults = function() {\r\n    if(vm.everything == null) {\r\n      vm.initeverything();\r\n    }\r\n    \r\n    if(vm.everything == null) {\r\n      return [];\r\n    }\r\n\r\n    var newResults = [];\r\n    var numeverything = vm.everything.length;\r\n    var curDisplay = 0;\r\n    for(var i=0;i<numeverything && (curDisplay<vm.maxDisplay);++i) {\r\n      var e = vm.everything[i];\r\n\r\n      if(e.levelLimit < vm.minLevel || e.levelLimit > vm.maxLevel || (!e.levelLimit)) {\r\n        continue;\r\n      }\r\n\r\n      if(vm.version != 'all' && vm.version != e.version) {\r\n        continue;\r\n      }\r\n\r\n      if(vm.nameSearch != '') {\r\n        var nameSearches = vm.nameSearch.split(' ');\r\n        if(nameSearches.length == 0) {\r\n          nameSearches = [vm.nameSearch];\r\n        }\r\n        var allMatch = true;\r\n        for(var ns=0;ns<nameSearches.length;++ns) {\r\n          if(e.name && e.name.toString().toUpperCase().indexOf(nameSearches[ns].toUpperCase()) == -1) {\r\n            allMatch = false;\r\n            break;\r\n          }\r\n        }\r\n        \r\n        if(!allMatch) {\r\n          continue;\r\n        }\r\n      }\r\n      \r\n      newResults.push(e);\r\n      curDisplay++;\r\n    }\r\n    \r\n    vm.totalNumResults = newResults.length;\r\n    return newResults;\r\n  }\r\n  \r\n  vm.changeSearch = function() {\r\n    if(vm.minLevel != vm.origMinLevel) {\r\n      localStorage.setItem('minLevel', vm.minLevel);\r\n      $location.search('minLevel', vm.minLevel);\r\n      vm.origMinLevel = vm.minLevel;\r\n    }\r\n    \r\n    if(vm.maxLevel != vm.origMaxLevel) {\r\n      localStorage.setItem('maxLevel', vm.maxLevel);\r\n      $location.search('maxLevel', vm.maxLevel);\r\n      vm.origMaxLevel = vm.maxLevel;\r\n    }\r\n\r\n    localStorage.setItem('nameSearch', vm.nameSearch);\r\n    $location.search('name', vm.nameSearch);\r\n    \r\n    vm.maxDisplay = 64;\r\n    vm.results = vm.getResults();\r\n  }\r\n\r\n  vm.showMoreResults = function() {\r\n    $timeout(function() {\r\n      // console.log('show more', vm.maxDisplay);\r\n      vm.maxDisplay += 18;\r\n      vm.results = vm.getResults();\r\n    });\r\n  }\r\n\r\n  var fileName = 'all-items.lzjson';  \r\n  dntData.init(fileName, null, function() {}, function() {\r\n    vm.initeverything();\r\n  }, false);\r\n\r\n  translations.init(null, vm.initeverything);\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n\r\nvar controllerParams = ['$scope','$window','$routeParams','$timeout','$location','$route',\r\n'translations',\r\n'itemCategory',\r\n'jobs',\r\n'hCodeValues',\r\n'itemFactory',\r\n'region',\r\n'saveHelper', itemSearchCtrl];\r\n\r\nangular.module('dnsim').controller('ItemSearchCtrl', controllerParams);\r\n\r\nfunction itemSearchCtrl(\r\n  $scope,$window,$routeParams,$timeout,$location,$route,\r\n  translations,\r\n  itemCategory,\r\n  jobs,\r\n  hCodeValues,\r\n  itemFactory,\r\n  region,\r\n  saveHelper) {\r\n  'use strict';\r\n  \r\n  var vm = this;\r\n  \r\n  vm.itemCategory = itemCategory.byPath($routeParams.cat);\r\n  if(!vm.itemCategory) {\r\n     var catName = localStorage.getItem('selectedItemCategory');\r\n     if(!catName) {\r\n       catName = 'titles';\r\n     }\r\n     \r\n     vm.itemCategory = itemCategory.byName(catName);\r\n     if(!vm.itemCategory || vm.itemCategory.hideInSearch) {\r\n       catName = 'titles';\r\n       vm.itemCategory = itemCategory.byName('titles');\r\n     }\r\n     if(vm.itemCategory) {\r\n       // console.log('moving');\r\n       $location.search('cat', vm.itemCategory.path);\r\n       $route.reload();\r\n     }\r\n     return;\r\n  }\r\n  \r\n  \r\n  $window.document.title = 'dngearsim | SEARCH ' + vm.itemCategory.name.toUpperCase();\r\n  \r\n  vm.job = {id: -1, name: ''};\r\n  vm.jobs = [vm.job];\r\n  vm.allJobs = [];\r\n  vm.minLevel = 1;\r\n  vm.maxLevel = 99;\r\n  vm.maxDisplay = 10;\r\n  vm.totalNumResults = 0;\r\n  vm.grades = hCodeValues.rankNames;\r\n  vm.stat = {id:-1, name:''};\r\n  vm.stats = [vm.stat];\r\n  vm.results = null;\r\n  \r\n  angular.forEach(hCodeValues.stats, function(stat, statId) {\r\n    if(stat.searchable) {\r\n      vm.stats.push(stat);\r\n    }\r\n  });\r\n  \r\n  var minLevel = Number(localStorage.getItem('minLevel'));\r\n  if($routeParams.minLevel) {\r\n    minLevel = Number($routeParams.minLevel);\r\n  }\r\n  if(minLevel > 0 && minLevel < 100) {\r\n    vm.minLevel = minLevel;\r\n  }\r\n  vm.origMinLevel = minLevel;\r\n  \r\n  var maxLevel = Number(localStorage.getItem('maxLevel'));\r\n  if($routeParams.maxLevel) {\r\n    maxLevel = Number($routeParams.maxLevel);\r\n  }\r\n  if(maxLevel > 0 && maxLevel < 100) {\r\n    vm.maxLevel = maxLevel;\r\n  }\r\n  vm.origMaxLevel = maxLevel;\r\n  \r\n  vm.nameSearch = localStorage.getItem('nameSearch');\r\n  if($routeParams.name) {\r\n    vm.nameSearch = $routeParams.name;\r\n  }\r\n  if(!vm.nameSearch) {\r\n    vm.nameSearch = '';\r\n  }\r\n  \r\n  vm.origSavedSearchStatId = localStorage.getItem('searchStat');\r\n  if($routeParams.stat) {\r\n    vm.origSavedSearchStatId = $routeParams.stat;\r\n  }\r\n  if(vm.origSavedSearchStatId > -1 && vm.origSavedSearchStatId in hCodeValues.stats) {\r\n    vm.stat = hCodeValues.stats[vm.origSavedSearchStatId];\r\n  }\r\n\r\n  vm.navigate = function() {\r\n    var catName = localStorage.getItem('selectedItemCategory');\r\n    if(catName) {\r\n      vm.itemCategory = itemCategory.byName(catName);\r\n      if(vm.itemCategory) {\r\n        // console.log('navigating to ', vm.itemCategory.path);\r\n        $location.search('cat', vm.itemCategory.path);\r\n        vm.save();\r\n        $route.reload();\r\n      }\r\n    }\r\n  }\r\n\r\n  vm.save = function() {\r\n    if(!vm.itemCategory.hideLevel) {\r\n      if(vm.minLevel != vm.origMinLevel) {\r\n        localStorage.setItem('minLevel', vm.minLevel);\r\n        $location.search('minLevel', vm.minLevel);\r\n        vm.origMinLevel = vm.minLevel;\r\n      }\r\n      \r\n      if(vm.maxLevel != vm.origMaxLevel) {\r\n        localStorage.setItem('maxLevel', vm.maxLevel);\r\n        $location.search('maxLevel', vm.maxLevel);\r\n        vm.origMaxLevel = vm.maxLevel;\r\n      }\r\n    }\r\n    else {\r\n      $location.search('minLevel', null);\r\n      $location.search('maxLevel', null);\r\n    }\r\n    \r\n    if(!vm.itemCategory.hideJob) {\r\n      if(vm.job != null) {\r\n        if(vm.origJobNumber != vm.job.id) {\r\n          localStorage.setItem('jobNumber', vm.job.id);\r\n          if(vm.job.id > -1) {\r\n            $location.search('job', vm.job.id);\r\n          }\r\n          else {\r\n            $location.search('job', null);\r\n          }\r\n          vm.origJobNumber = vm.job.id;\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      $location.search('job', null);\r\n    }\r\n  \r\n    if(vm.stat) {\r\n      if(vm.origSavedSearchStatId != vm.stat.id) {\r\n        localStorage.setItem('searchStat', vm.stat.id);\r\n        if(vm.stat.id > -1) {\r\n          $location.search('stat', vm.stat.id);\r\n        }\r\n        else {\r\n          $location.search('stat', null);\r\n        }\r\n        \r\n        vm.origSavedSearchStatId = vm.stat.id;\r\n      }\r\n    }\r\n\r\n    localStorage.setItem('nameSearch', vm.nameSearch);\r\n    $location.search('name', vm.nameSearch);\r\n  };\r\n  \r\n  function init() {\r\n    jobs.init(reportProgress, jobInit);\r\n  }\r\n  \r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n  \r\n  function jobInit() {\r\n    // console.log('called the job init func');\r\n    if(translations.isLoaded() && jobs.isLoaded()) {\r\n      // console.log('trying to init jobs');\r\n      // console.log('job dropdown should be set');\r\n      var newJobs = jobs.getFinalJobs();\r\n\r\n      newJobs.splice(0, 0, vm.jobs[0]);\r\n      vm.jobs = newJobs;\r\n      vm.allJobs = jobs.getAllJobs();\r\n      \r\n      var lastJobNumber = Number(localStorage.getItem('jobNumber'));\r\n      if($routeParams.job && $routeParams.job) {\r\n        lastJobNumber = Number($routeParams.job);\r\n      }\r\n      if(lastJobNumber != null) {\r\n        angular.forEach(newJobs, function(value, key) {\r\n          if(value.id == lastJobNumber) {\r\n            vm.job = value;\r\n            return;\r\n          }\r\n        });\r\n      }\r\n\r\n      itemCategory.init(vm.itemCategory.name, loadResults);\r\n    }\r\n  }\r\n  \r\n  vm.rankChecked = hCodeValues.checkedRank;\r\n    \r\n  vm.changeSearch = function() {\r\n    vm.save();\r\n    loadResults();\r\n  }\r\n  \r\n  function loadResults() {\r\n    vm.maxDisplay = 24;\r\n    vm.results = getResults();\r\n  }\r\n  \r\n  function getResults() {\r\n    var allItems = itemCategory.getItems(vm.itemCategory.name);\r\n    if(allItems == null) {\r\n      return null;\r\n    }\r\n    \r\n    allItems = allItems.sort(function(item1, item2) {\r\n        return (item2.levelLimit - item1.levelLimit);\r\n      });\r\n          \r\n    var pcStatId = -1;\r\n    if('pc' in vm.stat) {\r\n      pcStatId = vm.stat.pc;\r\n    }\r\n          \r\n    var altStatId = -1;\r\n    if('altStat' in vm.stat) {\r\n      altStatId = vm.stat.altStat;\r\n    }\r\n  \r\n    var statVals = [];\r\n    var newResults = [];\r\n    var numEquip = allItems.length;\r\n    var curDisplay = 0;\r\n    for(var i=0;i<numEquip && (curDisplay<vm.maxDisplay || vm.stat.id >= 0);++i) {\r\n      var e = allItems[i];\r\n      if(e) {\r\n        \r\n        if(!vm.itemCategory.hideLevel) {\r\n          if(e.levelLimit < vm.minLevel || e.levelLimit > vm.maxLevel) {\r\n            continue;\r\n          }\r\n        }\r\n          \r\n        if(!vm.itemCategory.hideRank) {\r\n          if(e.rank && !vm.rankChecked[e.rank.id]) {\r\n            continue;\r\n          }\r\n        }\r\n          \r\n        if(!vm.itemCategory.hideJob) {\r\n          if(vm.job && vm.job.id > -1) {\r\n            if(!vm.job.isClassJob(e.needJobClass)) {\r\n              continue;\r\n            }\r\n          }\r\n        }\r\n        \r\n        itemFactory.initItem(e);\r\n        if(e.typeName != vm.itemCategory.name) {\r\n          continue;\r\n        }\r\n        // console.log('name filter', vm.nameSearch); \r\n        \r\n        if(vm.nameSearch != '') {\r\n          // console.log('filtering on name');\r\n          var nameSearches = vm.nameSearch.split(' ');\r\n          if(!nameSearches.length) {\r\n            nameSearches = [vm.nameSearch];\r\n          }\r\n          var allMatch = true;\r\n          for(var ns=0;ns<nameSearches.length;++ns) {\r\n            if(e.name.toUpperCase().indexOf(nameSearches[ns].toUpperCase()) == -1) {\r\n              allMatch = false;\r\n              break;\r\n            }\r\n          }\r\n          \r\n          if(!allMatch) {\r\n            continue;\r\n          }\r\n        }\r\n        \r\n        if(vm.stat.id >= 0) {\r\n          var statFound = false;\r\n          \r\n          var statVal = {};\r\n          for(var s=0;s<e.stats.length;++s) {\r\n            var stat = e.stats[s];\r\n            if(stat.id == vm.stat.id) {\r\n              statFound = true;\r\n              statVal.i = curDisplay;\r\n              statVal.s = Number(stat.max);\r\n              break;\r\n            }\r\n            else if(stat.id == pcStatId) {\r\n              statFound = true;\r\n              statVal.i = curDisplay;\r\n              statVal.s = Number(stat.max);\r\n            }\r\n            else if(stat.id == altStatId) {\r\n              statFound = true;\r\n              statVal.i = curDisplay;\r\n              statVal.s = Number(stat.max);\r\n            }\r\n          }\r\n          \r\n          if(!statFound) {\r\n            continue;\r\n          }\r\n          else {\r\n            statVals.push(statVal);\r\n          }\r\n        }\r\n        \r\n        newResults.push(e);\r\n        curDisplay++;\r\n      }\r\n    }\r\n    \r\n    if(vm.stat.id >= 0) {\r\n      \r\n      var currentResults = Math.min(curDisplay, vm.maxDisplay);\r\n      \r\n      statVals = statVals.sort(function(value1, value2) {\r\n        return value2.s - value1.s;\r\n      });\r\n      \r\n      var statResults = [];\r\n      for(var i=0;i<currentResults;++i) {\r\n        statResults.push(newResults[statVals[i].i]);\r\n      }\r\n      newResults = statResults;\r\n    }\r\n    \r\n    vm.totalNumResults = newResults.length;\r\n    \r\n    return newResults;\r\n  }\r\n\r\n  vm.showMoreResults = function() {\r\n    $timeout(function() {\r\n      vm.maxDisplay += 18;\r\n      vm.results = getResults();\r\n    });\r\n  }\r\n  \r\n  region.init();\r\n  translations.init(reportProgress, init);\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dngearsimSkillSearch', function() {\r\n  return {\r\n    scope: {},\r\n    bindToController: {\r\n      job: '=job',\r\n      jobs: '=jobs',\r\n    },\r\n    controller: ['$window','$timeout','saveHelper','region','jobs','translations','dntData','hCodeValues','itemCategory','$location', skillSearchCtrl],\r\n    controllerAs: 'skillSearch',\r\n    templateUrl: 'ui/search/skill-search.html'\r\n  };\r\n});\r\n\r\nfunction skillSearchCtrl($window,$timeout,saveHelper, region, jobs, translations,dntData,hCodeValues,itemCategory,$location) {\r\n\r\n  var vm = this;\r\n  \r\n  vm.allJobs = [];\r\n  vm.dntName = '';\r\n  vm.skills = [];\r\n  vm.loadedJobId = -1;\r\n\r\n  vm.itemCategory = itemCategory.byName('skills');\r\n\r\n  vm.nameSearch = localStorage.getItem('nameSearch');\r\n  if(!vm.nameSearch) {\r\n    vm.nameSearch = '';\r\n  }\r\n  \r\n  region.init();\r\n  if(translations.isLoaded()) {\r\n    init();\r\n  }\r\n  else {\r\n    translations.init(reportProgress, function() { $timeout(init); } );\r\n  }\r\n\r\n  vm.navigate = function() {\r\n    $timeout(function() {\r\n      if(vm.itemCategory) {\r\n        $location.path(vm.itemCategory.path);\r\n      }\r\n    });\r\n  }\r\n  \r\n  vm.isLoading = function() {\r\n    \r\n    if(!translations.isLoaded()) {\r\n      // console.log('transations not loaded');\r\n      if(!translations.startedLoading) {\r\n        translations.init(reportProgress, function() { } );\r\n      }\r\n\r\n      return true;\r\n    }\r\n    \r\n    var baseName = jobs.getBaseJobName(vm.job);\r\n    var dntName = getDntName(baseName);\r\n    if(dntName) {\r\n      if(!dntData.isLoaded(dntName)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  };\r\n  \r\n  function getDntName(baseClassName) {\r\n    // console.log('got base class :' + baseClassName);\r\n    if(baseClassName != null) {\r\n      return 'skilltable_character' + baseClassName.toLowerCase() + '.lzjson';\r\n    }\r\n    else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  function getSkills() {\r\n    // console.log('getting skills for ' + vm.job.name);\r\n    if(vm.loadedJobId == vm.job.id) {\r\n      return vm.skills;\r\n    }\r\n    else {\r\n      \r\n      var baseJobNames = [];\r\n      if(vm.job.id >= 0) {\r\n        var baseName = jobs.getBaseJobName(vm.job);\r\n        baseJobNames.push(baseName);\r\n      }\r\n\r\n      angular.forEach(baseJobNames, function(baseName, index) {\r\n        var dntName = getDntName(baseName);\r\n        if(dntName) {\r\n          if(!dntData.isLoaded(dntName)) {\r\n            // console.log('loading skills for ' + baseName);\r\n            dntData.init(dntName, null, reportProgress, function() { $timeout(function() { setupSkills(baseJobNames, vm.job);} ); });\r\n          }\r\n          else {\r\n            setupSkills(baseJobNames, vm.job);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  function setupSkills(baseJobNames, job) {\r\n    \r\n    vm.skills = [];\r\n    var allReady = true;\r\n    angular.forEach(baseJobNames, function(baseName, index) {\r\n      var dntName = getDntName(baseName);\r\n      if(!dntData.isLoaded(dntName)) {\r\n        allReady = false;\r\n      }\r\n    });\r\n    \r\n    if(allReady) {\r\n      angular.forEach(baseJobNames, function(baseName, index) {\r\n        var dntName = getDntName(baseName);\r\n      \r\n        var skills = dntData.getData(dntName);\r\n        var numSkills = skills.length;\r\n        for(var s=0;s<numSkills;++s) {\r\n          if(skills[s].NameID == 0) {\r\n            continue;\r\n          }\r\n          \r\n          if(skills[s].EffectClass1 > 0 || \r\n             skills[s].EffectClass2 > 0 || \r\n             skills[s].EffectClass3 > 0 || \r\n             skills[s].EffectClass4 > 0 ||\r\n             skills[s].EffectClass5 > 0 ||  \r\n             skills[s].EffectClass6 > 0) {\r\n               \r\n            var newItem = {d: skills[s]};\r\n            \r\n            newItem.id = skills[s].id;\r\n            newItem.typeName = 'skills';\r\n            newItem.itemSource = 'skills';\r\n            newItem.name = translations.translate(skills[s].NameID, skills[s].NameIDParam);\r\n            newItem.needJobClass = skills[s].NeedJob;\r\n            newItem.rank = hCodeValues.rankNames[0];\r\n            newItem.baseJobName = baseName.toLowerCase();\r\n            newItem.icon = skills[s].IconImageIndex;\r\n            \r\n            vm.skills.push(newItem);\r\n          }\r\n        }\r\n      });\r\n  \r\n      vm.loadedJobId = job.id;\r\n    }\r\n  }\r\n  \r\n  vm.getResults = function() {\r\n    \r\n    var skills = getSkills();\r\n    if(skills == null) {\r\n      return [];\r\n    }\r\n    \r\n    if(vm.job && vm.job.id >= 0) {\r\n      localStorage.setItem('jobNumber', vm.job.id);\r\n    }\r\n    localStorage.setItem('nameSearch', vm.nameSearch);\r\n\r\n    var newResults = [];\r\n    var numSkills = skills.length;\r\n    var curDisplay = 0;\r\n    for(var i=0;i<numSkills;++i) {\r\n      var e = skills[i];\r\n      \r\n      if(vm.nameSearch != '') {\r\n        var nameSearches = vm.nameSearch.split(' ');\r\n        if(!nameSearches.length) {\r\n          nameSearches = [vm.nameSearch];\r\n        }\r\n        var allMatch = true;\r\n        for(var ns=0;ns<nameSearches.length;++ns) {\r\n          if(e.name && e.name.toString().toUpperCase().indexOf(nameSearches[ns].toUpperCase()) == -1) {\r\n            allMatch = false;\r\n            break;\r\n          }\r\n        }\r\n        \r\n        if(!allMatch) {\r\n          continue;\r\n        }\r\n      }\r\n      \r\n      if(vm.job.id >= 0 && !vm.job.isClassJob(e.needJobClass)) {\r\n        continue;\r\n      }\r\n      \r\n      newResults.push(e);\r\n    }\r\n    return newResults;\r\n  }\r\n  \r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n  \r\n  function jobInit() {\r\n    if(translations.isLoaded() && jobs.isLoaded()) {\r\n      var newJobs = jobs.getFinalJobs();\r\n\r\n      if(vm.jobs && vm.jobs.length) {\r\n        newJobs.splice(0, 0, vm.jobs[0]);\r\n      }\r\n      vm.jobs = newJobs;\r\n      vm.allJobs = jobs.getAllJobs();\r\n      \r\n      var lastJobNumber = Number(localStorage.getItem('jobNumber'));\r\n      // console.log('using job', lastJobNumber);\r\n      if(lastJobNumber != null) {\r\n        angular.forEach(newJobs, function(value, key) {\r\n          if(value.id == lastJobNumber) {\r\n            vm.job = value;\r\n            // console.log('using job', value);\r\n            return;\r\n          }\r\n        });\r\n      }\r\n      \r\n      vm.getResults();\r\n    }\r\n  }\r\n  \r\n  function init() {\r\n    // console.log('skill init');\r\n    if(jobs.isLoaded()) {\r\n      $timeout(jobInit);\r\n    }\r\n    else {\r\n      jobs.init(reportProgress, function() { $timeout(jobInit); } );\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimChooseClass', chooseClass);\r\n\r\nfunction chooseClass() {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {},\r\n    bindToController: {\r\n      job: '=job',\r\n      onSetJob: '&onSetJob'\r\n    },\r\n    templateUrl: 'ui/widgets/choose-class.html',\r\n    controllerAs: 'ctrl',\r\n    controller: [\r\n      '$window','$location','$routeParams','$timeout','saveHelper','dntData','jobs','hCodeValues','itemColumnsToLoad','character', \r\n      chooseClassController],\r\n  };\r\n}\r\n\r\nfunction chooseClassController($window,$location,$routeParams,$timeout,saveHelper,dntData,jobs,hCodeValues,itemColumnsToLoad,character) {\r\n  this.getFinalJobs = function() {\r\n    var allJobs = jobs.getFinalJobs();\r\n    var finalJobs = [];\r\n    for(var j=0;j<allJobs.length;++j) {\r\n      if(jobs.getBaseJobName(allJobs[j]) == this.bJob) {\r\n        finalJobs.push(allJobs[j]);\r\n      }\r\n    }\r\n    return finalJobs;\r\n  }\r\n  \r\n  this.getBaseJobs = function() {\r\n    return jobs.getBaseJobs();\r\n  }\r\n  \r\n  this.getJobName = function(englishName) {\r\n    var allJobs = jobs.getAllJobs();\r\n    for(var j=0;j<allJobs.length;++j) {\r\n      if(allJobs[j].d.EnglishName == englishName) {\r\n        return allJobs[j].name;\r\n      }\r\n    }\r\n  }\r\n  \r\n  this.setJob = function(job) {\r\n    this.job = job;\r\n    if(job) {\r\n      this.onSetJob();\r\n    }\r\n  }\r\n  \r\n  \r\n  jobs.init(reportProgress, $timeout);\r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n  \r\nangular.module('dnsim').directive('dnsimCategoryLinks', dnsimCategoryLinks);\r\n\r\nfunction dnsimCategoryLinks() {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {},\r\n    bindToController: {\r\n      collapse: '=collapse',\r\n      cat: '=cat',\r\n      buildScreen: '=buildScreen',\r\n      onChange: '&onChange'\r\n    },\r\n    templateUrl: 'ui/widgets/dnsim-category-links.html',\r\n    controller: dnsimCategoryLinksController,\r\n    controllerAs: 'ctrl',\r\n  };\r\n};\r\n\r\nfunction dnsimCategoryLinksController(itemCategory, $window, translations, $translate) {\r\n\r\n  var vm = this;\r\n\r\n  vm.categories = itemCategory.categories;\r\n  vm.collapsed = true;\r\n\r\n  vm.shouldShow = function(action) {\r\n    if(vm.buildScreen) {\r\n      return !action.hideInBuild;\r\n    }\r\n    else {\r\n      return !action.hideInSearch;\r\n    }\r\n  }\r\n\r\n  vm.isLoading = function() {\r\n    return !translations.loaded;\r\n  }\r\n\r\n  vm.setCategory = function(action) {\r\n    \r\n    if(vm.collapse) {\r\n      // console.log('collapsing cat', action);\r\n      vm.collapsed = !vm.collapsed;\r\n      $window.scrollTo(0, 0);\r\n    }\r\n    \r\n    // console.log('setting cat', action);\r\n    if(vm.cat != action) {\r\n      vm.cat = action;\r\n      localStorage.setItem('selectedItemCategory', action.name);\r\n\r\n      if(vm.onChange) {\r\n        vm.onChange();\r\n      }\r\n    }\r\n  }\r\n\r\n  vm.getName = function(action) {\r\n    if(action.tId) {\r\n      return translations.translate(action.tId).toLowerCase();\r\n    }\r\n    else {\r\n      return $translate.instant(action.name);\r\n    }\r\n  }\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n  \r\nangular.module('dnsim').directive('dnsimItemIcon', ['exportLinkHelper','$location','region', dnsimItemIcon]);\r\n\r\nfunction dnsimItemIcon(exportLinkHelper,$location,region) {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {\r\n      item: '=item',\r\n    },\r\n    templateUrl: 'ui/widgets/dnsim-item-icon.html',\r\n    link: function($scope, element, attrs) {\r\n      \r\n      $scope.$watch('item', function(newValue, oldValue) {\r\n        if (newValue) {\r\n          $scope.iconImage = $scope.getIcon();\r\n        }\r\n      });\r\n      \r\n      $scope.getIcon = function() {\r\n        if($scope.item && $scope.item.icon > 0) {\r\n          var fileIndex = Math.floor($scope.item.icon/200 + 1);\r\n          \r\n          var prefix;\r\n          if($scope.item.typeName == 'skills') {\r\n            prefix = 'skillicon';\r\n          }\r\n          else {\r\n            prefix = 'itemicon';\r\n          }\r\n          \r\n          if(fileIndex > 9) {\r\n            return prefix + fileIndex + '.png';\r\n          }\r\n          else {\r\n            return prefix + '0' + fileIndex + '.png';\r\n          }\r\n        }\r\n        return null;\r\n      }\r\n      \r\n      $scope.iconImage = $scope.getIcon();\r\n      \r\n      $scope.getIconXPostion = function() {\r\n        if($scope.item && $scope.item.icon > 0) {\r\n          return (($scope.item.icon % 10) * 40) + 5;\r\n        }\r\n        return 0;\r\n      }\r\n      \r\n      $scope.getIconYPostion = function() {\r\n        if($scope.item && $scope.item.icon > 0) {\r\n          return (Math.floor(($scope.item.icon % 200) / 10) * 40) + 4;\r\n        }\r\n        return 0;\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n  \r\nangular.module('dnsim').directive('dnsimItemLink', ['exportLinkHelper','$location','region', dnsimItemLink]);\r\n\r\nfunction dnsimItemLink(exportLinkHelper,$location,region) {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {\r\n      item: '=item',\r\n      noClick: '=noClick',\r\n    },\r\n    templateUrl: 'ui/widgets/dnsim-item-link.html',\r\n    link: function($scope, element, attrs) {\r\n      $scope.itemLink = 'item/?region=' + region.dntLocation.region + '&i=' + exportLinkHelper.encodeItem($scope.item);\r\n      // var basePath = angular.element(document.querySelector('base')).attr('href');\r\n      \r\n      $scope.$watch('item', function(newValue, oldValue) {\r\n        if (newValue) {\r\n          $scope.itemLink = 'item/?region=' + region.dntLocation.region + '&i=' + exportLinkHelper.encodeItem($scope.item);\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimJobIcon', [dnsimJobIcon]);\r\n\r\nfunction dnsimJobIcon() {\r\n  return {\r\n    restrict: 'E',\r\n    scope: {},\r\n    bindToController: {\r\n      item: '=item',\r\n      small: '=small'\r\n    },\r\n    templateUrl: 'ui/widgets/dnsim-job-icon.html',\r\n    controller: dnsimJobIconController,\r\n    controllerAs: 'ctrl'\r\n  }\r\n}\r\n\r\nfunction dnsimJobIconController() {\r\n  \r\n  if(this.small) {\r\n    this.sizeValue = '205px 205px';\r\n    this.iconSize = 22;\r\n    this.iconOffset = 0;\r\n  }\r\n  else {\r\n    this.sizeValue = '410px 410px';\r\n    this.iconSize = 44;\r\n    this.iconOffset = 5;\r\n  }\r\n\r\n  this.getIconXPostion = function() {\r\n    if(this.item && this.item.d && this.item.d.JobIcon > 0) {\r\n      return ((this.item.d.JobIcon % 9) * this.iconSize) + this.iconOffset;\r\n    }\r\n    return 0;\r\n  }\r\n  \r\n  this.getIconYPostion = function() {\r\n    if(this.item && this.item.d && this.item.d.JobIcon > 0) {\r\n      return (Math.floor(this.item.d.JobIcon / 9) * this.iconSize) + this.iconOffset;\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimLoading', ['dntData','translations','$timeout', 'region', dnsimLoading]);\r\n\r\nfunction dnsimLoading(dntData, translations, $timeout, region) {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    transclude: true,\r\n    scope: {\r\n      alsoShowFor: '=alsoShowFor',\r\n    },\r\n    templateUrl: 'ui/widgets/dnsim-loading.html',\r\n    link: function($scope, element, attrs) {\r\n      $scope.$on('TRANSLATION_LOAD_EVENT', function() {\r\n        $scope.setLoadCount();\r\n      });\r\n      \r\n      $scope.$on('DNTDATA_LOAD_EVENT', function() {\r\n        $scope.setLoadCount();\r\n      });\r\n      \r\n      $scope.$on('DNTDATA_LOAD_ERROR', function() {\r\n        $timeout(function() {\r\n          $scope.loadError = true;\r\n        });\r\n      });\r\n      \r\n      $scope.$on('TRANSLATION_LOAD_ERROR', function() {\r\n        $timeout(function() {\r\n          $scope.loadError = true;\r\n        });\r\n      });\r\n\r\n      $scope.numLoading = 0;\r\n      $scope.setLoadCount = function() {\r\n        $scope.noRegion = !region.dntLocation;\r\n        \r\n        var n = dntData.anyLoading();\r\n        if(!translations.isLoaded())\r\n        {\r\n          n++;\r\n        }\r\n        \r\n        // $timeout(function() {\r\n          if($scope.numLoading < n || !$scope.totalToLoad) {\r\n            $scope.totalToLoad = n;\r\n          }\r\n          $scope.numLoading = n;\r\n        // });\r\n        $timeout();\r\n      };\r\n      \r\n      $scope.loadError = false;\r\n      $scope.setLoadCount();\r\n    },\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimSelectAllOnClick', [dnsimSelectAllOnClick]);\r\n\r\nfunction dnsimSelectAllOnClick() {\r\n  'use strict';\r\n  return {\r\n    restrict: 'A',\r\n    link: function(scope, element, attrs) {\r\n      var hasSelectedAll = false;\r\n      element.on('click', function($event) {\r\n        if (!hasSelectedAll) {\r\n          try {\r\n            //IOs, Safari, thows exception on Chrome etc\r\n            this.selectionStart = 0;\r\n            this.selectionEnd = this.value.length + 1;\r\n            hasSelectedAll = true;\r\n          } catch (err) {\r\n            //Non IOs option if not supported, e.g. Chrome\r\n            this.select();\r\n            hasSelectedAll = true;\r\n          }\r\n        }\r\n      });\r\n      //On blur reset hasSelectedAll to allow full select\r\n      element.on('blur', function($event) {\r\n        hasSelectedAll = false;\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimStats', ['hCodeValues','$translate',dnsimStats]);\r\n\r\nfunction dnsimStats(hCodeValues, $translate) {\r\n  return {\r\n    restrict: 'A',\r\n    scope: {\r\n      stats: '=stats',\r\n      build: '=build',\r\n      altStats: '=altStats',\r\n      separator: '=separator',\r\n      filter: '=filter',\r\n      numInSet: '=numInSet'\r\n    },\r\n    link: function($scope, element, attrs) {\r\n      \r\n      var sep;\r\n      if(!$scope.separator) {\r\n        sep = '';\r\n      }\r\n      else {\r\n        sep = '&nbsp;' + $scope.separator + ' ';\r\n      }\r\n      \r\n      var addedElements = [];\r\n      var originalDisplay = element.css('display');\r\n      \r\n      function showStats() {\r\n        element.css('display', 'none' );\r\n        var stats = $scope.stats;\r\n        if(!stats) {\r\n          stats = $scope.altStats;\r\n        }\r\n        \r\n        angular.forEach(addedElements, function(value, key) {\r\n          value.remove();\r\n        });\r\n        \r\n        var first = true;\r\n        var lastElement = element;\r\n        \r\n        function append(text) {\r\n          var newElement = element.clone();\r\n          newElement.css('display', originalDisplay);\r\n          newElement.html(text);\r\n          \r\n          lastElement.after(newElement);\r\n          lastElement = newElement;\r\n          addedElements.push(newElement);\r\n        }\r\n\r\n        // get stats that are used to summarise\r\n        var summaryForStats = {};\r\n        angular.forEach(stats, function(stat, key) {\r\n          var def = hCodeValues.stats[stat.id];\r\n          if(def && def.summaryFor) {\r\n            summaryForStats[def.summaryFor] = stat;\r\n          }\r\n        });\r\n        \r\n        angular.forEach(stats, function(stat, key) {\r\n          var output = '';\r\n\r\n          // console.log('processing stat', stat);\r\n          \r\n          if(stat.id in hCodeValues.stats) {\r\n            \r\n            var def = hCodeValues.stats[stat.id];\r\n            if(!$scope.filter && 'hide' in def && def.hide) {\r\n              return;\r\n            }\r\n            \r\n            if($scope.filter && !def[$scope.filter]) {\r\n              return;\r\n            }\r\n\r\n            if(def.summaryFor) {\r\n              return;\r\n            }\r\n            // console.log('no summaryFor');\r\n            \r\n            if(!first) {\r\n              output += sep;\r\n            }\r\n            first = false;\r\n          \r\n            if('needSetNum' in stat) {\r\n              if(stat.needSetNum <= $scope.numInSet) {\r\n                output += '*';\r\n              }\r\n              output += stat.needSetNum + '&nbsp;';\r\n            }\r\n\r\n            output += '<strong>';\r\n            \r\n            if($scope.build) {\r\n              if(def.element == 'primary') {\r\n                var eleId = 0;\r\n                if($scope.build.element) {\r\n                  eleId = $scope.build.element.id;\r\n                }\r\n                output += $translate.instant(hCodeValues.elements[eleId].name) + '&nbsp;';\r\n              }\r\n              else if(def.element == 'secondary') {\r\n                var eleId = 0;\r\n                if($scope.build.secondaryElement) {\r\n                  eleId = $scope.build.secondaryElement.id;\r\n                }\r\n                output += $translate.instant(hCodeValues.elements[eleId].name) + '&nbsp;';\r\n              }\r\n            }\r\n            \r\n            output += $translate.instant(def.name)+':</strong>&nbsp;'+def.display(stat);\r\n            if(def.combineWith > 0) {\r\n              angular.forEach(stats, function(stat2, key2) {\r\n                if(stat2.id == def.combineWith) {\r\n                  if(stat2.max != stat.max) {\r\n                    output += '-' + def.display(stat2);\r\n                  }\r\n                }\r\n              });\r\n            }\r\n\r\n            if(stat.id in summaryForStats) {\r\n              var sStat = summaryForStats[stat.id];\r\n              var sDef = hCodeValues.stats[sStat.id];\r\n              output += '&nbsp;|&nbsp;<em>' + sDef.display(sStat);\r\n              output += '</em>';\r\n            }\r\n\r\n          }\r\n          else {\r\n            if(!first) {\r\n              output += sep;\r\n            }\r\n            first = false;\r\n          \r\n            if('needSetNum' in stat) {\r\n              output += stat.needSetNum + '-Increases&nbsp;';\r\n            }\r\n            \r\n            output += stat.id+':&nbsp;'+stat.max;\r\n          }\r\n          \r\n          append(output);\r\n        });\r\n      }\r\n        \r\n      $scope.$watch('stats', function(newValue, oldValue) {\r\n        if (newValue) {\r\n          showStats();\r\n        }\r\n      });\r\n      \r\n      $scope.$watch('altStats', function(newValue, oldValue) {\r\n        if (newValue) {\r\n          showStats();\r\n        }\r\n      });\r\n      \r\n      $scope.$watch('numInSet', function(newValue, oldValue) {\r\n        if (newValue >= 0) {\r\n          showStats();\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimStringToNumber', dnsimStringToNumber);\r\n\r\nfunction dnsimStringToNumber() {\r\n  return {\r\n    require: 'ngModel',\r\n    link: function(scope, element, attrs, ngModel) {\r\n      ngModel.$parsers.push(function(value) {\r\n        return '' + value;\r\n      });\r\n      ngModel.$formatters.push(function(value) {\r\n        return parseFloat(value, 10);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').directive('dnsimStringToPercent', dnsimStringToNumber);\r\n\r\nfunction dnsimStringToNumber() {\r\n  return {\r\n    require: 'ngModel',\r\n    link: function(scope, element, attrs, ngModel) {\r\n      ngModel.$parsers.push(function(value) {\r\n        return '' + (value/100.0);\r\n      });\r\n      ngModel.$formatters.push(function(value) {\r\n        return parseFloat(value, 10)*100;\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\nangular.module('dnsim').directive('fileChange', ['$parse', fileChangeFunction]);\r\n\r\nfunction fileChangeFunction($parse) {\r\n\r\n    return {\r\n      restrict: 'A',\r\n      link: function ($scope, element, attrs) {\r\n\r\n        // Get the function provided in the file-change attribute.\r\n        // Note the attribute has become an angular expression,\r\n        // which is what we are parsing. The provided handler is \r\n        // wrapped up in an outer function (attrHandler) - we'll \r\n        // call the provided event handler inside the handler()\r\n        // function below.\r\n        var attrHandler = $parse(attrs['fileChange']);\r\n\r\n        // This is a wrapper handler which will be attached to the\r\n        // HTML change event.\r\n        var handler = function (e) {\r\n\r\n          $scope.$apply(function () {\r\n\r\n            // Execute the provided handler in the directive's scope.\r\n            // The files variable will be available for consumption\r\n            // by the event handler.\r\n            attrHandler($scope, { $event: e, files: e.target.files });\r\n          });\r\n        };\r\n\r\n        // Attach the handler to the HTML change event \r\n        element[0].addEventListener('change', handler, false);\r\n      }\r\n    };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('character', character);\r\nfunction character(dntData,itemColumnsToLoad,jobs,hCodeValues) {\r\n\r\n  var jobConversions = 'rebootplayerweighttable.lzjson';\r\n  var statCaps = 'playercommonleveltable.lzjson';\r\n  var jobBaseStats = 'playerleveltable.optimised.json';\r\n\r\n  var heroLevels = 'heroleveltable.lzjson';\r\n  var heroLevelPotentials = 'potentialtable_herolevel.lzjson';\r\n  \r\n  function reportProgress(msg) {\r\n    // console.log('progress: ' + msg);\r\n  }\r\n\r\n  return {\r\n    init: function(complete) {\r\n      jobs.init(reportProgress, complete);\r\n      dntData.init(jobConversions, itemColumnsToLoad.jobConversionColsToLoad, reportProgress, complete, false);\r\n      dntData.init(statCaps, itemColumnsToLoad.statCapColsToLoad, reportProgress, complete, false);\r\n      dntData.init(jobBaseStats, itemColumnsToLoad.jobBaseStatColsToLoad, reportProgress, complete, false);\r\n      dntData.init(heroLevels, null, reportProgress, complete, false);\r\n      dntData.init(heroLevelPotentials, null, reportProgress, complete, false);\r\n    },\r\n    \r\n    getHeroStats: function(heroLevel) {\r\n      var heroStats = [];\r\n      if(heroLevel > 0) {\r\n        var index = dntData.findFast(heroLevels, 'id', heroLevel);\r\n        if(index.length == 1) {\r\n          var h = dntData.getRow(heroLevels, index[0]);\r\n          if(h) {\r\n            var pIndex = dntData.findFast(heroLevelPotentials, 'PotentialID', h.HeroLevelAbilityID);\r\n            if(pIndex.length == 1) {\r\n              var p = dntData.getRow(heroLevelPotentials, pIndex[0]);\r\n              if(p) {\r\n                heroStats = hCodeValues.getStats(p);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return heroStats;\r\n    },\r\n    \r\n    getStatCaps: function(level) {\r\n      if(level > 0) {\r\n        var index = dntData.findFast(statCaps, 'id', level);\r\n        if(index.length == 1) {\r\n          return dntData.getRow(statCaps, index[0]);\r\n        }\r\n      }\r\n      \r\n      return {};\r\n    },\r\n    \r\n    getConversions: function(jobId) {\r\n      if(jobId > 0) {\r\n        var index = dntData.findFast(jobConversions, 'id', jobId);\r\n        if(index.length == 1) {\r\n          return dntData.getRow(jobConversions, index[0]);\r\n        }\r\n      }\r\n      \r\n      return {};\r\n    },\r\n    \r\n    getBaseStats: function(level, jobId) {\r\n      if(level > 0 && jobId > 0) {\r\n        var index = dntData.findFast(jobBaseStats, 'id', (Number(jobId) * 100) + Number(level) - 100);\r\n        if(index.length == 1) {\r\n          return dntData.getRow(jobBaseStats, index[0]);\r\n        }\r\n      }\r\n      \r\n      return {};\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('itemColumnsToLoad',[itemColumnsToLoad]);\r\nfunction itemColumnsToLoad() {\r\n  return {\r\n    mainDnt: {\r\n      NameID: true, DescriptionID: true, NameIDParam: true, DescriptionIDParam: true,\r\n      Type: true,TypeParam1: true,TypeParam2: true, TypeParam3: true, LevelLimit: true, NeedJobClass: true, Rank: true,\r\n      State1: true, StateValue1: true, State1_Max: true,\r\n      State2: true, StateValue2: true, State2_Max: true,\r\n      State3: true, StateValue3: true, State3_Max: true,\r\n      State4: true, StateValue4: true, State4_Max: true,\r\n      State5: true, StateValue5: true, State5_Max: true,\r\n      State6: true, StateValue6: true, State6_Max: true,\r\n      State7: true, StateValue7: true, State7_Max: true,\r\n      State8: true, StateValue8: true, State8_Max: true,\r\n      State9: true, StateValue9: true, State9_Max: true,\r\n      State10: true,StateValue10: true,State10_Max: true,\r\n      EnchantID: true,\r\n      SkillID: true,\r\n      dragonjeweltype: true, AbleWStorage: true, ExchangeType:true, IconImageIndex: true, IsCash: true, DisjointDrop1: true, Disjointamount: true,\r\n      TierName: true\r\n    },\r\n    partsDnt: {\r\n      SetItemID: true\r\n    },\r\n    enchantDnt: {\r\n      EnchantID: true,EnchantLevel: true,EnchantRatio: true,BreakRatio: true,MinDown: true,MaxDown: true,NeedCoin: true,\r\n      DisjointDrop: true,\r\n      NeedItemID1: true,NeedItemCount1: true,NeedItemID2: true,NeedItemCount2: true,NeedItemID3: true,NeedItemCount3: true,NeedItemID4: true,NeedItemCount4: true,NeedItemID5: true,NeedItemCount5: true,ProtectItemCount: true,\r\n      State1: true,State1Value: true,State2: true,State2Value: true,State3: true,State3Value: true,State4: true,State4Value: true,State5: true,State5Value: true,State6: true,State6Value: true,State7: true,State7Value: true,State8: true,State8Value: true,State9: true,State9Value: true,State10: true,State10Value: true\r\n    },\r\n    potentialDnt : {\r\n      PotentialID: true, PotentialNo: true,PotentialRatio: true,\r\n      State1: true,State1Value: true,\r\n      State2: true,State2Value: true,\r\n      State3: true,State3Value: true,\r\n      State4: true,State4Value: true,\r\n      State5: true,State5Value: true,\r\n      State6: true,State6Value: true,\r\n      State7: true,State7Value: true,\r\n      State8: true,State8Value: true,\r\n      State9: true,State9Value: true,\r\n      State10: true,State10Value: true,\r\n      State11: true,State11Value: true,\r\n      State12: true,State12Value: true,\r\n      State13: true,State13Value: true,\r\n      State14: true,State14Value: true,\r\n      State15: true,State15Value: true,\r\n      State16: true,State16Value: true\r\n    },\r\n    gemDnt: {\r\n      Type: true\r\n    },\r\n    setDnt : null,\r\n    sparkDnt: null,\r\n    jobsDnt: {\r\n      JobName: true,JobNumber: true,BaseClass: true,ParentJob: true, EnglishName: true, JobIcon: true\r\n    },\r\n    jobBaseStatColsToLoad: {\r\n      Strength:true,Agility:true,Intelligence:true,Stamina:true,AggroperPvE:true,BaseMP:true\r\n    },\r\n    statCapColsToLoad: {\r\n      Cbase: true,\r\n      Cdefense: true,\r\n      Ccritical: true,\r\n      Cfinaldamage: true,\r\n      CcriticalDamage: true,\r\n    },\r\n    jobConversionColsToLoad: {\r\n      HP: true,StrengthAttack: true,AgilityAttack: true,IntelligenceAttack: true,PhysicalDefense: true,MagicDefense: true,Critical: true,CriticalResistance: true,Stiff: true,StiffResistance: true,Stun: true,StunResistance: true,MoveSpeed: true,MoveSpeedRevision: true,DownDelay: true,ElementAttack: true,ElementDefense: true,ElementDefenseMin: true,ElementDefenseMax: true,StrengthIntelligenceToCriticalDamage: true\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('dntData', ['$rootScope','$timeout',dntData]);\r\n\r\nfunction dntData($rootScope,$timeout) {\r\n  \r\n  function createLoader(dntLocation, file, colsToLoad) {\r\n\r\n    var loader = {\r\n      reader: new DntReader(),\r\n      \r\n      loaded: false,\r\n      startedLoading: false,\r\n      \r\n      file: file,\r\n      \r\n      dntLocation: dntLocation,\r\n      // progressCallback: null,\r\n      completeCallbacks : [],\r\n      \r\n      init: function(progress, complete, ignoreErrors) {\r\n        \r\n        if(this.loaded) {\r\n          if(complete) {\r\n            complete();\r\n          }\r\n        }\r\n        else {\r\n          // this.progressCallback = progress;\r\n          if(complete) {\r\n            this.completeCallbacks.push(complete);\r\n          }\r\n          \r\n          if(!this.startedLoading) {\r\n            this.startedLoading = true;\r\n            var t = this;\r\n            \r\n            this.reader.colsToLoad = colsToLoad;\r\n            \r\n            if(this.dntLocation && \r\n              this.dntLocation.url &&\r\n              this.dntLocation.url.length) {\r\n\r\n              $rootScope.$broadcast('DNTDATA_LOAD_EVENT');\r\n\r\n              $timeout(function() {\r\n                t.reader.loadDntFromServerFile(\r\n                  t.dntLocation.url + '/' + file,\r\n                  function(msg) {\r\n                    // if(t.progressCallback) {\r\n                      // t.progressCallback(msg);\r\n                    // }\r\n                  }, \r\n                  function(result, fileName) {\r\n                    // console.info('dnt loading complete : ' + file);\r\n                    t.loaded = true;\r\n                    \r\n                    angular.forEach(t.completeCallbacks, function(value, key) {\r\n                      if(value) {\r\n                        value();\r\n                      }\r\n                    });\r\n                    t.completeCallbacks = [];\r\n                    $rootScope.$broadcast('DNTDATA_LOAD_EVENT');\r\n                  },\r\n                  function(msg) {\r\n                    t.failed = true;\r\n                    if(ignoreErrors) {\r\n                      t.loaded = true;\r\n                      console.log('ignoring the error - this file may not exist yet for the region');\r\n                      angular.forEach(t.completeCallbacks, function(value, key) {\r\n                        if(value) {\r\n                          value();\r\n                        }\r\n                      });\r\n                      t.completeCallbacks = [];\r\n                      $rootScope.$broadcast('DNTDATA_LOAD_EVENT');\r\n                    }\r\n                    else {\r\n                      t.startedLoading = false;\r\n                      t.loaded = false;\r\n                      $rootScope.$broadcast('DNTDATA_LOAD_ERROR');\r\n                    }\r\n                  }  );\r\n              });\r\n            }\r\n            else {\r\n              // console.log(\"dnt location not set!\");\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \r\n      reset: function() {\r\n        this.reader = new DntReader();\r\n        this.loaded = false;\r\n        this.startedLoading = false;\r\n      }\r\n    }\r\n  \r\n    return loader;\r\n  };\r\n  \r\n  return {\r\n    loaders : {},\r\n    findIndexes : {},\r\n    dntLocation : null,\r\n    \r\n    setLocation: function(location) {\r\n      this.dntLocation = location;\r\n      var t = this;\r\n      angular.forEach(this.loaders, function(value, key) {\r\n        if(value.dntLocation != location) {\r\n          value.dntLocation = location;\r\n          t.reset(key);\r\n        }\r\n      });\r\n    },\r\n    \r\n    init : function (fileName, colsToLoad, progress, complete, ignoreErrors) {\r\n      if(ignoreErrors !== false) {\r\n        ignoreErrors = true;\r\n      }\r\n\r\n      if(!progress) {\r\n        progress = function() {};\r\n      }\r\n      if(!(fileName in this.loaders)) {\r\n        if(fileName.length > 0) {\r\n          this.loaders[fileName] = createLoader(this.dntLocation, fileName, colsToLoad);\r\n        }\r\n      }\r\n      this.loaders[fileName].init(progress, complete, ignoreErrors);\r\n    },\r\n    getData : function (fileName) {\r\n      if(this.isLoaded(fileName)) {\r\n        var reader = this.loaders[fileName].reader;\r\n        var retVal = new Array(reader.numRows);\r\n        for(var i=0;i<reader.numRows;++i) {\r\n          retVal[i] = reader.getRow(i);\r\n        }\r\n        \r\n        return retVal;\r\n      }\r\n      else {\r\n        return [];\r\n      }\r\n    },\r\n    find : function(fileName, column, value) {\r\n      var results = this.findFast(fileName, column, value);\r\n      var retVal = [];\r\n      var numResults = results.length;\r\n      for(var i=0;i<numResults;++i) {\r\n        retVal.push(this.getRow(fileName, results[i]));\r\n      }\r\n      \r\n      return retVal;\r\n    },\r\n    findFast : function(fileName, column, value) {\r\n      \r\n      if(this.isLoaded(fileName)) {\r\n        if(!(fileName in this.findIndexes)) {\r\n          this.findIndexes[fileName] = {};\r\n        }\r\n        \r\n        var reader = this.loaders[fileName].reader;\r\n        var colIndex = reader.columnIndexes[column];\r\n        \r\n        var findIndex = this.findIndexes[fileName];\r\n        \r\n        if(!(column in findIndex)) {\r\n          var index = {}\r\n          findIndex[column] = index;\r\n          \r\n          var data = reader.data;\r\n          var len = data.length;\r\n          for(var r=0;r<len;++r) {\r\n            var val = data[r][colIndex];\r\n\r\n            if(!(val in index)) {\r\n              index[val] = [r];\r\n            }\r\n            else {\r\n              index[val].push(r);\r\n            }\r\n          }\r\n        }\r\n        \r\n        if(value in findIndex[column]) {\r\n          if(Array.isArray(findIndex[column][value])) {\r\n            return findIndex[column][value];\r\n          }\r\n          else {\r\n            return [findIndex[column][value]];\r\n          }\r\n        }\r\n        else {\r\n          return [];\r\n        }\r\n      }\r\n      \r\n      return [];\r\n    },\r\n    isLoaded : function(fileName) {\r\n      return fileName in this.loaders && this.loaders[fileName].loaded;\r\n    },\r\n    hasFailed : function(fileName) {\r\n      return fileName in this.loaders && this.loaders[fileName].failed;\r\n    },\r\n    hasStartedLoading : function(fileName) {\r\n      return this.isLoaded(fileName) || (fileName in this.loaders && this.loaders[fileName].startedLoading);\r\n    },\r\n    reset : function(fileName) {\r\n      if(fileName in this.loaders) {\r\n        this.loaders[fileName].reset();\r\n        delete this.loaders[fileName];\r\n        delete this.findIndexes[fileName];\r\n      }\r\n    },\r\n    resetAll : function() {\r\n      var t = this;\r\n      angular.forEach(this.loaders, function(value, key) {\r\n        t.reset(key);\r\n      });\r\n    },\r\n    anyLoading : function() {\r\n      var found = 0;\r\n      angular.forEach(this.loaders, function(value, key) {\r\n        if(!value.loaded && value.startedLoading) {\r\n          found++;\r\n        }\r\n      });\r\n      \r\n      return found;\r\n    },\r\n    getNumRows : function(fileName) {\r\n      if(this.isLoaded(fileName)) {\r\n        return this.loaders[fileName].reader.numRows;\r\n      }\r\n      else {\r\n        return 0;\r\n      }\r\n    },\r\n    getRow : function(fileName, index) {\r\n      if(this.isLoaded(fileName)) {\r\n        return this.loaders[fileName].reader.getRow(index);\r\n      }\r\n      else {\r\n        return {};\r\n      }\r\n    },\r\n    lookupValue: function(fileName, data, columnName) {\r\n      if(this.isLoaded(fileName)) {\r\n        return data[this.loaders[fileName].reader.columnNames[columnName]];\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    },\r\n    convertData: function(fileName, data) {\r\n      if(this.isLoaded(fileName)) {\r\n        return this.loaders[fileName].reader.convertData(data);\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    },\r\n    getValue : function(fileName, index, columnName) {\r\n      if(this.isLoaded(fileName)) {\r\n        return this.loaders[fileName].reader.getValue(index, columnName);\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    },\r\n    saveMemory: function() {\r\n      for(var fileName in this.loaders) {\r\n        this.loaders[fileName].saveReaderMemory();\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('dntInit', ['items','jobs','dntData','itemFactory',dntInit]);\r\nfunction dntInit(items,jobs,dntData,itemFactory) {\r\n  return function(progress) {\r\n    \r\n    progress('starting init');\r\n    \r\n    var allFactories = [jobs];\r\n    \r\n    var dntFiles = {};\r\n    angular.forEach(items, function(item, key) {\r\n      if(key != 'all') {\r\n        angular.forEach(item, function(value, prop) {\r\n          if(prop.indexOf('Dnt') == prop.length-3) {\r\n            var newFactory = { \r\n              init: function(progress, complete) {\r\n                dntData.init(value, null, progress, complete);\r\n              },\r\n              isLoaded: function() {\r\n                return dntData.isLoaded(value);\r\n              },\r\n              fileName: value,\r\n            };\r\n            \r\n            allFactories.push(newFactory);\r\n          }\r\n        });\r\n      }\r\n    });\r\n    \r\n    function initFactory(index) {\r\n    \r\n      if(index < allFactories.length) {\r\n        allFactories[index].init(progress, function() { \r\n          if(allFactories[index].isLoaded()) {\r\n            if('fileName' in allFactories[index]) {\r\n              progress('dnt loaded: ' + allFactories[index].fileName);\r\n            }\r\n            initFactory(index+1);\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        progress('Full initialise complete');\r\n      }\r\n    }\r\n    \r\n    initFactory(0);\r\n  }\r\n}\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('dntReset',['items','jobs','dntData',dntReset]);\r\nfunction dntReset(items, jobs, dntData) {\r\n  return function() {\r\n    \r\n    angular.forEach(items, function(source, name) {\r\n      source.reset();\r\n    });\r\n    \r\n    jobs.reset();\r\n    dntData.resetAll();\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('dvStatcardHelper', dvStatcardHelper);\r\nfunction dvStatcardHelper() {\r\n  'use strict';\r\n\r\n  // Conversions between dngs stat IDs and dvstatcard keys\r\n  var statMap = {\r\n      0: 'statStr',\r\n      1: 'statAgi',\r\n      2: 'statInt',\r\n      3: 'statVit',\r\n      4: 'statPDmgMin',\r\n      5: 'statPDmgMax',\r\n      6: 'statMDmgMin',\r\n      7: 'statMDmgMax',\r\n      8: 'statPDef',\r\n      9: 'statMDef',\r\n      12: 'statCrit',\r\n      16: 'statFire',\r\n      17: 'statIce',\r\n      18: 'statLight',\r\n      19: 'statDark',\r\n      25: 'statHp',\r\n      26: 'statMana',\r\n      29: 'statFD',\r\n      103: 'statCritDmg',\r\n  };\r\n\r\n  //    Converts dngs stat IDs to dvstatcard stat keys\r\n  function convertStat(stat) {\r\n    var ret = statMap[stat.id];\r\n    return ret || 'unknown';\r\n  };\r\n\r\n  function convertPercentToNum(val) {\r\n      return val * 100;\r\n  };\r\n\r\n  //    Stats that need to have some conversion applied between dngs and dvstatcard\r\n  var adjustments = {\r\n      16: convertPercentToNum,\r\n      17: convertPercentToNum,\r\n      18: convertPercentToNum,\r\n      19: convertPercentToNum,\r\n  }\r\n\r\n  //    Convert between numerical standards between dngs and dvstatcard\r\n  function adjustStat(stat) {\r\n      var func = adjustments[stat.id];\r\n      if (func) {\r\n          return func(stat.max);\r\n      }\r\n      return stat.max;\r\n  };\r\n\r\n  return {\r\n      convertStats: function(build, buildName, calcStats) {\r\n        var ret = {\r\n            characterName: buildName,\r\n            remark: 'Imported from DNGearsim',\r\n            classId: build.job.id,\r\n            statHeroLevel: build.heroLevel,\r\n        }\r\n        for (var k in calcStats) {\r\n            var v = calcStats[k];\r\n            ret[convertStat(v)] = adjustStat(v);\r\n        }\r\n        return ret;\r\n      },\r\n      cardImportUrl: 'https://redirect.divinitor.com/dngsimport',\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('exportLinkHelper', exportLinkHelper);\r\nfunction exportLinkHelper($http,items,dntData,itemFactory,hCodeValues,itemColumnsToLoad,statHelper,translations,itemCategory,region) {\r\n\r\n  return {\r\n    \r\n    encodeItem: function(item, small) {\r\n      if(item) {\r\n        var itemString;\r\n\r\n        if(item.typeName == 'custom')  {\r\n          itemString = '_custom';\r\n          angular.forEach(item.stats, function(stat, index) {\r\n            if(index > 0) {\r\n              itemString += '|';\r\n            }\r\n            else {\r\n              itemString += ':C';\r\n            }\r\n            itemString += stat.id.toString(36) + '=' + stat.max;\r\n          });\r\n        }\r\n        else if(item.id) {\r\n          itemString = 'I' + item.id.toString(36) + ':_';\r\n          if('itemSource' in item) {\r\n            itemString += item.itemSource;\r\n          }\r\n          else if('itemTypeName' in item) {\r\n            // this is to support groups saved with the old property name\r\n            itemString += item.itemTypeName;\r\n          }\r\n          else if(item.fileName) {\r\n            itemString += ':F' + item.fileName;\r\n          }\r\n        \r\n          if(item.enchantmentNum || item.enchantmentNum == 0) {\r\n            itemString += ':E' + item.enchantmentNum.toString(36);\r\n          }\r\n          if(item.pid > 0) {\r\n            itemString += ':P' + item.pid.toString(36);\r\n          }\r\n          // if(item.setId > 0) {\r\n            // itemString += ':S' + item.setId.toString(36);\r\n          // }\r\n          if(item.sparkId > 0) {\r\n            itemString += ':H' + item.sparkId.toString(36);\r\n          }\r\n          if(item.typeName == 'skills') {\r\n            itemString += ':J' + item.baseJobName;\r\n          }\r\n          if(item.pve) {\r\n            itemString += ':V' + item.pve;\r\n          }\r\n        }\r\n        \r\n        if(item.name && !small) {\r\n          itemString += ':.' + item.name.replace(/ /g, '-').replace(/\\//g, ' ');\r\n        }\r\n\r\n        return itemString;\r\n      }\r\n      \r\n      return '';\r\n    },\r\n    \r\n    decodeItem: function(itemStr) {\r\n      var item = {};\r\n      \r\n      if(itemStr) {\r\n        angular.forEach(itemStr.split(':'), function(itemBit, bitIndex) {\r\n          if(itemBit.charAt(0) == 'I') {\r\n            item.id = parseInt(itemBit.substr(1), 36);\r\n          }\r\n          else if(itemBit.charAt(0) == 'E') {\r\n            item.enchantmentNum = parseInt(itemBit.substr(1), 36);\r\n          }\r\n          else if(itemBit.charAt(0) == 'P') {\r\n            item.pid = parseInt(itemBit.substr(1), 36);\r\n          }\r\n          else if(itemBit.charAt(0) == 'S') {\r\n            item.setId = parseInt(itemBit.substr(1), 36);\r\n          }\r\n          else if(itemBit.charAt(0) == 'H') {\r\n            item.sparkId = parseInt(itemBit.substr(1), 36);\r\n          }\r\n          else if(itemBit.charAt(0) == 'J') {\r\n            item.baseJobName = itemBit.substr(1);\r\n          }\r\n          else if(itemBit.charAt(0) == 'V') {\r\n            item.pve = itemBit.substr(1);\r\n          }\r\n          else if(itemBit.charAt(0) == '_') {\r\n            item.itemSource = itemBit.substr(1);\r\n          }\r\n          else if(itemBit.charAt(0) == '.') {\r\n            item.name = itemBit.substr(1).replace('-', ' ');\r\n          }\r\n          else if(itemBit.charAt(0) == 'C') {\r\n            item.stats = [];\r\n            var statString = itemBit.substr(1);\r\n            angular.forEach(statString.split('|'), function(statBit, statBitIndex) {\r\n              var splitStat = statBit.split('=');\r\n              item.stats.push({\r\n                id: parseInt(splitStat[0], 36),\r\n                max: Number(splitStat[1])\r\n              });\r\n            });\r\n          }\r\n          else if(itemBit.charAt(0) == 'F') {\r\n            \r\n            item.fileName = itemBit.substr(1);\r\n            angular.forEach(items, function(itemSource, key) {\r\n              if(itemSource.mainDnt && itemSource.mainDnt.indexOf(item.fileName + '.') == 0) {\r\n                item.itemSource = key;\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      \r\n      return item;\r\n    },\r\n    \r\n    createGroupLink: function(groupName, group) {\r\n      var itemStrings = [];\r\n      var self = this;\r\n      \r\n      if(group == null) {\r\n        return '';\r\n      }\r\n      \r\n      angular.forEach(group.items, function(item, key) {\r\n        var itemString = self.encodeItem(item, true);  \r\n        if(itemString && itemString.length) {\r\n          itemStrings.push(itemString);\r\n        }\r\n      });\r\n  \r\n      var retVal = 'view-group?region=';\r\n      if(region.dntLocation && region.dntLocation.region) {\r\n        retVal += region.dntLocation.region;\r\n      }\r\n      \r\n      if(group.enemyLevel) {\r\n        retVal += '&e=' + group.enemyLevel;\r\n      }\r\n      if(group.playerLevel) {\r\n        retVal += '&p=' + group.playerLevel;\r\n      }\r\n      if(group.heroLevel) {\r\n        retVal += '&h=' + group.heroLevel;\r\n      }\r\n      if(group.job && group.job.id) {\r\n        retVal += '&j=' + group.job.id;\r\n      }\r\n      if(group.damageType && group.damageType.id) {\r\n        retVal += '&d=' + group.damageType.id;\r\n      }\r\n      if(group.element && group.element.id) {\r\n        retVal += '&t=' + group.element.id;\r\n      }\r\n      if(group.secondaryElement && group.secondaryElement.id) {\r\n        retVal += '&s=' + group.secondaryElement.id;\r\n      }\r\n      retVal += '&g=' + encodeURI(groupName) + '&i=' + itemStrings.join(',');\r\n      return retVal;\r\n    },\r\n\r\n    reloadSkill: function(item) {\r\n\r\n        if(!item.enchantmentNum) {\r\n          item.enchantmentNum = 1;\r\n        }\r\n        \r\n        var skillDnt = 'skilltable_character' + item.baseJobName + '.lzjson';\r\n        var pv = 'pve';\r\n        if(item.pve == 'pvp') {\r\n          pv = 'pvp';\r\n        }\r\n        var skillLevelDnt = 'skillleveltable_character' + item.baseJobName + pv + '.lzjson';\r\n        \r\n        var skillData = dntData.find(skillDnt, 'id', item.id)[0];\r\n        if(!skillData) {\r\n          console.log('cannot get skill data from ', skillDnt);\r\n        }\r\n        var skillLevelDatas = dntData.getData(skillLevelDnt);\r\n\r\n        var skillLevelVals = {};\r\n        angular.forEach(skillLevelDatas, function(value, index) {\r\n          if(value.SkillIndex == item.id && value.SkillLevel == item.enchantmentNum) {\r\n            skillLevelVals = value;\r\n          }\r\n        });\r\n        \r\n        var newItem = {\r\n          id: item.id,\r\n          itemSource: item.itemSource,\r\n          typeName: item.itemSource,\r\n          needJobClass: skillData.NeedJob,\r\n          baseJobName: item.baseJobName,\r\n          rank: hCodeValues.rankNames[0],\r\n          enchantmentNum: item.enchantmentNum,\r\n          name: translations.translate(skillData.NameID, skillData.NameIDParam),\r\n          description: translations.translate(skillLevelVals.SkillExplanationID, skillLevelVals.SkillExplanationIDParam),\r\n          icon: skillData.IconImageIndex,\r\n          pve: item.pve\r\n        };\r\n        \r\n        newItem.stats = statHelper.getSkillStats(newItem, skillData, skillLevelDatas);\r\n        return newItem;\r\n    },\r\n\r\n    reloadSourceItem: function(item) {\r\n      var itemType = items[item.itemSource];\r\n      var ds = dntData.findFast(itemType.mainDnt, 'id', item.id);\r\n      if(!ds.length) {\r\n        console.log('item ' + item.id + ' not found in ' + itemType.mainDnt);\r\n        return;\r\n      }\r\n\r\n      var rowNum = ds[0];\r\n      var typeParam1 = dntData.getValue(itemType.mainDnt, rowNum, 'TypeParam1');\r\n    \r\n      var p = null;\r\n      \r\n      var ps = dntData.find(itemType.potentialDnt, 'id', item.pid);\r\n      if(!ps.length) {\r\n        ps = dntData.find(itemType.potentialDnt, 'PotentialID', typeParam1);\r\n      }\r\n      \r\n      if(!ps.length) {\r\n        ps = dntData.find(itemType.potentialDntEx, 'id', item.pid);\r\n        if(!ps.length) {\r\n          ps = dntData.find(itemType.potentialDntEx, 'PotentialID', typeParam1);\r\n        }\r\n      }\r\n      \r\n      if(ps.length > 0) {\r\n        p = ps[0];\r\n        \r\n        if(p.PotentialID != typeParam1) {\r\n          // this happened one time\r\n          // not sure how but it corrupted the stats\r\n          p = null;\r\n          console.log('bad potential');\r\n        }\r\n      }\r\n      \r\n      var newItem = itemFactory.createItem(itemType, rowNum, p);\r\n      itemFactory.initItem(newItem);\r\n      itemCategory.setItemCategory(newItem);\r\n      newItem.gemSlot = item.gemSlot;\r\n\r\n      var usePartDnt = null;\r\n      if(newItem.typeName != 'weapons' && newItem.typeId != 0) {\r\n        usePartDnt = 'partsDnt';\r\n      }\r\n      else {\r\n        usePartDnt = 'weaponDnt';\r\n      }\r\n\r\n      if(usePartDnt) {\r\n        if(dntData.isLoaded(itemType[usePartDnt]) && dntData.isLoaded(itemType.setDnt)) {\r\n          newItem.setStats = [];\r\n          var parts = dntData.find(itemType[usePartDnt], 'id', item.id);\r\n          if(parts.length > 0) {\r\n            newItem.setId = parts[0].SetItemID;\r\n            var sets = dntData.find(itemType.setDnt, 'id', parts[0].SetItemID);\r\n            if(sets.length > 0) {\r\n              newItem.setStats = hCodeValues.getStats(sets[0]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      newItem.fullStats = newItem.stats;\r\n      if(item.enchantmentNum >= 0) {\r\n        newItem.enchantmentNum = item.enchantmentNum;\r\n        \r\n        if(newItem.typeName == 'skills') {\r\n          // would this even happen?\r\n        }\r\n        else if(newItem.typeName == 'talisman') {\r\n          var extraStats = [];\r\n          angular.forEach(newItem.stats, function(stat, index) {\r\n            extraStats.push({id: stat.id, max: stat.max * (newItem.enchantmentNum/100)});\r\n          });\r\n          \r\n          newItem.enchantmentStats = extraStats;\r\n        }\r\n        else if(itemType.enchantDnt) {\r\n          var enchantments = dntData.find(itemType.enchantDnt, 'EnchantID', newItem.enchantmentId);\r\n          if(!enchantments.length && itemType.enchantDnt2) {\r\n            enchantments = dntData.find(itemType.enchantDnt2, 'EnchantID', newItem.enchantmentId);\r\n          }\r\n\r\n          angular.forEach(enchantments, function(enchantment, index) {\r\n            if(enchantment.EnchantLevel == newItem.enchantmentNum) {\r\n              newItem.enchantmentStats = hCodeValues.getStats(enchantment);\r\n            }\r\n          });\r\n        }\r\n        else if(itemType.petLevelDnt) {\r\n          var petLevels = dntData.find(itemType.petLevelDnt, 'PetLevelTypeID', newItem.enchantmentId);\r\n          angular.forEach(petLevels, function(enchantment, index) {\r\n            if(enchantment.PetLevel == newItem.enchantmentNum) {\r\n              newItem.enchantmentStats = hCodeValues.getStats(enchantment);\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      if(newItem.enchantmentStats) {\r\n        newItem.fullStats = hCodeValues.mergeStats(newItem.enchantmentStats, newItem.stats);\r\n      }\r\n      \r\n      if(item.sparkId > 0) {\r\n        newItem.sparkId = item.sparkId;\r\n        var sparks = dntData.find(itemType.sparkDnt, 'id', item.sparkId);\r\n        if(sparks.length > 0) {\r\n          newItem.sparkStats = hCodeValues.getStats(sparks[0]);\r\n          newItem.fullStats = hCodeValues.mergeStats(newItem.fullStats, newItem.sparkStats);\r\n        }\r\n      }\r\n      else if(newItem.dragonjeweltype) {\r\n        newItem.offensiveGemSlots = 0;\r\n        newItem.increasingGemSlots = 0;\r\n        var itemData = dntData.find('dragonjewelslottable.lzjson', 'DragonJewelID', newItem.dragonjeweltype);\r\n        if(itemData && itemData.length > 0) {\r\n          if(itemData[0].DragonJewelSlot1 == 1) newItem.offensiveGemSlots++;\r\n          if(itemData[0].DragonJewelSlot2 == 1) newItem.offensiveGemSlots++;\r\n          if(itemData[0].DragonJewelSlot3 == 1) newItem.offensiveGemSlots++;\r\n          if(itemData[0].DragonJewelSlot4 == 1) newItem.offensiveGemSlots++;\r\n          \r\n          if(itemData[0].DragonJewelSlot1 == 2) newItem.increasingGemSlots++;\r\n          if(itemData[0].DragonJewelSlot2 == 2) newItem.increasingGemSlots++;\r\n          if(itemData[0].DragonJewelSlot3 == 2) newItem.increasingGemSlots++;\r\n          if(itemData[0].DragonJewelSlot4 == 2) newItem.increasingGemSlots++;\r\n        }\r\n      }\r\n      \r\n      return newItem;\r\n    },\r\n    \r\n    reloadItem: function(item) {\r\n\r\n      if(item == null) {\r\n        // console.log('cannot reload null item');\r\n        return;\r\n      }\r\n      \r\n      // support for old property name\r\n      if('itemTypeName' in item && !item.itemSource) {\r\n        item.itemSource = item.itemTypeName;\r\n      }\r\n      \r\n      // console.log('checking ' + item.itemSource)\r\n      if(item.itemSource == 'rbTech') {\r\n        item.itemSource = 'tech';\r\n        // console.log('changed to ' + item.itemSource)\r\n      }\r\n      \r\n      if(item.itemSource == 'custom' || item.typeName == 'custom') {\r\n        item.typeName = 'custom';\r\n        return item;\r\n      }\r\n      else if(item.itemSource == 'skills' || item.typeName == 'skills') {\r\n        return this.reloadSkill(item);\r\n      }\r\n      else if(item.itemSource in items) {\r\n        var itemType = items[item.itemSource];\r\n        var ds = dntData.findFast(itemType.mainDnt, 'id', item.id);\r\n        if(ds.length) {\r\n          return this.reloadSourceItem(item);\r\n        }\r\n      }\r\n      \r\n      if(item.fileName) {\r\n        var datas = dntData.findFast(item.fileName + '.lzjson', 'id', item.id);\r\n        if(datas.length > 0) {\r\n          var row = datas[0];\r\n          var d = dntData.getRow(item.fileName + '.lzjson', row);\r\n          var newItem = itemFactory.createBasicItem(d);\r\n          newItem.row = row;\r\n          newItem.needJobClass = d.NeedJobClass;\r\n          newItem.exchangeType = d.ExchangeType;\r\n          newItem.fileName = item.fileName;\r\n          newItem.gemSlot = item.gemSlot;\r\n          newItem.description = translations.translate(d.DescriptionID, d.DescriptionIDParam);\r\n          itemFactory.initItem(newItem);\r\n          return newItem;\r\n        }\r\n        else {\r\n          return {name: 'unknown item'};\r\n        }\r\n      }\r\n      else {\r\n        return {name: 'unknown item source: ' + item.itemSource};\r\n      }\r\n    },\r\n    \r\n    getDntFiles: function(item) {\r\n      if(item == null) {\r\n        return {};\r\n      }\r\n\r\n      var dntFiles = {};\r\n      if(!item.itemSource && item.itemTypeName in items) {\r\n        item.itemSource = item.itemTypeName;\r\n      }\r\n      \r\n      if(item.itemSource == 'rbTech') {\r\n        item.itemSource = 'tech';\r\n      }\r\n      \r\n      if(item.itemSource in items) {\r\n        var itemType = items[item.itemSource];\r\n        \r\n        dntFiles['exchange.lzjson'] = null;\r\n        dntFiles[itemType.mainDnt] = itemColumnsToLoad.mainDnt;\r\n        \r\n        for(var fileType in itemType) {\r\n          if(fileType.indexOf('Dnt') > 0) {\r\n            if(fileType != 'enchantDnt' || fileType != 'enchantDnt2' || item.enchantmentNum) {\r\n              dntFiles[itemType[fileType]] = itemColumnsToLoad[fileType];\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      if(item.itemSource == 'skills' || item.typeName == 'skills') {\r\n          var skillDnt = 'skilltable_character' + item.baseJobName + '.lzjson';\r\n          dntFiles[skillDnt] = null;\r\n          var skillLevelDnt = 'skillleveltable_character' + item.baseJobName + 'pve' + '.lzjson';\r\n          dntFiles[skillLevelDnt] = null;\r\n          skillLevelDnt = 'skillleveltable_character' + item.baseJobName + 'pvp' + '.lzjson';\r\n          dntFiles[skillLevelDnt] = null;\r\n      }\r\n      \r\n      if(item.fileName) {\r\n        dntFiles[item.fileName + '.lzjson'] = null;\r\n      }\r\n    \r\n      return dntFiles;\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('groupHelper', ['exportLinkHelper',groupHelper]);\r\nfunction groupHelper(exportLinkHelper) {\r\n  'use strict';\r\n  \r\n  return {\r\n    reloadGroup: function(groupName, group) {\r\n      var newItems = [];\r\n      angular.forEach(group.items, function(item, key) {\r\n        var newItem = exportLinkHelper.reloadItem(item);\r\n        if(newItem) {\r\n          newItems.push(newItem);\r\n        }\r\n      });\r\n      \r\n      return newItems;\r\n    },\r\n    \r\n    getDntFiles: function(group) {\r\n\r\n      var allDntFiles = {};\r\n      angular.forEach(group.items, function(item, key1) {\r\n        \r\n        var dntFiles = exportLinkHelper.getDntFiles(item);\r\n\r\n        angular.forEach(dntFiles, function(value, key) {\r\n          allDntFiles[key] = value;\r\n        });\r\n      });\r\n      \r\n      return allDntFiles;\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('itemCategory',\r\n['itemFactory','items','dntData',itemCategory]);\r\nfunction itemCategory(itemFactory,items,dntData) {\r\n\r\n  return {\r\n    categories: [\r\n      {path: 'everything', name:'everything', searchType: 'everything', hideInBuild: true},\r\n      {path: 'titles', name:'titles', sourceType: 'titles', hideRank: true, hideJob: true, hideLevel: true, numItemText: '1', maxCat: 1},\r\n      {path: 'weapons', name:'weapons', sourceType: 'equipment', numItemText: '2', maxExchange: 1, maxCat: 2, limitExchange: [1,2]},\r\n      {path: 'armour', name:'armour', sourceType: 'equipment', numItemText: '5', maxExchange: 1, maxCat: 5, limitExchange: [3,4,5,6,7]},\r\n      {path: 'accessories', name:'accessories', sourceType: 'equipment', hideJob: true, maxCat: 4, maxExchange: 2, limitExchange: [8,9,10], tId: 7604},\r\n      {path: 'techs', name:'techs', sourceType: 'techs', maxCat: 4, maxExchange: 2, limitExchange: [8,9,10], hideJob: true},\r\n      {path: 'offensive-gems', name:'offensive gems', sourceType: 'gems', hideJob: true, maxCat: 4, maxExchange: 4, limitExchange: [54], limitGemType: 1},\r\n      {path: 'increasing-gems', name:'increasing gems', sourceType: 'gems', hideJob: true, maxCat: 14, maxExchange: 14, limitExchange: [54], limitGemType: 2},\r\n      {path: 'enhancement-plates', name:'enhancement plates', sourceType: 'plates', hideJob: true, numItemText: '8+3', maxCat: 11, maxExchange: 15, limitExchange: [33], limitRank: [0,1,2,3]},\r\n      {path: 'expedition-plates', name:'expedition plates', sourceType: 'plates', hideRank: true, hideJob: true, numItemText: '4', maxCat: 4, maxExchange: 15, limitExchange: [33], limitRank: [4,5]},\r\n      {path: 'talisman', name:'talisman', sourceType: 'talisman', hideJob: true, numItemText: '8+4', maxCat: 12, maxExchange: 12, limitExchange: [52,53], tId: 1000054149},\r\n      {path: 'costume', name:'costume', sourceType: 'cash', numItemText: '7', maxCat: 7, maxExchange: 1, hideLevel: true, limitExchange: [16,17,18,19,20,21,22], tId: 7607},\r\n      {path: 'imprint', name:'imprint', sourceType: 'imprint', numItemText: '7', maxCat: 7, hideLevel: true, hideJob: true, tId: 1000108314},\r\n      {path: 'cash', name:'cash', sourceType: 'cash', numItemText: '8', maxCat: 8, maxExchange: 2, hideJob: true, hideLevel: true, limitExchange: [23,24,25,26,27,28,29], tId: 7608},\r\n      {path: 'extras', name:'extras', sourceType: 'xtras', limitExchange: [47], hideJob: true, hideLevel: true, tId: 4504},\r\n      {path: 'skills', name:'skills', searchType: 'skills'},\r\n      {path: 'custom', name:'custom', searchType: 'custom', hideInSearch: true},\r\n      ],\r\n      \r\n    byName: function(name) {\r\n      var retVal = null;\r\n      angular.forEach(this.categories, function(category, index) {\r\n        if(category.name == name) {\r\n          retVal = category;\r\n        }\r\n      });\r\n      \r\n      return retVal;\r\n    },\r\n      \r\n    byPath: function(name) {\r\n      var retVal = null;\r\n      angular.forEach(this.categories, function(category, index) {\r\n        if(category.path == name) {\r\n          retVal = category;\r\n        }\r\n      });\r\n      \r\n      return retVal;\r\n    },\r\n    \r\n    getItems: function(name) {\r\n      var cat = this.byName(name);\r\n      if(cat && 'sourceType' in cat) {\r\n        var retVal = [];\r\n        angular.forEach(items, function(source, sourceName) {\r\n          if(source.type == cat.sourceType && retVal) {\r\n            if(!source.items && !source.loading) {\r\n              itemFactory.loadItems(source);\r\n            }\r\n            \r\n            if(source.items) {\r\n              retVal = retVal.concat(source.items);\r\n            }\r\n            else {\r\n              retVal = null; // if any are null just return null\r\n            }\r\n          }\r\n        });\r\n        \r\n        var catItems = [];\r\n        if(retVal) {\r\n          var vm = this;\r\n          angular.forEach(retVal, function(item, index) {\r\n            if(item.typeName == name) {\r\n              catItems.push(item);\r\n            }\r\n            else if(vm.isItemForCat(cat, item, item.data)) {\r\n              item.typeName = name;\r\n              catItems.push(item);\r\n            }\r\n          });\r\n        }\r\n        \r\n        return catItems;\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    },\r\n    \r\n    isItemForCat: function(cat, item) {\r\n\r\n      if(!(item.itemSource in items)) {\r\n        return false;\r\n      }\r\n      \r\n      if(items[item.itemSource].type != cat.sourceType) {\r\n        return false;\r\n      }\r\n      \r\n      if(item.itemType == cat.name) {\r\n        return true;\r\n      }\r\n      \r\n      var anyMatch;\r\n      if(cat.limitExchange) {\r\n        anyMatch = false;\r\n        for(var i=0;i<cat.limitExchange.length;++i) {\r\n          if(cat.limitExchange[i] == item.exchangeType || (item.rawData && cat.limitExchange[i] == item.rawData.ExchangeType)) {\r\n            anyMatch = true;\r\n          }\r\n        }\r\n\r\n        if(!anyMatch) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if(cat.limitRank) {\r\n        anyMatch = false;\r\n        for(var i=0;i<cat.limitRank.length;++i) {\r\n          if((item.rank && cat.limitRank[i] == item.rank.id) || (item.rawData && cat.limitRank[i] == item.rawData.Rank)) {\r\n            anyMatch = true;\r\n          }\r\n        }\r\n\r\n        if(!anyMatch) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if(cat.limitGemType) {\r\n        var gemTypes = dntData.find(items.gem.gemDnt, 'id', item.id);\r\n        if(gemTypes.length > 0) {\r\n          \r\n          if(gemTypes[0].Type != cat.limitGemType) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      \r\n      return true;\r\n    },\r\n    \r\n    init: function(name, complete) {\r\n      var cat = this.byName(name);\r\n      if(cat && 'sourceType' in cat) {\r\n        var sources = _.filter(items, function(source) {\r\n          return (source.type == cat.sourceType);\r\n        });\r\n\r\n        var numComplete = 0;\r\n        _.each(sources, function(source) {\r\n          source.init(function() {}, function() {\r\n              numComplete++;\r\n              if(numComplete == sources.length) {\r\n                complete();\r\n              }\r\n          });\r\n        });\r\n      }\r\n    },\r\n    \r\n    setItemCategory: function (item, rawData) {\r\n      var vm = this;\r\n      \r\n      angular.forEach(this.categories, function(cat, index) {\r\n        if(vm.isItemForCat(cat, item, rawData)) {\r\n          item.typeName = cat.name;\r\n        }\r\n      });\r\n    },\r\n    \r\n    getItemsByCategory: function(items) {\r\n      var itemMap = {};\r\n      if(items) {\r\n        var types = {};\r\n        angular.forEach(items, function(item, index) {\r\n          if(item) {\r\n            if(!(item.typeName in types)) {\r\n              types[item.typeName] = [];\r\n            }\r\n            types[item.typeName].push(item);\r\n          }\r\n        });\r\n        \r\n        angular.forEach(this.categories, function(category, index) {\r\n\r\n          if(category.name in types) {\r\n            \r\n            var sorted = types[category.name].sort(function(item1, item2) {\r\n              if(category.name == 'talisman') {\r\n                \r\n                var enh1 = item1.enchantmentNum;\r\n                if(!enh1) enh1 = 0;\r\n                var enh2 = item2.enchantmentNum;\r\n                if(!enh2) enh2 = 0;\r\n                \r\n                if(enh1 != enh2) {\r\n                  return enh2 - enh1;\r\n                }\r\n              }\r\n              else if(item1.itemSource == 'gem' || item1.itemSource == 'plate') {\r\n                if(item1.gemSlot || item2.gemSlot) {\r\n                  if(!item1.gemSlot) {\r\n                    return 1;\r\n                  }\r\n                  else if(!item2.gemSlot) {\r\n                    return -1;\r\n                  }\r\n                  return item1.gemSlot - item2.gemSlot;\r\n                }\r\n                else if(item2.levelLimit != item1.levelLimit) {\r\n                  return item2.levelLimit - item1.levelLimit;\r\n                }\r\n              }\r\n              else if('exchangeType' in item1 && 'exchangeType' in item2) {\r\n                return item1.exchangeType - item2.exchangeType;\r\n              }\r\n              \r\n              return item1.name.localeCompare(item2.name);\r\n            });\r\n            itemMap[category.name] = sorted;\r\n          }\r\n          else {\r\n            itemMap[category.name] = [];\r\n          }\r\n        });\r\n        \r\n        /*\r\n        angular.forEach(items, function(item, index) {\r\n          if(item && !(item.typeName in itemMap)) {\r\n            // console.log('we dont know ' + item.typeName + ' anymore')\r\n            itemMap.typeError = true;\r\n          }\r\n        });\r\n        */\r\n      }\r\n      return itemMap;\r\n    },\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('excludeService', excludeService);\r\n\r\nfunction excludeService() {\r\n return {\r\n     ids: [{\r\n            name: 'unbound plates',\r\n            min: 0,\r\n            max: 0\r\n        }\r\n     ],\r\n };\r\n}\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('itemFactory',itemFactory);\r\n\r\nfunction itemFactory(translations,dntData,hCodeValues,items) {\r\n  \r\n  return {\r\n    loadItems: loadItems,\r\n    initItem: initItem,\r\n    createItem: createItem,\r\n    getItemData: getItemData,\r\n    createBasicItem: createBasicItem,\r\n  };\r\n  \r\n  function createItem(itemType, row, p) {\r\n    \r\n    // data and potential are used to initialise name and stats\r\n    // this is only done when needed\r\n    // they are then removed from the object\r\n    return {\r\n      row: row,\r\n      potential : p,\r\n      id: dntData.getValue(itemType.mainDnt, row, 'id'),\r\n      itemSource : itemType.name,\r\n      levelLimit : dntData.getValue(itemType.mainDnt, row, 'LevelLimit'),\r\n      needJobClass : dntData.getValue(itemType.mainDnt, row, 'NeedJobClass'),\r\n      typeId : dntData.getValue(itemType.mainDnt, row, 'Type'),\r\n      exchangeType: dntData.getValue(itemType.mainDnt, row, 'ExchangeType'),\r\n      rank : hCodeValues.rankNames[dntData.getValue(itemType.mainDnt, row, 'Rank')],\r\n      pid: null,\r\n      name : null,\r\n      stats : null,\r\n      potentialRatio : null,\r\n      typeName : null,\r\n      sparkId: null,\r\n    };\r\n  }\r\n\r\n  function isDataLoaded(itemType) {\r\n    \r\n    if(!dntData.isLoaded(itemType.mainDnt)) {\r\n      return false;\r\n    }\r\n    \r\n    if(!translations.isLoaded()) {\r\n      return false;\r\n    }\r\n    \r\n    if('potentialDnt' in itemType && !dntData.isLoaded(itemType.potentialDnt)) {\r\n      return false;\r\n    }\r\n    \r\n    if('potentialDntEx' in itemType && !dntData.isLoaded(itemType.potentialDntEx)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n\r\n  }\r\n  \r\n  function loadItems(itemType) {\r\n\r\n    if(!isDataLoaded(itemType)) {\r\n      return null;\r\n    }\r\n    \r\n    var start = new Date().getTime();\r\n    \r\n    itemType.items = [];\r\n    var numRows = dntData.getNumRows(itemType.mainDnt);\r\n    for(var r=0;r<numRows;++r) {\r\n      var dType = dntData.getValue(itemType.mainDnt, r, 'Type');\r\n\r\n      var state1Max = dntData.getValue(itemType.mainDnt, r, 'State1_Max');\r\n      var dStateValue1 = dntData.getValue(itemType.mainDnt, r, 'StateValue1');\r\n      var dTypeParam1 = dntData.getValue(itemType.mainDnt, r, 'TypeParam1');\r\n        \r\n      // skip items with no data\r\n      if(state1Max > 0 || dStateValue1 > 0 || dTypeParam1 > 0 || dType == 35) {        \r\n        var potentials = [];\r\n        if(dTypeParam1 > 0 && 'potentialDnt' in itemType) {\r\n          potentials = dntData.find(itemType.potentialDnt, 'PotentialID', dTypeParam1);\r\n          \r\n          if(!potentials.length && 'potentialDntEx' in itemType) {\r\n            potentials = dntData.find(itemType.potentialDntEx, 'PotentialID', dTypeParam1);\r\n          }\r\n        }\r\n        \r\n        var numPotentials = potentials.length;\r\n        if(!numPotentials) {\r\n          potentials = [null];\r\n          numPotentials = 1;\r\n        }\r\n\r\n        for(var p=0;p<numPotentials;++p) {\r\n          var found = false;          \r\n          if(!found) {\r\n            itemType.items.push(createItem(itemType, r, potentials[p], 0));\r\n          }\r\n        }\r\n      }\r\n    }\r\n            \r\n    var end = new Date().getTime();\r\n    var time = end - start;\r\n    console.log('item init time: ' + (time/1000) + 's for ' + itemType.name);\r\n  }\r\n  \r\n  function initItem(item) {\r\n    \r\n    if(item.row >= 0) {\r\n      var d;\r\n      if(item.itemSource && item.itemSource in items) {\r\n        d = dntData.getRow(items[item.itemSource].mainDnt, item.row);\r\n      }\r\n      else if(item.fileName) {\r\n        d = dntData.getRow(item.fileName + '.lzjson', item.row);\r\n      }\r\n      delete item.row;\r\n\r\n      var p = item.potential;\r\n  \r\n      if(item.name == null) {\r\n        item.name = translations.translate(d.NameID, d.NameIDParam);\r\n        if(d.TierName) {\r\n          item.name += ' (' + translations.translate(d.TierName) + ')';\r\n        }\r\n      }\r\n      \r\n      if(!item.sparkTypeId && d.TypeParam2 > 0) {\r\n        item.sparkTypeId = d.TypeParam2;\r\n      }\r\n      \r\n      if(item.stats == null) {\r\n        var stats = hCodeValues.getStats(d);\r\n        if(p) {\r\n          var potentialStats = hCodeValues.getStats(p);\r\n          stats = hCodeValues.mergeStats(stats, potentialStats);\r\n        }\r\n        \r\n        item.stats = stats;\r\n      }\r\n      \r\n      if(d.SkillID && !item.skillId) {\r\n        item.skillId = d.SkillID;\r\n      }\r\n      \r\n      if(item.iconIndex == null) {\r\n        item.icon = d.IconImageIndex;\r\n        if(!item.icon && item.itemSource == 'title') {\r\n          item.icon = 12417;\r\n        }\r\n      }\r\n      \r\n      if(d.dragonjeweltype >= 0) {\r\n        item.dragonjeweltype = d.dragonjeweltype;\r\n      }\r\n      \r\n      if(d.EnchantID && !item.enchantmentId) {\r\n        item.enchantmentId = d.EnchantID;\r\n      }\r\n      \r\n      if(d.EnchantID && !item.enchantmentId) {\r\n        item.enchantmentId = d.EnchantID;\r\n      }\r\n      else if(d.Type == 35) {\r\n        item.itemSource = 'xtras';\r\n        var itemType = items[item.itemSource];\r\n        if(itemType) {\r\n          // item.fileName = itemType.mainDnt;\r\n          var petData = dntData.find(itemType.petDnt, 'id', d.id);\r\n          if(petData && petData.length) {\r\n            item.enchantmentId = petData[0].PetLevelTypeID;\r\n          }\r\n        }\r\n      }\r\n      \r\n      if(p) {\r\n        item.pid = p.id;\r\n      }\r\n      \r\n      delete item.potential;\r\n    }\r\n  }\r\n  \r\n  function getItemData(item) {\r\n    var itemType = items[item.itemSource];\r\n    \r\n    if(item.fileName && dntData.isLoaded(item.fileName + '.lzjson')) {\r\n      var result = getItemDataFromFile(item.fileName + '.lzjson', item);\r\n      if(result) {\r\n        return result;\r\n      }\r\n    }\r\n    \r\n    if(item.fileName && dntData.isLoaded(item.fileName + '.optimised.json')) {\r\n      var result = getItemDataFromFile(item.fileName + '.optimised.json', item);\r\n      if(result) {\r\n        return result;\r\n      }\r\n    }\r\n    \r\n    if(itemType && dntData.isLoaded(itemType.mainDnt)) {\r\n      var result = getItemDataFromFile(itemType.mainDnt, item);\r\n      if(result) {\r\n        return result;\r\n      }\r\n    }\r\n    \r\n    return [];\r\n  }\r\n  \r\n  function getItemDataFromFile(fileName, item) {\r\n    if(fileName) {\r\n      var itemData = dntData.find(fileName, 'id', item.id);\r\n      if(itemData && itemData.length > 0) {\r\n        return itemData[0];\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  function createBasicItem(d) {\r\n    if(!d) {\r\n      return [];\r\n    }\r\n    return {\r\n      id: d.id,\r\n      name: translations.translate(d.NameID, d.NameIDParam),\r\n      rank: hCodeValues.rankNames[d.Rank],\r\n      icon: d.IconImageIndex,\r\n      levelLimit : d.LevelLimit,\r\n      fileName: d.fileName,\r\n      typeId: d.Type\r\n    };\r\n  }\r\n}\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('items',\r\n['translations','dntData','itemColumnsToLoad',items]);\r\nfunction items(translations,dntData,itemColumnsToLoad) {\r\n  \r\n  var itemSources = {\r\n    \r\n      title : {\r\n        mainDnt: 'appellationtable.optimised.json', \r\n        type: 'titles', \r\n        minLevel: 0, \r\n        minRank: 0 },\r\n      // wspr: { mainDnt: 'itemtable_source.dnt', type: 'wellspring', minLevel: 24 },\r\n      \r\n      tech: { \r\n        mainDnt: 'itemtable_skilllevelup.optimised.json', \r\n        potentialDnt: 'potentialtable.optimised.json',\r\n        potentialDntEx: 'potentialtable_reboot.optimised.json',\r\n        sparkDnt: 'potentialtable_potentialjewel.optimised.json',\r\n        gemSlotDnt: 'dragonjewelslottable.lzjson',\r\n        type: 'techs', \r\n        minLevel: 60,\r\n        minRank: 0},\r\n      \r\n      tman: { \r\n        mainDnt: 'itemtable_talisman.optimised.json', \r\n        type: 'talisman', \r\n        potentialDnt: 'potentialtable_talismanitem.optimised.json',\r\n        minLevel: 24,\r\n        minRank: 0 },\r\n      \r\n      gem: { \r\n        mainDnt: 'itemtable_dragonjewel.optimised.json', \r\n        potentialDnt: 'potentialtable_dragonjewel.optimised.json',\r\n        potentialDntEx: 'potentialtable_reboot.optimised.json',\r\n        enchantDnt: 'enchanttable_dragonjewel.optimised.json', \r\n        gemDnt: 'dragonjeweltable.optimised.json',\r\n        type: 'gems',\r\n        minLevel: 24,\r\n        minRank: 3},\r\n      \r\n      plate: { \r\n        mainDnt : 'itemtable_glyph.optimised.json', \r\n        potentialDnt: 'potentialtable_glyph.optimised.json',\r\n        type: 'plates',\r\n        minLevel: 16,\r\n        minRank: 2 },\r\n      plate95: { \r\n        mainDnt : 'itemtable_glyph95.lzjson', \r\n        potentialDnt: 'potentialtable_glyph95.lzjson',\r\n        type: 'plates',\r\n        minLevel: 1,\r\n        minRank: 1,\r\n        ignoreErrors: true },\r\n\r\n      items: {\r\n        mainDnt: 'itemtable.optimised.json', \r\n        partsDnt: 'partstable.optimised.json', \r\n        weaponDnt: 'weapontable.optimised.json', \r\n        enchantDnt: 'enchanttable.optimised.json', \r\n        potentialDnt: 'potentialtable.optimised.json',\r\n        setDnt: 'setitemtable.optimised.json',\r\n        gemSlotDnt: 'dragonjewelslottable.lzjson',\r\n        type: 'equipment',\r\n        minLevel: 80,\r\n        minRank: 3 },\r\n      eq: {\r\n        mainDnt: 'itemtable_equipment.optimised.json', \r\n        partsDnt: 'partstable_equipment.optimised.json', \r\n        weaponDnt: 'weapontable_equipment.optimised.json', \r\n        enchantDnt: 'enchanttable.optimised.json', \r\n        potentialDnt: 'potentialtable.optimised.json',\r\n        sparkDnt: 'potentialtable_potentialjewel.optimised.json',\r\n        setDnt: 'setitemtable.optimised.json',\r\n        gemSlotDnt: 'dragonjewelslottable.lzjson',\r\n        type: 'equipment',\r\n        minLevel: 21,\r\n        minRank: 3 },\r\n      rbeq: { \r\n        mainDnt: 'itemtable_reboot.optimised.json', \r\n        partsDnt: 'partstable_reboot.optimised.json', \r\n        weaponDnt: 'weapontable_reboot.optimised.json', \r\n        enchantDnt: 'enchanttable_reboot.optimised.json',\r\n        enchantDnt2: 'enchanttable_95.lzjson',\r\n        potentialDnt: 'potentialtable_reboot.optimised.json',\r\n        setDnt: 'setitemtable.optimised.json',\r\n        gemSlotDnt: 'dragonjewelslottable.lzjson',\r\n        type: 'equipment',\r\n        minLevel: 24,\r\n        minRank: 3 },\r\n      pvpeq: { \r\n        mainDnt: 'itemtable_pvp.optimised.json',\r\n        partsDnt: 'partstable_pvp.optimised.json', \r\n        weaponDnt: 'weapontable_pvp.optimised.json', \r\n        enchantDnt: 'enchanttable.optimised.json', \r\n        setDnt: 'setitemtable.optimised.json',\r\n        type: 'equipment',\r\n        gemSlotDnt: 'dragonjewelslottable.lzjson',\r\n        minLevel: 24,\r\n        minRank: 3 },\r\n\r\n      cCommon: {\r\n        mainDnt: 'itemtable_commoncash.lzjson', \r\n        partsDnt: 'partstable_commoncash.lzjson', \r\n        weaponDnt: 'weapontable_commoncash.lzjson', \r\n        setDnt: 'setitemtable_cash.lzjson',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        ignoreErrors: true,\r\n        minRank: 4 },\r\n      cClone: {\r\n        mainDnt: 'itemtable_cashclone.optimised.json',\r\n        partsDnt: 'partstable_cashclone.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        ignoreErrors: true,\r\n        minRank: 4 },\r\n      c2016: { \r\n        mainDnt: 'itemtable_common2016.optimised.json', \r\n        partsDnt: 'partstable_common2016.optimised.json', \r\n        weaponDnt: 'weapontable_common2016.optimised.json', \r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      c2017: { \r\n        mainDnt: 'itemtable_common2017.optimised.json', \r\n        partsDnt: 'partstable_common2017.optimised.json', \r\n        weaponDnt: 'weapontable_common2017.optimised.json', \r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        ignoreErrors: true,\r\n        minRank: 0 },\r\n      c2015: { \r\n        mainDnt: 'itemtable_common2015.optimised.json', \r\n        partsDnt: 'partstable_common2015.optimised.json', \r\n        weaponDnt: 'weapontable_common2015.optimised.json', \r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      c2014: { \r\n        mainDnt: 'itemtable_common2014.optimised.json', \r\n        partsDnt: 'partstable_common2014.optimised.json', \r\n        weaponDnt: 'weapontable_common2014.optimised.json', \r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      cash: { \r\n        mainDnt: 'itemtable_cash.optimised.json', \r\n        partsDnt: 'partstable_cash.optimised.json', \r\n        weaponDnt: 'weapontable_cash.optimised.json', \r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      event: {\r\n        mainDnt: 'itemtable_event.optimised.json',\r\n        partsDnt: 'partstable_event.optimised.json',\r\n        weaponDnt: 'weapontable_event.optimised.json',\r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        type: 'cash',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      xtras: {\r\n        mainDnt: 'itemtable_vehicle.optimised.json',\r\n        partsDnt: 'vehiclepartstable.optimised.json',\r\n        setDnt: 'setitemtable_cash.optimised.json',\r\n        petDnt: 'vehicletable.lzjson',\r\n        petLevelDnt: 'petleveltable.lzjson', \r\n        type: 'xtras',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n      imprint: {\r\n        mainDnt: 'itemtable_imprinting.optimised.json',\r\n        type: 'imprint',\r\n        minLevel: 0,\r\n        minRank: 0 },\r\n    };\r\n    \r\n    // now that the sources are set up add some methods on them for initialisation\r\n    // each source will store the items from that source for reuse by searches\r\n    angular.forEach(itemSources, function(itemSource, key) {\r\n      itemSource.name = key;\r\n      itemSource.loading = false;\r\n      itemSource.items = null;\r\n      itemSource.init = init; // decalared below\r\n      itemSource.reset = function() {\r\n        itemSource.items = null;\r\n        itemSource.loading = false;\r\n      };\r\n    });\r\n\r\n    return itemSources;\r\n  \r\n  \r\n    function init(progress, complete) {\r\n      var itemSource = this;\r\n      itemSource.loading = true;\r\n  \r\n      if(itemSource.items) {\r\n        complete();\r\n      }\r\n      else {\r\n        \r\n        translations.init(progress, function() {\r\n          doComplete(itemSource, complete)\r\n        });\r\n        dntData.init(itemSource.mainDnt, itemColumnsToLoad.mainDnt, progress, function() {\r\n          doComplete(itemSource, complete)\r\n        }, itemSource.ignoreErrors);\r\n        if('potentialDnt' in itemSource) {\r\n          dntData.init(itemSource.potentialDnt, itemColumnsToLoad.potentialDnt, progress, function() {\r\n            doComplete(itemSource, complete)\r\n          }, itemSource.ignoreErrors);\r\n        }\r\n        if('potentialDntEx' in itemSource) {\r\n          dntData.init(itemSource.potentialDntEx, itemColumnsToLoad.potentialDnt, progress, function() {\r\n            doComplete(itemSource, complete)\r\n          }, itemSource.ignoreErrors);\r\n        }\r\n        if('gemDnt' in itemSource) {\r\n          dntData.init(itemSource.gemDnt, itemColumnsToLoad.gemDnt, progress, function() {\r\n            doComplete(itemSource, complete)\r\n          }, itemSource.ignoreErrors);\r\n        }\r\n  \r\n        doComplete(itemSource, complete);\r\n      }\r\n    }\r\n    \r\n    function doComplete(itemSource, complete) {\r\n      if(translations.isLoaded() && \r\n      dntData.isLoaded(itemSource.mainDnt) && \r\n      (!('potentialDnt' in itemSource) || dntData.isLoaded(itemSource.potentialDnt) || dntData.hasFailed(itemSource.potentialDnt)) &&\r\n      (!('potentialDntEx' in itemSource) || dntData.isLoaded(itemSource.potentialDntEx) || dntData.hasFailed(itemSource.potentialDntEx)) &&\r\n      (!('gemDnt' in itemSource) || dntData.isLoaded(itemSource.gemDnt) || dntData.hasFailed(itemSource.gemDnt))\r\n      ) {\r\n        complete();\r\n        itemSource.loading = false;\r\n      }\r\n    }\r\n  };\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('jobs', ['dntData', 'translations', 'itemColumnsToLoad', jobs]);\r\nfunction jobs(dntData, translations, itemColumnsToLoad) {\r\n  \r\n  var fileName ='jobtable.lzjson';\r\n  var colsToLoad = itemColumnsToLoad.jobsDnt;\r\n  \r\n  return {\r\n    fileName : fileName,\r\n    allJobs : null,\r\n    \r\n    isLoaded : function() {\r\n      return dntData.isLoaded(fileName);\r\n    },\r\n    \r\n    hasStartedLoading: function() {\r\n      return dntData.hasStartedLoading(fileName);\r\n    },\r\n    \r\n    init : function(progress, complete) {\r\n      dntData.init(fileName, colsToLoad, progress, function() {\r\n        complete();\r\n        }, false);\r\n    },\r\n\r\n    reset : function() {\r\n      this.allJobs = null;\r\n      dntData.reset(fileName);\r\n    },\r\n    \r\n    getFinalJobs : function () {\r\n      var jobs = [];\r\n      var alljobs = this.getAllJobs();\r\n      if(alljobs) {\r\n        var numRows = alljobs.length;\r\n        for(var r=0;r<numRows;++r) {\r\n          if(alljobs[r].d.JobNumber == 2 && alljobs[r].d.JobIcon > 0) {\r\n            jobs.push(alljobs[r]);\r\n          }\r\n        }\r\n      }\r\n      \r\n      return jobs;\r\n    },\r\n    \r\n    getBaseJobs : function () {\r\n      var retVal=[];\r\n      var baseJobs = {};\r\n\r\n      var self = this;\r\n      angular.forEach(this.getFinalJobs(), function(job, key) {\r\n        baseJobs[self.getBaseJobName(job)] = job;\r\n      });\r\n\r\n      angular.forEach(baseJobs, function(job, jobName) {\r\n        retVal.push(jobName);\r\n      });\r\n\r\n      return retVal;\r\n    },\r\n    \r\n    getAllJobs : function () {\r\n      if(this.allJobs == null && this.isLoaded() && translations.isLoaded()) {\r\n        var jobs = [];\r\n        var data = dntData.getData(fileName);\r\n        var numRows = data.length;\r\n        for(var r=0;r<numRows;++r) {\r\n          jobs[jobs.length] = this.createJob(data[r]);\r\n        }\r\n        \r\n        this.allJobs = jobs;\r\n      }\r\n      return this.allJobs;\r\n    },\r\n    \r\n    getById: function(id) {\r\n      var data = this.getAllJobs();\r\n      if(data) {\r\n        var numRows = data.length;\r\n        for(var r=0;r<numRows;++r) {\r\n          if(data[r].id == id) {\r\n            return data[r];\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \r\n    createJob : function(d) {\r\n      var t = this;\r\n      return {\r\n          d : d,\r\n          id : d.id,\r\n          name : translations.translate(d.JobName),\r\n          isClassJob : function(c) {\r\n            return t.isClassJob(d, c);\r\n          }\r\n        };\r\n    },\r\n    \r\n    isClassJob : function (d, c) {\r\n      if(c == 0) return true;\r\n      if(d.id == c) {\r\n        return true;\r\n      }\r\n      \r\n      var parentJob = d.ParentJob;\r\n      \r\n      if(!parentJob) return false;\r\n      if(parentJob == c) return true;\r\n\r\n      var parentJobData = this.getById(parentJob);\r\n      if(parentJobData) {\r\n        return this.isClassJob(parentJobData.d, c);\r\n      }\r\n      \r\n      return false;\r\n    },\r\n    \r\n    getBaseJobName : function(job) {\r\n      if(this.isLoaded()) {\r\n        var alljobs = this.getAllJobs();\r\n        if(alljobs) {\r\n          var numRows = alljobs.length;\r\n          for(var r=0;r<numRows;++r) {\r\n            if(alljobs[r].id == (job.d.BaseClass+1) && alljobs[r].d.EnglishName) {\r\n              return alljobs[r].d.EnglishName;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      return null;\r\n    },\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('onlineService', ['$window','$q','hCodeValues',onlineService]);\r\n\r\nfunction onlineService($window, $q, hCodeValues) {\r\n  // console.log('setup online service');\r\n  \r\n  var service = {\r\n    login: login,\r\n    getUser: function() {\r\n      return firebase.auth().currentUser;\r\n    },\r\n    signOut: signOut,\r\n    deleteAccount: deleteAccount,\r\n    \r\n    getUserBuilds: getUserBuilds,\r\n    deleteBuild: deleteBuild,\r\n    saveBuild: saveBuild,\r\n    getBuild: getBuild,\r\n    getClassBuilds: getClassBuilds,\r\n    \r\n    getProfile: getProfile,\r\n    saveProfile: saveProfile,\r\n    \r\n    stripBuildName: stripBuildName\r\n  };\r\n  \r\n  init();\r\n  \r\n  return service;\r\n  \r\n  function init() {\r\n    // console.log('init');\r\n    firebase.initializeApp({\r\n      apiKey: 'AIzaSyC-Mckgho1xAI2SQzsKnpsr2ObDKOhdSrE',\r\n      authDomain: 'dngearsim.firebaseapp.com',\r\n      databaseURL: 'https://dngearsim.firebaseio.com',\r\n      storageBucket: 'dngearsim.appspot.com',\r\n    });\r\n  }\r\n  \r\n  function login() {\r\n    return $q(function(resolve, reject) {\r\n      var auth = firebase.auth();\r\n        \r\n      auth.onAuthStateChanged(function(user) {\r\n        if(user == null) {\r\n          // console.log('redirecting');\r\n          $window.location.href = 'login.html';\r\n        }\r\n        else {\r\n          // console.log('logged in');\r\n          resolve(user);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  function getProfile(uid) {\r\n    // console.log('get profile');\r\n    return $q(function(resolve, reject) {\r\n      firebase.database().ref('profile/' + uid).once('value', function(storedProfile) {\r\n        if(storedProfile) {\r\n          resolve(storedProfile.val());\r\n        }\r\n        else {\r\n          resolve({});\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  function getBuild(uid, buildName) {\r\n    // console.log('get build');\r\n    return $q(function(resolve, reject) {\r\n      firebase.database().ref('builds/' + uid + '/' + stripBuildName(buildName)).once('value', function(storedProfile) {\r\n        if(storedProfile) {\r\n          resolve(decompressBuild(storedProfile.val()));\r\n        }\r\n        else {\r\n          resolve({});\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  function saveProfile(profile) {\r\n    return $q(function(resolve, reject) {\r\n      var user = service.getUser();\r\n      if(user) {\r\n        profile = angular.copy(profile);\r\n        deleteNullProperties(profile, true);\r\n        firebase.database().ref('profile/' + user.uid).set(profile).then(resolve);\r\n      }\r\n    });\r\n  }\r\n  \r\n  function getUserBuilds(uid) {\r\n    // console.log('get builds');\r\n    return $q(function(resolve, reject) {\r\n      // console.log('getting builds');\r\n      firebase.database().ref('builds/' + uid).once('value', function(storedBuilds) {\r\n        if(storedBuilds) {\r\n          var retVal = {};\r\n          var val = storedBuilds.val();\r\n          for(var buildName in val) {\r\n            retVal[buildName] = decompressBuild(val[buildName]);\r\n          }\r\n          resolve(retVal);\r\n        }\r\n        else {\r\n          resolve({});\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  function getClassBuilds(job) {\r\n    // console.log('get class builds');\r\n    return $q(function(resolve, reject) {\r\n      // console.log('getting builds', job.id);\r\n      firebase.database().ref('job-builds/' + job.id).once('value', function(jobBuilds) {\r\n        // console.log('ok');\r\n        if(jobBuilds) {\r\n          resolve(jobBuilds.val());\r\n        }\r\n        else {\r\n          resolve({});\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  function compressBuild(build) {\r\n    \r\n    if(build.items) {\r\n      _.each(build.items, function(item) {\r\n        delete item.fullStats;\r\n      });\r\n    }\r\n    \r\n    var stringifiedData = JSON.stringify(build);\r\n    return LZString.compressToUTF16(stringifiedData);\r\n  }\r\n  \r\n  function decompressBuild(compressedBuild) {\r\n    var stringifiedData = LZString.decompressFromUTF16(compressedBuild);\r\n    var build = JSON.parse(stringifiedData);\r\n    \r\n    if(build.items) {\r\n      _.each(build.items, function(item) {\r\n        item.fullStats = item.stats;\r\n        \r\n        if(item.enchantmentStats && item.enchantmentStats.length) {\r\n          item.fullStats = hCodeValues.mergeStats(item.enchantmentStats, item.fullStats);\r\n        }\r\n        \r\n        if(item.sparkStats && item.sparkStats.length) {\r\n          item.fullStats = hCodeValues.mergeStats(item.sparkStats, item.fullStats);\r\n        }\r\n      });\r\n    }\r\n    \r\n    return build;\r\n  }\r\n  \r\n  function saveBuild(buildName, build) {\r\n    var user = service.getUser();\r\n    var actions = [];\r\n    if(user) {\r\n      build = angular.copy(build);\r\n      deleteNullProperties(build, true);\r\n      // console.log('saving', build);\r\n      actions.push(\r\n        firebase.database().ref('builds/' + user.uid + '/' + stripBuildName(buildName)).set(compressBuild(build))\r\n      );\r\n      \r\n      if(build.job && build.job.id) {\r\n        // console.log('saving build');\r\n          \r\n        var data = {};\r\n        if(build.playerLevel) {\r\n          data.lev = build.playerLevel;\r\n        }\r\n        if(build.region) {\r\n          data.region = build.region;\r\n        }\r\n        if(build.guild) {\r\n          data.guild = build.guild;\r\n        }\r\n        if(build.about) {\r\n          data.about = build.about;\r\n        }\r\n        \r\n        deleteNullProperties(data, true);\r\n          \r\n        actions.push(\r\n          firebase.database().ref('job-builds/' + build.job.id + '/' + user.uid + '/' + stripBuildName(buildName)).set(data)\r\n        );\r\n      }\r\n    }\r\n    return $q.all(actions);\r\n  }\r\n  \r\n  function deleteNullProperties(test, recurse) {\r\n    for (var i in test) {\r\n        if (test[i] === undefined) {\r\n            delete test[i];\r\n        } else if (recurse && typeof test[i] === 'object') {\r\n            deleteNullProperties(test[i], recurse);\r\n        }\r\n    }\r\n  }\r\n  \r\n  function signOut() {\r\n    var auth = firebase.auth();\r\n    return $q(function(resolve, reject) {\r\n      auth.signOut().then(function() {\r\n        resolve();\r\n      }, function(error) {\r\n        reject();\r\n      });\r\n    });\r\n  }\r\n  \r\n  function deleteAccount(builds) {\r\n    var auth = firebase.auth();\r\n    var user = service.getUser();\r\n    \r\n    return $q(function(resolve, reject) {\r\n      \r\n      var pList = [\r\n        firebase.database().ref('builds/' + user.uid).remove(),\r\n        firebase.database().ref('profile/' + user.uid).remove(),\r\n        firebase.database().ref('private/' + user.uid).remove()];\r\n        \r\n      var jobIds = [];\r\n      for(var buildName in builds) {\r\n        if(builds[buildName].job) {\r\n          jobIds.push(builds[buildName].job.id);\r\n        }\r\n      }\r\n      \r\n      jobIds = _.uniq(jobIds);\r\n      _.each(jobIds, function(id) {\r\n        pList.push(\r\n          firebase.database().ref('job-builds/' + id + '/' + user.uid).remove()\r\n        )\r\n      });\r\n        \r\n      $q.all(pList).then(function() {\r\n        // console.log('deleted data');\r\n        user.delete().then(function() {\r\n          // console.log('deleted user');\r\n          auth.signOut().then(function() {\r\n            // console.log('signed out');\r\n            resolve();\r\n          }, function(error) {\r\n            reject();\r\n          });\r\n        });\r\n      });\r\n    });\r\n  }\r\n  \r\n  function deleteBuild(buildName, build) {\r\n    \r\n    var pList = [];\r\n    var user = service.getUser();\r\n    if(user) {\r\n      pList.push(\r\n        firebase.database().ref('builds/' + user.uid + '/' + stripBuildName(buildName)).remove());\r\n      \r\n      if(build.job) {\r\n        pList.push(\r\n          firebase.database().ref('job-builds/' + build.job.id + '/' + user.uid + '/' + stripBuildName(buildName)).remove());\r\n      }\r\n    }\r\n    \r\n    return $q.all(pList);\r\n  }\r\n  \r\n  function stripBuildName(buildName) {\r\n    return buildName.replace(/[.$\\[\\]#\\/]/g, '');\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('quickAddHelper', quickAddHelper);\r\nfunction quickAddHelper(dntData, translations, itemColumnsToLoad, itemCategory,itemFactory,jobs,hCodeValues) {\r\n\r\n  return {\r\n    getItem: getItem,\r\n    findData: findData\r\n  };\r\n  \r\n  function getItem(datas) {\r\n    var item = null;\r\n    for(var d=0;d<datas.length;++d) {\r\n      if(datas[d].def.isItemStep) {\r\n        item = datas[d].value;\r\n      }\r\n    }\r\n    \r\n    for(var d=0;d<datas.length;++d) {\r\n      if(datas[d].def.alterItem) {\r\n        datas[d].def.alterItem(datas[d].value.id, item);\r\n      }\r\n    }\r\n    \r\n    return item;\r\n  }\r\n  \r\n  function findData(category, build, datas, maxItems) {\r\n    if(!maxItems) {\r\n      maxItems = 9999;\r\n    }\r\n    \r\n    var allItems = itemCategory.getItems(category.name);\r\n    var retVal = [];\r\n    var numItems = allItems.length;\r\n\r\n    var sortFunc = null;\r\n    var sortId = null;\r\n    \r\n    for(var i=0;i<numItems;++i) {\r\n      \r\n      var item = allItems[i];\r\n      \r\n      if(!category.hideJob && build.job.id > 0 && item.needJobClass > 0 && !jobs.isClassJob(build.job.d, item.needJobClass)) {\r\n        continue;\r\n      }\r\n      itemFactory.initItem(item);\r\n      \r\n      var addItem = true;\r\n      for(var d=0;d<datas.length;++d) {\r\n        if(!datas[d].def.matchesItem || datas[d].def.matchesItem(datas[d].value.id, item)) {\r\n          if('sortFunc' in datas[d].def) {\r\n            sortFunc = datas[d].def.sortFunc;\r\n            sortId = datas[d].value.id;\r\n          }\r\n        }\r\n        else {\r\n          addItem = false;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if(addItem) {\r\n        retVal.push(item);\r\n      }\r\n      \r\n      if(retVal.length >= maxItems) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    retVal = filterDuplicates(retVal);\r\n\r\n    retVal = retVal.sort(function(item1, item2) {\r\n      if(sortFunc) {\r\n        return sortFunc(sortId, item1, item2);\r\n      }\r\n      else {\r\n        return item1.name.localeCompare(item2.name);\r\n      }\r\n    });\r\n    \r\n    return retVal;\r\n  }\r\n\r\n  function filterDuplicates(items) {\r\n    var retVal = [];\r\n    for(var i=0;i<items.length;++i) {\r\n        var found = false;\r\n        for(var j=0;j<i;++j) {\r\n            if(areSameItem(items[i], items[j])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(!found) {\r\n            retVal.push(items[i]);\r\n        }\r\n    }\r\n\r\n    return retVal;\r\n  }\r\n\r\n  function areSameItem(item1, item2) {\r\n      if(item1.name != item2.name || item1.stats.length != item2.stats.length || item1.rank != item2.rank || item1.levelLimit != item1.levelLimit) {\r\n          return false;\r\n      }\r\n\r\n      return _.isEqual(item1.stats, item2.stats);\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('quickAdd', quickAdd);\r\nfunction quickAdd(dntData, translations, itemColumnsToLoad, itemCategory,itemFactory,jobs,hCodeValues, quickAddSteps, quickAddHelper) {\r\n\r\n  return {\r\n    categorySteps: {\r\n      titles: ['titleStep'],\r\n      weapons: ['exchangeStep','levelStep','rankStep','itemNameStep','hasStatStep','itemStep','enhanceEqStep'],\r\n      armour: ['exchangeStep','levelStep','rankStep','itemNameStep','hasStatStep','itemStep','enhanceEqStep'],\r\n      accessories: ['accExchangeStep','levelStep','rankStep','itemNameStep','hasStatStep','itemStep'],\r\n      techs: ['exchangeStep','levelStep','rankStep','techSkillStep','itemNameStep','hasStatStep','itemStep'],\r\n      'offensive gems': ['levelStep','gemRankStep','itemNameStep','numStatsStep','hasStatStep','itemStep','enhanceGemStep'],\r\n      'increasing gems': ['levelStep','gemRankStep','itemNameStep','numStatsStep','hasStatStep','itemStep','enhanceGemStep'],\r\n      'enhancement plates': ['levelStep','rankStep','distinctItemNameStep','numStatsStep','hasStatStep','itemStep'],\r\n      'expedition plates': ['levelStep','distinctItemNameStep','numStatsStep','highStatStep','hasStatStep','itemStep'],\r\n      talisman: ['levelStep','talismanRankStep','distinctItemNameStep','numStatsStep','hasStatStep','itemStep','enhanceTalismanStep'],\r\n      costume: ['exchangeStep','rankStep','itemNameStep','itemStep'],\r\n      imprint: ['rankStep','itemNameStep','highStatStep','itemStep'],\r\n      cash: ['accExchangeStep','rankStep','itemNameStep','itemStep'],\r\n      custom: ['customStep'],\r\n    },\r\n    getOptions: function(category, build, datas) {\r\n      var t = this;\r\n      if(category.name in this.categorySteps) {\r\n        var stepName = this.getStepName(category, datas.length);\r\n        var stepDef = quickAddSteps[stepName];\r\n        var allOptions = stepDef.getOptions(category, build, datas);\r\n        if(stepDef.isItemStep) {\r\n          return allOptions;\r\n        }\r\n        else {\r\n          if(stepDef.minOptions) {\r\n              var unfilteredItems = quickAddHelper.findData(category, build, datas, 50);\r\n          }\r\n\r\n          var newOptions = _.filter(allOptions, function(option) {\r\n            var tempDatas = datas.concat([\r\n              t.createData(option, category, datas.length)\r\n            ]);\r\n\r\n            var items;\r\n            if(stepDef.minOptions) {\r\n              if(allOptions[0] == option) {\r\n                return true;\r\n              }\r\n\r\n              items = quickAddHelper.findData(category, build, tempDatas, 50);\r\n              if(items.length > 0 && items.length < 50) {\r\n                return items.length < unfilteredItems.length;\r\n              }\r\n            }\r\n            else {\r\n              items = quickAddHelper.findData(category, build, tempDatas, 1);\r\n            }\r\n            return items.length;\r\n          });\r\n\r\n          if(stepDef.minOptions && newOptions.length < stepDef.minOptions) {\r\n            return [allOptions[0]];\r\n          }\r\n\r\n          return newOptions;\r\n        }\r\n      }\r\n      else {\r\n        return [];\r\n      }\r\n    },\r\n    hasOptions: function(category, build, datas) {\r\n      if(category.name in this.categorySteps) {\r\n        var stepName = this.getStepName(category, datas.length);\r\n        if(quickAddSteps[stepName].hasOptions) {\r\n          return quickAddSteps[stepName].hasOptions(category, build, datas);\r\n        }\r\n        else {\r\n          return quickAddSteps[stepName].getOptions(category, build, datas).length > 0;\r\n        }\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    },\r\n    isValidStepNumber: function(category, stepNumber) {\r\n      return this.categorySteps[category.name].length > stepNumber;\r\n    },\r\n    createData: function(value, category, stepNumber) {\r\n      var stepName = this.getStepName(category, stepNumber);\r\n      var def = quickAddSteps[stepName];\r\n      \r\n      return {\r\n        step: stepName,\r\n        value: value,\r\n        def: def,\r\n      };\r\n    },\r\n    getItem: quickAddHelper.getItem,\r\n    getStepName: function(category, stepNumber) {\r\n      return this.categorySteps[category.name][stepNumber];\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('quickAddSteps', quickAddSteps);\r\nfunction quickAddSteps(dntData, translations, itemColumnsToLoad, itemCategory,itemFactory,jobs,hCodeValues, quickAddHelper) {\r\n\r\n  return {\r\n      exchangeStep: {\r\n        name: 'type',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          var exchanges = [];\r\n          \r\n          for(var e=0;e<category.limitExchange.length;++e) {\r\n            var exId = category.limitExchange[e];\r\n            \r\n            var numExchange = 0;\r\n            if(build.items) {\r\n              for(var i=0;i<build.items.length;++i) {\r\n                if(build.items[i].exchangeType == exId) {\r\n                  numExchange++;\r\n                }\r\n              }\r\n            }\r\n            \r\n            if(numExchange >= category.maxExchange) {\r\n              continue;\r\n            }\r\n            \r\n            var exchange = dntData.find('exchange.lzjson','ExchangeType',exId);\r\n            var exName = '';\r\n            if(exchange && exchange.length > 0 && exchange[0].NameID > 0) {\r\n              exName = translations.translate(exchange[0].NameID).toLowerCase();\r\n            }\r\n            exchanges.push({id: exId, name: exName.toLowerCase()});\r\n          }\r\n          \r\n          return exchanges;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.exchangeType == id;\r\n        }\r\n      },\r\n      accExchangeStep: {\r\n        name: 'type',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          var exchanges = [];\r\n          \r\n          for(var e=0;e<category.limitExchange.length;++e) {\r\n            var exId = category.limitExchange[e];\r\n            \r\n            var numExchange = 0;\r\n            for(var i=0;i<build.items.length;++i) {\r\n              if(build.items[i] && build.items[i].exchangeType == exId) {\r\n                numExchange++;\r\n              }\r\n            }\r\n            \r\n            if(exId == 10 || exId == 25) {\r\n              if(numExchange >= 2) {\r\n                continue;\r\n              }\r\n            }\r\n            else {\r\n              if(numExchange >= 1) {\r\n                continue;\r\n              }\r\n            }\r\n            \r\n            var exchange = dntData.find('exchange.lzjson','ExchangeType',exId);\r\n            if(exchange && exchange.length > 0 && exchange[0].NameID > 0) {\r\n              var exName = translations.translate(exchange[0].NameID).toLowerCase();\r\n              \r\n              exchanges.push({id: exId, name: exName.toLowerCase()});\r\n            }\r\n          }\r\n          \r\n          return exchanges;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.exchangeType == id;\r\n        }\r\n      },\r\n      levelStep: {\r\n        name: 'level',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          return [\r\n          { id: 95, name: 'level 95' },\r\n          { id: 93, name: 'level 93' },\r\n          { id: 90, name: 'level 90' },\r\n          { id: 80, name: 'level 80' },\r\n          { id: 70, name: 'level 70' }, \r\n          { id: 60, name: 'level 60' }, \r\n          { id: 50, name: 'level 50' }, \r\n          { id: 40, name: 'level 40' }, \r\n          { id: 32, name: 'level 32' }, \r\n          { id: 24, name: 'level 24' }, \r\n          ];\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.levelLimit == id;\r\n        }\r\n      },\r\n      talismanRankStep: {\r\n        name: 'rank',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          return [\r\n          { id: 3, name: 'epic' },\r\n          { id: 2, name: 'rare' },\r\n          { id: 999, name: 'quality high grade' },\r\n          { id: 1, name: 'magic' },\r\n          { id: 0, name: 'normal' },\r\n          ];\r\n        },\r\n        matchesItem: function(id, item) {\r\n          itemFactory.initItem(item);\r\n          if(item.name) {\r\n            // todo: change this to use the name id\r\n            var index = Math.max(\r\n              item.name.indexOf('Quality'),\r\n              item.name.indexOf('High Grade'));\r\n              \r\n            if(id == 999) {\r\n              return index === 0;\r\n            }\r\n            else {\r\n              return item.rank && item.rank.id == id && index != 0;\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n      },\r\n      gemRankStep: {\r\n        name: 'rank',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          return [\r\n          { id: 5, name: 'legendary' },\r\n          { id: 4, name: 'unique' },\r\n          { id: 999, name: 'quality high grade epic' },\r\n          { id: 3, name: 'epic' },\r\n          ];\r\n        },\r\n        matchesItem: function(id, item) {\r\n          itemFactory.initItem(item);\r\n          if(item.name) {\r\n            var index = Math.max(\r\n              item.name.indexOf('Quality'),\r\n              item.name.indexOf('High Grade'));\r\n            if(id == 999) {\r\n              return item.rank && item.rank.id == 3 && index >= 0;\r\n            }\r\n            else {\r\n              return item.rank && item.rank.id == id && index < 0;\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n      },\r\n      rankStep: {\r\n        name: 'rank',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          var values = [];\r\n          for(var id in hCodeValues.rankNames) {\r\n            values.push(hCodeValues.rankNames[id]);\r\n          }\r\n          return values;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.rank && item.rank.id == id;\r\n        }\r\n      },\r\n      enhanceTalismanStep: {\r\n        name: 'slot',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          return [\r\n          { id: 100, name: '+100% slot' },\r\n          { id: 75, name: '+75% slot' },\r\n          { id: 25, name: '+25% slot' },\r\n          { id: 0, name: '+0% slot' },\r\n          ];\r\n        },\r\n        alterItem: function(id, item) {\r\n          item.enchantmentNum = id;\r\n        }\r\n      },\r\n      titleStep: {\r\n        name: 'select',\r\n        getOptions: function(category, build, datas) {\r\n          var allTitles = quickAddHelper.findData(category, build, datas, 9999);\r\n          var usefulTitles = [];\r\n          for(var i=0;i<allTitles.length;++i) {\r\n            switch(allTitles[i].id) {\r\n              case 1975: // Manticore Expert\r\n              case 1973: // Returned\r\n              case 1008: // Dark Knight\r\n              case 230: // Miraculous\r\n              case 279: // Provoking\r\n              case 2032: // Sharing Goddess's Grief\r\n              case 2033: // Grief-stricken\r\n              case 1313: // Jakard's Demise\r\n              case 2188: // Teary eyed\r\n              // case 1280: // Dragon Tamer\r\n              // case 339: // Cow Wrangler\r\n                usefulTitles.push(allTitles[i]);\r\n                break;\r\n            }\r\n          }\r\n          \r\n          return usefulTitles;\r\n        },\r\n        hasOptions: function(category, build, datas) {\r\n          return true;\r\n        },\r\n        isItemStep: true,\r\n      },\r\n      enhanceEqStep: {\r\n        name: 'enhance',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          var item = quickAddHelper.getItem(datas);\r\n          if(item && item.enchantmentId) {\r\n            return [\r\n            { id: 20, name: 'enhance to +20' },\r\n            { id: 19, name: 'enhance to +19' },\r\n            { id: 18, name: 'enhance to +18' },\r\n            { id: 17, name: 'enhance to +17' },\r\n            { id: 16, name: 'enhance to +16' },\r\n            { id: 15, name: 'enhance to +15' },\r\n            { id: 14, name: 'enhance to +14' },\r\n            { id: 13, name: 'enhance to +13' },\r\n            { id: 12, name: 'enhance to +12' },\r\n            { id: 11, name: 'enhance to +11' },\r\n            { id: 10, name: 'enhance to +10' },\r\n            { id: 9, name: 'enhance to +9' },\r\n            { id: 8, name: 'enhance to +8' },\r\n            { id: 7, name: 'enhance to +7' },\r\n            { id: 6, name: 'enhance to +6' },\r\n            { id: 5, name: 'enhance to +5' },\r\n            { id: 4, name: 'enhance to +4' },\r\n            { id: 3, name: 'enhance to +3' },\r\n            { id: 2, name: 'enhance to +2' },\r\n            { id: 1, name: 'enhance to +1' },\r\n            { id: 0, name: 'not enhanced' },\r\n            ];\r\n          }\r\n          else {\r\n            return [{ id: 0, name: 'not enhanced' }];\r\n          }\r\n        },\r\n        alterItem: function(id, item) {\r\n          item.enchantmentNum = id;\r\n        }\r\n      },\r\n      enhanceGemStep: {\r\n        name: 'enhance',\r\n        getOptions: function(category, build, datas) {\r\n          \r\n          var item = quickAddHelper.getItem(datas);\r\n          if(item && item.enchantmentId) {\r\n            return [\r\n            { id: 15, name: 'enhance to +15' },\r\n            { id: 14, name: 'enhance to +14' },\r\n            { id: 13, name: 'enhance to +13' },\r\n            { id: 12, name: 'enhance to +12' },\r\n            { id: 11, name: 'enhance to +11' },\r\n            { id: 10, name: 'enhance to +10' },\r\n            { id: 9, name: 'enhance to +9' },\r\n            { id: 8, name: 'enhance to +8' },\r\n            { id: 7, name: 'enhance to +7' },\r\n            { id: 6, name: 'enhance to +6' },\r\n            { id: 5, name: 'enhance to +5' },\r\n            { id: 4, name: 'enhance to +4' },\r\n            { id: 3, name: 'enhance to +3' },\r\n            { id: 2, name: 'enhance to +2' },\r\n            { id: 1, name: 'enhance to +1' },\r\n            { id: 0, name: 'not enhanced' },\r\n            ];\r\n          }\r\n          else {\r\n            return [{ id: 0, name: 'not enhanced' }];\r\n          }\r\n        },\r\n        alterItem: function(id, item) {\r\n          item.enchantmentNum = id;\r\n        }\r\n      },\r\n      itemStep: {\r\n        name: 'select',\r\n        getOptions: function(category, build, datas) {\r\n          return quickAddHelper.findData(category, build, datas);\r\n        },\r\n        isItemStep: true,\r\n        hideName: true,\r\n      },\r\n      namedItemStep: {\r\n        name: 'select',\r\n        getOptions: function(category, build, datas) {\r\n          return quickAddHelper.findData(category, build, datas);\r\n        },\r\n        isItemStep: true,\r\n      },\r\n      techSkillStep: {\r\n        name: 'skill',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas, 1);\r\n          \r\n          // eventually show all the skills\r\n          // but for now\r\n          if(items.length > 0) {\r\n            return [{id: items[0].skillId, name: items[0].skillId}];\r\n          }\r\n          else {\r\n            return [];\r\n          }\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.skillId == id;\r\n        }\r\n      },\r\n      itemNameStep: {\r\n        name: 'item',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas);\r\n          var itemNames = {};\r\n          var itemNamesList = [];\r\n          for(var i=0;i<items.length;++i) {\r\n            var name = items[i].name;\r\n            if(!(name in itemNames)) {\r\n              itemNames[name] = true;\r\n              itemNamesList.push({\r\n                id: name,\r\n                name: name,\r\n              });\r\n            }\r\n          }\r\n          \r\n          return itemNamesList;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.name == id;\r\n        },\r\n        isItemStep: true,\r\n      },\r\n      distinctItemNameStep: {\r\n        name: 'item',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas);\r\n          var itemNames = {};\r\n          var itemNamesList = [];\r\n          \r\n          for(var i=0;i<build.items.length;++i) {\r\n            var item = build.items[i];\r\n            itemNames[item.name] = true;\r\n          }\r\n          \r\n          for(var i=0;i<items.length;++i) {\r\n            var name = items[i].name;\r\n            if(!(name in itemNames)) {\r\n              itemNames[name] = true;\r\n              itemNamesList.push({\r\n                id: name,\r\n                name: name,\r\n              });\r\n            }\r\n          }\r\n          \r\n          return itemNamesList;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          return item.name == id;\r\n        },\r\n        isItemStep: true,\r\n      },\r\n      numStatsStep: {\r\n        name: 'Num Stats',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas);\r\n          var numStats = {};\r\n          \r\n          for(var i=0;i<items.length;++i) {\r\n            var len = 0;\r\n            for(var j=0;j<items[i].stats.length;++j) {\r\n              var stat = hCodeValues.stats[items[i].stats[j].id];\r\n              if(stat && !stat.hide) {\r\n                len++;\r\n              }\r\n            }\r\n            numStats[len + 'x stats'] = len;\r\n          }\r\n          \r\n          var retVal = [];\r\n          for(var val in numStats) {\r\n            retVal.push({\r\n              id: numStats[val],\r\n              name: val,\r\n            });\r\n          }\r\n          \r\n          retVal = retVal.sort(function(a, b) {\r\n              return a.id - b.id;\r\n            });\r\n          \r\n          return retVal;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          var len = 0;\r\n          for(var j=0;j<item.stats.length;++j) {\r\n            var stat = hCodeValues.stats[item.stats[j].id];\r\n            if(stat && !stat.hide) {\r\n              len++;\r\n            }\r\n          }\r\n            \r\n          return len == id;\r\n        },\r\n        isItemStep: true,\r\n      },\r\n      highStatStep: {\r\n        name: 'High Stat',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas);\r\n            \r\n          var allItem = { id: -1, name: 'all' };\r\n          var retVal = [allItem];\r\n          if(items.length > 1) {\r\n            var allStats = {};\r\n            \r\n            for(var i=0;i<items.length;++i) {\r\n              for(var j=0;j<items[i].stats.length;++j) {\r\n                var stat = hCodeValues.stats[items[i].stats[j].id];\r\n                if(stat && stat.quickHigh && !('high ' + stat.name in allStats)) {\r\n                  allStats['high ' + stat.name] = stat.id;\r\n                }\r\n              }\r\n            }\r\n\r\n            for(var val in allStats) {\r\n              retVal.push({\r\n                id: allStats[val],\r\n                name: val,\r\n              });\r\n            }\r\n            \r\n            if(retVal.length <= 2) {\r\n              retVal = [allItem];\r\n            }\r\n            else {\r\n              retVal = retVal.sort(function(a, b) {\r\n                  return a.id - b.id;\r\n                });\r\n            }\r\n          }\r\n          \r\n          return retVal;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          if(id == -1) {\r\n            return true;\r\n          }\r\n          \r\n          var largestVal = 0;\r\n          var selectedVal = 0;\r\n          \r\n          for(var j=0;j<item.stats.length;++j) {\r\n            var val = item.stats[j];\r\n            var stat = hCodeValues.stats[val.id];\r\n            if(stat.quickHigh) {\r\n              if(val.id == id) {\r\n                selectedVal += val.max;\r\n              }\r\n              else if(val.max > largestVal) {\r\n                largestVal = val.max;\r\n              }\r\n            }\r\n          }\r\n          \r\n          return selectedVal > largestVal;\r\n        },\r\n        sortFunc: function(id, item1, item2) {\r\n          var val1 = 0;\r\n          var val2 = 0;\r\n          \r\n          for(var i=0;i<item1.stats.length;++i) {\r\n            if(item1.stats[i].id == id) {\r\n              val1 = item1.stats[i].max;\r\n              break;\r\n            }\r\n          }\r\n          for(var j=0;j<item2.stats.length;++j) {\r\n            if(item2.stats[j].id == id) {\r\n              val2 = item2.stats[j].max;\r\n              break;\r\n            }\r\n          }\r\n          return val2 - val1;\r\n        },\r\n        isItemStep: false,\r\n        minOptions: 3,\r\n      },\r\n      hasStatStep: {\r\n        name: 'Has Stat',\r\n        getOptions: function(category, build, datas) {\r\n          var items = quickAddHelper.findData(category, build, datas);\r\n            \r\n          var allItem = { id: -1, name: 'all' };\r\n          var retVal = [allItem];\r\n          if(items.length > 1) {\r\n            var allStats = {};\r\n            \r\n            for(var i=0;i<items.length;++i) {\r\n              for(var j=0;j<items[i].stats.length;++j) {\r\n                var stat = hCodeValues.stats[items[i].stats[j].id];\r\n                if(stat && stat.searchable && !('high ' + stat.name in allStats)) {\r\n                  allStats['has ' + stat.name] = stat.id;\r\n                }\r\n              }\r\n            }\r\n\r\n            for(var val in allStats) {\r\n              retVal.push({\r\n                id: allStats[val],\r\n                name: val,\r\n              });\r\n            }\r\n            \r\n            if(retVal.length <= 2) {\r\n              retVal = [allItem];\r\n            }\r\n            else {\r\n              retVal = retVal.sort(function(a, b) {\r\n                  return a.id - b.id;\r\n                });\r\n            }\r\n          }\r\n          \r\n          return retVal;\r\n        },\r\n        matchesItem: function(id, item) {\r\n          if(id == -1) {\r\n            return true;\r\n          }\r\n          \r\n          for(var j=0;j<item.stats.length;++j) {\r\n            var val = item.stats[j];\r\n            var stat = hCodeValues.stats[val.id];\r\n            if(stat.searchable) {\r\n              if(val.id == id) {\r\n                return true;\r\n              }\r\n            }\r\n          }\r\n          \r\n          return false;\r\n        },\r\n        sortFunc: function(id, item1, item2) {\r\n          var val1 = 0;\r\n          var val2 = 0;\r\n          \r\n          for(var i=0;i<item1.stats.length;++i) {\r\n            if(item1.stats[i].id == id) {\r\n              val1 = item1.stats[i].max;\r\n              break;\r\n            }\r\n          }\r\n          for(var j=0;j<item2.stats.length;++j) {\r\n            if(item2.stats[j].id == id) {\r\n              val2 = item2.stats[j].max;\r\n              break;\r\n            }\r\n          }\r\n          return val2 - val1;\r\n        },\r\n        isItemStep: false,\r\n        minOptions: 3,\r\n      },\r\n      customStep: {\r\n        name: 'misc',\r\n        getOptions: function(category, build, datas) {\r\n          return hCodeValues.customItems;\r\n        },\r\n        isItemStep: true,\r\n      },\r\n    }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('region', ['translations','dntReset','dntData','$route',region]);\r\nfunction region(translations,dntReset,dntData,$route) {\r\n  \r\n  var alternativeFiles = {region: 'ALT', name: 'Alternative user specified files', url : ''};\r\n  var hostedFiles =[\r\n      {region: 'sea', name: 'south east asia', url : 'https://seadnfiles.firebaseapp.com'},\r\n      {region: 'na', name: 'north america', url : 'https://dnna.firebaseapp.com'},\r\n      {region: 'eu', name: 'europe', url : 'https://eufiles.firebaseapp.com'},\r\n      {region: 'ina', name: 'indonesia ', url : 'https://inafiles-da491.firebaseapp.com'},\r\n      {region: 'th', name: 'thailand', url : 'https://thdnfiles.firebaseapp.com'},\r\n      {region: 'vn', name: 'vietnam ', url : 'https://vndnfiles.firebaseapp.com'},\r\n      {region: 'tw', name: 'taiwan ', url : 'https://twdnfiles.firebaseapp.com'},\r\n      // {region: 'jdn', name: 'japan ', url : 'https://jdnfiles-59d57.firebaseapp.com'},\r\n      {region: 'cdn', name: 'china ', url : 'https://cdnfiles.firebaseapp.com'},\r\n      {region: 'kdn', name: 'korea ', url : 'https://kdnfiles.firebaseapp.com'},\r\n    ];\r\n  \r\n  var dntLocationRegion = localStorage.getItem('lastDNTRegion');\r\n  var dntLocation = null;\r\n  if(dntLocationRegion) {\r\n    angular.forEach(hostedFiles, function(hostedFile, index) {\r\n      if(hostedFile.region == dntLocationRegion) {\r\n        dntLocation = hostedFile;\r\n      }\r\n    });\r\n  }\r\n\r\n  var lastTFile = localStorage.getItem('UIStrings_file');\r\n  var tlocation = null;\r\n  if(lastTFile) {\r\n    angular.forEach(hostedFiles, function(hostedFile, index) {\r\n      if(hostedFile.region != alternativeFiles.region && lastTFile.indexOf(hostedFile.url) > -1) {\r\n        tlocation = hostedFile;\r\n      }\r\n    });\r\n  }\r\n  \r\n  if(tlocation == null) {\r\n    tlocation = dntLocation;\r\n  }\r\n\r\n  return {\r\n    hostedFiles : hostedFiles,\r\n    alternativeFiles : alternativeFiles,\r\n    dntLocation : dntLocation,\r\n    tlocation : tlocation,\r\n    \r\n    setCustomUrl: function(url) {\r\n      // console.log('setting custom location');\r\n      this.alternativeFiles.url = url;\r\n\r\n      var newFiles = [];\r\n      angular.forEach(hostedFiles, function(hostedFile, index) {\r\n        if(hostedFile.region != alternativeFiles.region) {\r\n          newFiles.push(hostedFile);\r\n        }\r\n      });\r\n  \r\n      newFiles.push(alternativeFiles);\r\n      hostedFiles = newFiles;\r\n      this.hostedFiles = newFiles;\r\n    },\r\n    \r\n    setLocationByName: function(locationName) {\r\n      var newLocation = null;\r\n      \r\n      angular.forEach(hostedFiles, function(hostedFile, index) {\r\n        if(hostedFile.region == locationName) {\r\n          newLocation = hostedFile;\r\n        }\r\n      });\r\n        \r\n      this.setLocation(newLocation);\r\n    },\r\n    \r\n    setLocation: function(location) {\r\n      if(location && location != this.dntLocation) {\r\n        this.dntLocation = location;\r\n        dntReset();\r\n        localStorage.setItem('lastDNTRegion', location.region);\r\n        dntReset();\r\n        $route.reload();\r\n      }\r\n\r\n      var override = this.getOverride();\r\n      if(this.tlocation == null || !override) {\r\n        this.setTLocation(location);\r\n      }\r\n      \r\n      this.init();\r\n      \r\n      // $route.reload();\r\n    },\r\n    \r\n    setTLocation: function(location) {\r\n      \r\n      if(location != this.tlocation) {\r\n        \r\n        this.tlocation = location;\r\n        sessionStorage.removeItem('UIStrings');\r\n        localStorage.removeItem('UIStrings_file');\r\n        dntReset();\r\n        translations.reset();\r\n        if(location) {\r\n          var override = this.getOverride();\r\n          translations.small = !override;\r\n          translations.location = this.tlocation.url;\r\n          translations.region = this.tlocation.region;\r\n          translations.init(function() {}, function() {\r\n            $route.reload();\r\n          });\r\n        }\r\n      }\r\n    },\r\n    \r\n    getOverride: function() {\r\n      if(localStorage.getItem('tOverride')) {\r\n        return true;\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    },\r\n    \r\n    setOverride: function(value) {\r\n      if(!value) {\r\n        localStorage.removeItem('tOverride');\r\n      }\r\n      else {\r\n        localStorage.setItem('tOverride', '1');\r\n      }\r\n      this.setTLocation(this.dntLocation);\r\n    },\r\n    \r\n    init: function() {\r\n      if(this.getOverride()) {\r\n        translations.small = false;\r\n      }\r\n      else {\r\n        this.tLocation = this.dntLocation;\r\n        translations.small = true;\r\n      }\r\n      \r\n      if(this.tlocation) {\r\n        translations.location = this.tlocation.url;\r\n        translations.region = this.tlocation.region;\r\n      }\r\n      dntData.setLocation(this.dntLocation);\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('saveHelper', ['itemCategory',saveHelper]);\r\nfunction saveHelper(itemCategory) {\r\n  return {\r\n    saveItem: function(groupName, item) {\r\n      var groups = this.getSavedItems();\r\n      if(groupName in groups && Array.isArray(groups[groupName].items)) {\r\n        \r\n        groups[groupName].items.push(item);\r\n        groups[groupName].lastUpdate = (new Date()).getTime();\r\n        this.updatedSavedItems(groupName, groups[groupName].items);\r\n      }\r\n      else {\r\n        this.updatedSavedItems(groupName, [item]);\r\n      }\r\n    },\r\n    \r\n    saveBuildSelection : function(buildName, builds) {\r\n      this.setCurrentBuild(buildName);\r\n      if(builds && buildName in builds && builds[buildName].job && builds[buildName].job.id) {\r\n        localStorage.setItem('jobNumber', builds[buildName].job.id);\r\n      }\r\n    },\r\n    \r\n    importGroup: function(groupName, updatedItems) {\r\n      var items = this.getSavedItems();\r\n      groupName = this.getUniqueGroupName(groupName, items);\r\n      this.updatedSavedItems(groupName, updatedItems);\r\n      return groupName;\r\n    },\r\n    \r\n    getUniqueGroupName: function(groupName, existingGroups) {\r\n      var groupNameIndex = 0;\r\n      if(groupName.lastIndexOf(')') == groupName.length-1) {\r\n        var startIndex = groupName.lastIndexOf('(');\r\n        if(startIndex > 0) {\r\n          var foundIndex = Number(groupName.substr(startIndex+1, groupName.length-startIndex-2));\r\n          if(foundIndex > 0) {\r\n            groupNameIndex = foundIndex + 1;\r\n            groupName = groupName.substr(0, startIndex - 1);\r\n          }\r\n        }\r\n      }\r\n      \r\n      var originalName = groupName;\r\n      for(;;) {\r\n        var groupName = originalName;\r\n        if(groupNameIndex > 0) {\r\n          groupName = originalName + ' (' + groupNameIndex + ')';\r\n        }\r\n        \r\n        if(groupName in existingGroups) {\r\n          groupNameIndex++;\r\n        }\r\n        else {\r\n          break;\r\n        }\r\n      }\r\n      \r\n      return groupName;\r\n    },\r\n    \r\n    deleteBuild: function(buildName) {\r\n      var builds = this.getSavedItems();\r\n      if(buildName in builds) {\r\n          delete builds[buildName];\r\n          this.setCurrentBuild(null);\r\n          this.saveBuilds(builds);\r\n      }\r\n    },\r\n    \r\n    updatedSavedItems: function(groupName, updatedItems) {\r\n      var items = this.getSavedItems();\r\n      if(groupName in items) {\r\n        items[groupName].items = updatedItems;\r\n        items[groupName].lastUpdate = (new Date()).getTime();\r\n      }\r\n      else {\r\n        items[groupName] = {items : updatedItems, lastUpdate: (new Date()).getTime()};\r\n          // console.log('created group');\r\n      }\r\n      \r\n      this.saveBuilds(items);\r\n    },\r\n    \r\n    saveBuilds: function(builds) {\r\n      var stringifiedData = JSON.stringify(builds);\r\n      localStorage.setItem('savedItems', LZString.compressToUTF16(stringifiedData));\r\n    },\r\n\r\n    saveBuild: function(oldGroupName, newGroupName, build) {\r\n      this.updateBuild(\r\n        oldGroupName, \r\n        newGroupName,\r\n        build.enemyLevel,\r\n        build.playerLevel,\r\n        build.heroLevel,\r\n        build.job,\r\n        build.damageType,\r\n        build.element,\r\n        build.secondaryElement,\r\n        build.critResist,\r\n        build.eleResist,\r\n        build.enemyStatCaps, \r\n        build.playerStatCaps, \r\n        build.conversions, \r\n        build.baseStats, \r\n        build.heroStats);\r\n    },\r\n    \r\n    updateBuild: function(\r\n      oldGroupName, newGroupName, enemyLevel, playerLevel, heroLevel, job, damageType, element, secondaryElement, critResist, eleResist,\r\n      enemyStatCaps, playerStatCaps, conversions, baseStats, heroStats) {\r\n        \r\n      var savedItems = this.getSavedItems();\r\n      \r\n      if(newGroupName in savedItems || oldGroupName == newGroupName) {\r\n        // console.log('not changing name');\r\n        newGroupName = oldGroupName;\r\n      }\r\n      else if(oldGroupName in savedItems) {\r\n        var group = savedItems[oldGroupName];\r\n        savedItems[newGroupName] = group;\r\n        delete savedItems[oldGroupName];\r\n      }\r\n      \r\n      savedItems[newGroupName].enemyLevel = enemyLevel;\r\n      savedItems[newGroupName].playerLevel = playerLevel;\r\n      savedItems[newGroupName].heroLevel = heroLevel;\r\n      savedItems[newGroupName].job = job;\r\n      savedItems[newGroupName].damageType = damageType;\r\n      savedItems[newGroupName].element = element;\r\n      savedItems[newGroupName].secondaryElement = secondaryElement;\r\n      savedItems[newGroupName].critResist = critResist;\r\n      savedItems[newGroupName].eleResist = eleResist;\r\n      savedItems[newGroupName].enemyStatCaps = enemyStatCaps;\r\n      savedItems[newGroupName].playerStatCaps = playerStatCaps;\r\n      savedItems[newGroupName].conversions = conversions;\r\n      savedItems[newGroupName].baseStats = baseStats;\r\n      savedItems[newGroupName].heroStats = heroStats;\r\n      \r\n      this.saveBuilds(savedItems);\r\n    },\r\n    \r\n    getSavedItems: function() {\r\n      try {\r\n        var stringifiedData = LZString.decompressFromUTF16(localStorage.getItem('savedItems'));\r\n        var savedItems = JSON.parse(stringifiedData);\r\n        return savedItems;\r\n      }\r\n      catch(ex) {\r\n      }\r\n      \r\n      return {};\r\n    },\r\n    \r\n    currentBuild: null,\r\n    getCurrentBuild: function() {\r\n      if(!this.currentBuild) {\r\n        this.currentBuild = localStorage.getItem('currentGroup');\r\n        if(this.currentBuild) {\r\n          var savedItems = this.getSavedItems();\r\n          if(!(this.currentBuild in savedItems)) {\r\n            localStorage.removeItem('currentGroup');\r\n            this.currentBuild = null;\r\n          }\r\n        }\r\n      }\r\n      \r\n      return this.currentBuild;\r\n    },\r\n    \r\n    setCurrentBuild: function(buildName) {\r\n      this.currentBuild = buildName;\r\n      if(!buildName) {\r\n        localStorage.removeItem('currentGroup', buildName);\r\n      }\r\n      else {\r\n        localStorage.setItem('currentGroup', buildName);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('statHelper', ['hCodeValues',statHelper]);\r\nfunction statHelper(hCodeValues) {\r\n\r\n  return {\r\n    \r\n    getSetStats: function(groupItems) {\r\n      var stats = [];\r\n      var sets = {};\r\n      \r\n      angular.forEach(groupItems, function(value, key) {\r\n        if(value !== null && value.setStats != null) {\r\n          if(value.setId in sets) {\r\n            sets[value.setId].numItems++;\r\n          }\r\n          else {\r\n            sets[value.setId] = { numItems : 1, stats : value.setStats };\r\n          }\r\n        }\r\n      });\r\n      \r\n      angular.forEach(sets, function(value, key) {\r\n        angular.forEach(value.stats, function(stat, index) {\r\n          if(stat.needSetNum <= value.numItems) {\r\n            stats.push(stat);\r\n          }\r\n        });\r\n      });\r\n      \r\n      return hCodeValues.mergeStats(stats);\r\n    },\r\n    \r\n    getNumItemsForSet: function(items, setId) {\r\n      var numItems = 0;\r\n      angular.forEach(items, function(value, key) {\r\n        if(value && value.setId && value.setId == setId) {\r\n          numItems++;\r\n        }\r\n      });\r\n      \r\n      return numItems;\r\n    },\r\n    \r\n    getCombinedStats: function(groupItems) {\r\n      var stats = [];\r\n      \r\n      angular.forEach(groupItems, function(value, key) {\r\n        if(value) {\r\n          \r\n          if(value.fullStats) {\r\n            stats = stats.concat(value.fullStats);\r\n          }\r\n          else if(value.stats) {\r\n            stats = stats.concat(value.stats);\r\n          }\r\n        }\r\n      });\r\n      \r\n      return hCodeValues.mergeStats(stats);\r\n    },\r\n    \r\n    getCalculatedStatsFromItems: function(group, items) {\r\n      var nakedStats = this.getNakedStats(group);\r\n      var combinedStats = this.getCombinedStats(items);\r\n      var setStats = this.getSetStats(items);\r\n      var allStats = nakedStats.concat(combinedStats).concat(setStats);\r\n      if(group.heroStats != null && group.heroStats.length > 0) {\r\n        allStats = allStats.concat(group.heroStats);\r\n      }\r\n      allStats = hCodeValues.mergeStats(allStats);\r\n      \r\n      return this.getCalculatedStats(group, allStats);\r\n    },\r\n    \r\n    getCalculatedStats: function(group, combinedStats) {\r\n      \r\n      var retVal = [];\r\n      var statLookup = {};\r\n      if(!group.conversions || !group.enemyStatCaps || !group.playerStatCaps) {\r\n        return [];\r\n      }\r\n      \r\n      angular.forEach(combinedStats, function(stat, index) {\r\n        statLookup[stat.id] = stat;\r\n      });\r\n      \r\n      function getPc(stat) {\r\n        var statDef = hCodeValues.stats[stat.id];\r\n        if(statLookup[statDef.pc]) {\r\n          return Number(statLookup[statDef.pc].max);\r\n        }\r\n        else {\r\n          return 0;\r\n        }\r\n      }\r\n      \r\n      function getSkillPc(stat) {\r\n        var statDef = hCodeValues.stats[stat.id];\r\n        if(statLookup[statDef.skPc]) {\r\n          return Number(statLookup[statDef.skPc].max);\r\n        }\r\n        else {\r\n          return 0;\r\n        }\r\n      }\r\n      \r\n      function applyPc(stat) {\r\n        stat.max = Math.floor(\r\n          stat.max * (1+getPc(stat)) * (1+getSkillPc(stat))\r\n          );\r\n      }\r\n      \r\n      function dupeStat(id) {\r\n        var stat = statLookup[id];\r\n        if(stat) {\r\n          return {id: id, max: Number(stat.max), pc: stat.pc};\r\n        }\r\n        else {\r\n          return {id: id, max: 0, pc: 0};\r\n        }\r\n      }\r\n      \r\n      function addStat(stat) {\r\n        if(stat.max > 0) {\r\n          retVal.push(stat);\r\n        }\r\n      }\r\n\r\n      var critResist;\r\n      if(!('critResist' in group)) {\r\n        critResist = 0.20;\r\n      }\r\n      else {\r\n        critResist = group.critResist / 100.0;\r\n      }\r\n\r\n      var eleResist;\r\n      if(!('eleResist' in group)) {\r\n        eleResist = 0;\r\n      }\r\n      else {\r\n        eleResist = group.eleResist / 100.0;\r\n      }\r\n      \r\n      // base stats\r\n      var str = dupeStat(0);\r\n      applyPc(str);\r\n      addStat(str);\r\n      \r\n      var agi = dupeStat(1);\r\n      applyPc(agi);\r\n      addStat(agi);\r\n      \r\n      var int = dupeStat(2);\r\n      applyPc(int);\r\n      addStat(int);\r\n\r\n      var vit = dupeStat(3);\r\n      applyPc(vit);\r\n      addStat(vit);\r\n\r\n      // add vit to hp\r\n      var hp = dupeStat(25);\r\n      hp.max += (vit.max * Number(group.conversions.HP));\r\n      applyPc(hp);\r\n      addStat(hp);\r\n      \r\n      // defs\r\n      var def = dupeStat(8);\r\n      def.max += (vit.max * Number(group.conversions.PhysicalDefense));\r\n      applyPc(def);\r\n      addStat(def);\r\n      \r\n      var defpc = dupeStat(1008);\r\n      // defpc.max = Math.max(0.85, Number(def.max)/Number(group.enemyStatCaps.Cdefense));\r\n      defpc.max = Math.min(0.85,def.max/Number(group.enemyStatCaps.Cdefense));\r\n      addStat(defpc);\r\n      \r\n      var mdef = dupeStat(9);\r\n      mdef.max += (int.max * Number(group.conversions.MagicDefense));\r\n      applyPc(mdef);\r\n      addStat(mdef);\r\n      \r\n      var mdefpc = dupeStat(1009);\r\n      // mdefpc.max = Math.max(0.85, Number(mdef.max)/Number(group.enemyStatCaps.Cdefense));\r\n      mdefpc.max = Math.min(0.85,mdef.max/Number(group.enemyStatCaps.Cdefense));\r\n      addStat(mdefpc);\r\n      \r\n      // attack power - like fd but for bufs\r\n      // this shows as blue damage\r\n      // i think there are magic and phis variants of this but doesnt matter\r\n      var aPwr = dupeStat(3000);\r\n      \r\n      var minPdmg = dupeStat(4);\r\n      var maxPdmg = dupeStat(5);\r\n\r\n      // physical damage\r\n      if(!group.damageType || group.damageType.id != 2) {\r\n        var extraPdmg = dupeStat(32);\r\n        var extraPdmgMod= dupeStat(101);\r\n        var paPwr = dupeStat(3001);\r\n        \r\n        // special stats for zeal\r\n        var intToPdmg = dupeStat(10164);\r\n        \r\n        minPdmg.max += extraPdmg.max;\r\n        minPdmg.max += Math.floor(str.max*Number(group.conversions.StrengthAttack));\r\n        minPdmg.max += Math.floor(agi.max*Number(group.conversions.AgilityAttack));\r\n        \r\n        minPdmg.max = Math.floor(minPdmg.max*(1+(getPc(minPdmg) + extraPdmgMod.max)));\r\n        minPdmg.max = Math.floor(minPdmg.max * (1+aPwr.max+paPwr.max));\r\n        minPdmg.max += Math.floor(intToPdmg.max * int.max);\r\n        addStat(minPdmg);\r\n  \r\n        maxPdmg.max += extraPdmg.max;\r\n        maxPdmg.max += Math.floor(str.max*Number(group.conversions.StrengthAttack));\r\n        maxPdmg.max += Math.floor(agi.max*Number(group.conversions.AgilityAttack));\r\n        \r\n        maxPdmg.max = Math.floor(maxPdmg.max*(1+(getPc(maxPdmg) + extraPdmgMod.max)));\r\n        maxPdmg.max = Math.floor(maxPdmg.max * (1+aPwr.max+paPwr.max));\r\n        maxPdmg.max += Math.floor(intToPdmg.max * int.max);\r\n        addStat(maxPdmg);\r\n      }\r\n      \r\n      var minMdmg = dupeStat(6);\r\n      var maxMdmg = dupeStat(7);\r\n      \r\n      // magic damage\r\n      if(!group.damageType || group.damageType.id != 1) {\r\n        var extraMdmg = dupeStat(33);\r\n        var extraMdmgMod = dupeStat(102);\r\n        var maPwr = dupeStat(3002);\r\n        \r\n        // special stats for zeal\r\n        var strToMdmg = dupeStat(10165);\r\n        var intToMdmg = dupeStat(10372);\r\n        \r\n        minMdmg.max += extraMdmg.max;\r\n        minMdmg.max += Math.floor(int.max*Number(group.conversions.IntelligenceAttack));\r\n\r\n        minMdmg.max = Math.floor(minMdmg.max*(1+(getPc(minMdmg) + extraMdmgMod.max)));\r\n        minMdmg.max = minMdmg.max * (1+aPwr.max+maPwr.max);\r\n        minMdmg.max += Math.floor(strToMdmg.max * str.max);\r\n        minMdmg.max += Math.floor(intToMdmg.max * int.max);\r\n        addStat(minMdmg);\r\n        \r\n        maxMdmg.max += extraMdmg.max;\r\n        maxMdmg.max += (int.max*Number(group.conversions.IntelligenceAttack));\r\n        \r\n        maxMdmg.max = Math.floor(maxMdmg.max*(1+(getPc(maxMdmg) + extraMdmgMod.max)));\r\n        maxMdmg.max = maxMdmg.max * (1+aPwr.max+maPwr.max);\r\n        maxMdmg.max += Math.floor(strToMdmg.max * str.max);\r\n        maxMdmg.max += Math.floor(intToMdmg.max * int.max);\r\n        addStat(maxMdmg);\r\n      }\r\n      \r\n      \r\n      // crit chance %\r\n      var crit = dupeStat(12);\r\n      crit.max += (agi.max*Number(group.conversions.Critical));\r\n      applyPc(crit);\r\n      \r\n      var skCrit = dupeStat(4012);\r\n      crit.max += skCrit.max;\r\n      addStat(crit);\r\n      var itemCrit = dupeStat(1012);\r\n      \r\n      var critChance = Math.min(0.89, (crit.max / Number(group.enemyStatCaps.Ccritical)) + itemCrit.max);\r\n      retVal.push({id: 1012, max: critChance});\r\n\r\n      // crit damage %\r\n      var cDmg = dupeStat(103);\r\n      cDmg.max += ((str.max+int.max) * Number(group.conversions.StrengthIntelligenceToCriticalDamage));\r\n      applyPc(cDmg);\r\n      addStat(cDmg);\r\n\r\n      var itemCtriDmg = dupeStat(1103);\r\n      var critDamagePc = Math.min(1, (cDmg.max / group.playerStatCaps.CcriticalDamage) + itemCtriDmg.max);\r\n      addStat({id: 1103, max: critDamagePc + 2});\r\n\r\n      // fd\r\n      var fd = dupeStat(29);\r\n      addStat(fd);\r\n      var maxFd = Number(group.enemyStatCaps.Cfinaldamage);\r\n      \r\n      var fdPc = dupeStat(1029);\r\n      fdPc.max += Math.min(Math.max(0.35*Number(fd.max)/maxFd,Math.pow(Number(fd.max)/maxFd,2.2)),1);\r\n      addStat(fdPc);\r\n      \r\n      // elements\r\n      var firePc = dupeStat(16);\r\n      addStat(firePc);\r\n      \r\n      var icePc = dupeStat(17);\r\n      addStat(icePc);\r\n      \r\n      var lightPc = dupeStat(18);\r\n      addStat(lightPc);\r\n      \r\n      var darkPc = dupeStat(19);\r\n      addStat(darkPc);\r\n      \r\n      // average damage\r\n      function addAvgDamageStat(id, min, max) {\r\n        \r\n        var nonEleDamage = (min+max)/2;\r\n        // add crit\r\n        nonEleDamage += (critChance * (critDamagePc+1) * nonEleDamage * (1 - critResist));\r\n        // apply fd\r\n        nonEleDamage = nonEleDamage * (1 + fdPc.max);\r\n        \r\n        // apply element(s)\r\n        var avgDmg = nonEleDamage;\r\n        if(group.element && group.element.id > 0) {\r\n          var elementStat = statLookup[hCodeValues.elements[group.element.id].dmgStat];\r\n          if(elementStat) {\r\n            avgDmg = avgDmg * (1 + Number(elementStat.max)) * (1 - Number(eleResist));\r\n          }\r\n        }\r\n        addStat({id: id, max: avgDmg});\r\n        var secElementId = 0;\r\n        var priElementId = 0;\r\n        if(group.element) {\r\n          priElementId = group.element.id;\r\n        }\r\n        else {\r\n          priElementId = 0;\r\n        }\r\n        if(group.secondaryElement) {\r\n          secElementId = group.secondaryElement.id;\r\n        }\r\n        else {\r\n          secElementId = 0;\r\n        }\r\n        \r\n        if(secElementId != priElementId) {\r\n          if(secElementId > 0) {\r\n            var secondaryElementStat = statLookup[hCodeValues.elements[group.secondaryElement.id].dmgStat];\r\n            if(secondaryElementStat) {\r\n              var secAvgDmg = nonEleDamage * (1+Number(secondaryElementStat.max)) * (1 - Number(eleResist));\r\n              addStat({id: id + 1000, max: secAvgDmg});\r\n            }\r\n          }\r\n          else {\r\n            addStat({id: id + 1000, max: nonEleDamage});\r\n          }\r\n        }\r\n      }\r\n      \r\n      // average damages\r\n      if(!group.damageType || group.damageType.id == 1 || group.damageType.id == 0) {\r\n        addAvgDamageStat(1004, minPdmg.max, maxPdmg.max);\r\n      }\r\n\r\n      if(!group.damageType || group.damageType.id == 2 || group.damageType.id == 0) {\r\n        addAvgDamageStat(1006, minMdmg.max, maxMdmg.max);\r\n      }\r\n      \r\n      if(!group.damageType || group.damageType.id == 3) {\r\n        addAvgDamageStat(1001, minMdmg.max+minPdmg.max, maxMdmg.max+maxPdmg.max);\r\n      }\r\n      \r\n      // Equivalent HP\r\n      var pdefEqHp = dupeStat(2008);\r\n      pdefEqHp.max = hp.max / (1-defpc.max);\r\n      \r\n      var mdefEqHp = dupeStat(2009);\r\n      mdefEqHp.max = hp.max / (1-mdefpc.max);\r\n      \r\n      var eqHp = dupeStat(3008);\r\n      eqHp.max = (pdefEqHp.max + mdefEqHp.max) / 2;\r\n      addStat(eqHp);\r\n      \r\n      return retVal;\r\n    },\r\n    \r\n    getNakedStats: function(group) {\r\n      \r\n      if(\r\n        group.baseStats && \r\n        group.baseStats.Strength > 0) {\r\n\r\n        return [\r\n          {id:0, max:group.baseStats.Strength},\r\n          {id:1, max:group.baseStats.Agility},\r\n          {id:2, max:group.baseStats.Intelligence},\r\n          {id:3, max:group.baseStats.Stamina}\r\n          ];\r\n      }\r\n      else {\r\n        return [];\r\n      }\r\n    },\r\n    \r\n    getSkillStats : function (item, data, skillData) {\r\n\r\n      var skillLevelVals = null;\r\n      angular.forEach(skillData, function(value, index) {\r\n        if(value.SkillIndex == item.id && value.SkillLevel == item.enchantmentNum) {\r\n          skillLevelVals = value;\r\n          return;\r\n        }\r\n      });\r\n      \r\n      if(!skillLevelVals) {\r\n        return null;\r\n      }\r\n      \r\n      var index = 1;\r\n      var effects = [];\r\n      var stillCols = true;\r\n      \r\n      while(stillCols) {\r\n        var colName = 'EffectClass' + index;\r\n        var valColName = 'EffectClassValue' + index;\r\n        if(data && colName in data && valColName in skillLevelVals) {\r\n          if(data[colName] > 0) {\r\n            \r\n            var val = skillLevelVals[valColName];\r\n            \r\n            // for now add 10k\r\n            var effectId = data[colName];\r\n            var map = hCodeValues.skillEffectMapping[effectId];\r\n            if(map && map.getVals) {\r\n              var vals = map.getVals(val);\r\n              for(var i=0;i<vals.length;++i) {\r\n                effects.push(vals[i]);\r\n              }\r\n            }\r\n            else {\r\n              var statId;\r\n              if(map && map.mapTo) {\r\n                statId = map.mapTo;\r\n              }\r\n              else {\r\n                statId = 10000 + effectId;\r\n              }\r\n              \r\n              if(val > 0) {\r\n                effects.push({ id: statId, effect: effectId, max: val });\r\n              }\r\n              else {\r\n                if(val.toString().indexOf(';') > 0) {\r\n                  var vals = val.split(';');\r\n                  if(vals.length > 0 && vals[0] > 0) {\r\n                    effects.push({ id: statId, effect: effectId, max: vals[0] });\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          stillCols = false;\r\n        }\r\n        \r\n        index++;\r\n      }\r\n      \r\n      return effects;\r\n    },\r\n\r\n    getBuildStats: function(build) {\r\n      var stats = {};\r\n      stats.nakedStats = this.getNakedStats(build);\r\n      stats.combinedStats = this.getCombinedStats(build.items);\r\n      stats.setStats = this.getSetStats(build.items);\r\n      stats.allStats = stats.nakedStats.concat(stats.combinedStats).concat(stats.setStats);\r\n      if(build.heroStats && build.heroStats.length) {\r\n        stats.heroStats = build.heroStats;\r\n        stats.allStats = stats.allStats.concat(build.heroStats);\r\n      }\r\n      stats.allStats = hCodeValues.mergeStats(stats.allStats);\r\n      \r\n      stats.calculatedStats = this.getCalculatedStats(build, stats.allStats);\r\n      return stats;\r\n    }\r\n  };\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('translations', ['$routeParams', '$rootScope', 'uiTranslations', '$translate', translations]);\r\nfunction translations($routeParams, $rootScope, uiTranslations, $translate) {\r\n\r\n  var dnTranslations = new DnTranslations();\r\n  var smallFile = 'uistring.optimised.lzjson';\r\n  var bigFile = 'uistring.lzjson';\r\n\r\n  var completeCallback = [];\r\n  var progressCallback = [];\r\n\r\n  return {\r\n\r\n    getRawData: function() {\r\n      return dnTranslations.data;\r\n    },\r\n    \r\n    reset : function() {\r\n      dnTranslations = new DnTranslations();\r\n      dnTranslations.sizeLimit = 100;\r\n      this.loaded = false;\r\n      this.startedLoading = false;\r\n      completeCallback = [];\r\n      progressCallback = [];\r\n    },\r\n    \r\n    getFileName: function() {\r\n      if(this.small) {\r\n        // console.log('loading optimised translations');\r\n        return smallFile;\r\n      }\r\n      else {\r\n        // console.log('loading full translations');\r\n        return bigFile;\r\n      }\r\n    },\r\n    \r\n    loaded : false,\r\n    startedLoading : false,\r\n    small: false,\r\n    \r\n    location : null,\r\n    region: null,\r\n  \r\n    init : function(progress, complete) {\r\n\r\n      if(this.isLoaded()) {\r\n        complete();\r\n      }\r\n      else {\r\n        progressCallback = [];\r\n        if(progress) {\r\n          progressCallback.push(progress);\r\n        }\r\n        if(complete) {\r\n          completeCallback.push(complete);\r\n        }\r\n  \r\n        if(!this.startedLoading) {\r\n          this.startedLoading = true;\r\n          var t = this;\r\n          \r\n          var fileName = null;\r\n          if(this.location && this.location != '') {\r\n            fileName = this.location + '/' + this.getFileName();\r\n            \r\n            if(fileName != localStorage.getItem(\"UIStrings_file\")) {\r\n              sessionStorage.removeItem('UIStrings');\r\n              localStorage.removeItem('UIStrings_file');\r\n            }\r\n          }\r\n          \r\n          $rootScope.$broadcast('TRANSLATION_LOAD_EVENT');\r\n          dnTranslations.loadDefaultFile(\r\n            fileName, \r\n            function(msg) {\r\n              angular.forEach(progressCallback, function(value, key) { value(msg); });\r\n            }, \r\n            function() {\r\n              uiTranslations.addTranslations(t.region, t.getRawData());\r\n              // console.log('using ', t.region);\r\n              $translate.use(t.region);\r\n              t.loaded = true;\r\n              angular.forEach(completeCallback, function(value, key) { value(); });\r\n              completeCallback = [];\r\n              $rootScope.$broadcast('TRANSLATION_LOAD_EVENT');\r\n            },\r\n            function(msg) {\r\n              angular.forEach(progressCallback, function(value, key) { value(msg); });\r\n              $rootScope.$broadcast('TRANSLATION_LOAD_ERROR');\r\n              t.startedLoading = false;\r\n              t.loaded = false;\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    \r\n    isLoaded : function() {\r\n      if(!this.loaded) {\r\n        var fileName = this.location + '/' + this.getFileName();\r\n        \r\n        if(fileName != localStorage.getItem(\"UIStrings_file\")) {\r\n          sessionStorage.removeItem('UIStrings');\r\n          localStorage.removeItem('UIStrings_file');\r\n        }\r\n\r\n        this.loaded = dnTranslations.loadFromSession();\r\n        if(this.loaded) {\r\n          uiTranslations.addTranslations(this.region, this.getRawData());\r\n          $translate.use(this.region);\r\n          this.startedLoading = true;\r\n        }\r\n      }\r\n      return this.loaded;\r\n    },\r\n    \r\n    translate : function(id,idParam) {\r\n      if(this.loaded) {\r\n        try {\r\n          var name;\r\n          if(!id) {\r\n            return '';\r\n          }\r\n          else {\r\n            name = dnTranslations.translate(id);\r\n            \r\n            if(typeof name != 'string') {\r\n              return 'm' + name;\r\n            }\r\n          }\r\n          \r\n          if(idParam && name) {\r\n            \r\n            if(typeof idParam === 'string') {\r\n              var params = idParam.split(',');\r\n              for(var p=0;p<params.length;++p) {\r\n                var pid = params[p];\r\n                if(pid.indexOf('{') == 0) {\r\n                  pid = params[p].replace(/\\{|\\}/g,'');\r\n                  pid = dnTranslations.translate(pid);\r\n                }\r\n                \r\n                name = name.replace('{' + p + '}', pid);\r\n              }\r\n            }\r\n            else {\r\n              name = name.replace('{0}', idParam);\r\n            }\r\n          }\r\n\r\n          return name;\r\n        }\r\n        catch(ex) {\r\n          console.log('unable to translate', id, idParam, ex);\r\n        }\r\n      }\r\n\r\n      return 'm' + id;\r\n    }\r\n  }\r\n}\r\n\r\n})();","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('uiTranslations', uiTranslations);\r\n\r\n// translations for each region go in here\r\n// the key is the english text\r\nvar uiTranslationLookup = {\r\n    cdn: {\r\n        'dragon nest gear simulator': '',\r\n        'enemy lvl': '',\r\n        'damage type': '',\r\n        'player lvl': '',\r\n        'hero level stats': '',\r\n        'naked stats': '',\r\n        'stat affects': '',\r\n        'str': '',\r\n        'agi': '',\r\n        'int': '',\r\n        'builds': '',\r\n        'search': '',\r\n        'select region': '',\r\n        'create a new build': '',\r\n        'import': '',\r\n        'publish': '',\r\n        'find a build': '',\r\n        'about': '',\r\n        'import a build from a json build file': 'json',\r\n        'log in and publish your builds online': '',\r\n        'vit': '',\r\n        'fd': '',\r\n        'pdmg': '',\r\n        'mdmg': '',\r\n        'crit': '',\r\n        'cdmg': '',\r\n        'fire%': '',\r\n        'ice%': '',\r\n        'light%': '',\r\n        'dark%': '',\r\n        'pdef': '',\r\n        'mdef': '',\r\n        'weapons': '',\r\n        'armour': '',\r\n        'techs': '',\r\n        'titles': '',\r\n        'expedition plates': '',\r\n        'enhancement plates': '',\r\n        'increasing gems': '',\r\n        'offensive gems': '',\r\n        'back': '',\r\n        'cancel': '',\r\n        'epic': 'A',\r\n        'unique': 'S',\r\n        'legendary': 'L',\r\n        'quick add': '',\r\n        'hero lvl': ''\r\n    },\r\n    sea: {\r\n        'offensive gems':  'offensive jades',\r\n        'increasing gems':  'increasing jades',\r\n        'expedition plates': 'unique heraldry',\r\n        'enhancement plates': 'normal heraldry',\r\n        'techs': 'skill accessory',\r\n    },\r\n};\r\n\r\n// this function gets called on language change to add the translations to the main list\r\nfunction uiTranslations($routeParams, $rootScope) {\r\n    return {\r\n        addTranslations: function(region, data) {\r\n            if(region && data && region in uiTranslationLookup) {\r\n                var regionData = uiTranslationLookup[region];\r\n                for(var key in regionData) {\r\n                    data[key] = regionData[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n})();\r\n","(function () {\r\n'use strict';\r\n\r\nangular.module('dnsim').factory('hCodeValues', [hCodeValues]);\r\nfunction hCodeValues() {\r\n\r\n  function toOneDec(stat) {\r\n    return Math.round(stat.max*10)/10;\r\n  }\r\n  function toNoDec(stat) {\r\n    return Math.floor(stat.max);\r\n  }\r\n  function inThousands(stat) {\r\n    var val = Number(stat.max);\r\n    if(val < 100) {\r\n      return val;\r\n    }\r\n    else if(val < 100000) {\r\n      return Math.round(val/100)/10 + 'k';\r\n    }\r\n    else if(val < 1000000) {\r\n      return Math.round(val/1000) + 'k';\r\n    }\r\n    else if(val < 10000000) {\r\n      return Math.round(val/10000)/100 + 'm';\r\n    }\r\n    else {\r\n      return Math.round(val/1000000) + 'm';\r\n    }\r\n  }\r\n  function toPercent(stat) {\r\n    return (Math.round(stat.max*10000)/100) + '%';\r\n  }\r\n  \r\n  return {\r\n    stats : {\r\n      0  : {id: 0, name: 'str', display: inThousands, dps: true, pc: 50, skPc: 4050, searchable: true, quickHigh: true },\r\n      1  : {id: 1, name: 'agi', display: inThousands, dps: true, pc: 51, skPc: 4051, searchable: true, quickHigh: true },\r\n      2  : {id: 2, name: 'int', display: inThousands, dps: true, pc: 52, skPc: 4052, searchable: true, quickHigh: true },\r\n      3  : {id: 3, name: 'vit', display: inThousands, def: true, pc: 53, skPc: 4053, searchable: true, quickHigh: true },\r\n      4  : {id: 4, name: 'pdmg', display: inThousands, combineWith: 5, dps: true, pc: 54, searchable: true, altStat: 32, quickHigh: true },\r\n      5  : {id: 5, name: 'maxPdmg', display: inThousands, hide: true, pc: 55 },\r\n      6  : {id: 6, name: 'mdmg', display: inThousands, combineWith: 7, dps: true, pc: 56, searchable: true, altStat: 33, quickHigh: true },\r\n      7  : {id: 7, name: 'maxMdmg', display: inThousands, hide: true, pc: 57 },\r\n      8  : {id: 8, name: 'pdef', display: inThousands, def: true, pc: 58, searchable: true },\r\n      9  : {id: 9, name: 'mdef', display: inThousands, def: true, pc: 59, searchable: true },\r\n      10 : {id: 10, name: 'para', display: inThousands, pc: 60, noCustom: true },\r\n      11 : {id: 11, name: 'para resist', display: inThousands, pc: 61, noCustom: true },\r\n      12 : {id: 12, name: 'crit', display: inThousands, dps: true, pc: 62, searchable: true },\r\n      13 : {id: 13, name: 'crit resist', display: inThousands, pc: 63, noCustom: true },\r\n      14 : {id: 14, name: 'stun', display: inThousands, pc: 64, noCustom: true },\r\n      15 : {id: 15, name: 'stun resist', display: inThousands, pc: 65, noCustom: true },\r\n      16 : {id: 16, name: 'fire%', display: toPercent, dps: true, searchable: true },\r\n      17 : {id: 17, name: 'ice%', display: toPercent, dps: true, searchable: true },\r\n      18 : {id: 18, name: 'light%', display: toPercent, dps: true, searchable: true },\r\n      19 : {id: 19, name: 'dark%', display: toPercent, dps: true, searchable: true },\r\n      20 : {id: 20, name: 'fire def', display: toPercent, def: true, searchable: true },\r\n      21 : {id: 21, name: 'ice def', display: toPercent, def: true, searchable: true },\r\n      22 : {id: 22, name: 'light def', display: toPercent, def: true, searchable: true },\r\n      23 : {id: 23, name: 'dark def', display: toPercent, def: true, searchable: true },\r\n      25 : {id: 25, name: 'hp', display: inThousands, def: true, pc: 75, skPc: 4075, searchable: true },\r\n      26 : {id: 26, name: 'mp', display: inThousands, def: true, pc: 76, skPc: 4076 },\r\n      29 : {id: 29, name: 'fd', display: toNoDec, dps: true, searchable: true },\r\n      \r\n      // these are both min and max\r\n      // shows with the same name but these are used really just for set bonus I think\r\n      32 : {id: 32, name: 'pdmg', display: toNoDec, dps: true, pc: 54, quickHigh: true },\r\n      33 : {id: 33, name: 'mdmg', display: toNoDec, dps: true, pc: 56, quickHigh: true },\r\n      \r\n      50 : {id: 50, name: 'str%', display: toPercent, dps: true },\r\n      51 : {id: 51, name: 'agi%', display: toPercent, dps: true },\r\n      52 : {id: 52, name: 'int%', display: toPercent, dps: true },\r\n      53 : {id: 53, name: 'vit%', display: toPercent, def: true },\r\n      54 : {id: 54, name: 'pdmg%', display: toPercent, combineWith: 55, dps: true },\r\n      55 : {id: 55, name: 'maxPdmg%', display: toPercent, hide: true },\r\n      56 : {id: 56, name: 'mdmg%', display: toPercent, combineWith: 57, dps: true },\r\n      57 : {id: 57, name: 'maxMdmg%', display: toPercent, hide: true },\r\n      58 : {id: 58, name: 'pdef%', display: toPercent, def: true },\r\n      59 : {id: 59, name: 'mdef%', display: toPercent, def: true },\r\n      60 : {id: 60, name: 'para%', display: toPercent, noCustom: true, def: true },\r\n      61 : {id: 61, name: 'para resist%', display: toPercent, noCustom: true, def: true },\r\n      62 : {id: 62, name: 'crit%', display: toPercent, dps: true },\r\n      63 : {id: 63, name: 'crit resist%', display: toPercent, def: true },\r\n      64 : {id: 64, name: 'stun%', display: toPercent, noCustom: true, def: true },\r\n      65 : {id: 65, name: 'stun resist%', display: toPercent, noCustom: true, def: true },\r\n      74 : {id: 74, name: 'move%', display: toPercent, noCustom: true, def: true },\r\n      75 : {id: 75, name: 'hp%', display: toPercent, def: true },\r\n      76 : {id: 76, name: 'mp%', display: toPercent, def: true },\r\n      77 : {id: 77, name: 'mp recover%', display: toPercent, def: true },\r\n      81 : {id: 81, name: 'safe move%', display: toPercent, noCustom: true, def: true },\r\n\r\n      // these are both min and max\r\n      // shows with the same name but these are used really just for set bonus I think\r\n      101 : {id: 101, name: 'pdmg%', display: toPercent, noCustom: true, dps: true, quickHigh: true },\r\n      102 : {id: 102, name: 'mdmg%', display: toPercent, noCustom: true, dps: true, quickHigh: true },\r\n\r\n      103: {id: 103, name: 'cdmg', display: inThousands, dps: true, pc: 104, searchable: true },\r\n      104: {id: 104, name: 'crit dmg%', display: toPercent, noCustom: true, dps: true },\r\n      105: {id: 104, name: 'pvp dmg', display: inThousands, noCustom: true, dps: true },\r\n      106: {id: 106, name: 'pvp def', display: inThousands, noCustom: true, def: true },\r\n      107: {id: 107, name: 'mp?', display: toNoDec, noCustom: true, hide: true, def: true },\r\n      \r\n      // stats below here are ones I made up\r\n      1001: {id: 1001, name: 'dmg', display: inThousands, summaryDisplay: true, element: 'primary', noCustom: true, hide: true },\r\n      1004: {id: 1004, name: 'pdmg', display: inThousands, summaryDisplay: true, element: 'primary', noCustom: true, hide: true },\r\n      1006: {id: 1006, name: 'mdmg', display: inThousands, summaryDisplay: true, element: 'primary', noCustom: true, hide: true },\r\n      \r\n      1008: {id: 1008, name: 'pdef', display: toPercent, noCustom: true, summaryFor: 8 },\r\n      1009: {id: 1009, name: 'mdef', display: toPercent, noCustom: true, summaryFor: 9 },\r\n      \r\n      1012: {id: 1012, name: 'crit chance', display: toPercent, noCustom: true, dps: true, summaryFor: 12 },\r\n      1029: {id: 1029, name: 'fd', display: toPercent, noCustom: true, dps: true, summaryFor: 29 },\r\n      1103: {id: 1103, name: 'crit dmg', display: toPercent, noCustom: true, dps: true, summaryFor: 103 },\r\n      \r\n      2001: {id: 2001, name: 'dmg', display: inThousands, summaryDisplay: true, element: 'secondary', noCustom: true, hide: true },\r\n      2004: {id: 2004, name: 'pdmg', display: inThousands, summaryDisplay: true, element: 'secondary', noCustom: true, hide: true },\r\n      2006: {id: 2006, name: 'mdmg', display: inThousands, summaryDisplay: true, element: 'secondary', noCustom: true, hide: true },\r\n      \r\n      2008: {id: 2008, name: 'pdef eqhp', display: inThousands, noCustom: true },\r\n      2009: {id: 2009, name: 'mdef eqhp', display: inThousands, noCustom: true },\r\n      \r\n      3000: {id: 3000, name: 'skDmg%', display: toPercent, dps: true },\r\n      3001: {id: 3001, name: 'skPDmg%', display: toPercent, dps: true },\r\n      3002: {id: 3002, name: 'skMDmg%', display: toPercent, dps: true },\r\n      \r\n      3008: {id: 3008, name: 'eqhp', display: inThousands, summaryDisplay: true, noCustom: true, hide: true },\r\n      \r\n      4012: {id: 4012, name: 'skCrit', display: inThousands, dps: true },\r\n      4050: {id: 4050, name: 'skStr%', display: toPercent, dps: true },\r\n      4051: {id: 4051, name: 'skAgi%', display: toPercent, dps: true },\r\n      4052: {id: 4052, name: 'skInt%', display: toPercent, dps: true },\r\n      4053: {id: 4053, name: 'skVit%', display: toPercent, def: true },\r\n      4075: {id: 4075, name: 'skHp%', display: toPercent, def: true },\r\n      4076: {id: 4076, name: 'skMp%', display: toPercent, def: true },\r\n      \r\n      // special cases for skills\r\n      10164: {id: 10164, name: 'intToPdmg', display: toPercent, noCustom: true, dps: true },\r\n      10165: {id: 10165, name: 'strToMdmg', display: toPercent, noCustom: true, dps: true },\r\n      10372: {id: 10372, name: 'intToMdmg', display: toPercent, noCustom: true, dps: true },\r\n      // items over 10000 are unknown skill effects\r\n    },\r\n  \r\n    rankNames : {\r\n      0 : { id: 0, name : 'normal' },\r\n      1 : { id: 1, name : 'magic' },\r\n      2 : { id: 2, name : 'rare' },\r\n      3 : { id: 3, name : 'epic' },\r\n      4 : { id: 4, name : 'unique' },\r\n      5 : { id: 5, name : 'legendary' },\r\n      // 6 : { id: 6, name : 'divine' },\r\n    },\r\n    \r\n    shopNames : {\r\n      28001: 'lament',28002: 'lament',28003: 'lament',28004: 'lament',28005: 'lament',28006: 'lament',28007: 'lament',28008: 'lament',28009: 'lament',28101: 'lament',\r\n      29001: 'aura',29002: 'aura',29003: 'aura',29004: 'aura',29005: 'aura',29006: 'aura',29007: 'aura',29008: 'aura',29009: 'aura',\r\n      5001: 'medal',5002: 'medal',5003: 'medal',5004: 'medal',5005: 'medal',5006: 'medal',5007: 'medal',5008: 'medal',5009: 'medal',\r\n      5101: 'ladder',5102: 'ladder',5103: 'ladder',5104: 'ladder',5105: 'ladder',5106: 'ladder',5107: 'ladder',5108: 'ladder',5109: 'ladder',\r\n      59001: 'garden bunny',\r\n      52001 : 'nightmare', 52002 : 'nightmare', 52003 : 'nightmare', 52004 : 'nightmare', 52005 : 'nightmare', 52006 : 'nightmare', 52007 : 'nightmare', 52008 : 'nightmare', 52009 : 'nightmare',\r\n      21: 'blacksmith', 22: 'blacksmith', 23: 'blacksmith', 24: 'blacksmith', 25: 'blacksmith', 26: 'blacksmith', 27: 'blacksmith', 28: 'blacksmith', 29: 'blacksmith', \r\n      89001: 'guild master',\r\n      88001: 'battlefield', 88002: 'battlefield', 88003: 'battlefield', 88004: 'battlefield', 88005: 'battlefield', 88006: 'battlefield', 88007: 'battlefield', 88008: 'battlefield', 88009: 'battlefield', \r\n      66001: 'erosion',\r\n      35006: 'plate',\r\n      14051: 'abyss', 14052: 'abyss', 14053: 'abyss', 14054: 'abyss', 14055: 'abyss', 14056: 'abyss', 14057: 'abyss', 14058: 'abyss', 14059: 'abyss', \r\n      40011: 'daredevil faire', 40012: 'daredevil faire', 40013: 'daredevil faire', 40014: 'daredevil faire', 40015: 'daredevil faire', 40016: 'daredevil faire', 40017: 'daredevil faire', 40018: 'daredevil faire',\r\n      40001: 'daredevil faire', 40002: 'daredevil faire', 40111: 'daredevil faire',\r\n      91001: 'wrath',\r\n      45001: 'farm',\r\n      100004: 'event',\r\n      89000: 'nightmare'\r\n    },\r\n    \r\n    checkedRank : {\r\n      0 : true,\r\n      1 : true,\r\n      2 : true,\r\n      3 : true,\r\n      4 : true,\r\n      5 : true,\r\n    },\r\n    \r\n    typeNames : {\r\n      0 : 'weapons',\r\n      1 : 'equipment',\r\n      5 : 'plates',\r\n      8 : 'pouch',\r\n      38 : 'plates',\r\n      90 : 'welspring',\r\n      132 : 'talisman',\r\n      139 : 'gems',\r\n    },\r\n    \r\n    elements : {\r\n      0 : { id: 0, name: 'non-ele' },\r\n      1 : { id: 1, name: 'fire', dmgStat: 16 },\r\n      2 : { id: 2, name: 'ice', dmgStat: 17 },\r\n      3 : { id: 3, name: 'light', dmgStat: 18 },\r\n      4 : { id: 4, name: 'dark', dmgStat: 19 },\r\n    },\r\n    \r\n    damageTypes : {\r\n      0 : { id: 0, name: 'both separate' },\r\n      1 : { id: 1, name: 'physical' },\r\n      2 : { id: 2, name: 'magical' },\r\n      3 : { id: 3, name: 'both combined' },\r\n    },\r\n    \r\n    // note: skills shown on-screen have 1k added to their id\r\n    skillEffectMapping : {\r\n      2 : { id: 2, name: 'phyisical attack power', mapTo: 3001 },\r\n      13 : { id: 13, name: 'mp', mapTo: 26 },\r\n      25 : { id: 25, name: 'action speed' },\r\n      29 : { id: 29, name: 'magic attack power', mapTo: 3002 },\r\n      32 : { id: 32, name: 'fire %', mapTo: 16 },\r\n      33 : { id: 33, name: 'ice %', mapTo: 17 },\r\n      34 : { id: 34, name: 'light %', mapTo: 18 },\r\n      35 : { id: 35, name: 'dark %', mapTo: 19 },\r\n      36 : { id: 36, name: 'fire def', mapTo: 20 },\r\n      37 : { id: 37, name: 'ice def', mapTo: 21 },\r\n      38 : { id: 38, name: 'light def', mapTo: 22 },\r\n      39 : { id: 39, name: 'dark def', mapTo: 23 },\r\n      58 : { id: 58, name: 'hp%', mapTo: 4075 },\r\n      59 : { id: 59, name: 'mp%', mapTo: 4076 },\r\n      65 : { id: 65, name: 'range' },\r\n      76 : { id: 76, name: 'movement speed', mapTo: 74 },\r\n      87 : { id: 87, name: 'str%', mapTo: 4050 },\r\n      88 : { id: 88, name: 'agi%', mapTo: 4051 },\r\n      89 : { id: 89, name: 'int%', mapTo: 4052 },\r\n      90 : { id: 90, name: 'vit%', mapTo: 4053 },\r\n      // 134 : { id: 134, name: 'p dmg reduction%' },\r\n      // 135 : { id: 135, name: 'm dmg reduction%' },\r\n      185 : { id: 185, name: 'wots attack power', mapTo: 3000 },\r\n      251 : { id: 251, name: 'critical chance%', mapTo: 1012 },\r\n      164 : { id: 164, name: 'intToPdmg', mapTo: 10164 },\r\n      165 : { id: 165, name: 'strToMdmg', mapTo: 10165 },\r\n      222: {\r\n        id: 222, \r\n        name: 'hellfire', \r\n        getVals: function(val) {\r\n          if(val.indexOf(';') > 0) {\r\n            var vals = val.split(';');\r\n            return [\r\n              {id: 62, effect: 222, max: Number(vals[0])/100.0},\r\n              {id: 4012, effect: 222, max: Number(vals[1])},\r\n              ];\r\n          }\r\n          else {\r\n            return [{id: 62, effect: 222, max: Number(val)/100.0}];\r\n          }\r\n        }\r\n      },\r\n      372: {\r\n        id: 372,\r\n        name: 'statConversion',\r\n        getVals: function(val) {\r\n          if(val.indexOf(';') > 0) {\r\n            var vals = val.split(';');\r\n            if(vals.length == 3 && vals[0] == 2 && vals[2] == 6) {\r\n              return [{ id: 10372, name: 'intToMdmg', max: Number(vals[1]) }];\r\n            }\r\n          }\r\n          return [];\r\n        }\r\n      },\r\n      \r\n      \r\n      389: { id: 389, name: 'fd buf', mapTo: 1029 },\r\n      404: { id: 404, name: 'critical damage%', mapTo: 1103 },\r\n    },\r\n    \r\n    gemExchanges: [\r\n      {id: 2, exchange: 1, name: 'Weapon'},\r\n      {id: 3, exchange: 2, name: 'Off-Hand Weapon'},\r\n      {id: 4, exchange: 3, name: 'Headgear'},\r\n      {id: 5, exchange: 4, name: 'Body Armor'},\r\n      {id: 6, exchange: 5, name: 'Leg Armor'},\r\n      {id: 7, exchange: 6, name: 'Gloves'},\r\n      {id: 8, exchange: 7, name: 'Shoes'},\r\n      {id: 101, exchange: 8, name: 'Necklace'},\r\n      {id: 102, exchange: 9, name: 'Earrings'},\r\n      {id: 103, exchange: 10, name: 'Ring'},\r\n    ],\r\n    \r\n    customItems: \r\n    [\r\n    {id: 0, typeName:'custom', name: 'hp unified', stats: [{id: 4075, max:0.05}]},\r\n    ],\r\n  \r\n    getStats : function(data) {\r\n\r\n      var useMax=false;\r\n      var useStateXVal=false;\r\n      var mightHaveSets=true;\r\n      var prop = 'State1_Max';\r\n      if(prop in data) {\r\n        useMax = true;\r\n      }\r\n      else {\r\n        prop = 'State1Value';\r\n        if(prop in data) {\r\n          useStateXVal = true;\r\n        }\r\n      }\r\n      \r\n      var currentState = 0;\r\n      var statVals = [];\r\n      for(;;) {\r\n        currentState++;\r\n        \r\n        var stateProp = 'State' + currentState;\r\n        if(!(stateProp in data)) {\r\n          break;\r\n        }\r\n\r\n        var stateId = data[stateProp];\r\n        if(stateId == -1) {\r\n          break;\r\n        }\r\n        \r\n        if(stateId == 107) {\r\n          // is this mp?\r\n        }\r\n        else {\r\n          \r\n          var currentData = { id: stateId };\r\n          \r\n          var prop;\r\n        \r\n          if(useMax) {\r\n            prop = 'State' + currentState + '_Max';\r\n            currentData.max = data[prop];\r\n          }\r\n          else if(useStateXVal) {\r\n            prop = 'State' + currentState + 'Value';\r\n            currentData.max = data[prop];\r\n          }\r\n          else {\r\n            prop = 'StateValue' + currentState;\r\n            currentData.max = Number(data[prop]);\r\n          }\r\n          \r\n          if(currentData.max > 0 || currentData.max < 0) {\r\n            if(mightHaveSets) {\r\n              prop = 'NeedSetNum' + currentState;\r\n              if(prop in data) {\r\n                if(data[prop] == 0) {\r\n                  break;\r\n                }\r\n                currentData.needSetNum = data[prop];\r\n              }\r\n              else {\r\n                mightHaveSets = false;\r\n              }\r\n            }\r\n          \r\n            statVals.push(currentData);\r\n          }\r\n        }\r\n      }\r\n      \r\n      return statVals;\r\n    },\r\n    \r\n    setupStat : function(stat, id) {\r\n      stat.id = Number(id);\r\n    },\r\n    \r\n    mergeStats : function(stats1, stats2) {\r\n      var statMap = {};\r\n      \r\n      var self = this;\r\n      function add(value) {\r\n        \r\n        var amount = Number(value.max);\r\n        if(self.stats[value.id] && 'pc' in self.stats[value.id]) {\r\n          amount = Math.floor(amount);\r\n        }\r\n        \r\n        if(value.id in statMap) {\r\n          statMap[value.id] += amount;\r\n        }\r\n        else {\r\n          statMap[value.id] = amount;\r\n        }\r\n      }\r\n      \r\n      angular.forEach(stats1, function(value, key) {\r\n        if(value) {\r\n          add(value);\r\n        }\r\n      });\r\n      \r\n      if(stats2) {\r\n        angular.forEach(stats2, function(value, key) {\r\n          if(value) {\r\n            add(value);\r\n          }\r\n        });\r\n      }\r\n      \r\n      var newStats = [];\r\n      \r\n      for(var key in statMap) {\r\n        var stat = { max : statMap[key], id: Number(key) };\r\n        newStats.push(stat);\r\n      }\r\n        \r\n      return newStats;\r\n    }\r\n  }\r\n}\r\n\r\n})();"]}